<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™‚äº‹äººç”Ÿ V8.0ï¼šé«”åŠ›åˆ¶</title>
    <style>
        :root { --bg: #121212; --card: #1e1e1e; --accent: #bb86fc; --text: #e0e0e0; --green: #03dac6; --red: #cf6679; --gold: #ffd700; --blue: #2196f3; }
        body { font-family: 'å¾®è»Ÿæ­£é»‘é«”', sans-serif; background: var(--bg); color: var(--text); max-width: 600px; margin: 0 auto; padding-bottom: 80px; user-select: none; overflow-x: hidden; }
        
        /* é ‚éƒ¨ç‹€æ…‹åˆ— */
        .header { background: #2c2c2c; padding: 10px 15px; position: sticky; top: 0; z-index: 50; box-shadow: 0 2px 8px rgba(0,0,0,0.6); }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; font-size: 0.9em; text-align: center; }
        .big-stat { font-size: 1.2em; font-weight: bold; color: var(--gold); grid-column: span 3; margin-bottom: 5px; }
        
        /* ğŸ”¥ æ–°å¢ï¼šé«”åŠ›æ¢æ¨£å¼ ğŸ”¥ */
        .stamina-container { grid-column: span 3; margin-top: 5px; text-align: left; }
        .stamina-label { font-size: 0.8em; color: var(--blue); margin-bottom: 2px; display: flex; justify-content: space-between; }
        .progress-bg { background: #444; height: 8px; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--blue); transition: width 0.3s ease; }
        .progress-fill.low { background: var(--red); } /* é«”åŠ›ä½æ™‚è®Šç´…è‰² */

        /* åœ–ç‰‡èˆ‡å¡ç‰‡ */
        .img-banner { width: 100%; height: 150px; object-fit: cover; border-radius: 8px 8px 0 0; display: block; background: #333; }
        .item-img { width: 60px; height: 60px; object-fit: cover; border-radius: 8px; margin-right: 10px; background: #333; }
        .card { background: var(--card); border-radius: 10px; margin: 15px 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); overflow: hidden; }
        .card-body { padding: 15px; }
        .card h3 { margin-top: 0; color: var(--accent); border-bottom: 1px solid #333; padding-bottom: 10px; }

        /* æŒ‰éˆ•ç¾¤çµ„ */
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button { background: #333; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; transition: 0.2s; font-size: 1em; position: relative; overflow: hidden; }
        button:hover { background: #444; filter: brightness(1.2); }
        
        /* é«”åŠ›ä¸è¶³æ™‚çš„æŒ‰éˆ•æ¨£å¼ */
        button:disabled { opacity: 0.4; cursor: not-allowed; filter: grayscale(1); }
        
        /* è¡Œå‹•æ¶ˆè€—æç¤º (å°å­—) */
        .cost-tag { font-size: 0.7em; color: #aaa; display: block; margin-top: 2px; }

        .btn-buy { background: var(--green); color: black; font-weight: bold; }
        .btn-risk { background: var(--red); color: white; }
        .btn-main { background: var(--accent); color: black; font-weight: bold; width: 100%; margin-top: 10px; font-size: 1.1em; }
        .btn-main.pulse { animation: pulse 1.5s infinite; } /* å¼·åˆ¶ä¸‹ä¸€æ­²æ™‚æŒ‰éˆ•é–ƒçˆ */

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(187, 134, 252, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(187, 134, 252, 0); } 100% { box-shadow: 0 0 0 0 rgba(187, 134, 252, 0); } }

        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: #000; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #333; z-index: 50; }
        .nav-item { color: #888; cursor: pointer; text-align: center; font-size: 0.8em; }
        .nav-item.active { color: var(--accent); font-weight: bold; }
        .nav-icon { display: block; font-size: 1.5em; margin-bottom: 2px; }

        .page { display: none; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        .log-box { height: 120px; overflow-y: auto; background: #111; padding: 10px; border-radius: 5px; font-size: 0.9em; color: #ccc; border: 1px solid #333; }
        
        /* Modal æ¨£å¼çœç•¥ï¼Œèˆ‡ä¹‹å‰ç›¸åŒ */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 100; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-box { background: var(--card); width: 85%; max-width: 400px; padding: 20px; border-radius: 12px; border: 1px solid var(--accent); text-align: center; box-shadow: 0 0 20px rgba(187, 134, 252, 0.2); animation: popIn 0.3s; }
        .modal-title { font-size: 1.4em; color: var(--gold); margin-bottom: 10px; font-weight: bold; }
        .modal-desc { margin-bottom: 20px; font-size: 1.1em; line-height: 1.5; }
        .modal-btn { width: 100%; margin-bottom: 10px; padding: 15px; border: 1px solid #444; }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="header">
        <div class="stat-grid">
            <div class="big-stat" id="money-display">$0</div>
            <div>ğŸ“… <span id="year">2025</span> (<span id="age">0</span>æ­²)</div>
            <div>â¤ï¸ <span id="health">100</span></div>
            <div>ğŸ˜Š <span id="happy">80</span></div>
            
            <div class="stamina-container">
                <div class="stamina-label">
                    <span>âš¡ é«”åŠ›</span>
                    <span id="stamina-text">100/100</span>
                </div>
                <div class="progress-bg">
                    <div id="stamina-bar" class="progress-fill" style="width: 100%;"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="event-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-title" id="ev-title"></div>
            <div class="modal-desc" id="ev-desc"></div>
            <button class="modal-btn" id="btn-choice-a">é¸é … A</button>
            <button class="modal-btn" id="btn-choice-b">é¸é … B</button>
        </div>
    </div>

    <div id="page-home" class="page active">
        <div class="card">
            <img src="images/banner-home.jpg" class="img-banner" onerror="this.src='https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=600'">
            <div class="card-body">
                <h3>ğŸ“ å¹´åº¦è¡Œå‹•</h3>
                <div class="btn-grid">
                    <button onclick="action('work')" id="btn-work">
                        ğŸ’¼ å·¥ä½œè³ºéŒ¢
                        <span class="cost-tag">âš¡ -30</span>
                    </button>
                    <button onclick="action('study')" id="btn-study">
                        ğŸ“š é€²ä¿®æ™ºåŠ›
                        <span class="cost-tag">âš¡ -20</span>
                    </button>
                    <button onclick="action('play')" id="btn-play">
                        ğŸ® ç©æ¨‚æ”¾é¬†
                        <span class="cost-tag">âš¡ -10</span>
                    </button>
                    <button onclick="action('gym')" id="btn-gym">
                        ğŸ‹ï¸ å¥èº«é‹å‹•
                        <span class="cost-tag">âš¡ -25</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h3>ğŸ“œ äººç”Ÿå‹•æ…‹</h3>
                <div id="game-log" class="log-box"></div>
                <button class="btn-main" id="btn-nextyear" onclick="nextYear()">ğŸ‚ ä¸‹ä¸€æ­² (é«”åŠ›å›æ»¿)</button>
            </div>
        </div>
    </div>

    <div id="page-assets" class="page">
        <div class="card"><div class="card-body"><h3>ğŸï¸ è±ªè»Šè»Šåº«</h3><div id="car-shop"></div></div></div>
        <div class="card"><div class="card-body"><h3>ğŸ˜ï¸ æˆ¿ç”¢åœ°å¥‘</h3><div id="house-shop"></div></div></div>
    </div>
    <div id="page-casino" class="page"><div class="card"><div class="card-body"><h3>ğŸ° çš‡å®¶è³­å ´</h3><input type="number" id="bet-amount" placeholder="é‡‘é¡" style="width:90%;padding:10px;margin-bottom:10px"><div class="btn-grid"><button class="btn-risk" onclick="gamble('big')">å¤§</button><button class="btn-risk" onclick="gamble('small')">å°</button></div><p id="casino-msg"></p></div></div></div>
    <div id="page-profile" class="page"><div class="card"><div class="card-body"><h3>ğŸ† æˆå°±</h3><div id="achievement-list"></div><button onclick="restartGame()" style="width:100%;margin-top:10px">é‡ä¾†</button></div></div></div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="nav('home')"><span class="nav-icon">ğŸ </span>ç”Ÿæ´»</div>
        <div class="nav-item" onclick="nav('assets')"><span class="nav-icon">ğŸï¸</span>è³‡ç”¢</div>
        <div class="nav-item" onclick="nav('casino')"><span class="nav-icon">ğŸ°</span>è³­å ´</div>
        <div class="nav-item" onclick="nav('profile')"><span class="nav-icon">ğŸ†</span>æˆå°±</div>
    </div>

    <script src="data.js"></script>
    <script>
        // --- éŠæˆ²å¼•æ“è¨­å®š ---
        let Game = { 
            age: 18, money: 5000, health: 100, happy: 80, intel: 40, charm: 30, 
            stamina: 100, // ğŸ”¥ æ–°å¢é«”åŠ›å±¬æ€§
            inventory: [], achievements: [] 
        };
        
        // ğŸ”¥ å®šç¾©å„è¡Œå‹•çš„é«”åŠ›æ¶ˆè€—
        const COSTS = {
            work: 30,
            study: 20,
            play: 10,
            gym: 25
        };

        let activeEvent = null;

        function init() { renderShop(); updateUI(); log("V8.0 é«”åŠ›åˆ¶ä¸Šç·šï¼è«‹å¦¥å–„åˆ†é…é«”åŠ›ã€‚"); }

        function updateUI() {
            ['age', 'health', 'happy', 'intel', 'charm'].forEach(k => { let el=document.getElementById(k); if(el) el.innerText = Game[k]; });
            document.getElementById('money-display').innerText = "$" + Game.money.toLocaleString();

            // ğŸ”¥ æ›´æ–°é«”åŠ›æ¢ UI
            let bar = document.getElementById('stamina-bar');
            let text = document.getElementById('stamina-text');
            
            // ç¢ºä¿é«”åŠ›ä¸ä½æ–¼ 0
            if(Game.stamina < 0) Game.stamina = 0;
            
            bar.style.width = Game.stamina + "%";
            text.innerText = Game.stamina + "/100";

            // é¡è‰²è®ŠåŒ–ï¼šä½é«”åŠ›è®Šç´…
            if(Game.stamina < 20) bar.classList.add('low');
            else bar.classList.remove('low');

            // ğŸ”¥ æª¢æŸ¥æŒ‰éˆ•ç‹€æ…‹ï¼šé«”åŠ›ä¸è¶³å°±åœç”¨
            checkButtonState('btn-work', COSTS.work);
            checkButtonState('btn-study', COSTS.study);
            checkButtonState('btn-play', COSTS.play);
            checkButtonState('btn-gym', COSTS.gym);

            // å¦‚æœé«”åŠ›å¤ªä½ï¼Œè®“ã€Œä¸‹ä¸€æ­²ã€æŒ‰éˆ•ç™¼å…‰æç¤º
            let nextBtn = document.getElementById('btn-nextyear');
            if(Game.stamina < 10) nextBtn.classList.add('pulse');
            else nextBtn.classList.remove('pulse');
        }

        function checkButtonState(btnId, cost) {
            let btn = document.getElementById(btnId);
            if(Game.stamina < cost) {
                btn.disabled = true; // è®Šç°
            } else {
                btn.disabled = false; // æ¢å¾©
            }
        }

        function log(msg) { 
            let box = document.getElementById('game-log'); 
            box.innerHTML = `<div style="margin-bottom:6px;border-bottom:1px solid #333;">[${Game.age}æ­²] ${msg}</div>` + box.innerHTML; 
        }

        // --- è¡Œå‹•é‚è¼¯ ---
        function action(type) {
            if(Game.health <= 0) return alert("å·²æ­»äº¡");
            
            // ğŸ”¥ æª¢æŸ¥é«”åŠ›
            let cost = COSTS[type];
            if(Game.stamina < cost) {
                return alert("é«”åŠ›ä¸è¶³ï¼è«‹æŒ‰ã€Œä¸‹ä¸€æ­²ã€ä¼‘æ¯ã€‚");
            }

            // æ‰£é™¤é«”åŠ›
            Game.stamina -= cost;

            if(type === 'work') { let v = 25000+(Game.intel*800); Game.money+=v; Game.health-=3; Game.happy-=5; log(`å·¥ä½œè³ºäº† $${v}`); }
            if(type === 'study') { Game.intel+=4; Game.money-=2000; log("é€²ä¿®æ™ºåŠ›+4"); }
            if(type === 'play') { Game.happy+=12; Game.money-=4000; log("ç©æ¨‚å¿«æ¨‚+12"); }
            if(type === 'gym') { Game.health+=5; Game.charm+=2; Game.money-=800; log("å¥èº«å¥åº·+5"); }

            updateUI();
        }

        function nextYear() {
            if(Game.health <= 0) return;

            Game.age++;
            Game.health -= 3;
            
            // ğŸ”¥ æ–°çš„ä¸€å¹´ï¼Œé«”åŠ›å›æ»¿
            Game.stamina = 100;
            log("ğŸ’¤ ä½ ä¼‘æ¯äº†ä¸€æ•´å¹´ï¼Œé«”åŠ›æ¢å¾©åˆ° 100ï¼");

            Game.inventory.forEach(id => {
                let car = CAR_DATA.find(c => c.id === id); if(car) Game.charm += 1;
                let house = HOUSE_DATA.find(h => h.id === id); if(house) Game.happy += 2;
            });

            if(Math.random() < 0.3 && typeof EVENT_DATA !== 'undefined') {
                let randIndex = Math.floor(Math.random() * EVENT_DATA.length);
                activeEvent = EVENT_DATA[randIndex];
                document.getElementById('ev-title').innerText = activeEvent.title;
                document.getElementById('ev-desc').innerText = activeEvent.desc;
                
                let btnA = document.getElementById('btn-choice-a');
                let btnB = document.getElementById('btn-choice-b');
                
                btnA.onclick = function() { resolveEvent(0); };
                btnB.onclick = function() { resolveEvent(1); };
                btnA.innerText = activeEvent.choices[0].txt;
                btnB.innerText = activeEvent.choices[1].txt;
                
                document.getElementById('event-modal').style.display = 'flex';
            }
            
            if(Game.health <= 0) Game.health = 0;
            updateUI();
        }

        function resolveEvent(idx) {
            let resultText = activeEvent.choices[idx].effect(Game);
            log(`âš¡ [äº‹ä»¶] ${activeEvent.title}: ${resultText}`);
            document.getElementById('event-modal').style.display = 'none';
            updateUI();
        }

        function renderShop() {
            // é€™è£¡å‡è¨­ data.js å·²è¼‰å…¥
            if(typeof CAR_DATA === 'undefined') return;
            let carHtml = "";
            CAR_DATA.forEach(c => { carHtml += `<div style="display:flex;justify-content:space-between;margin-bottom:10px;border-bottom:1px solid #333;"><div style="display:flex;"><img src="${c.img}" class="item-img" onerror="this.style.display='none'"><div><b>${c.name}</b><br><span style="color:#888;font-size:0.8em">é­…åŠ›+${c.charm}</span></div></div><button class="btn-buy" onclick="buy('car', '${c.id}')">$${c.price/10000}è¬</button></div>`; });
            document.getElementById('car-shop').innerHTML = carHtml;

            let houseHtml = "";
            HOUSE_DATA.forEach(h => { houseHtml += `<div style="display:flex;justify-content:space-between;margin-bottom:10px;border-bottom:1px solid #333;"><div style="display:flex;"><img src="${h.img}" class="item-img" onerror="this.style.display='none'"><div><b>${h.name}</b><br><span style="color:#888;font-size:0.8em">å¿«æ¨‚+${h.happy}</span></div></div><button class="btn-buy" onclick="buy('house', '${h.id}')">$${h.price/10000}è¬</button></div>`; });
            document.getElementById('house-shop').innerHTML = houseHtml;
        }

        function buy(type, id) {
            let item = type === 'car' ? CAR_DATA.find(c => c.id === id) : HOUSE_DATA.find(h => h.id === id);
            if(Game.inventory.includes(id)) return alert("å·²æ“æœ‰ï¼");
            if(Game.money >= item.price) { Game.money -= item.price; Game.inventory.push(id); log(`ğŸ‰ è³¼è²·æˆåŠŸï¼š${item.name}`); updateUI(); } else alert("éŒ¢ä¸å¤ ï¼");
        }

        function gamble(c){ 
            let v=parseInt(document.getElementById('bet-amount').value);
            if(!v||v>Game.money)return alert("é‡‘é¡éŒ¯èª¤");
            // ğŸ”¥ è³­åšä¹Ÿéœ€è¦æ¶ˆè€—ä¸€é»é»é«”åŠ› (å¯é¸)
            if(Game.stamina < 5) return alert("é«”åŠ›ä¸è¶³ï¼Œæ²’ç²¾ç¥è³­åšäº†ã€‚");
            Game.stamina -= 5;
            
            let d=Math.floor(Math.random()*10);
            let r=d>=5?'big':'small';
            if(c===r){Game.money+=v;log(`è³­åšè´äº† $${v}`);}else{Game.money-=v;log(`è³­åšè¼¸äº† $${v}`);}
            updateUI();
        }
        function nav(p){ document.querySelectorAll('.page').forEach(e=>e.classList.remove('active')); document.getElementById('page-'+p).classList.add('active'); }
        function restartGame(){ location.reload(); }

        init();
    </script>
</body>
</html>
