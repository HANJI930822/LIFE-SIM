<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™‚äº‹äººç”Ÿ V17.0ï¼šçµ‚æ¥µç‰ˆ</title>
    <style>
        :root {
            --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-dark: #0f0f23;
            --card: linear-gradient(135deg, #1e1e2e 0%, #2a2a3e 100%);
            --accent: #bb86fc;
            --accent-glow: rgba(187, 134, 252, 0.3);
            --text: #ffffff;
            --text-dim: #b0b0b0;
            --green: #03dac6;
            --red: #cf6679;
            --gold: #ffd700;
            --blue: #2196f3;
            --orange: #ff9800;
            --purple: #9c27b0;
        }
        
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box;
        }
        
        body {
            font-family: 'å¾®è»Ÿæ­£é»‘é«”', 'Noto Sans TC', sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            max-width: 600px;
            margin: 0 auto;
            padding-bottom: 80px;
            overflow-x: hidden;
            position: relative;
            /* ç§»é™¤ user-select: none é¿å…å½±éŸ¿é»æ“Š */
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 300px;
            background: var(--bg-primary);
            z-index: -1;
            opacity: 0.3;
            pointer-events: none; /* ç¢ºä¿ä¸æ“‹ä½é»æ“Š */
        }
        
        /* ===== HEADER ===== */
        .header {
            background: linear-gradient(135deg, #1e1e2e 0%, #2a2a3e 100%);
            padding: 15px;
            position: sticky;
            top: 0;
            z-index: 100; /* æé«˜å±¤ç´š */
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            border-bottom: 2px solid var(--accent);
        }
        
        .player-info {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }
        
        .player-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            box-shadow: 0 0 15px var(--accent-glow);
        }
        
        .player-details {
            flex: 1;
        }
        
        .player-name-line {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--gold);
        }
        
        .player-subtitle {
            font-size: 0.8em;
            color: var(--text-dim);
        }
        
        .big-stat {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--gold);
            text-align: center;
            margin: 10px 0;
            text-shadow: 0 0 10px var(--gold);
        }
        
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            font-size: 0.85em;
            text-align: center;
        }
        
        .stat-item {
            background: rgba(255,255,255,0.1);
            padding: 8px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
            display: block;
            color: var(--text);
        }
        
        .status-alerts {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .status-alert {
            padding: 8px;
            border-radius: 8px;
            font-size: 0.8em;
            font-weight: bold;
            text-align: center;
            animation: slideIn 0.3s;
        }
        
        .alert-red { background: linear-gradient(135deg, #b00020, #d32f2f); color: #fff; }
        .alert-orange { background: linear-gradient(135deg, #ff9800, #fb8c00); color: #fff; }
        .alert-blue { background: linear-gradient(135deg, #2196f3, #1976d2); color: #fff; }
        
        /* ===== SKILLS ===== */
.skills-container {
    margin-top: 10px;
    background: rgba(0,0,0,0.3);
    border-radius: 8px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.skills-header {
    padding: 10px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(187, 134, 252, 0.1);
    transition: all 0.3s;
    user-select: none;
}

.skills-header:hover {
    background: rgba(187, 134, 252, 0.2);
}

.skills-header:active {
    transform: scale(0.98);
}

.skills-title {
    font-size: 0.9em;
    font-weight: bold;
    color: var(--accent);
}

.skills-toggle {
    font-size: 1.2em;
    transition: transform 0.3s;
    color: var(--accent);
}

.skills-toggle.collapsed {
    transform: rotate(-90deg);
}

.skills-body {
    padding: 10px;
    max-height: 500px;
    overflow: hidden;
    transition: max-height 0.4s ease, padding 0.3s ease;
}

.skills-body.collapsed {
    max-height: 0;
    padding: 0 10px;
}

.skill-item {
    margin-bottom: 8px;
}

.skill-header {
    display: flex;
    justify-content: space-between;
    font-size: 0.8em;
    margin-bottom: 3px;
    color: var(--text);
}

.skill-bar-bg {
    background: #333;
    height: 6px;
    border-radius: 3px;
    overflow: hidden;
}

.skill-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--blue), var(--green));
    transition: width 0.5s ease;
}

        /* ===== CARDS ===== */
        .card {
            background: var(--card);
            border-radius: 15px;
            margin: 15px 10px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
            animation: fadeIn 0.4s;
            position: relative; /* ç¢ºä¿å±¤ç´šæ­£ç¢º */
            z-index: 1;
        }
        
        .card-header {
            padding: 15px;
            background: rgba(187, 134, 252, 0.15);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-title {
            font-size: 1.1em;
            font-weight: bold;
            color: var(--accent);
        }
        
        .card-body { 
            padding: 15px;
            position: relative;
            z-index: 2;
        }
        
        /* ===== BUTTONS ä¿®å¾©é»æ“Šå•é¡Œ ===== */
        .btn-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            position: relative;
            z-index: 10; /* ç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
        }
        
        button {
            background: linear-gradient(135deg, #444, #555);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95em;
            font-weight: 500;
            border: 1px solid rgba(255,255,255,0.2);
            position: relative;
            overflow: hidden;
            z-index: 10; /* ç¢ºä¿å¯é»æ“Š */
            pointer-events: auto; /* å¼·åˆ¶å•Ÿç”¨é»æ“Š */
        }
        
        /* ä¿®å¾© ::before å½å…ƒç´ æ“‹ä½é»æ“Šçš„å•é¡Œ */
        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
            pointer-events: none; /* é—œéµï¼šè®“å½å…ƒç´ ä¸æ“‹ä½é»æ“Š */
            z-index: -1; /* æ”¾åˆ°æŒ‰éˆ•æ–‡å­—ä¸‹æ–¹ */
        }
        
        button:hover::before {
            width: 300px;
            height: 300px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(187, 134, 252, 0.4);
        }
        
        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(187, 134, 252, 0.3);
        }
        
        button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            filter: grayscale(1);
            pointer-events: none; /* disabled æ™‚æ‰ç¦ç”¨é»æ“Š */
        }
        
        .btn-main {
            background: linear-gradient(135deg, var(--accent), #9c27b0);
            color: white;
            font-weight: bold;
            width: 100%;
            margin-top: 10px;
            font-size: 1.1em;
            box-shadow: 0 4px 15px var(--accent-glow);
        }
        
        .btn-job {
            background: linear-gradient(135deg, #2196f3, #1976d2);
        }
        
        .btn-buy {
            background: linear-gradient(135deg, var(--green), #00897b);
            color: black;
            font-weight: bold;
        }
        
        .btn-risk {
            background: linear-gradient(135deg, var(--red), #c62828);
        }
        
        .cost-tag {
            font-size: 0.7em;
            color: #ddd;
            display: block;
            margin-top: 3px;
            pointer-events: none; /* ä¸æ“‹ä½æŒ‰éˆ•é»æ“Š */
        }
        
        /* ===== ORIGIN CAROUSEL è¼ªæ’­å¼å‡ºèº«é¸æ“‡ ===== */
.origin-carousel {
    position: relative;
    padding: 20px 50px;
    min-height: 320px;
}

.origin-card-wrapper {
    position: relative;
    width: 100%;
    overflow: hidden;
}

.origin-card {
    background: linear-gradient(135deg, #2a2a3e, #3a3a4e);
    border: 2px solid rgba(255,255,255,0.2);
    border-radius: 12px;
    padding: 20px;
    text-align: left;
    transition: all 0.3s;
    position: relative;
    z-index: 10;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    animation: fadeIn 0.4s;
    min-height: 280px;
}

.origin-card.selected {
    border-color: var(--accent);
    background: linear-gradient(135deg, #3a3a5e, #4a4a6e);
    box-shadow: 0 0 25px var(--accent-glow);
}

.origin-card.selected::before {
    content: 'âœ“ å·²é¸æ“‡';
    position: absolute;
    top: 15px;
    right: 15px;
    background: var(--accent);
    color: #fff;
    padding: 5px 12px;
    border-radius: 15px;
    font-size: 0.8em;
    font-weight: bold;
    z-index: 20;
    pointer-events: none;
}

.origin-name {
    font-weight: bold;
    color: var(--gold);
    font-size: 1.4em;
    margin-bottom: 8px;
    padding-right: 80px;
}

.origin-desc {
    font-size: 0.95em;
    color: var(--text-dim);
    margin: 8px 0;
    line-height: 1.5;
}

.origin-parents {
    font-size: 0.9em;
    color: #888;
    margin: 8px 0;
    font-style: italic;
    background: rgba(255,255,255,0.05);
    padding: 5px 10px;
    border-radius: 5px;
    display: inline-block;
}

.origin-stats {
    color: var(--green);
    font-size: 0.9em;
    margin-top: 12px;
    line-height: 1.8;
    background: rgba(3, 218, 198, 0.1);
    padding: 10px;
    border-radius: 8px;
    border-left: 3px solid var(--green);
}

/* å·¦å³åˆ‡æ›æŒ‰éˆ• */
.carousel-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, var(--accent), #9c27b0);
    border: none;
    border-radius: 50%;
    color: white;
    font-size: 1.5em;
    cursor: pointer;
    z-index: 20;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 15px rgba(187, 134, 252, 0.4);
    transition: all 0.3s;
    pointer-events: auto;
}

.carousel-btn:hover {
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 6px 20px rgba(187, 134, 252, 0.6);
}

.carousel-btn:active {
    transform: translateY(-50%) scale(0.95);
}

.carousel-btn.prev {
    left: 0;
}

.carousel-btn.next {
    right: 0;
}

/* æŒ‡ç¤ºå™¨ */
.carousel-indicator {
    text-align: center;
    margin-top: 15px;
    font-size: 0.9em;
    color: var(--text-dim);
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
}

.indicator-dots {
    display: flex;
    gap: 6px;
}

.indicator-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: rgba(255,255,255,0.3);
    transition: all 0.3s;
}

.indicator-dot.active {
    background: var(--accent);
    width: 24px;
    border-radius: 4px;
}

.origin-counter {
    font-weight: bold;
    color: var(--accent);
}

        /* ===== MODAL ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 300; /* æœ€é«˜å±¤ç´š */
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
            animation: fadeIn 0.3s;
        }
        
        .modal-box {
            background: var(--card);
            width: 90%;
            max-width: 450px;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid var(--accent);
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            animation: slideUp 0.4s;
            position: relative;
            z-index: 310;
        }
        
        .modal-title {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--gold);
            margin-bottom: 15px;
        }
        
        .modal-desc {
            margin-bottom: 20px;
            line-height: 1.6;
            color: var(--text);
            white-space: pre-wrap;
        }
        
        .modal-btn {
            width: 100%;
            margin-bottom: 10px;
            padding: 15px;
            position: relative;
            z-index: 320;
        }
        
        /* ===== NAV BAR ===== */
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            max-width: 600px;
            background: linear-gradient(135deg, #1e1e2e, #000);
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            border-top: 2px solid var(--accent);
            z-index: 200; /* é«˜å±¤ç´šä½†ä½æ–¼ modal */
            box-shadow: 0 -4px 20px rgba(0,0,0,0.5);
        }
        
        .nav-item {
            color: #888;
            cursor: pointer;
            text-align: center;
            font-size: 0.75em;
            padding: 5px;
            transition: all 0.3s;
            flex: 1;
            position: relative;
            z-index: 210;
            pointer-events: auto;
        }
        
        .nav-item:hover {
            color: var(--accent);
        }
        
        .nav-item:active {
            transform: scale(0.95);
        }
        
        .nav-item.active {
            color: var(--accent);
            font-weight: bold;
        }
        
        .nav-icon {
            display: block;
            font-size: 1.8em;
            margin-bottom: 2px;
        }
        
        .page {
            display: none;
            animation: fadeIn 0.3s;
            position: relative;
            z-index: 1;
        }
        
        .page.active { display: block; }
        
        /* ===== TALENT TAGS ===== */
        .talent-tag {
            display: inline-block;
            background: linear-gradient(135deg, var(--gold), #ffa000);
            color: black;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.75em;
            margin-right: 5px;
            margin-top: 3px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(255, 215, 0, 0.3);
            pointer-events: none;
        }
        
        .talent-bad {
            background: linear-gradient(135deg, var(--red), #c62828);
            color: white;
        }
        
        /* ===== LOG BOX ===== */
        .log-box {
            height: 150px;
            overflow-y: auto;
            background: rgba(0,0,0,0.4);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85em;
            color: #ddd;
            border: 1px solid rgba(255,255,255,0.1);
            line-height: 1.6;
        }
        
        .log-box::-webkit-scrollbar {
            width: 6px;
        }
        
        .log-box::-webkit-scrollbar-track {
            background: #222;
        }
        
        .log-box::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 3px;
        }
        
        /* ===== JOB/ITEM CARD ===== */
        .job-card {
            background: rgba(255,255,255,0.08);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 10px;
            border: 1px solid rgba(255,255,255,0.15);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            z-index: 5;
            pointer-events: auto;
        }
        
        .job-card:hover {
            background: rgba(255,255,255,0.12);
            transform: translateX(5px);
        }
        
        .job-card:active {
            transform: translateX(3px);
        }
        
        .job-name {
            font-weight: bold;
            color: var(--blue);
            font-size: 1.1em;
        }
        
        .job-salary {
            color: var(--green);
            font-size: 0.9em;
        }
        
        .job-requirement {
            color: var(--text-dim);
            font-size: 0.8em;
            margin-top: 3px;
        }
        
        /* ===== ANIMATIONS ===== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .section-title {
            font-size: 1.2em;
            color: var(--gold);
            margin: 20px 10px 10px;
            text-align: left;
            font-weight: bold;
        }
        
        #scene-game { display: none; }
        
        /* ç¢ºä¿æ‰€æœ‰å¯äº’å‹•å…ƒç´ éƒ½åœ¨æ­£ç¢ºå±¤ç´š */
        input, select, button, .origin-card, .job-card, .nav-item {
            -webkit-tap-highlight-color: rgba(187, 134, 252, 0.3);
            touch-action: manipulation;
        }
    </style>
</head>
<body>

    <!-- å‰µè§’ç•«é¢ -->
    <div id="scene-creation">
        <h1 class="creation-title">ğŸ§¬ æŠ•èƒæ¨¡æ“¬å™¨ V17.0</h1>
        
        <div class="card">
            <div class="card-body">
                <div class="input-group">
                    <label>âœï¸ å§“å</label>
                    <input type="text" id="inp-name" placeholder="è¼¸å…¥å§“å" maxlength="8" value="æ¸¬è©¦ç©å®¶">
                </div>
                <div class="input-group">
                    <label>ğŸš» æ€§åˆ¥</label>
                    <select id="inp-gender">
                        <option value="ç”·">ğŸ‘¨ ç”·ç”Ÿ</option>
                        <option value="å¥³">ğŸ‘© å¥³ç”Ÿ</option>
                        <option value="å…¶ä»–">ğŸŒˆ å…¶ä»–</option>
                    </select>
                </div>
            </div>
        </div>
        
        <h3 class="section-title">ğŸ² é¸æ“‡å‡ºèº«èƒŒæ™¯</h3>
<div class="origin-carousel">
    <button class="carousel-btn prev" onclick="changeOrigin(-1)">â€¹</button>
    <div class="origin-card-wrapper" id="origin-display"></div>
    <button class="carousel-btn next" onclick="changeOrigin(1)">â€º</button>
</div>
<div class="carousel-indicator">
    <span class="origin-counter"><span id="current-origin">1</span> / <span id="total-origins">18</span></span>
    <div class="indicator-dots" id="indicator-dots"></div>
</div>

        
        <button class="btn-main" onclick="startGame()">ğŸš€ é–‹å§‹äººç”Ÿå†’éšª</button>
    </div>

    <!-- éŠæˆ²ä¸»ç•«é¢ -->
    <div id="scene-game">
        <div class="header">
            <div class="player-info">
                <div class="player-avatar" id="player-avatar">ğŸ‘¶</div>
                <div class="player-details">
                    <div class="player-name-line">
                        <span id="player-name">???</span>
                        <span style="font-size: 0.8em; color: var(--text-dim);">
                            | <span id="age-display">0</span>æ­²
                        </span>
                    </div>
                    <div class="player-subtitle">
                        <span id="player-origin">å¹³å‡¡å®¶åº­</span> â€¢ 
                        <span id="player-job">ç„¡æ¥­</span>
                    </div>
                    <div id="talent-display" style="margin-top: 5px;"></div>
                </div>
            </div>
            
            <div class="big-stat" id="money-display">$0</div>
            
            <div class="stat-grid">
                <div class="stat-item">
                    <span>â¤ï¸ å¥åº·</span>
                    <span class="stat-value" id="health">100</span>
                </div>
                <div class="stat-item">
                    <span>ğŸ˜Š å¿«æ¨‚</span>
                    <span class="stat-value" id="happy">80</span>
                </div>
                <div class="stat-item">
                    <span>ğŸ§  æ™ºåŠ›</span>
                    <span class="stat-value" id="intel">50</span>
                </div>
            </div>
            
            <div class="skills-container" id="skills-container"></div>
            
            <div class="stamina-container">
                <div class="stamina-label">
                    <span>âš¡ é«”åŠ›</span>
                    <span id="stamina-text">100/100</span>
                </div>
                <div class="progress-bg">
                    <div id="stamina-bar" class="progress-fill"></div>
                </div>
            </div>
            
            <div class="status-alerts" id="status-alerts"></div>
        </div>

        <!-- é¦–é ï¼šç”Ÿæ´» -->
        <div id="page-home" class="page active">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ğŸ“… äººç”Ÿéšæ®µï¼š<span id="life-stage">å¬°å…’æœŸ</span></span>
                </div>
                <div class="card-body">
                    <div class="btn-grid" id="action-buttons">
                        <!-- å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ğŸ“œ äººç”Ÿå‹•æ…‹</span>
                </div>
                <div class="card-body">
                    <div id="game-log" class="log-box"></div>
                    <button class="btn-main" onclick="nextYear()">
                        ğŸ‚ ä¸‹ä¸€æ­² (é«”åŠ›å›æ»¿)
                    </button>
                </div>
            </div>
        </div>

        <!-- è·æ¥­é  -->
        <div id="page-career" class="page">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ğŸ’¼ è·æ¥­é¸æ“‡</span>
                </div>
                <div class="card-body">
                    <div style="color: var(--text-dim); margin-bottom: 15px; font-size: 0.9em;">
                        ğŸ’¡ é¸æ“‡è·æ¥­å¾Œæ¯å¹´è‡ªå‹•ç²å¾—è–ªæ°´ï¼Œä¸åŒè·æ¥­æœ‰ä¸åŒç‰¹æ®Šæ•ˆæœ
                    </div>
                    <div id="job-list"></div>
                </div>
            </div>
        </div>

        <!-- è³‡ç”¢é  -->
        <div id="page-assets" class="page">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ğŸï¸ è»Šåº«</span>
                </div>
                <div class="card-body" id="car-shop"></div>
            </div>
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ğŸ˜ï¸ æˆ¿ç”¢</span>
                </div>
                <div class="card-body" id="house-shop"></div>
            </div>
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ğŸ’ å¥¢ä¾ˆå“</span>
                </div>
                <div class="card-body" id="luxury-shop"></div>
            </div>
        </div>

        <!-- ç¤¾äº¤é  -->
        <div id="page-social" class="page">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ğŸ’– äººéš›é—œä¿‚</span>
                </div>
                <div class="card-body">
                    <div id="npc-list"></div>
                    <div id="find-partner-area" style="margin-top: 15px; display: none;">
                        <button class="btn-main" onclick="findPartner()">
                            ğŸ“± ä½¿ç”¨äº¤å‹è»Ÿé«” ($500)
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æˆå°±é  -->
        <div id="page-profile" class="page">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ğŸ† æˆå°±ç³»çµ±</span>
                </div>
                <div class="card-body">
                    <div id="achievement-list"></div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ğŸ“Š äººç”Ÿçµ±è¨ˆ</span>
                </div>
                <div class="card-body" id="stats-panel">
                    <!-- å‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
            
            <div class="card">
                <div class="card-body">
                    <button class="btn-main" onclick="restartGame()">
                        ğŸ”„ é‡æ–°é–‹å§‹äººç”Ÿ
                    </button>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨å°èˆª -->
        <div class="nav-bar">
            <div class="nav-item active" onclick="nav('home', event)">
                <span class="nav-icon">ğŸ </span>
                ç”Ÿæ´»
            </div>
            <div class="nav-item" onclick="nav('career', event)">
                <span class="nav-icon">ğŸ’¼</span>
                è·æ¥­
            </div>
            <div class="nav-item" onclick="nav('assets', event)">
                <span class="nav-icon">ğŸï¸</span>
                è³‡ç”¢
            </div>
            <div class="nav-item" onclick="nav('social', event)">
                <span class="nav-icon">ğŸ’–</span>
                ç¤¾äº¤
            </div>
            <div class="nav-item" onclick="nav('profile', event)">
                <span class="nav-icon">ğŸ†</span>
                æˆå°±
            </div>
        </div>
    </div>

    <!-- äº‹ä»¶å½ˆçª— -->
    <div id="event-modal" class="modal-overlay" onclick="if(event.target===this) closeModal()">
        <div class="modal-box">
            <div class="modal-title" id="ev-title"></div>
            <div class="modal-desc" id="ev-desc"></div>
            <button class="modal-btn" id="btn-choice-a">A</button>
            <button class="modal-btn" id="btn-choice-b">B</button>
        </div>
    </div>

    <script>
        // ==========================================
        // ğŸ”´ è³‡æ–™å®šç¾©
        // ==========================================
        
        const TALENTS = [
            { id: 't1', name: 'éç›®ä¸å¿˜', desc: 'å­¸ç¿’æ•ˆç‡+50%', type: 'good', effect: (g) => { g.learnBonus = 1.5; } },
            { id: 't2', name: 'å¤©ç”Ÿç¥åŠ›', desc: 'å¥åº·è¡°é€€æ¸›åŠ', type: 'good', effect: (g) => { g.healthDecay = 0.5; } },
            { id: 't3', name: 'è¬äººè¿·', desc: 'é­…åŠ›+20ï¼Œç¤¾äº¤æ•ˆæœ+30%', type: 'good', effect: (g) => { g.skills.charm += 20; g.socialBonus = 1.3; } },
            { id: 't4', name: 'æŠ•è³‡çœ¼å…‰', desc: 'è¢«å‹•æ”¶å…¥+20%', type: 'good', effect: (g) => { g.incomeBonus = 1.2; } },
            { id: 't5', name: 'ç»ç’ƒå¿ƒ', desc: 'å¿«æ¨‚å€¼ä¸‹é™åŠ å€', type: 'bad', effect: (g) => { g.happyDecay = 2; } },
            { id: 't6', name: 'é«”å¼±å¤šç—…', desc: 'åˆå§‹å¥åº·-20', type: 'bad', effect: (g) => { g.health -= 20; } },
            { id: 't7', name: 'ç¤¾äº¤ææ‡¼', desc: 'é­…åŠ›-15', type: 'bad', effect: (g) => { g.skills.charm -= 15; } },
            { id: 't8', name: 'å¯ŒäºŒä»£å¿ƒæ…‹', desc: 'å·¥ä½œæ”¶å…¥-30%', type: 'bad', effect: (g) => { g.workPenalty = 0.7; } },
            { id: 't9', name: 'å¤©è³¦ç•°ç¨Ÿ', desc: 'æ‰€æœ‰æŠ€èƒ½æˆé•·+20%', type: 'good', effect: (g) => { g.skillBonus = 1.2; } },
            { id: 't10', name: 'å¹¸é‹æ˜Ÿ', desc: 'éš¨æ©Ÿäº‹ä»¶æ­£é¢çµæœ+10%', type: 'good', effect: (g) => { g.luckBonus = 0.1; } }
        ];

        const ORIGINS = [
            { 
                id: 'common', name: 'å¹³å‡¡å®¶åº­', 
                desc: 'çˆ¶æ¯éƒ½æ˜¯æ™®é€šä¸Šç­æ—ï¼Œç”Ÿæ´»å®‰ç©©å¹³å‡¡ï¼Œæ²’æœ‰å¤§èµ·å¤§è½ã€‚', 
                parents: 'çˆ¶:å…¬å‹™å“¡ / æ¯:æ•™å¸«', 
                money: 50000, intel: 50, happy: 80, yearlyMoney: 1000, 
                buff: 'å¹³è¡¡ç™¼å±•ï¼Œç„¡ç‰¹æ®ŠåŠ æˆ'
            },
            { 
                id: 'rich', name: 'å¯ŒäºŒä»£', 
                desc: 'å«è‘—é‡‘æ¹¯åŒ™å‡ºç”Ÿï¼Œå®¶æ—ä¼æ¥­é¾å¤§ï¼Œä¸æ„åƒç©¿ã€‚å¾å°åœ¨è±ªå®…é•·å¤§ã€‚', 
                parents: 'çˆ¶:é›†åœ˜è‘£äº‹é•· / æ¯:ç å¯¶è¨­è¨ˆå¸«', 
                money: 5000000, intel: 40, happy: 90, yearlyMoney: 100000, 
                buff: 'ğŸ’° é–‹å±€500è¬ + å¹´é ˜10è¬é›¶ç”¨éŒ¢'
            },
            { 
                id: 'genius', name: 'å¯’é–€å¤©æ‰', 
                desc: 'å®¶å¢ƒæ¸…å¯’ä½åœ¨è€èˆŠå…¬å¯“ï¼Œä½†å¤©ç”Ÿæ™ºå•†é©šäººï¼Œæ˜¯æ”¹è®Šå‘½é‹çš„å¸Œæœ›ã€‚', 
                parents: 'çˆ¶:å·¥åœ°å·¥äºº / æ¯:æ¸…æ½”å“¡', 
                money: -50000, intel: 120, happy: 60, yearlyMoney: 0, 
                buff: 'ğŸ§  æ™ºåŠ›120ä½†è² å‚µ5è¬'
            },
            { 
                id: 'star', name: 'æ¼”è—ä¸–å®¶', 
                desc: 'çˆ¶æ¯éƒ½æ˜¯å¨›æ¨‚åœˆå¤§å’–ï¼Œå¾å°åœ¨é‚å…‰ç‡ˆä¸‹é•·å¤§ï¼Œäººè„ˆéå¸ƒæ¼”è—åœˆã€‚', 
                parents: 'çˆ¶:å½±å¸ / æ¯:å¤©å', 
                money: 1000000, intel: 50, happy: 70, yearlyMoney: 50000, 
                buff: 'âœ¨ é­…åŠ›çˆ†è¡¨ + æ¼”è—è³‡æº'
            },
            { 
                id: 'scholar', name: 'æ›¸é¦™é–€ç¬¬', 
                desc: 'å®¶æ—ä¸‰ä»£éƒ½æ˜¯çŸ¥è­˜ä»½å­ï¼Œå®¶è£¡è—æ›¸è¬å·ï¼Œé‡è¦–æ•™è‚²å‹éä¸€åˆ‡ã€‚', 
                parents: 'çˆ¶:å¤§å­¸æ•™æˆ / æ¯:å¾‹å¸«', 
                money: 200000, intel: 80, happy: 75, yearlyMoney: 5000, 
                buff: 'ğŸ“š é«˜å­¸ç¿’åŠ› + æ•™è‚²è³‡æºè±å¯Œ'
            },
            { 
                id: 'military', name: 'è»äººä¸–å®¶', 
                desc: 'ç¥–çˆ¶æ˜¯é€€å½¹å°‡è»ï¼Œçˆ¶è¦ªç¾å½¹è»å®˜ï¼Œå®¶é¢¨ç´€å¾‹åš´æ˜ã€‚', 
                parents: 'çˆ¶:è»å®˜ / æ¯:è»é†«', 
                money: 150000, intel: 60, happy: 70, yearlyMoney: 3000, 
                buff: 'ğŸ’ª åˆå§‹å¥åº·+20ï¼Œç´€å¾‹åš´æ ¼'
            },
            { 
                id: 'doctor', name: 'é†«ç”Ÿä¸–å®¶', 
                desc: 'çˆ¶æ¯éƒ½æ˜¯é†«ç”Ÿï¼Œå¾å°åœ¨é†«é™¢é•·å¤§ï¼Œè€³æ¿¡ç›®æŸ“é†«å­¸çŸ¥è­˜ã€‚', 
                parents: 'çˆ¶:å¤–ç§‘ä¸»ä»» / æ¯:å©¦ç”¢ç§‘é†«å¸«', 
                money: 800000, intel: 85, happy: 75, yearlyMoney: 10000, 
                buff: 'âš•ï¸ é†«ç™‚æŠ€èƒ½+30ï¼Œå¥åº·çŸ¥è­˜è±å¯Œ'
            },
            { 
                id: 'farmer', name: 'è¾²å®¶å­å¼Ÿ', 
                desc: 'ä¸–ä»£å‹™è¾²ï¼Œå®¶è£¡æœ‰å¹¾ç”²è¾²åœ°ï¼Œéè‘—æ—¥å‡ºè€Œä½œæ—¥è½è€Œæ¯çš„ç”Ÿæ´»ã€‚', 
                parents: 'çˆ¶:è¾²å¤« / æ¯:æœè¾²', 
                money: 20000, intel: 40, happy: 85, yearlyMoney: 500, 
                buff: 'ğŸŒ¾ å¥åº·+15ï¼Œå¿«æ¨‚+5ï¼Œç´”æ¨¸ç”Ÿæ´»'
            },
            { 
                id: 'fisher', name: 'æ¼æ‘ä¸–å®¶', 
                desc: 'ç¥–å…ˆä¸–ä»£æ•é­šï¼Œç†Ÿæ‚‰æµ·æ´‹ï¼Œèˆ‡å¤§æµ·ç‚ºä¼ã€‚é¢±é¢¨æ˜¯æœ€å¤§çš„æ•µäººã€‚', 
                parents: 'çˆ¶:æ¼èˆ¹èˆ¹é•· / æ¯:é­šè²©', 
                money: 30000, intel: 45, happy: 80, yearlyMoney: 1000, 
                buff: 'ğŸŸ å¥åº·+10ï¼Œè²¡å¯Œæ³¢å‹•å¤§'
            },
            { 
                id: 'aboriginal', name: 'åŸä½æ°‘éƒ¨è½', 
                desc: 'åœ¨å±±ä¸Šéƒ¨è½é•·å¤§ï¼Œèƒ½æ­Œå–„èˆï¼Œèˆ‡å¤§è‡ªç„¶å…±ç”Ÿã€‚ä¿æœ‰å‚³çµ±æ–‡åŒ–ã€‚', 
                parents: 'çˆ¶:éƒ¨è½çµäºº / æ¯:ç·¨ç¹”å·¥è—å¸«', 
                money: 10000, intel: 45, happy: 90, yearlyMoney: 500, 
                buff: 'ğŸµ é­…åŠ›+15ï¼Œè—è¡“+20ï¼Œå¿«æ¨‚+10'
            },
            { 
                id: 'immigrant', name: 'æ–°ä½æ°‘å®¶åº­', 
                desc: 'æ¯è¦ªæ˜¯æ–°ç§»æ°‘ï¼Œæœƒèªªå¤šç¨®èªè¨€ï¼Œå®¶è£¡èåˆå…©åœ‹æ–‡åŒ–ã€‚', 
                parents: 'çˆ¶:å·¥å» ä½œæ¥­å“¡ / æ¯:è¶Šå—æ–°ä½æ°‘', 
                money: 30000, intel: 55, happy: 75, yearlyMoney: 800, 
                buff: 'ğŸŒ æºé€š+20ï¼Œå¤šå…ƒæ–‡åŒ–è¦–é‡'
            },
            { 
                id: 'single_parent', name: 'å–®è¦ªå®¶åº­', 
                desc: 'çˆ¶æ¯é›¢ç•°ï¼Œè·Ÿè‘—æ¯è¦ªè¾›è‹¦é•·å¤§ã€‚é›–ç„¶è¾›è‹¦ä½†æ¯æ„›æ»¿æ»¿ã€‚', 
                parents: 'æ¯:é¤å»³æœå‹™å“¡', 
                money: -20000, intel: 55, happy: 65, yearlyMoney: 0, 
                buff: 'ğŸ’” è² å‚µä½†æ›´ç¨ç«‹å …å¼·'
            },
            { 
                id: 'tech', name: 'ç§‘æŠ€æ–°è²´', 
                desc: 'çˆ¶æ¯éƒ½åœ¨ç«¹ç§‘å·¥ä½œï¼Œå¾å°æ¥è§¸æœ€æ–°ç§‘æŠ€ç”¢å“ï¼Œå®¶è£¡å…¨æ˜¯3Cã€‚', 
                parents: 'çˆ¶:å·¥ç¨‹å¸« / æ¯:PM', 
                money: 500000, intel: 75, happy: 70, yearlyMoney: 15000, 
                buff: 'ğŸ’» ç¨‹å¼è¨­è¨ˆ+30ï¼Œç§‘æŠ€è³‡æºè±å¯Œ'
            },
            { 
                id: 'artist', name: 'è—è¡“å®¶æ—', 
                desc: 'çˆ¶è¦ªæ˜¯ç•«å®¶ï¼Œæ¯è¦ªæ˜¯é‹¼ç´å®¶ï¼Œå®¶è£¡å……æ»¿è—è¡“æ°£æ¯ã€‚', 
                parents: 'çˆ¶:ç•«å®¶ / æ¯:é‹¼ç´å®¶', 
                money: 80000, intel: 65, happy: 85, yearlyMoney: 2000, 
                buff: 'ğŸ¨ è—è¡“+40ï¼Œé­…åŠ›+10ï¼Œæ”¶å…¥ä¸ç©©'
            },
            { 
                id: 'politician', name: 'æ”¿æ²»ä¸–å®¶', 
                desc: 'çˆ¶è¦ªæ˜¯ç«‹å§”ï¼Œçˆºçˆºæ˜¯å‰å¸‚é•·ï¼Œå®¶æ—åœ¨æ”¿å£‡æœ‰å½±éŸ¿åŠ›ã€‚', 
                parents: 'çˆ¶:ç«‹æ³•å§”å“¡ / æ¯:åŸºé‡‘æœƒåŸ·è¡Œé•·', 
                money: 2000000, intel: 70, happy: 75, yearlyMoney: 30000, 
                buff: 'ğŸ›ï¸ æºé€š+25ï¼Œäººè„ˆå»£ï¼Œåˆå§‹è³‡é‡‘è±åš'
            },
            { 
                id: 'orphan', name: 'å­¤å…’é™¢', 
                desc: 'å¾å°åœ¨å­¤å…’é™¢é•·å¤§ï¼Œæ²’æœ‰è¦ªäººï¼Œåªèƒ½é è‡ªå·±ã€‚æ›´æ‡‚å¾—çæƒœã€‚', 
                parents: 'ç„¡', 
                money: 0, intel: 50, happy: 50, yearlyMoney: 0, 
                buff: 'ğŸ˜¢ ç„¡çˆ¶æ¯ä½†æ„å¿—åŠ›+30ï¼Œæ›´ç¨ç«‹'
            },
            { 
                id: 'temple', name: 'å»Ÿå®‡ä¸–å®¶', 
                desc: 'å®¶æ—ä¸–ä»£ç®¡ç†åœ°æ–¹å¤§å»Ÿï¼Œå¾å°åƒèˆ‡å»Ÿæœƒæ´»å‹•ï¼Œç†Ÿæ‚‰æ°‘ä¿—æ–‡åŒ–ã€‚', 
                parents: 'çˆ¶:å»Ÿå®‡ä¸»å§” / æ¯:ä¹©ç«¥', 
                money: 300000, intel: 50, happy: 80, yearlyMoney: 5000, 
                buff: 'ğŸ® æºé€š+15ï¼Œå¿«æ¨‚+5ï¼Œåœ°æ–¹äººè„ˆå»£'
            },
            { 
                id: 'mafia', name: 'é»‘é“ä¸–å®¶', 
                desc: 'çˆ¶è¦ªæ˜¯è§’é ­ï¼Œå®¶æ—åœ¨åœ°æ–¹æœ‰å‹¢åŠ›ã€‚å¾å°åœ¨åˆ€å…‰åŠå½±ä¸­é•·å¤§ã€‚', 
                parents: 'çˆ¶:è§’é ­è€å¤§ / æ¯:é…’åº—ç¶“ç†', 
                money: 500000, intel: 45, happy: 60, yearlyMoney: 20000, 
                buff: 'ğŸ—¡ï¸ é­…åŠ›+20ï¼Œå¥åº·+15ï¼Œä½†é¢¨éšªé«˜'
            }
        ];

        const JOBS = [
            { id: 'none', name: 'ç„¡æ¥­', salary: 0, requirement: {}, effect: null, desc: 'å¾…æ¥­ä¸­' },
            { id: 'clerk', name: 'ä¸€èˆ¬è·å“¡', salary: 35000, requirement: { intel: 40 }, 
              effect: (g) => { g.happy -= 2; }, desc: 'æœä¹æ™šäº”çš„è¾¦å…¬å®¤å·¥ä½œ' },
            { id: 'engineer', name: 'è»Ÿé«”å·¥ç¨‹å¸«', salary: 80000, requirement: { intel: 80, programming: 60 }, 
              effect: (g) => { g.skills.programming += 2; g.happy -= 5; g.health -= 3; }, desc: 'é«˜è–ªä½†å£“åŠ›å¤§ï¼Œå¸¸åŠ ç­' },
            { id: 'doctor', name: 'é†«ç”Ÿ', salary: 180000, requirement: { intel: 120, medical: 80 }, 
              effect: (g) => { g.health -= 5; g.skills.medical += 3; }, desc: 'æ•‘æ­»æ‰¶å‚·ï¼Œæ”¶å…¥è±åšä½†è¾›è‹¦' },
            { id: 'artist', name: 'è—è¡“å®¶', salary: 40000, requirement: { art: 70, charm: 60 }, 
              effect: (g) => { g.happy += 10; g.skills.art += 3; }, desc: 'æ”¶å…¥ä¸ç©©ä½†è¿½æ±‚å¤¢æƒ³' },
            { id: 'teacher', name: 'æ•™å¸«', salary: 55000, requirement: { intel: 70, communication: 60 }, 
              effect: (g) => { g.happy += 5; g.skills.communication += 2; }, desc: 'ç©©å®šä¸”æœ‰æ„ç¾©çš„å·¥ä½œ' },
            { id: 'entrepreneur', name: 'å‰µæ¥­å®¶', salary: 120000, requirement: { intel: 90, finance: 70, charm: 70 }, 
              effect: (g) => { 
                const fluctuation = Math.floor(Math.random() * 150000 - 50000);
                g.money += fluctuation;
                g.happy -= 15;
                g.health -= 8;
                if (fluctuation > 0) log(`ğŸ’° äº‹æ¥­æœ‰æˆï¼Œé¡å¤–è³ºäº† $${fluctuation.toLocaleString()}`);
                else log(`ğŸ“‰ äº‹æ¥­è™§æ $${Math.abs(fluctuation).toLocaleString()}`);
              }, desc: 'é«˜é¢¨éšªé«˜å›å ±ï¼Œæ”¶å…¥æ³¢å‹•å¤§' },
            { id: 'influencer', name: 'ç¶²ç´…/ç›´æ’­ä¸»', salary: 90000, requirement: { charm: 90, communication: 70 }, 
              effect: (g) => { g.skills.charm += 2; g.happy += 8; g.money += Math.floor(Math.random() * 50000); }, 
              desc: 'é ç²‰çµ²ç¶“æ¿Ÿè³ºéŒ¢ï¼Œæ”¶å…¥ä¸ç©©' },
            { id: 'scientist', name: 'ç ”ç©¶å“¡', salary: 95000, requirement: { intel: 110 }, 
              effect: (g) => { g.intel += 5; g.happy += 3; }, desc: 'æ¢ç´¢æœªçŸ¥çš„é‚Šç•Œ' },
            { id: 'lawyer', name: 'å¾‹å¸«', salary: 150000, requirement: { intel: 100, communication: 80 }, 
              effect: (g) => { g.skills.communication += 3; g.happy -= 8; }, desc: 'é«˜æ”¶å…¥ä½†å·¥ä½œå£“åŠ›å¤§' },
            { id: 'chef', name: 'ä¸»å»š', salary: 60000, requirement: { cooking: 80, art: 40 }, 
              effect: (g) => { g.skills.cooking += 3; g.happy += 5; }, desc: 'ç”¨ç¾é£Ÿç™‚ç™’äººå¿ƒ' },
            { id: 'pilot', name: 'æ©Ÿå¸«', salary: 200000, requirement: { intel: 90, health: 80 }, 
              effect: (g) => { g.health -= 5; g.happy += 3; }, desc: 'ç¿±ç¿”å¤©éš›ï¼Œé«˜è–ªä½†é«”åŠ›æ¶ˆè€—å¤§' },
            { id: 'athlete', name: 'è·æ¥­é‹å‹•å“¡', salary: 100000, requirement: { health: 90, charm: 60 }, 
              effect: (g) => { 
                g.health += 3;
                if (g.age > 35) {
                  g.happy -= 10;
                  log('âš ï¸ å¹´ç´€æ¼¸é•·ï¼Œè·æ¥­ç”Ÿæ¶¯æ¥è¿‘å°¾è²');
                }
              }, desc: 'åƒé’æ˜¥é£¯ï¼Œ35æ­²å¾Œæ€¥é½è¡°é€€' },
            { id: 'police', name: 'è­¦å¯Ÿ', salary: 65000, requirement: { health: 70, communication: 50 }, 
              effect: (g) => { g.health -= 3; g.happy -= 5; }, desc: 'ç¶­è­·ç¤¾æœƒæ²»å®‰ï¼Œä½†æœ‰è·æ¥­é¢¨éšª' },
            { id: 'designer', name: 'è¨­è¨ˆå¸«', salary: 70000, requirement: { art: 80, programming: 40 }, 
              effect: (g) => { g.skills.art += 3; g.happy += 3; }, desc: 'ç™¼æ®å‰µæ„ï¼Œå·¥ä½œè‡ªç”±åº¦é«˜' }
        ];

        const ACHIEVEMENTS = [
            { id: 'first_job', name: 'åˆå…¥è·å ´', desc: 'ç²å¾—ç¬¬ä¸€ä»½å·¥ä½œ', icon: 'ğŸ’¼', check: (g) => g.jobId !== 'none' },
            { id: 'millionaire', name: 'ç™¾è¬å¯Œç¿', desc: 'è³‡ç”¢é”åˆ°100è¬', icon: 'ğŸ’°', check: (g) => g.money >= 1000000 },
            { id: 'ten_million', name: 'åƒè¬å¯Œè±ª', desc: 'è³‡ç”¢é”åˆ°1000è¬', icon: 'ğŸ’', check: (g) => g.money >= 10000000 },
            { id: 'billionaire', name: 'å„„è¬å¯Œç¿', desc: 'è³‡ç”¢é”åˆ°1å„„', icon: 'ğŸ†', check: (g) => g.money >= 100000000 },
            { id: 'genius', name: 'å¤©æ‰', desc: 'æ™ºåŠ›é”åˆ°150', icon: 'ğŸ§ ', check: (g) => g.intel >= 150 },
            { id: 'charming', name: 'è¬äººè¿·', desc: 'é­…åŠ›é”åˆ°120', icon: 'âœ¨', check: (g) => g.skills.charm >= 120 },
            { id: 'healthy', name: 'å¥åº·é”äºº', desc: '60æ­²æ™‚å¥åº·ä»>80', icon: 'ğŸ’ª', check: (g) => g.age >= 60 && g.health > 80 },
            { id: 'happy_life', name: 'å¿«æ¨‚äººç”Ÿ', desc: 'ä¿æŒå¿«æ¨‚å€¼>80é”30å¹´', icon: 'ğŸ˜Š', check: (g) => g.happyYears >= 30 },
            { id: 'social_master', name: 'ç¤¾äº¤é”äºº', desc: 'æ“æœ‰5å€‹ä»¥ä¸Šå¥½å‹', icon: 'ğŸ‘¥', check: (g) => g.relationships.filter(r => r.type === 'friend').length >= 5 },
            { id: 'married', name: 'åŸ·å­ä¹‹æ‰‹', desc: 'æˆåŠŸçµå©š', icon: 'ğŸ’', check: (g) => g.relationships.some(r => r.id.startsWith('spouse')) },
            { id: 'parent', name: 'ç‚ºäººçˆ¶æ¯', desc: 'æ“æœ‰å­å¥³', icon: 'ğŸ‘¶', check: (g) => g.relationships.some(r => r.type === 'child') },
            { id: 'house_owner', name: 'æœ‰æˆ¿ä¸€æ—', desc: 'è³¼è²·ç¬¬ä¸€é–“æˆ¿ç”¢', icon: 'ğŸ˜ï¸', check: (g) => g.inventory.some(i => i.startsWith('house')) },
            { id: 'car_owner', name: 'æœ‰è»Šä¸€æ—', desc: 'è³¼è²·ç¬¬ä¸€è¼›è»Š', icon: 'ğŸï¸', check: (g) => g.inventory.some(i => i.startsWith('car')) },
            { id: 'skill_master', name: 'å…¨èƒ½å¤©æ‰', desc: 'æ‰€æœ‰æŠ€èƒ½é”åˆ°80', icon: 'ğŸŒŸ', check: (g) => Object.values(g.skills).every(v => v >= 80) },
            { id: 'elder', name: 'é•·å£½', desc: 'æ´»åˆ°80æ­²', icon: 'ğŸ‚', check: (g) => g.age >= 80 },
            { id: 'centenarian', name: 'äººç‘', desc: 'æ´»åˆ°100æ­²', icon: 'ğŸŠ', check: (g) => g.age >= 100 },
            { id: 'perfect', name: 'å®Œç¾äººç”Ÿ', desc: '60æ­²æ™‚å¥åº·/å¿«æ¨‚/é‡‘éŒ¢éƒ½>é«˜æ¨™', icon: 'ğŸ‘‘', check: (g) => g.age >= 60 && g.health > 80 && g.happy > 80 && g.money > 10000000 },
            { id: 'workaholic', name: 'å·¥ä½œç‹‚', desc: 'åœ¨åŒä¸€è·ä½å·¥ä½œè¶…é20å¹´', icon: 'ğŸ“Š', check: (g) => g.jobYears >= 20 },
            { id: 'debt_free', name: 'ç„¡å‚µä¸€èº«è¼•', desc: 'å¾è² å‚µç‹€æ…‹ç¿»èº«åˆ°è³‡ç”¢100è¬', icon: 'ğŸ¯', check: (g) => g.hasBeenInDebt && g.money >= 1000000 },
            { id: 'rags_to_riches', name: 'å±Œçµ²é€†è¥²', desc: 'å¾è²§å›°å‡ºèº«æˆç‚ºå„„è¬å¯Œç¿', icon: 'ğŸš€', check: (g) => ['genius', 'single_parent', 'orphan', 'farmer'].includes(g.originId) && g.money >= 100000000 }
        ];

        const LIFE_STAGES = [
            { min: 0, max: 2, name: 'å¬°å…’æœŸ', icon: 'ğŸ‘¶' },
            { min: 3, max: 5, name: 'å¹¼å…’æœŸ', icon: 'ğŸ§’' },
            { min: 6, max: 12, name: 'å…’ç«¥æœŸ', icon: 'ğŸ‘¦' },
            { min: 13, max: 17, name: 'é’å°‘å¹´', icon: 'ğŸ§‘' },
            { min: 18, max: 25, name: 'é’å¹´æœŸ', icon: 'ğŸ‘¨' },
            { min: 26, max: 40, name: 'å£¯å¹´æœŸ', icon: 'ğŸ‘¨â€ğŸ’¼' },
            { min: 41, max: 60, name: 'ä¸­å¹´æœŸ', icon: 'ğŸ‘¨â€ğŸ¦³' },
            { min: 61, max: 999, name: 'è€å¹´æœŸ', icon: 'ğŸ‘´' }
        ];

        const CARS = [
            { id: 'car1', name: 'åœ‹ç”¢ä»£æ­¥è»Š', price: 500000, charm: 3, desc: 'é®é¢¨é¿é›¨å°±å¥½' },
            { id: 'car2', name: 'Toyota Camry', price: 1200000, charm: 8, desc: 'å¯é è€ç”¨çš„ä¸­å‹æˆ¿è»Š' },
            { id: 'car3', name: 'Tesla Model 3', price: 1800000, charm: 15, desc: 'é›»å‹•è»Šæ–°æ½®æµ' },
            { id: 'car4', name: 'BMW 5ç³»åˆ—', price: 3500000, charm: 25, desc: 'è±ªè¯å“ç‰Œè±¡å¾µ' },
            { id: 'car5', name: 'ä¿æ™‚æ· 911', price: 7000000, charm: 40, desc: 'ç¶“å…¸è·‘è»Š' },
            { id: 'car6', name: 'æ³•æ‹‰åˆ© F8', price: 15000000, charm: 70, desc: 'çµ‚æ¥µå¤¢å¹»è·‘è»Š' }
        ];
        
        const HOUSES = [
            { id: 'house1', name: 'å¥—æˆ¿', price: 2500000, happy: 5, passive: 3000, desc: 'å°è€Œæº«é¦¨çš„èµ·é»' },
            { id: 'house2', name: 'å…©æˆ¿å…¬å¯“', price: 6000000, happy: 12, passive: 8000, desc: 'é©åˆå°å®¶åº­' },
            { id: 'house3', name: 'é›»æ¢¯å¤§æ¨“', price: 12000000, happy: 20, passive: 15000, desc: 'ç”Ÿæ´»æ©Ÿèƒ½å®Œå–„' },
            { id: 'house4', name: 'é€å¤©å', price: 25000000, happy: 30, passive: 30000, desc: 'ç¨é–€ç¨æˆ¶çš„è‡ªç”±' },
            { id: 'house5', name: 'å¸å¯¶è±ªå®…', price: 80000000, happy: 50, passive: 80000, desc: 'é ‚ç´šç”Ÿæ´»å“è³ª' },
            { id: 'house6', name: 'æµ·æ™¯åˆ¥å¢…', price: 200000000, happy: 80, passive: 200000, desc: 'äººç”Ÿé ‚å³°çš„è±¡å¾µ' }
        ];

        const LUXURIES = [
            { id: 'lux1', name: 'å‹åŠ›å£«æ‰‹éŒ¶', price: 500000, charm: 10, desc: 'æ™‚é–“çš„è—è¡“å“' },
            { id: 'lux2', name: 'åç‰ŒåŒ…', price: 300000, charm: 8, desc: 'LVã€Gucciã€HermÃ¨s' },
            { id: 'lux3', name: 'é«˜ç´šéŸ³éŸ¿', price: 800000, happy: 10, desc: 'äº«å—é ‚ç´šéŸ³è³ª' },
            { id: 'lux4', name: 'éŠè‰‡', price: 50000000, charm: 50, happy: 30, desc: 'æµ·ä¸Šç§»å‹•åŸå ¡' },
            { id: 'lux5', name: 'ç§äººé£›æ©Ÿ', price: 300000000, charm: 100, happy: 50, desc: 'çµ‚æ¥µå¥¢è¯' }
        ];

        // ==========================================
        // ğŸ”´ éŠæˆ²ç‹€æ…‹
        // ==========================================
        let currentOriginIndex = 0;
        let Game = {
            name: '', origin: '', originId: '', age: 0, gender: 'ç”·',
            money: 0, health: 100, happy: 80, intel: 50,
            stamina: 100, maxStamina: 100,
            
            skills: {
                programming: 0,
                art: 0,
                medical: 0,
                cooking: 0,
                finance: 0,
                communication: 0,
                charm: 0
            },
            
            jobId: 'none',
            jobYears: 0,
            yearlyMoney: 0,
            
            inventory: [],
            relationships: [],
            talents: [],
            unlockedAchievements: [],
            
            happyYears: 0,
            debtYears: 0,
            hasBeenInDebt: false,
            totalActions: 0,
            totalEvents: 0,
            
            // åŠ æˆä¿‚æ•¸
            learnBonus: 1,
            healthDecay: 1,
            happyDecay: 1,
            socialBonus: 1,
            incomeBonus: 1,
            workPenalty: 1,
            skillBonus: 1,
            luckBonus: 0
        };

        let activeEvent = null;
        let selectedOriginId = 'common';

        // ==========================================
        // ğŸ”´ åˆå§‹åŒ–
        // ==========================================
        
        let currentOriginIndex = 0;

function initCreation() {
    // è¨­å®šç¸½æ•¸
    document.getElementById('total-origins').textContent = ORIGINS.length;
    
    // ç”ŸæˆæŒ‡ç¤ºå™¨é»é»
    let dotsHtml = '';
    ORIGINS.forEach((_, index) => {
        dotsHtml += `<div class="indicator-dot ${index === 0 ? 'active' : ''}" onclick="goToOrigin(${index})"></div>`;
    });
    document.getElementById('indicator-dots').innerHTML = dotsHtml;
    
    // é¡¯ç¤ºç¬¬ä¸€å€‹å‡ºèº«
    renderOriginCard();
    
    // éµç›¤å·¦å³éµæ”¯æ´
    document.addEventListener('keydown', function(e) {
        if (document.getElementById('scene-creation').style.display !== 'none') {
            if (e.key === 'ArrowLeft') changeOrigin(-1);
            if (e.key === 'ArrowRight') changeOrigin(1);
        }
    });
}

function renderOriginCard() {
    const origin = ORIGINS[currentOriginIndex];
    selectedOriginId = origin.id;
    
    const html = `
        <div class="origin-card selected" data-origin-id="${origin.id}">
            <div class="origin-name">${origin.name}</div>
            <div class="origin-parents">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ${origin.parents}</div>
            <div class="origin-desc">${origin.desc}</div>
            <div class="origin-stats">
                ğŸ’° åˆå§‹è³‡é‡‘: $${origin.money.toLocaleString()}<br>
                ğŸ§  æ™ºåŠ›: ${origin.intel} | ğŸ˜Š å¿«æ¨‚: ${origin.happy}<br>
                ğŸ“… å¹´é›¶ç”¨éŒ¢: $${origin.yearlyMoney.toLocaleString()}<br>
                âœ¨ ${origin.buff}
            </div>
        </div>
    `;
    
    document.getElementById('origin-display').innerHTML = html;
    document.getElementById('current-origin').textContent = currentOriginIndex + 1;
    
    // æ›´æ–°æŒ‡ç¤ºå™¨
    document.querySelectorAll('.indicator-dot').forEach((dot, index) => {
        if (index === currentOriginIndex) {
            dot.classList.add('active');
        } else {
            dot.classList.remove('active');
        }
    });
}

function changeOrigin(direction) {
    currentOriginIndex += direction;
    
    // å¾ªç’°
    if (currentOriginIndex < 0) {
        currentOriginIndex = ORIGINS.length - 1;
    } else if (currentOriginIndex >= ORIGINS.length) {
        currentOriginIndex = 0;
    }
    
    renderOriginCard();
}

function goToOrigin(index) {
    currentOriginIndex = index;
    renderOriginCard();
}

function selectOrigin(id) {
    // ä¿ç•™é€™å€‹å‡½æ•¸ä»¥é˜²å…¶ä»–åœ°æ–¹èª¿ç”¨
    selectedOriginId = id;
}

        function selectOrigin(id) {
            selectedOriginId = id;
            document.querySelectorAll('.origin-card').forEach(c => c.classList.remove('selected'));
            const selectedCard = document.querySelector(`[data-origin-id="${id}"]`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
            }
        }

        function startGame() {
            const name = document.getElementById('inp-name').value.trim();
            if (!name) return alert('è«‹è¼¸å…¥å§“å');
            
            const origin = ORIGINS.find(o => o.id === selectedOriginId);
            const gender = document.getElementById('inp-gender').value;
            
            // éš¨æ©Ÿå¤©è³¦
            let talentPool = [...TALENTS];
            let selectedTalents = [];
            const talentCount = Math.random() > 0.6 ? 2 : 1;
            for (let i = 0; i < talentCount; i++) {
                const idx = Math.floor(Math.random() * talentPool.length);
                selectedTalents.push(talentPool[idx]);
                talentPool.splice(idx, 1);
            }
            
            // åˆå§‹åŒ–éŠæˆ²ç‹€æ…‹
            Game = {
                ...Game,
                name, origin: origin.name, originId: origin.id, gender,
                money: origin.money,
                intel: origin.intel,
                happy: origin.happy,
                yearlyMoney: origin.yearlyMoney,
                talents: selectedTalents,
                age: 0,
                relationships: []
            };
            
            // è¨˜éŒ„æ˜¯å¦è² å‚µé
            if (Game.money < 0) Game.hasBeenInDebt = true;
            
            // æ ¹æ“šå‡ºèº«æ·»åŠ çˆ¶æ¯é—œä¿‚
            if (origin.parents && origin.parents !== 'ç„¡') {
                const parentsSplit = origin.parents.split(' / ');
                if (parentsSplit.length === 2) {
                    Game.relationships.push(
                        { id: 'dad', name: 'çˆ¸çˆ¸', type: 'parent', relation: 80, role: parentsSplit[0] },
                        { id: 'mom', name: 'åª½åª½', type: 'parent', relation: 90, role: parentsSplit[1] }
                    );
                } else if (parentsSplit.length === 1) {
                    Game.relationships.push(
                        { id: 'mom', name: 'åª½åª½', type: 'parent', relation: 95, role: parentsSplit[0] }
                    );
                }
            }
            
            // æ‡‰ç”¨å‡ºèº«ç‰¹æ®Šæ•ˆæœ
            if (origin.id === 'military') Game.health += 20;
            if (origin.id === 'doctor') Game.skills.medical += 30;
            if (origin.id === 'farmer') { Game.health += 15; Game.happy += 5; }
            if (origin.id === 'fisher') Game.health += 10;
            if (origin.id === 'aboriginal') { Game.skills.charm += 15; Game.skills.art += 20; Game.happy += 10; }
            if (origin.id === 'immigrant') Game.skills.communication += 20;
            if (origin.id === 'tech') Game.skills.programming += 30;
            if (origin.id === 'artist') { Game.skills.art += 40; Game.skills.charm += 10; }
            if (origin.id === 'politician') Game.skills.communication += 25;
            if (origin.id === 'temple') { Game.skills.communication += 15; Game.happy += 5; }
            if (origin.id === 'mafia') { Game.skills.charm += 20; Game.health += 15; }
            if (origin.id === 'star') Game.skills.charm += 30;
            
            // æ‡‰ç”¨å¤©è³¦æ•ˆæœ
            Game.talents.forEach(t => t.effect(Game));
            
            document.getElementById('scene-creation').style.display = 'none';
            document.getElementById('scene-game').style.display = 'block';
            
            updateUI();
            renderJobs();
            renderShop();
            renderSocial();
            renderAchievements();
            renderStats();
            
            log(`ğŸ‘¶ ${Game.name} å‡ºç”Ÿäº†ï¼`);
            log(`ğŸ  å‡ºèº«ï¼š${Game.origin}`);
            log(`ğŸ² å¤©è³¦ï¼š${Game.talents.map(t => t.name).join('ã€')}`);
        }

        // ==========================================
        // ğŸ”´ UI æ›´æ–°
        // ==========================================
        
        function log(msg) {
            const box = document.getElementById('game-log');
            if (box) {
                const timestamp = `[${Game.age}æ­²] `;
                box.innerHTML += timestamp + msg + "<br>";
                box.scrollTop = box.scrollHeight;
            }
        }
        
        function updateUI() {
            // åŸºæœ¬è³‡è¨Š
            document.getElementById('player-name').textContent = Game.name;
            document.getElementById('age-display').textContent = Game.age;
            document.getElementById('player-origin').textContent = Game.origin;
            document.getElementById('player-job').textContent = JOBS.find(j => j.id === Game.jobId).name;
            document.getElementById('money-display').textContent = '$' + Game.money.toLocaleString();
            
            // æ•¸å€¼
            document.getElementById('health').textContent = Math.max(0, Math.floor(Game.health));
            document.getElementById('happy').textContent = Math.max(0, Math.floor(Game.happy));
            document.getElementById('intel').textContent = Math.floor(Game.intel);
            
            // é ­åƒ
            const stage = LIFE_STAGES.find(s => Game.age >= s.min && Game.age <= s.max);
            document.getElementById('player-avatar').textContent = stage.icon;
            document.getElementById('life-stage').textContent = stage.name;
            
            // å¤©è³¦æ¨™ç±¤
            let talentHtml = '';
            Game.talents.forEach(t => {
                talentHtml += `<span class="talent-tag ${t.type === 'bad' ? 'talent-bad' : ''}" title="${t.desc}">${t.name}</span>`;
            });
            document.getElementById('talent-display').innerHTML = talentHtml;
            
           // æŠ€èƒ½æ¢ï¼ˆåœ¨ updateUI å‡½æ•¸å…§ï¼‰
let skillHtml = '';
const skillNames = {
    programming: 'ğŸ’» ç¨‹å¼',
    art: 'ğŸ¨ è—è¡“',
    medical: 'âš•ï¸ é†«ç™‚',
    cooking: 'ğŸ³ çƒ¹é£ª',
    finance: 'ğŸ’° ç†è²¡',
    communication: 'ğŸ’¬ æºé€š',
    charm: 'âœ¨ é­…åŠ›'
};

Object.keys(Game.skills).forEach(key => {
    const val = Math.min(200, Math.floor(Game.skills[key]));
    const percent = (val / 200) * 100;
    skillHtml += `
        <div class="skill-item">
            <div class="skill-header">
                <span>${skillNames[key]}</span>
                <span>${val}</span>
            </div>
            <div class="skill-bar-bg">
                <div class="skill-bar-fill" style="width: ${percent}%"></div>
            </div>
        </div>
    `;
});

// æª¢æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„æŠ˜ç–Šç‹€æ…‹
const isCollapsed = localStorage.getItem('skillsCollapsed') === 'true';
const collapsedClass = isCollapsed ? 'collapsed' : '';

document.getElementById('skills-container').innerHTML = `
    <div class="skills-header" onclick="toggleSkills()">
        <div class="skills-title">ğŸ“Š æŠ€èƒ½é¢æ¿</div>
        <div class="skills-toggle ${collapsedClass}">â–¼</div>
    </div>
    <div class="skills-body ${collapsedClass}">
        ${skillHtml}
    </div>
`;
            
            // é«”åŠ›æ¢
            const stamina = Math.max(0, Math.min(100, Game.stamina));
            const staminaRatio = stamina / 100;
            document.getElementById('stamina-bar').style.transform = `scaleX(${staminaRatio})`;
            document.getElementById('stamina-text').textContent = `${Math.floor(stamina)}/100`;
            
            if (stamina < 20) {
                document.getElementById('stamina-bar').classList.add('low');
            } else {
                document.getElementById('stamina-bar').classList.remove('low');
            }
            
            // ç‹€æ…‹è­¦å‘Š
            let alertHtml = '';
            if (Game.money < 0) {
                alertHtml += `<div class="status-alert alert-red">âš ï¸ è² å‚µè­¦å‘Šï¼å‰© ${3 - Game.debtYears} å¹´</div>`;
            }
            if (Game.happy < 20) {
                alertHtml += `<div class="status-alert alert-orange">â˜ï¸ æ†‚é¬±ç‹€æ…‹</div>`;
            }
            if (Game.health < 30) {
                alertHtml += `<div class="status-alert alert-red">ğŸ¥ é‡ç—…è­¦å‘Š</div>`;
            }
            if (Game.age >= 18 && Game.jobId === 'none') {
                alertHtml += `<div class="status-alert alert-blue">ğŸ’¼ å°šæœªå°±æ¥­</div>`;
            }
            document.getElementById('status-alerts').innerHTML = alertHtml;
            
            // æ›´æ–°è¡Œå‹•æŒ‰éˆ•
            updateActionButtons();
        }

        function updateActionButtons() {
            const btns = document.getElementById('action-buttons');
            let html = '';
            
            const age = Game.age;
            
            if (age <= 2) {
                html = `
                    <button onclick="action('cry')">ğŸ˜­ å“­é¬§<span class="cost-tag">âš¡-10</span></button>
                    <button onclick="action('sleep')">ğŸ˜´ ç¡è¦º<span class="cost-tag">âš¡-20</span></button>
                    <button onclick="action('play_toy')">ğŸ§¸ ç©ç©å…·<span class="cost-tag">âš¡-15</span></button>
                    <button onclick="action('learn_speak')">ğŸ—£ï¸ ç‰™ç‰™å­¸èª<span class="cost-tag">âš¡-25</span></button>
                `;
            } else if (age <= 5) {
                html = `
                    <button onclick="action('kindergarten')">ğŸ« ä¸Šå¹¼å…’åœ’<span class="cost-tag">âš¡-20</span></button>
                    <button onclick="action('draw')">ğŸ–ï¸ ç•«ç•«<span class="cost-tag">âš¡-15</span></button>
                    <button onclick="action('watch_tv')">ğŸ“º çœ‹å¡é€š<span class="cost-tag">âš¡-10</span></button>
                    <button onclick="action('make_friend')">ğŸ‘« äº¤æœ‹å‹<span class="cost-tag">âš¡-20</span></button>
                `;
            } else if (age <= 12) {
                html = `
                    <button onclick="action('study_hard')">ğŸ“– èªçœŸè®€æ›¸<span class="cost-tag">âš¡-30</span></button>
                    <button onclick="action('cram_school')">ğŸ“š è£œç¿’ç­<span class="cost-tag">âš¡-25 / $-2000</span></button>
                    <button onclick="action('sports')">âš½ é‹å‹•<span class="cost-tag">âš¡-20</span></button>
                    <button onclick="action('play_game')">ğŸ® æ‰“é›»å‹•<span class="cost-tag">âš¡-15</span></button>
                `;
            } else if (age <= 17) {
                html = `
                    <button onclick="action('exam_prep')">ğŸ“ è€ƒè©¦è¡åˆº<span class="cost-tag">âš¡-35</span></button>
                    <button onclick="action('club')">ğŸ¸ ç¤¾åœ˜æ´»å‹•<span class="cost-tag">âš¡-20</span></button>
                    <button onclick="action('date_crush')">ğŸ’• ç´„æ›–æ˜§å°è±¡<span class="cost-tag">âš¡-25 / $-500</span></button>
                    <button onclick="action('rebel')">ğŸ˜ å›é€†æœŸ<span class="cost-tag">âš¡-15</span></button>
                `;
            } else {
                html = `
                    <button onclick="action('work')">ğŸ’¼ åŠªåŠ›å·¥ä½œ<span class="cost-tag">âš¡-35</span></button>
                    <button onclick="action('study_skill')">ğŸ“š å­¸ç¿’æŠ€èƒ½<span class="cost-tag">âš¡-25 / $-3000</span></button>
                    <button onclick="action('socialize')">ğŸ» ç¤¾äº¤æ´»å‹•<span class="cost-tag">âš¡-20 / $-2000</span></button>
                    <button onclick="action('relax')">ğŸ® ä¼‘é–’å¨›æ¨‚<span class="cost-tag">âš¡-15 / $-1000</span></button>
                `;
            }
            
            btns.innerHTML = html;
            
            const allBtns = btns.querySelectorAll('button');
            allBtns.forEach(btn => {
                if (Game.stamina < 10 || Game.happy < 5 || Game.health <= 0) {
                    btn.disabled = true;
                }
            });
        }

        function action(type) {
            if (Game.health <= 0) return alert('å·²æ­»äº¡ï¼Œè«‹æŒ‰ã€Œä¸‹ä¸€æ­²ã€æŸ¥çœ‹çµå±€');
            
            let cost = 20;
            let effects = {};
            
            switch (type) {
                case 'cry':
                    cost = 10;
                    effects = { happy: 5 };
                    log('ğŸ˜­ å“­äº†ä¸€æ•´å¤©ï¼Œçˆ¸åª½ä¾†å“„ä½ ');
                    break;
                case 'sleep':
                    cost = 20;
                    effects = { health: 3, happy: 2 };
                    log('ğŸ˜´ ç¡å¾—å¾ˆé¦™ç”œ');
                    break;
                case 'play_toy':
                    cost = 15;
                    effects = { happy: 8 };
                    log('ğŸ§¸ ç©ç©å…·å¥½é–‹å¿ƒ');
                    break;
                case 'learn_speak':
                    cost = 25;
                    effects = { intel: 3 * Game.learnBonus, 'skills.communication': 2 * Game.skillBonus };
                    log('ğŸ—£ï¸ å­¸æœƒèªªæ›´å¤šè©å½™');
                    break;
                case 'kindergarten':
                    cost = 20;
                    effects = { intel: 2 * Game.learnBonus, 'skills.communication': 3 * Game.skillBonus, happy: 5 };
                    log('ğŸ« åœ¨å¹¼å…’åœ’ç©å¾—å¾ˆé–‹å¿ƒ');
                    break;
                case 'draw':
                    cost = 15;
                    effects = { 'skills.art': 4 * Game.skillBonus, happy: 5 };
                    log('ğŸ–ï¸ ç•«äº†ä¸€å¹…ç•«');
                    break;
                case 'watch_tv':
                    cost = 10;
                    effects = { happy: 10, intel: -1 };
                    log('ğŸ“º çœ‹äº†ä¸€æ•´å¤©å¡é€š');
                    break;
                case 'make_friend':
                    cost = 20;
                    effects = { 'skills.communication': 5 * Game.skillBonus, happy: 8 };
                    log('ğŸ‘« äº¤åˆ°æ–°æœ‹å‹äº†');
                    if (Math.random() > 0.7) addFriend();
                    break;
                case 'study_hard':
                    cost = 30;
                    effects = { intel: 5 * Game.learnBonus, happy: -3 };
                    log('ğŸ“– èªçœŸè®€æ›¸ï¼Œæˆç¸¾é€²æ­¥');
                    break;
                case 'cram_school':
                    if (Game.money < 2000) return alert('æ²’éŒ¢è£œç¿’');
                    cost = 25;
                    effects = { intel: 8 * Game.learnBonus, money: -2000, happy: -5 };
                    log('ğŸ“š è£œç¿’ç­è¡åˆº');
                    break;
                case 'sports':
                    cost = 20;
                    effects = { health: 5, happy: 5, 'skills.charm': 2 * Game.skillBonus };
                    log('âš½ é‹å‹•æµæ±—çœŸèˆ’æš¢');
                    break;
                case 'play_game':
                    cost = 15;
                    effects = { happy: 12, intel: -2 };
                    log('ğŸ® æ‰“é›»å‹•æ‰“åˆ°å¿˜è¨˜æ™‚é–“');
                    break;
                case 'exam_prep':
                    cost = 35;
                    effects = { intel: 10 * Game.learnBonus, happy: -8 };
                    log('ğŸ“ ç‚ºè€ƒè©¦åŠªåŠ›è¡åˆº');
                    break;
                case 'club':
                    cost = 20;
                    effects = { 'skills.communication': 5 * Game.skillBonus, 'skills.charm': 3 * Game.skillBonus, happy: 10 };
                    log('ğŸ¸ ç¤¾åœ˜æ´»å‹•å¾ˆæœ‰è¶£');
                    break;
                case 'date_crush':
                    if (Game.money < 500) return alert('æ²’éŒ¢ç´„æœƒ');
                    cost = 25;
                    effects = { money: -500, happy: 15, 'skills.charm': 5 * Game.skillBonus };
                    log('ğŸ’• å’Œæ›–æ˜§å°è±¡å‡ºå»ç©');
                    break;
                case 'rebel':
                    cost = 15;
                    effects = { happy: 8, intel: -3 };
                    log('ğŸ˜ å›é€†æœŸï¼Œä¸æƒ³è½å¤§äººçš„è©±');
                    Game.relationships.forEach(r => {
                        if (r.type === 'parent') r.relation -= 5;
                    });
                    break;
                case 'work':
                    cost = 35;
                    const job = JOBS.find(j => j.id === Game.jobId);
                    if (job && job.salary > 0) {
                        const salary = Math.floor(job.salary * Game.incomeBonus * Game.workPenalty);
                        effects = { money: salary, happy: -5, health: -3 };
                        log(`ğŸ’¼ å·¥ä½œè³ºäº† $${salary.toLocaleString()}`);
                        if (job.effect) job.effect(Game);
                        Game.jobYears++;
                    } else {
                        effects = { happy: -10 };
                        log('ğŸ’¼ å¾…æ¥­ä¸­ï¼Œå¿ƒæƒ…ä½è½');
                    }
                    break;
                case 'study_skill':
                    if (Game.money < 3000) return alert('æ²’éŒ¢é€²ä¿®');
                    cost = 25;
                    const skillKeys = Object.keys(Game.skills);
                    const randomSkill = skillKeys[Math.floor(Math.random() * skillKeys.length)];
                    effects = { money: -3000, intel: 3 * Game.learnBonus };
                    effects[`skills.${randomSkill}`] = 8 * Game.learnBonus * Game.skillBonus;
                    log(`ğŸ“š å­¸ç¿’äº†æ–°æŠ€èƒ½ (${randomSkill})`);
                    break;
                case 'socialize':
                    if (Game.money < 2000) return alert('æ²’éŒ¢ç¤¾äº¤');
                    cost = 20;
                    effects = { money: -2000, happy: 10, 'skills.communication': 5 * Game.skillBonus, 'skills.charm': 3 * Game.skillBonus };
                    log('ğŸ» å’Œæœ‹å‹èšé¤èŠå¤©');
                    if (Math.random() > 0.6) addFriend();
                    break;
                case 'relax':
                    if (Game.money < 1000) return alert('æ²’éŒ¢å¨›æ¨‚');
                    cost = 15;
                    effects = { money: -1000, happy: 15 };
                    log('ğŸ® æ”¾é¬†ä¼‘é–’ï¼Œå……é›»å®Œç•¢');
                    break;
            }
            
            if (Game.stamina < cost) return alert('é«”åŠ›ä¸è¶³');
            
            Game.stamina -= cost;
            Game.totalActions++;
            
            Object.keys(effects).forEach(key => {
                if (key.startsWith('skills.')) {
                    const skillName = key.split('.')[1];
                    Game.skills[skillName] = Math.max(0, Game.skills[skillName] + effects[key]);
                } else {
                    Game[key] = Game[key] + effects[key];
                }
            });
            
            updateUI();
        }

        function nextYear() {
            if (Game.health <= 0) {
                showEnding();
                return;
            }
            
            Game.age++;
            Game.stamina = 100;
            
            Game.health -= (3 * Game.healthDecay);
            Game.happy -= (2 * Game.happyDecay);
            
            if (Game.age >= 40) Game.health -= 2;
            if (Game.age >= 60) Game.health -= 3;
            if (Game.age >= 80) Game.health -= 5;
            
            if (Game.age < 18 && Game.yearlyMoney > 0) {
                Game.money += Game.yearlyMoney;
                log(`ğŸ§§ é ˜åˆ°é›¶ç”¨éŒ¢ $${Game.yearlyMoney.toLocaleString()}`);
            }
            
            if (Game.jobId !== 'none') {
                const job = JOBS.find(j => j.id === Game.jobId);
                const salary = Math.floor(job.salary * Game.incomeBonus * Game.workPenalty * 12);
                Game.money += salary;
                log(`ğŸ’¼ å¹´åº¦è–ªè³‡å…¥å¸³ $${salary.toLocaleString()}`);
            }
            
            const passiveIncome = Game.inventory.reduce((sum, id) => {
                const house = HOUSES.find(h => h.id === id);
                return sum + (house ? house.passive * 12 : 0);
            }, 0);
            
            if (passiveIncome > 0) {
                Game.money += passiveIncome;
                log(`ğŸ˜ï¸ æˆ¿ç”¢è¢«å‹•æ”¶å…¥ $${passiveIncome.toLocaleString()}`);
            }
            
            if (Game.money < 0) {
                Game.debtYears++;
                Game.hasBeenInDebt = true;
                if (Game.debtYears >= 3) {
                    Game.inventory = [];
                    Game.money = 0;
                    Game.happy -= 50;
                    log('ğŸ’¥ ç ´ç”¢ï¼è³‡ç”¢è¢«å……å…¬');
                    Game.debtYears = 0;
                }
            } else {
                Game.debtYears = 0;
            }
            
            if (Game.health < 30) {
                const medicalCost = 100000;
                Game.money -= medicalCost;
                log(`ğŸ¥ ä½é™¢æ²»ç™‚ -$${medicalCost.toLocaleString()}`);
            }
            
            Game.relationships.forEach(r => {
                r.relation = Math.max(0, r.relation - 2);
                if (r.relation < 20 && r.type === 'parent') {
                    log(`âš ï¸ å’Œ ${r.name} çš„é—œä¿‚ç–é äº†`);
                }
            });
            
            if (Game.happy > 80) Game.happyYears++;
            
            // é‡è¦äººç”Ÿç¯€é»
            if (Game.age === 6) log('ğŸ’ é–‹å§‹ä¸Šå°å­¸äº†');
            if (Game.age === 13) log('ğŸ« å‡ä¸Šä¸­å­¸');
            if (Game.age === 18) {
                log('ğŸ“ é«˜ä¸­ç•¢æ¥­ï¼å¯ä»¥é–‹å§‹å·¥ä½œäº†');
                checkAchievements();
            }
            if (Game.age === 30) log('ğŸ‚ é‚å…¥30æ­²å¤§é—œ');
            if (Game.age === 40) log('â° å·²ç¶“40æ­²äº†ï¼Œæ™‚å…‰é£›é€');
            if (Game.age === 50) log('ğŸ•°ï¸ åŠç™¾äººç”Ÿï¼Œå›é¡§éå¾€');
            if (Game.age === 60) log('ğŸ‘´ æ­¥å…¥è€å¹´ï¼Œå›é¦–äººç”Ÿ');
            if (Game.age === 70) log('ğŸŠ å¤ç¨€ä¹‹å¹´ï¼Œäººç”Ÿé–±æ­·è±å¯Œ');
            if (Game.age === 80) log('ğŸ‚ è€„è€‹ä¹‹å¹´ï¼Œé•·å£½çš„è±¡å¾µ');
            if (Game.age === 90) log('ğŸŒŸ é®èƒŒä¹‹å¹´ï¼Œå‚³å¥‡äººç”Ÿ');
            if (Game.age === 100) log('ğŸ‘‘ æœŸé ¤ä¹‹å¹´ï¼Œäººç‘å‚³å¥‡ï¼');
            
            log(`ğŸ‚ ${Game.age} æ­²äº†`);
            
                       
            // éš¨æ©Ÿäº‹ä»¶ 25% æ©Ÿç‡
            if (Math.random() < 0.25) {
                triggerRandomEvent();
            }
            
            if (Game.health <= 0) {
                Game.health = 0;
                log('ğŸ’€ ç”Ÿå‘½çµ‚çµ');
                showEnding();
                return;
            }
            
            checkAchievements();
            updateUI();
            renderSocial();
            renderStats();
        }

        // ==========================================
        // ğŸ”´ éš¨æ©Ÿäº‹ä»¶ç³»çµ±
        // ==========================================
        
        function triggerRandomEvent() {
            const events = [
                // å¥½é‹äº‹ä»¶
                { prob: 20, title: 'ğŸ° ä¸­æ¨‚é€', desc: 'è²·å½©åˆ¸ä¸­äº†å°çï¼', effect: (g) => { g.money += 100000; return 'ç²å¾— $100,000'; }},
                { prob: 15, title: 'ğŸ’¼ å‡è·åŠ è–ª', desc: 'å·¥ä½œè¡¨ç¾å„ªç•°ï¼Œè€é—†è³è­˜', effect: (g) => { g.money += 50000; g.happy += 10; return 'å¹´è–ª+$50,000'; }},
                { prob: 20, title: 'ğŸ“š æ„å¤–æ”¶ç©«', desc: 'åœ¨æ›¸åº—ç™¼ç¾ä¸€æœ¬æ”¹è®Šäººç”Ÿçš„æ›¸', effect: (g) => { g.intel += 5; g.happy += 8; return 'æ™ºåŠ›+5ï¼Œé–‹æ‹“è¦–é‡'; }},
                { prob: 15, title: 'ğŸƒ å¥èº«æˆåŠŸ', desc: 'å …æŒé‹å‹•ï¼Œé«”æ…‹è®Šå¥½', effect: (g) => { g.health += 10; g.skills.charm += 5; return 'å¥åº·+10ï¼Œé­…åŠ›+5'; }},
                { prob: 10, title: 'ğŸ’ æ”¶åˆ°ç¦®ç‰©', desc: 'æœ‹å‹é€ä½ é©šå–œç”Ÿæ—¥ç¦®ç‰©', effect: (g) => { g.happy += 15; return 'å¿ƒæƒ…å¤§å¥½'; }},
                
                // å£é‹äº‹ä»¶
                { prob: 25, title: 'ğŸš— äº¤é€šäº‹æ•…', desc: 'ç™¼ç”Ÿè»Šç¦ï¼Œéœ€è¦ä¼‘é¤Š', effect: (g) => { g.health -= 15; g.money -= 30000; g.happy -= 10; return 'å¥åº·-15ï¼Œé†«ç™‚è²»-$30,000'; }},
                { prob: 20, title: 'ğŸ¦  ç”Ÿç—…æ„Ÿå†’', desc: 'æ›å­£æ„Ÿå†’ï¼Œèº«é«”ä¸é©', effect: (g) => { g.health -= 8; g.happy -= 5; return 'å¥åº·-8ï¼Œè‡¥åºŠä¼‘æ¯'; }},
                { prob: 15, title: 'ğŸ“± æ‰‹æ©Ÿæ‰äº†', desc: 'æ‰‹æ©Ÿä¸æ…æ‰è½æ‘”å£', effect: (g) => { g.money -= 20000; g.happy -= 8; return 'æå¤± $20,000 æ›æ–°æ©Ÿ'; }},
                { prob: 20, title: 'ğŸ˜° å·¥ä½œå£“åŠ›', desc: 'å·¥ä½œé‡æš´å¢ï¼Œå£“åŠ›å±±å¤§', effect: (g) => { g.happy -= 12; g.health -= 5; return 'èº«å¿ƒä¿±ç–²'; }},
                { prob: 15, title: 'ğŸ’” å¤±æˆ€', desc: 'æ„Ÿæƒ…å‡ºç¾å•é¡Œ', effect: (g) => { g.happy -= 20; return 'å¿ƒç¢äº†'; }},
                
                // ä¸­æ€§äº‹ä»¶
                { prob: 18, title: 'ğŸ¬ è¿½åŠ‡', desc: 'è¿·ä¸Šä¸€éƒ¨ç¥åŠ‡ï¼Œç†¬å¤œè¿½å®Œ', effect: (g) => { g.happy += 10; g.health -= 5; return 'å¿«æ¨‚ä½†ç¼ºä¹ç¡çœ '; }},
                { prob: 18, title: 'ğŸ” å¤§é¤', desc: 'å’Œæœ‹å‹èšé¤åƒå¤§é¤', effect: (g) => { g.happy += 12; g.money -= 3000; return 'åƒå¾—å¾ˆé–‹å¿ƒ'; }},
                { prob: 15, title: 'ğŸ® é›»ç©å±•', desc: 'åƒåŠ éŠæˆ²å±•è¦½', effect: (g) => { g.happy += 15; g.money -= 2000; return 'è²·äº†å¾ˆå¤šå‘¨é‚Š'; }},
                { prob: 20, title: 'ğŸ“– è®€æ›¸æœƒ', desc: 'åƒåŠ è®€æ›¸æœƒåˆ†äº«', effect: (g) => { g.intel += 3; g.skills.communication += 5; return 'æ”¶ç©«è‰¯å¤š'; }},
                { prob: 18, title: 'ğŸ–ï¸ é€±æœ«æ—…è¡Œ', desc: 'çŸ­æœŸæ—…éŠæ”¾é¬†å¿ƒæƒ…', effect: (g) => { g.happy += 20; g.money -= 15000; return 'èº«å¿ƒå……é›»å®Œæˆ'; }}
            ];
            
            const event = events[Math.floor(Math.random() * events.length)];
            const result = event.effect(Game);
            
            log(`ğŸ“¢ ${event.title}ï¼š${event.desc}`);
            log(`   â””â”€ ${result}`);
            
            Game.totalEvents++;
            updateUI();
        }

        function showEnding() {
            let endingType = 'å¹³å‡¡äººç”Ÿ';
            let endingIcon = 'ğŸ’€';
            let endingDesc = 'ä½ çš„äººç”Ÿæ—…ç¨‹çµæŸäº†ã€‚';
            
            if (Game.money >= 100000000) {
                endingType = 'å„„è¬å¯Œç¿çµå±€';
                endingIcon = 'ğŸ‘‘';
                endingDesc = 'ä½ æˆç‚ºå„„è¬å¯Œç¿ï¼Œé”åˆ°è²¡å¯Œå·”å³°ï¼äººç”Ÿè´å®¶ï¼';
            } else if (Game.money >= 10000000) {
                endingType = 'æˆåŠŸäººå£«çµå±€';
                endingIcon = 'ğŸ’¼';
                endingDesc = 'ä½ æˆç‚ºåƒè¬å¯Œè±ªï¼Œéä¸Šäº†å¯Œè£•çš„ç”Ÿæ´»ã€‚';
            } else if (Game.age >= 100) {
                endingType = 'é•·å£½å‚³å¥‡çµå±€';
                endingIcon = 'ğŸŠ';
                endingDesc = 'ä½ æ´»åˆ°ç™¾æ­²é«˜é½¡ï¼Œè¦‹è­‰äº†æ™‚ä»£è®Šé·ï¼Œäººç”Ÿåœ“æ»¿ï¼';
            } else if (Game.age >= 80 && Game.happy > 70) {
                endingType = 'å¹¸ç¦äººç”Ÿçµå±€';
                endingIcon = 'ğŸ˜Š';
                endingDesc = 'ä½ åº¦éäº†æ¼«é•·è€Œå¹¸ç¦çš„ä¸€ç”Ÿï¼Œå……æ»¿ç¾å¥½å›æ†¶ã€‚';
            } else if (Game.intel >= 150) {
                endingType = 'æ™ºè€…çµå±€';
                endingIcon = 'ğŸ§ ';
                endingDesc = 'ä½ æ“æœ‰è¶…å‡¡çš„æ™ºæ…§ï¼Œç‚ºä¸–ç•Œå¸¶ä¾†è²¢ç»ã€‚';
            } else if (Game.skills.charm >= 120) {
                endingType = 'é­…åŠ›ä¹‹æ˜Ÿçµå±€';
                endingIcon = 'âœ¨';
                endingDesc = 'ä½ çš„é­…åŠ›ç„¡äººèƒ½åŠï¼Œæˆç‚ºçœ¾äººä»°æ…•çš„å°è±¡ã€‚';
            } else if (Game.money < 0) {
                endingType = 'ç ´ç”¢çµå±€';
                endingIcon = 'ğŸ’¸';
                endingDesc = 'ä½ è² å‚µç´¯ç´¯ï¼Œåœ¨è²§å›°ä¸­åº¦éé¤˜ç”Ÿ...';
            } else if (Game.happy < 30) {
                endingType = 'æ†‚é¬±çµå±€';
                endingIcon = 'â˜ï¸';
                endingDesc = 'ä½ ä¸€ç”Ÿéƒ½æ´»åœ¨é™°éœ¾ä¹‹ä¸‹ï¼Œæœªèƒ½æ‰¾åˆ°çœŸæ­£çš„å¿«æ¨‚...';
            } else if (Game.age < 30) {
                endingType = 'æ—©é€çµå±€';
                endingIcon = 'ğŸ•Šï¸';
                endingDesc = 'ä½ çš„äººç”Ÿéæ–¼çŸ­æš«ï¼Œæœªèƒ½å®Œæˆæ›´å¤šå¤¢æƒ³...';
            } else {
                endingType = 'å¹³å‡¡äººç”Ÿçµå±€';
                endingIcon = 'ğŸƒ';
                endingDesc = 'ä½ éå®Œäº†å¹³å‡¡è€ŒçœŸå¯¦çš„ä¸€ç”Ÿï¼Œé€™å°±æ˜¯äººç”Ÿã€‚';
            }
            
            document.getElementById('ending-icon').textContent = endingIcon;
            document.getElementById('ending-title').textContent = endingType;
            document.getElementById('ending-desc').textContent = endingDesc;
            document.getElementById('ending-stats').innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; text-align: left;">
                    <div>ğŸ‘¤ å§“å: ${Game.name}</div>
                    <div>ğŸ‚ äº«å¹´: ${Game.age}æ­²</div>
                    <div>ğŸ’° è³‡ç”¢: $${Game.money.toLocaleString()}</div>
                    <div>ğŸ§  æ™ºåŠ›: ${Math.floor(Game.intel)}</div>
                    <div>ğŸ˜Š å¿«æ¨‚: ${Math.floor(Game.happy)}</div>
                    <div>â¤ï¸ å¥åº·: ${Math.floor(Game.health)}</div>
                    <div>ğŸ’¼ è·æ¥­: ${JOBS.find(j => j.id === Game.jobId).name}</div>
                    <div>ğŸ‘¥ é—œä¿‚: ${Game.relationships.length}äºº</div>
                    <div>ğŸ† æˆå°±: ${Game.unlockedAchievements.length}/${ACHIEVEMENTS.length}</div>
                    <div>ğŸ¯ è¡Œå‹•: ${Game.totalActions}æ¬¡</div>
                    <div>ğŸ“Š äº‹ä»¶: ${Game.totalEvents}æ¬¡</div>
                    <div>ğŸ  å‡ºèº«: ${Game.origin}</div>
                </div>
            `;
            
            document.getElementById('ending-overlay').style.display = 'flex';
        }

        function checkAchievements() {
            ACHIEVEMENTS.forEach(ach => {
                if (Game.unlockedAchievements.includes(ach.id)) return;
                
                if (ach.check(Game)) {
                    Game.unlockedAchievements.push(ach.id);
                    showAchievementToast(ach.name);
                    log(`ğŸ† è§£é–æˆå°±ï¼š${ach.name}`);
                }
            });
            
            renderAchievements();
        }

        function renderAchievements() {
            let html = '';
            
            ACHIEVEMENTS.forEach(ach => {
                const unlocked = Game.unlockedAchievements.includes(ach.id);
                
                html += `
                    <div class="job-card" style="opacity: ${unlocked ? 1 : 0.4}; cursor: default;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="font-size: 2em;">${unlocked ? ach.icon || 'ğŸ†' : 'ğŸ”’'}</div>
                            <div>
                                <div class="job-name">${ach.name}</div>
                                <div style="font-size: 0.85em; color: var(--text-dim);">${ach.desc}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('achievement-list').innerHTML = html;
        }

        function showAchievementToast(name) {
            const toast = document.createElement('div');
            toast.className = 'achievement-toast';
            toast.innerHTML = `
                <div class="achievement-icon">ğŸ†</div>
                <div>
                    <div style="font-size: 0.9em;">è§£é–æˆå°±</div>
                    <div style="font-size: 1.1em;">${name}</div>
                </div>
            `;
            toast.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: linear-gradient(135deg, #ffd700, #ffb300);
                color: #000;
                padding: 15px;
                border-radius: 10px;
                box-shadow: 0 5px 20px rgba(255, 215, 0, 0.5);
                z-index: 150;
                animation: slideIn 0.5s;
                font-weight: bold;
                display: flex;
                gap: 10px;
                align-items: center;
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.5s reverse';
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 500);
            }, 3000);
        }

        function renderJobs() {
            let html = '';
            
            JOBS.forEach(job => {
                if (job.id === 'none') return;
                
                let canApply = true;
                let reqText = '';
                
                if (job.requirement) {
                    Object.keys(job.requirement).forEach(key => {
                        const required = job.requirement[key];
                        const current = key === 'intel' ? Game.intel : (key === 'health' ? Game.health : Game.skills[key] || 0);
                        
                        if (current < required) canApply = false;
                        
                        const emoji = key === 'intel' ? 'ğŸ§ ' : key === 'health' ? 'â¤ï¸' : 'ğŸ“Š';
                        reqText += `${emoji} ${key}: ${required} `;
                    });
                }
                
                const isCurrentJob = Game.jobId === job.id;
                
                html += `
                    <div class="job-card ${isCurrentJob ? 'selected' : ''}" 
                         ${canApply && !isCurrentJob ? `onclick="selectJob('${job.id}')"` : ''} 
                         style="${!canApply || isCurrentJob ? 'cursor: default;' : ''}">
                        <div class="job-name">${job.name} ${isCurrentJob ? 'âœ“ (ç•¶å‰)' : ''}</div>
                        <div class="job-salary">ğŸ’° æœˆè–ª: $${job.salary.toLocaleString()}</div>
                        <div class="job-requirement">${reqText}</div>
                        <div style="font-size: 0.85em; color: var(--text-dim); margin-top: 3px;">
                            ${job.desc}
                        </div>
                        ${!canApply ? '<div style="color: var(--red); font-size: 0.8em; margin-top: 3px;">âŒ æ¢ä»¶ä¸ç¬¦</div>' : ''}
                    </div>
                `;
            });
            
            document.getElementById('job-list').innerHTML = html;
        }

        function selectJob(jobId) {
            if (Game.age < 18) return alert('æœªæ»¿18æ­²ç„¡æ³•å·¥ä½œ');
            
            Game.jobId = jobId;
            Game.jobYears = 0;
            
            const job = JOBS.find(j => j.id === jobId);
            log(`ğŸ’¼ é–‹å§‹å¾äº‹ ${job.name}`);
            
            checkAchievements();
            updateUI();
            renderJobs();
        }

        function renderSocial() {
            let html = '';
            
            if (Game.relationships.length === 0) {
                html = '<div style="color: var(--text-dim); text-align: center; padding: 20px;">é‚„æ²’æœ‰ä»»ä½•äººéš›é—œä¿‚</div>';
            }
            
            Game.relationships.forEach(npc => {
                const emoji = npc.type === 'parent' ? (npc.id === 'dad' ? 'ğŸ‘¨' : 'ğŸ‘©') :
                              npc.type === 'partner' ? 'ğŸ’•' :
                              npc.type === 'spouse' ? 'ğŸ’' :
                              npc.type === 'child' ? 'ğŸ‘¶' : 'ğŸ‘¥';
                
                html += `
                    <div class="job-card" style="cursor: default;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="font-size: 2em;">${emoji}</div>
                            <div style="flex: 1;">
                                <div class="job-name">${npc.name}</div>
                                <div style="font-size: 0.85em; color: var(--text-dim);">
                                    ${npc.role} | è¦ªå¯†åº¦: ${Math.floor(npc.relation)}/100
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('npc-list').innerHTML = html;
            
            const hasPartner = Game.relationships.some(r => r.type === 'partner' || r.type === 'spouse');
            document.getElementById('find-partner-area').style.display = (Game.age >= 18 && !hasPartner) ? 'block' : 'none';
        }

        function findPartner() {
            if (Game.money < 500) return alert('æ²’éŒ¢ä½¿ç”¨äº¤å‹è»Ÿé«”');
            
            Game.money -= 500;
            const chance = (Game.skills.charm / 150) * 0.8 + 0.2;
            
            if (Math.random() < chance) {
                const names = ['å°ç¾', 'é˜¿è±ª', 'é›…å©·', 'å¿—æ˜', 'Emily', 'Jack', 'å°ç³', 'å¤§è¡›', 'å‡±è‰', 'ä¿Šå‚‘'];
                const name = names[Math.floor(Math.random() * names.length)];
                
                Game.relationships.push({
                    id: 'partner_' + Date.now(),
                    name: name,
                    type: 'partner',
                    relation: 50,
                    role: 'ä¼´ä¾¶'
                });
                
                log(`ğŸ’– é…å°æˆåŠŸï¼å’Œ ${name} é–‹å§‹äº¤å¾€`);
            } else {
                Game.happy -= 10;
                log('ğŸ’” æ²’æœ‰é…å°æˆåŠŸ...');
            }
            
            updateUI();
            renderSocial();
        }

        function addFriend() {
            const names = ['å°æ', 'å°ç‹', 'å°é™³', 'å°æ—', 'Amy', 'David', 'å°å¼µ', 'é˜¿æ˜', 'å°è¯', 'é˜¿å¾·'];
            const name = names[Math.floor(Math.random() * names.length)];
            
            Game.relationships.push({
                id: 'friend_' + Date.now(),
                name: name,
                type: 'friend',
                relation: 60,
                role: 'æœ‹å‹'
            });
            
            log(`ğŸ‘¥ å’Œ ${name} æˆç‚ºæœ‹å‹`);
            checkAchievements();
        }

        function renderShop() {
            // è»Šåº«
            let carHtml = '';
            CARS.forEach(car => {
                const owned = Game.inventory.includes(car.id);
                carHtml += `
                    <div class="job-card" style="cursor: default;">
                        <div class="job-name">${car.name} ${owned ? 'âœ“ (å·²æ“æœ‰)' : ''}</div>
                        <div class="job-salary">âœ¨ é­…åŠ› +${car.charm}</div>
                        <div style="font-size: 0.85em; color: var(--text-dim); margin: 5px 0;">
                            ${car.desc}
                        </div>
                        <div style="margin-top: 8px;">
                            <button class="btn-buy" onclick="buyItem('${car.id}')" ${owned ? 'disabled' : ''}>
                                è³¼è²· $${(car.price / 10000).toFixed(0)}è¬
                            </button>
                        </div>
                    </div>
                `;
            });
            
            // æˆ¿ç”¢
            let houseHtml = '';
            HOUSES.forEach(house => {
                const owned = Game.inventory.includes(house.id);
                houseHtml += `
                    <div class="job-card" style="cursor: default;">
                        <div class="job-name">${house.name} ${owned ? 'âœ“ (å·²æ“æœ‰)' : ''}</div>
                        <div class="job-salary">
                            ğŸ˜Š å¿«æ¨‚ +${house.happy} | ğŸ’° è¢«å‹•æ”¶å…¥ $${house.passive.toLocaleString()}/æœˆ
                        </div>
                        <div style="font-size: 0.85em; color: var(--text-dim); margin: 5px 0;">
                            ${house.desc}
                        </div>
                        <div style="margin-top: 8px;">
                            <button class="btn-buy" onclick="buyItem('${house.id}')" ${owned ? 'disabled' : ''}>
                                è³¼è²· $${(house.price / 10000).toFixed(0)}è¬
                            </button>
                        </div>
                    </div>
                `;
            });
            
            // å¥¢ä¾ˆå“
            let luxHtml = '';
            LUXURIES.forEach(lux => {
                const owned = Game.inventory.includes(lux.id);
                luxHtml += `
                    <div class="job-card" style="cursor: default;">
                        <div class="job-name">${lux.name} ${owned ? 'âœ“ (å·²æ“æœ‰)' : ''}</div>
                        <div class="job-salary">
                            ${lux.charm ? `âœ¨ é­…åŠ› +${lux.charm}` : ''} 
                            ${lux.happy ? `ğŸ˜Š å¿«æ¨‚ +${lux.happy}` : ''}
                        </div>
                        <div style="font-size: 0.85em; color: var(--text-dim); margin: 5px 0;">
                            ${lux.desc}
                        </div>
                        <div style="margin-top: 8px;">
                            <button class="btn-buy" onclick="buyItem('${lux.id}')" ${owned ? 'disabled' : ''}>
                                è³¼è²· $${(lux.price / 10000).toFixed(0)}è¬
                            </button>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('car-shop').innerHTML = carHtml;
            document.getElementById('house-shop').innerHTML = houseHtml;
            document.getElementById('luxury-shop').innerHTML = luxHtml;
        }

        function buyItem(id) {
            const car = CARS.find(c => c.id === id);
            const house = HOUSES.find(h => h.id === id);
            const lux = LUXURIES.find(l => l.id === id);
            const item = car || house || lux;
            
            if (!item) return;
            if (Game.inventory.includes(id)) return alert('å·²æ“æœ‰');
            if (Game.money < item.price) return alert('éŒ¢ä¸å¤ ');
            
            Game.money -= item.price;
            Game.inventory.push(id);
            
            if (car) {
                Game.skills.charm += car.charm;
                log(`ğŸï¸ è³¼è²·äº† ${car.name}`);
            } else if (house) {
                Game.happy += house.happy;
                log(`ğŸ˜ï¸ è³¼è²·äº† ${house.name}`);
            } else {
                if (lux.charm) Game.skills.charm += lux.charm;
                if (lux.happy) Game.happy += lux.happy;
                log(`ğŸ’ è³¼è²·äº† ${lux.name}`);
            }
            
            checkAchievements();
            updateUI();
            renderShop();
        }

        function renderStats() {
            const highestSkill = Object.keys(Game.skills).reduce((a, b) => 
                Game.skills[a] > Game.skills[b] ? a : b
            );
            
            const totalWealth = Game.money + Game.inventory.reduce((sum, id) => {
                const item = [...CARS, ...HOUSES, ...LUXURIES].find(i => i.id === id);
                return sum + (item ? item.price : 0);
            }, 0);
            
            const html = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9em;">
                    <div>ğŸ‚ ç•¶å‰å¹´é½¡: ${Game.age}æ­²</div>
                    <div>ğŸ  å‡ºèº«: ${Game.origin}</div>
                    <div>ğŸ’° ç¸½è³‡ç”¢: $${totalWealth.toLocaleString()}</div>
                    <div>ğŸ’¼ å·¥ä½œå¹´è³‡: ${Game.jobYears}å¹´</div>
                    <div>ğŸ‘¥ äººéš›é—œä¿‚: ${Game.relationships.length}äºº</div>
                    <div>ğŸ† æˆå°±æ•¸: ${Game.unlockedAchievements.length}/${ACHIEVEMENTS.length}</div>
                    <div>ğŸ¯ åŸ·è¡Œè¡Œå‹•: ${Game.totalActions}æ¬¡</div>
                    <div>ğŸ“¢ è§¸ç™¼äº‹ä»¶: ${Game.totalEvents}æ¬¡</div>
                    <div>ğŸ˜Š å¿«æ¨‚å¹´æ•¸: ${Game.happyYears}å¹´</div>
                    <div>ğŸŒŸ æœ€å¼·æŠ€èƒ½: ${highestSkill}</div>
                </div>
            `;
            
            document.getElementById('stats-panel').innerHTML = html;
        }

        function nav(page, event) {
            event.preventDefault();
            event.stopPropagation();
            
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + page).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            // æ›´æ–°ç‰¹å®šé é¢çš„è³‡æ–™
            if (page === 'profile') {
                renderStats();
            }
        }

        function closeModal() {
            document.getElementById('event-modal').style.display = 'none';
        }

        function restartGame() {
            location.reload();
        }
        // ==========================================
// ğŸ”´ æŠ€èƒ½é¢æ¿æŠ˜ç–ŠåŠŸèƒ½
// ==========================================

function toggleSkills() {
    const body = document.querySelector('.skills-body');
    const toggle = document.querySelector('.skills-toggle');
    
    if (body && toggle) {
        const isCollapsed = body.classList.contains('collapsed');
        
        if (isCollapsed) {
            // å±•é–‹
            body.classList.remove('collapsed');
            toggle.classList.remove('collapsed');
            localStorage.setItem('skillsCollapsed', 'false');
        } else {
            // æ”¶èµ·
            body.classList.add('collapsed');
            toggle.classList.add('collapsed');
            localStorage.setItem('skillsCollapsed', 'true');
        }
    }
}

        // åˆå§‹åŒ–
        initCreation();
        
    </script>
</body>
</html>



