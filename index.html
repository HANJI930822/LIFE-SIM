<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™‚äº‹äººç”Ÿ V16.0ï¼šå®Œæ•´ç‰ˆ</title>
    <style>
        :root {
            --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-dark: #0f0f23;
            --card: linear-gradient(135deg, #1e1e2e 0%, #2a2a3e 100%);
            --accent: #bb86fc;
            --accent-glow: rgba(187, 134, 252, 0.3);
            --text: #e0e0e0;
            --text-dim: #9e9e9e;
            --green: #03dac6;
            --red: #cf6679;
            --gold: #ffd700;
            --blue: #2196f3;
            --orange: #ff9800;
            --purple: #9c27b0;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'å¾®è»Ÿæ­£é»‘é«”', 'Noto Sans TC', sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            max-width: 600px;
            margin: 0 auto;
            padding-bottom: 80px;
            user-select: none;
            overflow-x: hidden;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 300px;
            background: var(--bg-primary);
            z-index: -1;
            opacity: 0.3;
        }
        
        /* ===== HEADER ===== */
        .header {
            background: linear-gradient(135deg, #1e1e2e 0%, #2a2a3e 100%);
            padding: 15px;
            position: sticky;
            top: 0;
            z-index: 50;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            border-bottom: 2px solid var(--accent);
        }
        
        .player-info {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }
        
        .player-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            box-shadow: 0 0 15px var(--accent-glow);
        }
        
        .player-details {
            flex: 1;
        }
        
        .player-name-line {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--gold);
        }
        
        .player-subtitle {
            font-size: 0.8em;
            color: var(--text-dim);
        }
        
        .big-stat {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--gold);
            text-align: center;
            margin: 10px 0;
            text-shadow: 0 0 10px var(--gold);
        }
        
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            font-size: 0.85em;
            text-align: center;
        }
        
        .stat-item {
            background: rgba(255,255,255,0.05);
            padding: 8px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
            display: block;
        }
        
        .status-alerts {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .status-alert {
            padding: 8px;
            border-radius: 8px;
            font-size: 0.8em;
            font-weight: bold;
            text-align: center;
            animation: slideIn 0.3s;
        }
        
        .alert-red { background: linear-gradient(135deg, #b00020, #d32f2f); }
        .alert-orange { background: linear-gradient(135deg, #ff9800, #fb8c00); }
        .alert-blue { background: linear-gradient(135deg, #2196f3, #1976d2); }
        
        /* ===== SKILLS ===== */
        .skills-container {
            margin-top: 10px;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 8px;
        }
        
        .skill-item {
            margin-bottom: 8px;
        }
        
        .skill-header {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            margin-bottom: 3px;
        }
        
        .skill-bar-bg {
            background: #333;
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .skill-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--blue), var(--green));
            transition: width 0.5s ease;
        }
        
        /* ===== STAMINA ===== */
        .stamina-container {
            margin-top: 10px;
        }
        
        .stamina-label {
            font-size: 0.85em;
            color: var(--blue);
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }
        
        .progress-bg {
            background: #444;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2196f3, #03dac6);
            width: 100%;
            transform-origin: left;
            transform: scaleX(1);
            transition: transform 0.3s ease;
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.6);
        }
        
        .progress-fill.low {
            background: linear-gradient(90deg, #cf6679, #f44336);
        }
        
        /* ===== CARDS ===== */
        .card {
            background: var(--card);
            border-radius: 15px;
            margin: 15px 10px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
            animation: fadeIn 0.4s;
        }
        
        .card-header {
            padding: 15px;
            background: rgba(187, 134, 252, 0.1);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-title {
            font-size: 1.1em;
            font-weight: bold;
            color: var(--accent);
        }
        
        .card-body { padding: 15px; }
        
        /* ===== BUTTONS ===== */
        .btn-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        button {
            background: linear-gradient(135deg, #333, #444);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95em;
            font-weight: 500;
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        button:hover::before {
            width: 300px;
            height: 300px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(187, 134, 252, 0.4);
        }
        
        button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            filter: grayscale(1);
        }
        
        .btn-main {
            background: linear-gradient(135deg, var(--accent), #9c27b0);
            color: white;
            font-weight: bold;
            width: 100%;
            margin-top: 10px;
            font-size: 1.1em;
            box-shadow: 0 4px 15px var(--accent-glow);
        }
        
        .btn-job {
            background: linear-gradient(135deg, #2196f3, #1976d2);
        }
        
        .btn-buy {
            background: linear-gradient(135deg, var(--green), #00897b);
            color: black;
            font-weight: bold;
        }
        
        .btn-risk {
            background: linear-gradient(135deg, var(--red), #c62828);
        }
        
        .cost-tag {
            font-size: 0.7em;
            color: #ccc;
            display: block;
            margin-top: 3px;
        }
        
        /* ===== ORIGIN SELECTION ===== */
        #scene-creation {
            padding: 20px;
            text-align: center;
        }
        
        .creation-title {
            font-size: 2em;
            background: var(--bg-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
        }
        
        .origin-card {
            background: linear-gradient(135deg, #1e1e2e, #2a2a3e);
            border: 2px solid #333;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s;
        }
        
        .origin-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }
        
        .origin-card.selected {
            border-color: var(--accent);
            background: linear-gradient(135deg, #2a2a3e, #3a3a4e);
            box-shadow: 0 0 20px var(--accent-glow);
        }
        
        .origin-name {
            font-weight: bold;
            color: var(--gold);
            font-size: 1.2em;
            margin-bottom: 5px;
        }
        
        .origin-desc {
            font-size: 0.9em;
            color: var(--text-dim);
            margin: 5px 0;
        }
        
        /* ===== MODAL ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 200;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
            animation: fadeIn 0.3s;
        }
        
        .modal-box {
            background: var(--card);
            width: 90%;
            max-width: 450px;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid var(--accent);
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            animation: slideUp 0.4s;
        }
        
        .modal-title {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--gold);
            margin-bottom: 15px;
        }
        
        .modal-desc {
            margin-bottom: 20px;
            line-height: 1.6;
            color: var(--text-dim);
        }
        
        .modal-btn {
            width: 100%;
            margin-bottom: 10px;
            padding: 15px;
        }
        
        /* ===== ACHIEVEMENT TOAST ===== */
        .achievement-toast {
            position: fixed;
            top: 80px;
            right: -400px;
            width: 300px;
            background: linear-gradient(135deg, #ffd700, #ffb300);
            color: #000;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.5);
            z-index: 150;
            animation: slideInRight 0.5s forwards;
            font-weight: bold;
        }
        
        .achievement-icon {
            font-size: 2em;
            float: left;
            margin-right: 10px;
        }
        
        /* ===== NAV BAR ===== */
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(135deg, #1e1e2e, #000);
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            border-top: 2px solid var(--accent);
            z-index: 50;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.5);
        }
        
        .nav-item {
            color: #888;
            cursor: pointer;
            text-align: center;
            font-size: 0.75em;
            padding: 5px;
            transition: all 0.3s;
            flex: 1;
        }
        
        .nav-item:hover {
            color: var(--accent);
        }
        
        .nav-item.active {
            color: var(--accent);
            font-weight: bold;
        }
        
        .nav-icon {
            display: block;
            font-size: 1.8em;
            margin-bottom: 2px;
        }
        
        .page {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .page.active { display: block; }
        
        /* ===== TALENT TAGS ===== */
        .talent-tag {
            display: inline-block;
            background: linear-gradient(135deg, var(--gold), #ffa000);
            color: black;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.75em;
            margin-right: 5px;
            margin-top: 3px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(255, 215, 0, 0.3);
        }
        
        .talent-bad {
            background: linear-gradient(135deg, var(--red), #c62828);
            color: white;
        }
        
        /* ===== LOG BOX ===== */
        .log-box {
            height: 150px;
            overflow-y: auto;
            background: rgba(0,0,0,0.4);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85em;
            color: #ccc;
            border: 1px solid rgba(255,255,255,0.1);
            line-height: 1.6;
        }
        
        .log-box::-webkit-scrollbar {
            width: 6px;
        }
        
        .log-box::-webkit-scrollbar-track {
            background: #222;
        }
        
        .log-box::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 3px;
        }
        
        /* ===== JOB CARD ===== */
        .job-card {
            background: rgba(255,255,255,0.05);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 10px;
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .job-card:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }
        
        .job-name {
            font-weight: bold;
            color: var(--blue);
            font-size: 1.1em;
        }
        
        .job-salary {
            color: var(--green);
            font-size: 0.9em;
        }
        
        .job-requirement {
            color: var(--text-dim);
            font-size: 0.8em;
            margin-top: 3px;
        }
        
        /* ===== ANIMATIONS ===== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes slideInRight {
            from { right: -400px; }
            to { right: 20px; }
        }
        
        @keyframes slideOutRight {
            from { right: 20px; }
            to { right: -400px; }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* ===== ENDING SCREEN ===== */
        .ending-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 300;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(15px);
        }
        
        .ending-content {
            text-align: center;
            padding: 30px;
            max-width: 500px;
        }
        
        .ending-icon {
            font-size: 5em;
            margin-bottom: 20px;
            animation: fadeIn 1s;
        }
        
        .ending-title {
            font-size: 2em;
            font-weight: bold;
            color: var(--gold);
            margin-bottom: 15px;
        }
        
        .ending-desc {
            font-size: 1.1em;
            line-height: 1.8;
            color: var(--text-dim);
            margin-bottom: 20px;
        }
        
        .ending-stats {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        #scene-game { display: none; }
        
        .input-group {
            margin-bottom: 15px;
            text-align: left;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-dim);
        }
        
        .input-group input,
        .input-group select {
            width: 100%;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            border-radius: 8px;
            font-size: 1em;
        }
    </style>
</head>
<body>

    <!-- å‰µè§’ç•«é¢ -->
    <div id="scene-creation">
        <h1 class="creation-title">ğŸ§¬ æŠ•èƒæ¨¡æ“¬å™¨ V16.0</h1>
        
        <div class="card">
            <div class="card-body">
                <div class="input-group">
                    <label>âœï¸ å§“å</label>
                    <input type="text" id="inp-name" placeholder="è¼¸å…¥å§“å" maxlength="8">
                </div>
                <div class="input-group">
                    <label>ğŸš» æ€§åˆ¥</label>
                    <select id="inp-gender">
                        <option value="ç”·">ğŸ‘¨ ç”·ç”Ÿ</option>
                        <option value="å¥³">ğŸ‘© å¥³ç”Ÿ</option>
                        <option value="å…¶ä»–">ğŸŒˆ å…¶ä»–</option>
                    </select>
                </div>
            </div>
        </div>
        
        <h3 style="text-align:left; margin: 20px 10px 10px; color: var(--gold);">
            ğŸ² é¸æ“‡å‡ºèº«èƒŒæ™¯
        </h3>
        <div id="origin-list"></div>
        
        <button class="btn-main" onclick="startGame()">ğŸš€ é–‹å§‹äººç”Ÿå†’éšª</button>
    </div>

    <!-- éŠæˆ²ä¸»ç•«é¢ -->
    <div id="scene-game">
        <div class="header">
            <div class="player-info">
                <div class="player-avatar" id="player-avatar">ğŸ‘¶</div>
                <div class="player-details">
                    <div class="player-name-line">
                        <span id="player-name">???</span>
                        <span style="font-size: 0.8em; color: var(--text-dim);">
                            | <span id="age-display">0</span>æ­²
                        </span>
                    </div>
                    <div class="player-subtitle">
                        <span id="player-origin">å¹³å‡¡å®¶åº­</span> â€¢ 
                        <span id="player-job">ç„¡æ¥­</span>
                    </div>
                    <div id="talent-display" style="margin-top: 5px;"></div>
                </div>
            </div>
            
            <div class="big-stat" id="money-display">$0</div>
            
            <div class="stat-grid">
                <div class="stat-item">
                    <span>â¤ï¸ å¥åº·</span>
                    <span class="stat-value" id="health">100</span>
                </div>
                <div class="stat-item">
                    <span>ğŸ˜Š å¿«æ¨‚</span>
                    <span class="stat-value" id="happy">80</span>
                </div>
                <div class="stat-item">
                    <span>ğŸ§  æ™ºåŠ›</span>
                    <span class="stat-value" id="intel">50</span>
                </div>
            </div>
            
            <div class="skills-container" id="skills-container"></div>
            
            <div class="stamina-container">
                <div class="stamina-label">
                    <span>âš¡ é«”åŠ›</span>
                    <span id="stamina-text">100/100</span>
                </div>
                <div class="progress-bg">
                    <div id="stamina-bar" class="progress-fill"></div>
                </div>
            </div>
            
            <div class="status-alerts" id="status-alerts"></div>
        </div>

        <!-- é¦–é ï¼šç”Ÿæ´» -->
        <div id="page-home" class="page active">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ğŸ“… äººç”Ÿéšæ®µï¼š<span id="life-stage">å¬°å…’æœŸ</span></span>
                </div>
                <div class="card-body">
                    <div class="btn-grid" id="action-buttons">
                        <!-- å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ğŸ“œ äººç”Ÿå‹•æ…‹</span>
                </div>
                <div class="card-body">
                    <div id="game-log" class="log-box"></div>
                    <button class="btn-main" onclick="nextYear()">
                        ğŸ‚ ä¸‹ä¸€æ­² (é«”åŠ›å›æ»¿)
                    </button>
                </div>
            </div>
        </div>

        <!-- è·æ¥­é  -->
        <div id="page-career" class="page">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ğŸ’¼ è·æ¥­é¸æ“‡</span>
                </div>
                <div class="card-body">
                    <div style="color: var(--text-dim); margin-bottom: 15px; font-size: 0.9em;">
                        ğŸ’¡ é¸æ“‡è·æ¥­å¾Œæ¯å¹´è‡ªå‹•ç²å¾—è–ªæ°´ï¼Œä¸åŒè·æ¥­æœ‰ä¸åŒåŠ æˆæ•ˆæœ
                    </div>
                    <div id="job-list"></div>
                </div>
            </div>
        </div>

        <!-- è³‡ç”¢é  -->
        <div id="page-assets" class="page">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ğŸï¸ è»Šåº«</span>
                </div>
                <div class="card-body" id="car-shop"></div>
            </div>
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ğŸ˜ï¸ æˆ¿ç”¢</span>
                </div>
                <div class="card-body" id="house-shop"></div>
            </div>
        </div>

        <!-- ç¤¾äº¤é  -->
        <div id="page-social" class="page">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ğŸ’– äººéš›é—œä¿‚</span>
                </div>
                <div class="card-body">
                    <div id="npc-list"></div>
                    <div id="find-partner-area" style="margin-top: 15px; display: none;">
                        <button class="btn-main" onclick="findPartner()">
                            ğŸ“± ä½¿ç”¨äº¤å‹è»Ÿé«” ($500)
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æˆå°±é  -->
        <div id="page-profile" class="page">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ğŸ† æˆå°±ç³»çµ±</span>
                </div>
                <div class="card-body">
                    <div id="achievement-list"></div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-body">
                    <button class="btn-main" onclick="restartGame()">
                        ğŸ”„ é‡æ–°é–‹å§‹äººç”Ÿ
                    </button>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨å°èˆª -->
        <div class="nav-bar">
            <div class="nav-item active" onclick="nav('home')">
                <span class="nav-icon">ğŸ </span>
                ç”Ÿæ´»
            </div>
            <div class="nav-item" onclick="nav('career')">
                <span class="nav-icon">ğŸ’¼</span>
                è·æ¥­
            </div>
            <div class="nav-item" onclick="nav('assets')">
                <span class="nav-icon">ğŸï¸</span>
                è³‡ç”¢
            </div>
            <div class="nav-item" onclick="nav('social')">
                <span class="nav-icon">ğŸ’–</span>
                ç¤¾äº¤
            </div>
            <div class="nav-item" onclick="nav('profile')">
                <span class="nav-icon">ğŸ†</span>
                æˆå°±
            </div>
        </div>
    </div>

    <!-- äº‹ä»¶å½ˆçª— -->
    <div id="event-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-title" id="ev-title"></div>
            <div class="modal-desc" id="ev-desc"></div>
            <button class="modal-btn" id="btn-choice-a">A</button>
            <button class="modal-btn" id="btn-choice-b">B</button>
        </div>
    </div>

    <!-- çµå±€ç•«é¢ -->
    <div id="ending-overlay" class="ending-overlay">
        <div class="ending-content">
            <div class="ending-icon" id="ending-icon">ğŸ’€</div>
            <div class="ending-title" id="ending-title">äººç”Ÿçµ‚çµ</div>
            <div class="ending-desc" id="ending-desc"></div>
            <div class="ending-stats" id="ending-stats"></div>
            <button class="btn-main" onclick="restartGame()">
                ğŸ”„ é‡æ–°æŠ•èƒ
            </button>
        </div>
    </div>

    <!-- æˆå°±æç¤º -->
    <div id="achievement-toast" class="achievement-toast" style="display: none;">
        <div class="achievement-icon">ğŸ†</div>
        <div>
            <div style="font-size: 0.9em;">è§£é–æˆå°±</div>
            <div id="toast-text" style="font-size: 1.1em;"></div>
        </div>
    </div>

    <script>
        // ==========================================
        // ğŸ”´ è³‡æ–™å®šç¾©
        // ==========================================
        
        const TALENTS = [
            { id: 't1', name: 'éç›®ä¸å¿˜', desc: 'å­¸ç¿’æ•ˆç‡+50%', type: 'good', effect: (g) => { g.learnBonus = 1.5; } },
            { id: 't2', name: 'å¤©ç”Ÿç¥åŠ›', desc: 'å¥åº·è¡°é€€æ¸›åŠ', type: 'good', effect: (g) => { g.healthDecay = 0.5; } },
            { id: 't3', name: 'è¬äººè¿·', desc: 'é­…åŠ›+20ï¼Œç¤¾äº¤æ•ˆæœ+30%', type: 'good', effect: (g) => { g.skills.charm += 20; g.socialBonus = 1.3; } },
            { id: 't4', name: 'æŠ•è³‡çœ¼å…‰', desc: 'è¢«å‹•æ”¶å…¥+20%', type: 'good', effect: (g) => { g.incomeBonus = 1.2; } },
            { id: 't5', name: 'ç»ç’ƒå¿ƒ', desc: 'å¿«æ¨‚å€¼ä¸‹é™åŠ å€', type: 'bad', effect: (g) => { g.happyDecay = 2; } },
            { id: 't6', name: 'é«”å¼±å¤šç—…', desc: 'åˆå§‹å¥åº·-20', type: 'bad', effect: (g) => { g.health -= 20; } },
            { id: 't7', name: 'ç¤¾äº¤ææ‡¼', desc: 'é­…åŠ›-15', type: 'bad', effect: (g) => { g.skills.charm -= 15; } },
            { id: 't8', name: 'å¯ŒäºŒä»£å¿ƒæ…‹', desc: 'å·¥ä½œæ”¶å…¥-30%', type: 'bad', effect: (g) => { g.workPenalty = 0.7; } }
        ];

        const ORIGINS = [
            { id: 'common', name: 'å¹³å‡¡å®¶åº­', desc: 'çˆ¶æ¯éƒ½æ˜¯æ™®é€šä¸Šç­æ—ï¼Œç”Ÿæ´»å®‰ç©©ã€‚', parents: 'çˆ¶:å…¬å‹™å“¡ / æ¯:æ•™å¸«', 
              money: 50000, intel: 50, happy: 80, yearlyMoney: 1000, buff: 'å¹³è¡¡ç™¼å±•' },
            { id: 'rich', name: 'å¯ŒäºŒä»£', desc: 'å«è‘—é‡‘æ¹¯åŒ™å‡ºç”Ÿï¼Œä¸æ„åƒç©¿ã€‚', parents: 'çˆ¶:é›†åœ˜è‘£äº‹ / æ¯:ååª›', 
              money: 5000000, intel: 40, happy: 90, yearlyMoney: 100000, buff: 'å·¨é¡è²¡å¯Œ+è¢«å‹•æ”¶å…¥' },
            { id: 'genius', name: 'å¯’é–€å¤©æ‰', desc: 'å®¶å¢ƒæ¸…å¯’ï¼Œä½†å¤©è³¦ç•°ç¨Ÿã€‚', parents: 'çˆ¶:å·¥äºº / æ¯:æ¸…æ½”å·¥', 
              money: -50000, intel: 120, happy: 60, yearlyMoney: 0, buff: 'è¶…é«˜æ™ºåŠ›ä½†è² å‚µ' },
            { id: 'star', name: 'æ¼”è—ä¸–å®¶', desc: 'çˆ¶æ¯éƒ½æ˜¯å¨›æ¨‚åœˆæ˜æ˜Ÿã€‚', parents: 'çˆ¶:å½±å¸ / æ¯:æ­Œå', 
              money: 1000000, intel: 50, happy: 70, yearlyMoney: 50000, buff: 'é­…åŠ›çˆ†è¡¨+äººè„ˆå»£' },
            { id: 'scholar', name: 'æ›¸é¦™é–€ç¬¬', desc: 'å®¶æ—é‡è¦–æ•™è‚²ï¼Œæ›¸é¦™ä¸–å®¶ã€‚', parents: 'çˆ¶:å¤§å­¸æ•™æˆ / æ¯:å¾‹å¸«', 
              money: 200000, intel: 80, happy: 75, yearlyMoney: 5000, buff: 'é«˜å­¸ç¿’åŠ›+æ•™è‚²è³‡æº' }
        ];

        const JOBS = [
            { id: 'none', name: 'ç„¡æ¥­', salary: 0, requirement: {}, effect: null },
            { id: 'clerk', name: 'ä¸€èˆ¬è·å“¡', salary: 35000, requirement: { intel: 40 }, 
              effect: (g) => { g.happy -= 2; }, desc: 'æœä¹æ™šäº”çš„è¾¦å…¬å®¤å·¥ä½œ' },
            { id: 'engineer', name: 'å·¥ç¨‹å¸«', salary: 70000, requirement: { intel: 80, programming: 60 }, 
              effect: (g) => { g.skills.programming += 2; g.happy -= 5; }, desc: 'é«˜è–ªä½†å£“åŠ›å¤§' },
            { id: 'doctor', name: 'é†«ç”Ÿ', salary: 150000, requirement: { intel: 120, medical: 80 }, 
              effect: (g) => { g.health -= 5; g.skills.medical += 3; }, desc: 'æ•‘æ­»æ‰¶å‚·ï¼Œæ”¶å…¥è±åš' },
            { id: 'artist', name: 'è—è¡“å®¶', salary: 40000, requirement: { art: 70, charm: 60 }, 
              effect: (g) => { g.happy += 10; g.skills.art += 3; }, desc: 'æ”¶å…¥ä¸ç©©ä½†å¿«æ¨‚' },
            { id: 'teacher', name: 'æ•™å¸«', salary: 50000, requirement: { intel: 70, communication: 60 }, 
              effect: (g) => { g.happy += 5; g.skills.communication += 2; }, desc: 'ç©©å®šä¸”æœ‰æ„ç¾©' },
            { id: 'entrepreneur', name: 'å‰µæ¥­å®¶', salary: 100000, requirement: { intel: 90, finance: 70, charm: 70 }, 
              effect: (g) => { g.money += Math.floor(Math.random() * 100000 - 30000); g.happy -= 10; }, desc: 'é«˜é¢¨éšªé«˜å›å ±' },
            { id: 'influencer', name: 'ç¶²ç´…', salary: 80000, requirement: { charm: 90, communication: 70 }, 
              effect: (g) => { g.skills.charm += 2; g.happy += 5; }, desc: 'é ç²‰çµ²ç¶“æ¿Ÿè³ºéŒ¢' },
            { id: 'scientist', name: 'ç ”ç©¶å“¡', salary: 90000, requirement: { intel: 110 }, 
              effect: (g) => { g.intel += 5; g.happy += 3; }, desc: 'æ¢ç´¢æœªçŸ¥çš„é‚Šç•Œ' }
        ];

        const ACHIEVEMENTS = [
            { id: 'first_job', name: 'åˆå…¥è·å ´', desc: 'ç²å¾—ç¬¬ä¸€ä»½å·¥ä½œ', check: (g) => g.jobId !== 'none' },
            { id: 'millionaire', name: 'ç™¾è¬å¯Œç¿', desc: 'è³‡ç”¢é”åˆ°100è¬', check: (g) => g.money >= 1000000 },
            { id: 'billionaire', name: 'å„„è¬å¯Œç¿', desc: 'è³‡ç”¢é”åˆ°1å„„', check: (g) => g.money >= 100000000 },
            { id: 'genius', name: 'å¤©æ‰', desc: 'æ™ºåŠ›é”åˆ°150', check: (g) => g.intel >= 150 },
            { id: 'charming', name: 'è¬äººè¿·', desc: 'é­…åŠ›é”åˆ°120', check: (g) => g.skills.charm >= 120 },
            { id: 'healthy', name: 'å¥åº·é”äºº', desc: '60æ­²æ™‚å¥åº·ä»>80', check: (g) => g.age >= 60 && g.health > 80 },
            { id: 'happy_life', name: 'å¿«æ¨‚äººç”Ÿ', desc: 'ä¿æŒå¿«æ¨‚å€¼>80é”30å¹´', check: (g) => g.happyYears >= 30 },
            { id: 'social_master', name: 'ç¤¾äº¤é”äºº', desc: 'æ“æœ‰5å€‹ä»¥ä¸Šå¥½å‹', check: (g) => g.relationships.filter(r => r.type === 'friend').length >= 5 },
            { id: 'married', name: 'åŸ·å­ä¹‹æ‰‹', desc: 'æˆåŠŸçµå©š', check: (g) => g.relationships.some(r => r.id === 'spouse') },
            { id: 'parent', name: 'ç‚ºäººçˆ¶æ¯', desc: 'æ“æœ‰å­å¥³', check: (g) => g.relationships.some(r => r.type === 'child') },
            { id: 'house_owner', name: 'æœ‰æˆ¿ä¸€æ—', desc: 'è³¼è²·ç¬¬ä¸€é–“æˆ¿ç”¢', check: (g) => g.inventory.some(i => i.startsWith('house')) },
            { id: 'car_owner', name: 'æœ‰è»Šä¸€æ—', desc: 'è³¼è²·ç¬¬ä¸€è¼›è»Š', check: (g) => g.inventory.some(i => i.startsWith('car')) },
            { id: 'skill_master', name: 'å…¨èƒ½å¤©æ‰', desc: 'æ‰€æœ‰æŠ€èƒ½é”åˆ°80', check: (g) => Object.values(g.skills).every(v => v >= 80) },
            { id: 'elder', name: 'é•·å£½', desc: 'æ´»åˆ°80æ­²', check: (g) => g.age >= 80 },
            { id: 'perfect', name: 'å®Œç¾äººç”Ÿ', desc: '60æ­²æ™‚å¥åº·/å¿«æ¨‚/é‡‘éŒ¢éƒ½>é«˜æ¨™', check: (g) => g.age >= 60 && g.health > 80 && g.happy > 80 && g.money > 10000000 }
        ];

        const LIFE_STAGES = [
            { min: 0, max: 2, name: 'å¬°å…’æœŸ', icon: 'ğŸ‘¶' },
            { min: 3, max: 5, name: 'å¹¼å…’æœŸ', icon: 'ğŸ§’' },
            { min: 6, max: 12, name: 'å…’ç«¥æœŸ', icon: 'ğŸ‘¦' },
            { min: 13, max: 17, name: 'é’å°‘å¹´', icon: 'ğŸ§‘' },
            { min: 18, max: 25, name: 'é’å¹´æœŸ', icon: 'ğŸ‘¨' },
            { min: 26, max: 40, name: 'å£¯å¹´æœŸ', icon: 'ğŸ‘¨â€ğŸ’¼' },
            { min: 41, max: 60, name: 'ä¸­å¹´æœŸ', icon: 'ğŸ‘¨â€ğŸ¦³' },
            { min: 61, max: 999, name: 'è€å¹´æœŸ', icon: 'ğŸ‘´' }
        ];

        // ==========================================
        // ğŸ”´ éŠæˆ²ç‹€æ…‹
        // ==========================================
        
        let Game = {
            name: '', origin: '', age: 0, gender: 'ç”·',
            money: 0, health: 100, happy: 80, intel: 50,
            stamina: 100, maxStamina: 100,
            
            skills: {
                programming: 0,
                art: 0,
                medical: 0,
                cooking: 0,
                finance: 0,
                communication: 0,
                charm: 0
            },
            
            jobId: 'none',
            jobYears: 0,
            yearlyMoney: 0,
            
            inventory: [],
            relationships: [],
            talents: [],
            unlockedAchievements: [],
            
            happyYears: 0,
            debtYears: 0,
            
            // åŠ æˆä¿‚æ•¸
            learnBonus: 1,
            healthDecay: 1,
            happyDecay: 1,
            socialBonus: 1,
            incomeBonus: 1,
            workPenalty: 1
        };

        let activeEvent = null;
        let selectedOriginId = null;

        // ==========================================
        // ğŸ”´ åˆå§‹åŒ–
        // ==========================================
        
        function initCreation() {
            let html = '';
            ORIGINS.forEach(o => {
                html += `
                    <div class="origin-card" onclick="selectOrigin('${o.id}', this)">
                        <div class="origin-name">${o.name}</div>
                        <div class="origin-desc">${o.parents}</div>
                        <div class="origin-desc">${o.desc}</div>
                        <div style="color: var(--green); font-size: 0.85em; margin-top: 5px;">
                            âœ¨ ${o.buff} | ğŸ’° $${o.money.toLocaleString()} | é›¶ç”¨éŒ¢: $${o.yearlyMoney}/å¹´
                        </div>
                    </div>
                `;
            });
            document.getElementById('origin-list').innerHTML = html;
            selectOrigin(ORIGINS[0].id, document.querySelector('.origin-card'));
        }

        function selectOrigin(id, el) {
            selectedOriginId = id;
            document.querySelectorAll('.origin-card').forEach(c => c.classList.remove('selected'));
            if (el) el.classList.add('selected');
        }

        function startGame() {
            const name = document.getElementById('inp-name').value.trim();
            if (!name) return alert('è«‹è¼¸å…¥å§“å');
            
            const origin = ORIGINS.find(o => o.id === selectedOriginId);
            const gender = document.getElementById('inp-gender').value;
            
            // éš¨æ©Ÿå¤©è³¦
            let talentPool = [...TALENTS];
            let selectedTalents = [];
            const talentCount = Math.random() > 0.6 ? 2 : 1;
            for (let i = 0; i < talentCount; i++) {
                const idx = Math.floor(Math.random() * talentPool.length);
                selectedTalents.push(talentPool[idx]);
                talentPool.splice(idx, 1);
            }
            
            // åˆå§‹åŒ–éŠæˆ²ç‹€æ…‹
            Game = {
                ...Game,
                name, origin: origin.name, gender,
                money: origin.money,
                intel: origin.intel,
                happy: origin.happy,
                yearlyMoney: origin.yearlyMoney,
                talents: selectedTalents,
                age: 0,
                relationships: [
                    { id: 'dad', name: 'çˆ¸çˆ¸', type: 'parent', relation: 80, role: origin.parents.split(' / ')[0] },
                    { id: 'mom', name: 'åª½åª½', type: 'parent', relation: 90, role: origin.parents.split(' / ')[1] }
                ]
            };
            
            // æ‡‰ç”¨å¤©è³¦æ•ˆæœ
            Game.talents.forEach(t => t.effect(Game));
            
            document.getElementById('scene-creation').style.display = 'none';
            document.getElementById('scene-game').style.display = 'block';
            
            updateUI();
            renderJobs();
            renderShop();
            renderSocial();
            renderAchievements();
            
            log(`ğŸ‘¶ ${Game.name} å‡ºç”Ÿäº†ï¼`);
            log(`ğŸ² å¤©è³¦ï¼š${Game.talents.map(t => t.name).join('ã€')}`);
        }

        // ==========================================
        // ğŸ”´ UI æ›´æ–°
        // ==========================================
        
        function updateUI() {
            // åŸºæœ¬è³‡è¨Š
            document.getElementById('player-name').textContent = Game.name;
            document.getElementById('age-display').textContent = Game.age;
            document.getElementById('player-origin').textContent = Game.origin;
            document.getElementById('player-job').textContent = JOBS.find(j => j.id === Game.jobId).name;
            document.getElementById('money-display').textContent = '$' + Game.money.toLocaleString();
            
            // æ•¸å€¼
            document.getElementById('health').textContent = Math.max(0, Math.floor(Game.health));
            document.getElementById('happy').textContent = Math.max(0, Math.floor(Game.happy));
            document.getElementById('intel').textContent = Math.floor(Game.intel);
            
            // é ­åƒ
            const stage = LIFE_STAGES.find(s => Game.age >= s.min && Game.age <= s.max);
            document.getElementById('player-avatar').textContent = stage.icon;
            document.getElementById('life-stage').textContent = stage.name;
            
            // å¤©è³¦æ¨™ç±¤
            let talentHtml = '';
            Game.talents.forEach(t => {
                talentHtml += `<span class="talent-tag ${t.type === 'bad' ? 'talent-bad' : ''}" title="${t.desc}">${t.name}</span>`;
            });
            document.getElementById('talent-display').innerHTML = talentHtml;
            
            // æŠ€èƒ½æ¢
            let skillHtml = '';
            const skillNames = {
                programming: 'ğŸ’» ç¨‹å¼',
                art: 'ğŸ¨ è—è¡“',
                medical: 'âš•ï¸ é†«ç™‚',
                cooking: 'ğŸ³ çƒ¹é£ª',
                finance: 'ğŸ’° ç†è²¡',
                communication: 'ğŸ’¬ æºé€š',
                charm: 'âœ¨ é­…åŠ›'
            };
            
            Object.keys(Game.skills).forEach(key => {
                const val = Math.min(150, Math.floor(Game.skills[key]));
                const percent = (val / 150) * 100;
                skillHtml += `
                    <div class="skill-item">
                        <div class="skill-header">
                            <span>${skillNames[key]}</span>
                            <span>${val}</span>
                        </div>
                        <div class="skill-bar-bg">
                            <div class="skill-bar-fill" style="width: ${percent}%"></div>
                        </div>
                    </div>
                `;
            });
            document.getElementById('skills-container').innerHTML = skillHtml;
            
            // é«”åŠ›æ¢
            const stamina = Math.max(0, Math.min(100, Game.stamina));
            const staminaRatio = stamina / 100;
            document.getElementById('stamina-bar').style.transform = `scaleX(${staminaRatio})`;
            document.getElementById('stamina-text').textContent = `${Math.floor(stamina)}/100`;
            
            if (stamina < 20) {
                document.getElementById('stamina-bar').classList.add('low');
            } else {
                document.getElementById('stamina-bar').classList.remove('low');
            }
            
            // ç‹€æ…‹è­¦å‘Š
            let alertHtml = '';
            if (Game.money < 0) {
                alertHtml += `<div class="status-alert alert-red">âš ï¸ è² å‚µè­¦å‘Šï¼å‰© ${3 - Game.debtYears} å¹´</div>`;
            }
            if (Game.happy < 20) {
                alertHtml += `<div class="status-alert alert-orange">â˜ï¸ æ†‚é¬±ç‹€æ…‹</div>`;
            }
            if (Game.health < 30) {
                alertHtml += `<div class="status-alert alert-red">ğŸ¥ é‡ç—…è­¦å‘Š</div>`;
            }
            if (Game.age >= 18 && Game.jobId === 'none') {
                alertHtml += `<div class="status-alert alert-blue">ğŸ’¼ å°šæœªå°±æ¥­</div>`;
            }
            document.getElementById('status-alerts').innerHTML = alertHtml;
            
            // æ›´æ–°è¡Œå‹•æŒ‰éˆ•
            updateActionButtons();
        }

        function updateActionButtons() {
            const btns = document.getElementById('action-buttons');
            let html = '';
            
            const age = Game.age;
            
            if (age <= 2) {
                // å¬°å…’æœŸ
                html = `
                    <button onclick="action('cry')">ğŸ˜­ å“­é¬§<span class="cost-tag">âš¡-10</span></button>
                    <button onclick="action('sleep')">ğŸ˜´ ç¡è¦º<span class="cost-tag">âš¡-20</span></button>
                    <button onclick="action('play_toy')">ğŸ§¸ ç©ç©å…·<span class="cost-tag">âš¡-15</span></button>
                    <button onclick="action('learn_speak')">ğŸ—£ï¸ ç‰™ç‰™å­¸èª<span class="cost-tag">âš¡-25</span></button>
                `;
            } else if (age <= 5) {
                // å¹¼å…’æœŸ
                html = `
                    <button onclick="action('kindergarten')">ğŸ« ä¸Šå¹¼å…’åœ’<span class="cost-tag">âš¡-20</span></button>
                    <button onclick="action('draw')">ğŸ–ï¸ ç•«ç•«<span class="cost-tag">âš¡-15</span></button>
                    <button onclick="action('watch_tv')">ğŸ“º çœ‹å¡é€š<span class="cost-tag">âš¡-10</span></button>
                    <button onclick="action('make_friend')">ğŸ‘« äº¤æœ‹å‹<span class="cost-tag">âš¡-20</span></button>
                `;
            } else if (age <= 12) {
                // å…’ç«¥æœŸï¼ˆå°å­¸ï¼‰
                html = `
                    <button onclick="action('study_hard')">ğŸ“– èªçœŸè®€æ›¸<span class="cost-tag">âš¡-30</span></button>
                    <button onclick="action('cram_school')">ğŸ“š è£œç¿’ç­<span class="cost-tag">âš¡-25 / $-2000</span></button>
                    <button onclick="action('sports')">âš½ é‹å‹•<span class="cost-tag">âš¡-20</span></button>
                    <button onclick="action('play_game')">ğŸ® æ‰“é›»å‹•<span class="cost-tag">âš¡-15</span></button>
                `;
            } else if (age <= 17) {
                // é’å°‘å¹´ï¼ˆä¸­å­¸ï¼‰
                html = `
                    <button onclick="action('exam_prep')">ğŸ“ è€ƒè©¦è¡åˆº<span class="cost-tag">âš¡-35</span></button>
                    <button onclick="action('club')">ğŸ¸ ç¤¾åœ˜æ´»å‹•<span class="cost-tag">âš¡-20</span></button>
                    <button onclick="action('date_crush')">ğŸ’• ç´„æ›–æ˜§å°è±¡<span class="cost-tag">âš¡-25 / $-500</span></button>
                    <button onclick="action('rebel')">ğŸ˜ å›é€†æœŸ<span class="cost-tag">âš¡-15</span></button>
                `;
            } else {
                // æˆäºº
                html = `
                    <button onclick="action('work')">ğŸ’¼ åŠªåŠ›å·¥ä½œ<span class="cost-tag">âš¡-35</span></button>
                    <button onclick="action('study_skill')">ğŸ“š å­¸ç¿’æŠ€èƒ½<span class="cost-tag">âš¡-25 / $-3000</span></button>
                    <button onclick="action('socialize')">ğŸ» ç¤¾äº¤æ´»å‹•<span class="cost-tag">âš¡-20 / $-2000</span></button>
                    <button onclick="action('relax')">ğŸ® ä¼‘é–’å¨›æ¨‚<span class="cost-tag">âš¡-15 / $-1000</span></button>
                `;
            }
            
            btns.innerHTML = html;
            
            // æª¢æŸ¥æ˜¯å¦å¯ç”¨
            const allBtns = btns.querySelectorAll('button');
            allBtns.forEach(btn => {
                if (Game.stamina < 10 || Game.happy < 10) {
                    btn.disabled = true;
                }
            });
        }

        function action(type) {
            if (Game.health <= 0) return alert('å·²æ­»äº¡');
            
            let cost = 20;
            let effects = {};
            
            // æ ¹æ“šä¸åŒè¡Œå‹•è¨ˆç®—æ•ˆæœ
            switch (type) {
                case 'cry':
                    cost = 10;
                    effects = { happy: 5 };
                    log('ğŸ˜­ å“­äº†ä¸€æ•´å¤©ï¼Œçˆ¸åª½ä¾†å“„ä½ ');
                    break;
                case 'sleep':
                    cost = 20;
                    effects = { health: 3, happy: 2 };
                    log('ğŸ˜´ ç¡å¾—å¾ˆé¦™ç”œ');
                    break;
                case 'play_toy':
                    cost = 15;
                    effects = { happy: 8 };
                    log('ğŸ§¸ ç©ç©å…·å¥½é–‹å¿ƒ');
                    break;
                case 'learn_speak':
                    cost = 25;
                    effects = { intel: 3 * Game.learnBonus, 'skills.communication': 2 };
                    log('ğŸ—£ï¸ å­¸æœƒèªªæ›´å¤šè©å½™');
                    break;
                case 'kindergarten':
                    cost = 20;
                    effects = { intel: 2 * Game.learnBonus, 'skills.communication': 3, happy: 5 };
                    log('ğŸ« åœ¨å¹¼å…’åœ’ç©å¾—å¾ˆé–‹å¿ƒ');
                    break;
                case 'draw':
                    cost = 15;
                    effects = { 'skills.art': 4, happy: 5 };
                    log('ğŸ–ï¸ ç•«äº†ä¸€å¹…ç•«');
                    break;
                case 'watch_tv':
                    cost = 10;
                    effects = { happy: 10, intel: -1 };
                    log('ğŸ“º çœ‹äº†ä¸€æ•´å¤©å¡é€š');
                    break;
                case 'make_friend':
                    cost = 20;
                    effects = { 'skills.communication': 5, happy: 8 };
                    log('ğŸ‘« äº¤åˆ°æ–°æœ‹å‹äº†');
                    if (Math.random() > 0.7) addFriend();
                    break;
                case 'study_hard':
                    cost = 30;
                    effects = { intel: 5 * Game.learnBonus, happy: -3 };
                    log('ğŸ“– èªçœŸè®€æ›¸ï¼Œæˆç¸¾é€²æ­¥');
                    break;
                case 'cram_school':
                    if (Game.money < 2000) return alert('æ²’éŒ¢è£œç¿’');
                    cost = 25;
                    effects = { intel: 8 * Game.learnBonus, money: -2000, happy: -5 };
                    log('ğŸ“š è£œç¿’ç­è¡åˆº');
                    break;
                case 'sports':
                    cost = 20;
                    effects = { health: 5, happy: 5, 'skills.charm': 2 };
                    log('âš½ é‹å‹•æµæ±—çœŸèˆ’æš¢');
                    break;
                case 'play_game':
                    cost = 15;
                    effects = { happy: 12, intel: -2 };
                    log('ğŸ® æ‰“é›»å‹•æ‰“åˆ°å¿˜è¨˜æ™‚é–“');
                    break;
                case 'exam_prep':
                    cost = 35;
                    effects = { intel: 10 * Game.learnBonus, happy: -8 };
                    log('ğŸ“ ç‚ºè€ƒè©¦åŠªåŠ›è¡åˆº');
                    break;
                case 'club':
                    cost = 20;
                    effects = { 'skills.communication': 5, 'skills.charm': 3, happy: 10 };
                    log('ğŸ¸ ç¤¾åœ˜æ´»å‹•å¾ˆæœ‰è¶£');
                    break;
                case 'date_crush':
                    if (Game.money < 500) return alert('æ²’éŒ¢ç´„æœƒ');
                    cost = 25;
                    effects = { money: -500, happy: 15, 'skills.charm': 5 };
                    log('ğŸ’• å’Œæ›–æ˜§å°è±¡å‡ºå»ç©');
                    break;
                case 'rebel':
                    cost = 15;
                    effects = { happy: 8, intel: -3 };
                    log('ğŸ˜ å›é€†æœŸï¼Œä¸æƒ³è½å¤§äººçš„è©±');
                    Game.relationships.forEach(r => {
                        if (r.type === 'parent') r.relation -= 5;
                    });
                    break;
                case 'work':
                    cost = 35;
                    const job = JOBS.find(j => j.id === Game.jobId);
                    if (job && job.salary > 0) {
                        const salary = Math.floor(job.salary * Game.incomeBonus * Game.workPenalty);
                        effects = { money: salary, happy: -5, health: -3 };
                        log(`ğŸ’¼ å·¥ä½œè³ºäº† $${salary.toLocaleString()}`);
                        if (job.effect) job.effect(Game);
                        Game.jobYears++;
                    } else {
                        effects = { happy: -10 };
                        log('ğŸ’¼ å¾…æ¥­ä¸­ï¼Œå¿ƒæƒ…ä½è½');
                    }
                    break;
                case 'study_skill':
                    if (Game.money < 3000) return alert('æ²’éŒ¢é€²ä¿®');
                    cost = 25;
                    const skillKeys = Object.keys(Game.skills);
                    const randomSkill = skillKeys[Math.floor(Math.random() * skillKeys.length)];
                    effects = { money: -3000, intel: 3 * Game.learnBonus };
                    effects[`skills.${randomSkill}`] = 8 * Game.learnBonus;
                    log(`ğŸ“š å­¸ç¿’äº†æ–°æŠ€èƒ½`);
                    break;
                case 'socialize':
                    if (Game.money < 2000) return alert('æ²’éŒ¢ç¤¾äº¤');
                    cost = 20;
                    effects = { money: -2000, happy: 10, 'skills.communication': 5, 'skills.charm': 3 };
                    log('ğŸ» å’Œæœ‹å‹èšé¤èŠå¤©');
                    if (Math.random() > 0.6) addFriend();
                    break;
                case 'relax':
                    if (Game.money < 1000) return alert('æ²’éŒ¢å¨›æ¨‚');
                    cost = 15;
                    effects = { money: -1000, happy: 15 };
                    log('ğŸ® æ”¾é¬†ä¼‘é–’ï¼Œå……é›»å®Œç•¢');
                    break;
            }
            
            if (Game.stamina < cost) return alert('é«”åŠ›ä¸è¶³');
            
            Game.stamina -= cost;
            
            // æ‡‰ç”¨æ•ˆæœ
            Object.keys(effects).forEach(key => {
                if (key.startsWith('skills.')) {
                    const skillName = key.split('.')[1];
                    Game.skills[skillName] = Math.max(0, Game.skills[skillName] + effects[key]);
                } else {
                    Game[key] = Game[key] + effects[key];
                }
            });
            
            updateUI();
        }

        // ==========================================
        // ğŸ”´ ä¸‹ä¸€æ­²
        // ==========================================
        
        function nextYear() {
            if (Game.health <= 0) return;
            
            Game.age++;
            Game.stamina = 100;
            
            // è‡ªç„¶è¡°é€€
            Game.health -= (3 * Game.healthDecay);
            Game.happy -= (2 * Game.happyDecay);
            
            // å¹´é½¡ç›¸é—œ
            if (Game.age >= 40) Game.health -= 2;
            if (Game.age >= 60) Game.health -= 3;
            
            // é›¶ç”¨éŒ¢
            if (Game.age < 18 && Game.yearlyMoney > 0) {
                Game.money += Game.yearlyMoney;
                log(`ğŸ§§ é ˜åˆ°é›¶ç”¨éŒ¢ $${Game.yearlyMoney.toLocaleString()}`);
            }
            
            // å·¥ä½œæ”¶å…¥
            if (Game.jobId !== 'none') {
                const job = JOBS.find(j => j.id === Game.jobId);
                const salary = Math.floor(job.salary * Game.incomeBonus * Game.workPenalty * 12);
                Game.money += salary;
                log(`ğŸ’¼ å¹´åº¦è–ªè³‡å…¥å¸³ $${salary.toLocaleString()}`);
            }
            
            // è¢«å‹•æ”¶å…¥ï¼ˆæˆ¿ç”¢ã€æŠ•è³‡ï¼‰
            const passiveIncome = Math.floor(Game.money * 0.03 * Game.incomeBonus);
            if (passiveIncome > 0) {
                Game.money += passiveIncome;
                log(`ğŸ“ˆ è¢«å‹•æ”¶å…¥ $${passiveIncome.toLocaleString()}`);
            }
            
            // è² å‚µæ‡²ç½°
            if (Game.money < 0) {
                Game.debtYears++;
                if (Game.debtYears >= 3) {
                    Game.inventory = [];
                    Game.money = 0;
                    Game.happy -= 50;
                    log('ğŸ’¥ ç ´ç”¢ï¼è³‡ç”¢è¢«å……å…¬');
                    Game.debtYears = 0;
                }
            } else {
                Game.debtYears = 0;
            }
            
            // é‡ç—…ä½é™¢
            if (Game.health < 30) {
                Game.money -= 100000;
                log('ğŸ¥ ä½é™¢æ²»ç™‚ -$100,000');
            }
            
            // é—œä¿‚è¡°é€€
            Game.relationships.forEach(r => {
                r.relation = Math.max(0, r.relation - 2);
            });
            
            // å¿«æ¨‚å¹´æ•¸çµ±è¨ˆ
            if (Game.happy > 80) Game.happyYears++;
            
            // é‡è¦å¹´é½¡äº‹ä»¶
            if (Game.age === 6) log('ğŸ’ é–‹å§‹ä¸Šå°å­¸äº†');
            if (Game.age === 13) log('ğŸ« å‡ä¸Šä¸­å­¸');
            if (Game.age === 18) {
                log('ğŸ“ é«˜ä¸­ç•¢æ¥­ï¼å¯ä»¥é–‹å§‹å·¥ä½œäº†');
                checkAchievements();
            }
            if (Game.age === 30) log('ğŸ‚ é‚å…¥30æ­²å¤§é—œ');
            if (Game.age === 40) log('â° å·²ç¶“40æ­²äº†ï¼Œæ™‚å…‰é£›é€');
            if (Game.age === 60) log('ğŸ‘´ æ­¥å…¥è€å¹´ï¼Œå›é¦–äººç”Ÿ');
            
            log(`ğŸ‚ ${Game.age} æ­²äº†`);
            
            // éš¨æ©Ÿäº‹ä»¶
            if (Math.random() < 0.25) {
                triggerRandomEvent();
            }
            
            // æª¢æŸ¥æ­»äº¡
            if (Game.health <= 0) {
                Game.health = 0;
                log('ğŸ’€ ç”Ÿå‘½çµ‚çµ');
                showEnding();
                return;
            }
            
            // æª¢æŸ¥æˆå°±
            checkAchievements();
            
            updateUI();
            renderSocial();
        }

        // ==========================================
        // ğŸ”´ éš¨æ©Ÿäº‹ä»¶
        // ==========================================
        
        function triggerRandomEvent() {
            const events = [
                {
                    title: 'ä¸­çäº†',
                    desc: 'ä½ åœ¨è·¯é‚Šæ’¿åˆ°ä¸€å¼µç™¼ç¥¨ï¼Œç«Ÿç„¶ä¸­äº†çï¼',
                    choices: [
                        { txt: 'é ˜ç', effect: (g) => { g.money += 50000; return 'é ˜åˆ°5è¬å…ƒ'; } },
                        { txt: 'æå‡ºå»', effect: (g) => { g.skills.charm += 10; g.happy += 10; return 'åšå–„äº‹å¿ƒæƒ…å¥½'; } }
                    ]
                },
                {
                    title: 'é‡åˆ°è©é¨™',
                    desc: 'æœ‰äººæ‰“é›»è©±èªªä½ ä¸­çäº†ï¼Œè¦å…ˆåŒ¯æ¬¾æ‰‹çºŒè²»...',
                    choices: [
                        { txt: 'åŒ¯æ¬¾', effect: (g) => { g.money -= 20000; g.happy -= 20; return 'è¢«é¨™äº†...'; } },
                        { txt: 'æ›æ–·', effect: (g) => { g.intel += 5; return 'è°æ˜åœ°é¿é–‹è©é¨™'; } }
                    ]
                },
                {
                    title: 'æœ‹å‹å€ŸéŒ¢',
                    desc: 'å¥½å‹å‘ä½ å€Ÿ10è¬ï¼Œèªªæ€¥ç”¨...',
                    choices: [
                        { txt: 'å€Ÿ', effect: (g) => { 
                            if (g.money >= 100000) {
                                g.money -= 100000;
                                return 'å€Ÿäº†10è¬';
                            } else {
                                return 'æ²’é‚£éº¼å¤šéŒ¢';
                            }
                        }},
                        { txt: 'æ‹’çµ•', effect: (g) => { g.happy -= 10; return 'æ‹’çµ•äº†æœ‹å‹'; } }
                    ]
                },
                {
                    title: 'å¥åº·æª¢æŸ¥',
                    desc: 'å…¬å¸å®‰æ’å¥åº·æª¢æŸ¥',
                    choices: [
                        { txt: 'å»æª¢æŸ¥', effect: (g) => { 
                            if (g.health < 60) {
                                g.happy -= 15;
                                return 'ç™¼ç¾ä¸€äº›å°æ¯›ç—…...';
                            } else {
                                g.happy += 10;
                                return 'èº«é«”å¾ˆå¥åº·ï¼';
                            }
                        }},
                        { txt: 'å¤ªå¿™ä¸å»', effect: (g) => { return 'å¿™ç¢Œçš„ä¸€å¤©'; } }
                    ]
                },
                {
                    title: 'æŠ•è³‡æ©Ÿæœƒ',
                    desc: 'æœ‰äººæ¨è–¦ä½ æŠ•è³‡ä¸€å€‹é …ç›®',
                    choices: [
                        { txt: 'æŠ•è³‡5è¬', effect: (g) => {
                            if (g.money < 50000) return 'éŒ¢ä¸å¤ ';
                            g.money -= 50000;
                            if (Math.random() > 0.5) {
                                g.money += 150000;
                                return 'è³ºäº†10è¬ï¼';
                            } else {
                                g.happy -= 20;
                                return 'è¡€æœ¬ç„¡æ­¸...';
                            }
                        }},
                        { txt: 'ä¸æŠ•è³‡', effect: (g) => { g.skills.finance += 3; return 'è¬¹æ…ç†è²¡'; } }
                    ]
                }
            ];
            
            const evt = events[Math.floor(Math.random() * events.length)];
            activeEvent = evt;
            showModal(evt.title, evt.desc, evt.choices[0].txt, evt.choices[1].txt, 0, 1);
        }

        function showModal(title, desc, btn1, btn2, idx1, idx2) {
            document.getElementById('ev-title').textContent = title;
            document.getElementById('ev-desc').textContent = desc;
            
            const btnA = document.getElementById('btn-choice-a');
            const btnB = document.getElementById('btn-choice-b');
            
            btnA.textContent = btn1;
            btnB.textContent = btn2;
            
            btnA.onclick = () => resolveEvent(idx1);
            btnB.onclick = () => resolveEvent(idx2);
            
            document.getElementById('event-modal').style.display = 'flex';
        }

        function resolveEvent(idx) {
            const result = activeEvent.choices[idx].effect(Game);
            log(`âš¡ ${result}`);
            document.getElementById('event-modal').style.display = 'none';
            updateUI();
        }

        // ==========================================
        // ğŸ”´ è·æ¥­ç³»çµ±
        // ==========================================
        
        function renderJobs() {
            let html = '';
            
            JOBS.forEach(job => {
                if (job.id === 'none') return;
                
                let canApply = true;
                let reqText = '';
                
                if (job.requirement) {
                    Object.keys(job.requirement).forEach(key => {
                        const required = job.requirement[key];
                        const current = key === 'intel' ? Game.intel : Game.skills[key];
                        
                        if (current < required) canApply = false;
                        
                        reqText += `${key === 'intel' ? 'ğŸ§ ' : 'ğŸ“Š'} ${key}: ${required} `;
                    });
                }
                
                const isCurrentJob = Game.jobId === job.id;
                
                html += `
                    <div class="job-card ${isCurrentJob ? 'selected' : ''}" onclick="${canApply ? `selectJob('${job.id}')` : ''}">
                        <div class="job-name">${job.name} ${isCurrentJob ? '(ç•¶å‰)' : ''}</div>
                        <div class="job-salary">ğŸ’° æœˆè–ª: $${job.salary.toLocaleString()}</div>
                        <div class="job-requirement">${reqText}</div>
                        <div style="font-size: 0.85em; color: var(--text-dim); margin-top: 3px;">
                            ${job.desc}
                        </div>
                        ${!canApply ? '<div style="color: var(--red); font-size: 0.8em; margin-top: 3px;">âŒ æ¢ä»¶ä¸ç¬¦</div>' : ''}
                    </div>
                `;
            });
            
            document.getElementById('job-list').innerHTML = html;
        }

        function selectJob(jobId) {
            if (Game.age < 18) return alert('æœªæ»¿18æ­²ç„¡æ³•å·¥ä½œ');
            
            Game.jobId = jobId;
            Game.jobYears = 0;
            
            const job = JOBS.find(j => j.id === jobId);
            log(`ğŸ’¼ é–‹å§‹å¾äº‹ ${job.name}`);
            
            checkAchievements();
            updateUI();
            renderJobs();
        }

        // ==========================================
        // ğŸ”´ ç¤¾äº¤ç³»çµ±
        // ==========================================
        
        function renderSocial() {
            let html = '';
            
            Game.relationships.forEach(npc => {
                const emoji = npc.type === 'parent' ? (npc.id === 'dad' ? 'ğŸ‘¨' : 'ğŸ‘©') :
                              npc.type === 'partner' ? 'ğŸ’•' :
                              npc.type === 'spouse' ? 'ğŸ’' :
                              npc.type === 'child' ? 'ğŸ‘¶' : 'ğŸ‘¥';
                
                html += `
                    <div class="job-card" style="cursor: default;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="font-size: 2em;">${emoji}</div>
                            <div style="flex: 1;">
                                <div class="job-name">${npc.name}</div>
                                <div style="font-size: 0.85em; color: var(--text-dim);">
                                    ${npc.role} | è¦ªå¯†åº¦: ${Math.floor(npc.relation)}/100
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 8px; display: flex; gap: 5px;">
                            ${npc.type === 'parent' ? `
                                <button class="btn-mini" onclick="socialAction('${npc.id}', 'chat')" style="padding: 5px 10px; font-size: 0.8em;">èŠå¤© âš¡-5</button>
                                <button class="btn-mini" onclick="socialAction('${npc.id}', 'ask_money')" style="padding: 5px 10px; font-size: 0.8em;">è¦é›¶ç”¨éŒ¢ âš¡-10</button>
                            ` : ''}
                            ${npc.type === 'partner' ? `
                                <button class="btn-mini" onclick="socialAction('${npc.id}', 'date')" style="padding: 5px 10px; font-size: 0.8em;">ç´„æœƒ $-2000</button>
                                <button class="btn-mini" onclick="socialAction('${npc.id}', 'propose')" style="padding: 5px 10px; font-size: 0.8em;">æ±‚å©š</button>
                            ` : ''}
                            ${npc.type === 'spouse' ? `
                                <button class="btn-mini" onclick="socialAction('${npc.id}', 'date')" style="padding: 5px 10px; font-size: 0.8em;">ç´„æœƒ $-2000</button>
                                <button class="btn-mini" onclick="socialAction('${npc.id}', 'have_child')" style="padding: 5px 10px; font-size: 0.8em;">ç”Ÿå°å­©</button>
                            ` : ''}
                            ${npc.type === 'friend' ? `
                                <button class="btn-mini" onclick="socialAction('${npc.id}', 'chat')" style="padding: 5px 10px; font-size: 0.8em;">èšæœƒ âš¡-10</button>
                            ` : ''}
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('npc-list').innerHTML = html;
            
            const hasPartner = Game.relationships.some(r => r.type === 'partner' || r.type === 'spouse');
            document.getElementById('find-partner-area').style.display = (Game.age >= 18 && !hasPartner) ? 'block' : 'none';
        }

        function socialAction(id, type) {
            const npc = Game.relationships.find(r => r.id === id);
            if (!npc) return;
            
            if (type === 'chat') {
                if (Game.stamina < 5) return alert('é«”åŠ›ä¸è¶³');
                Game.stamina -= 5;
                npc.relation = Math.min(100, npc.relation + 5 * Game.socialBonus);
                Game.happy += 5;
                log(`å’Œ ${npc.name} èŠå¤©ï¼Œé—œä¿‚æ›´å¥½äº†`);
            } else if (type === 'ask_money') {
                if (Game.stamina < 10) return alert('é«”åŠ›ä¸è¶³');
                Game.stamina -= 10;
                
                if (npc.relation > 50) {
                    const amount = Math.floor(Math.random() * 5000) + 2000;
                    Game.money += amount;
                    npc.relation -= 5;
                    log(`å‘ ${npc.name} è¦åˆ°äº† $${amount}`);
                } else {
                    npc.relation -= 10;
                    Game.happy -= 10;
                    log(`${npc.name} æ‹’çµ•çµ¦éŒ¢ï¼Œé‚„ç½µäº†ä½ `);
                }
            } else if (type === 'date') {
                if (Game.money < 2000) return alert('æ²’éŒ¢ç´„æœƒ');
                Game.money -= 2000;
                Game.stamina -= 15;
                npc.relation = Math.min(100, npc.relation + 10 * Game.socialBonus);
                Game.happy += 15;
                log(`å’Œ ${npc.name} ç”œèœœç´„æœƒ`);
            } else if (type === 'propose') {
                if (npc.relation < 90) return alert('è¦ªå¯†åº¦ä¸å¤ ï¼ˆéœ€è¦90ï¼‰');
                if (Game.money < 100000) return alert('éœ€è¦10è¬è²·æˆ’æŒ‡');
                
                Game.money -= 100000;
                npc.type = 'spouse';
                npc.role = 'é…å¶';
                Game.happy += 50;
                log(`ğŸ‰ å’Œ ${npc.name} çµå©šäº†ï¼`);
                checkAchievements();
            } else if (type === 'have_child') {
                if (npc.relation < 80) return alert('é—œä¿‚ä¸å¤ å¥½');
                
                const childName = ['å°æ˜', 'å°è¯', 'å°ç¾', 'å°å¼·'][Math.floor(Math.random() * 4)];
                Game.relationships.push({
                    id: 'child_' + Date.now(),
                    name: childName,
                    type: 'child',
                    relation: 100,
                    role: 'å­å¥³'
                });
                
                Game.happy += 30;
                Game.money -= 50000;
                log(`ğŸ‘¶ ${childName} å‡ºç”Ÿäº†ï¼`);
                checkAchievements();
            }
            
            updateUI();
            renderSocial();
        }

        function findPartner() {
            if (Game.money < 500) return alert('æ²’éŒ¢ä½¿ç”¨äº¤å‹è»Ÿé«”');
            
            Game.money -= 500;
            const chance = (Game.skills.charm / 150) * 0.8 + 0.2;
            
            if (Math.random() < chance) {
                const names = ['å°ç¾', 'é˜¿è±ª', 'é›…å©·', 'å¿—æ˜', 'Emily', 'Jack'];
                const name = names[Math.floor(Math.random() * names.length)];
                
                Game.relationships.push({
                    id: 'partner_' + Date.now(),
                    name: name,
                    type: 'partner',
                    relation: 50,
                    role: 'ä¼´ä¾¶'
                });
                
                log(`ğŸ’– é…å°æˆåŠŸï¼å’Œ ${name} é–‹å§‹äº¤å¾€`);
            } else {
                Game.happy -= 10;
                log('ğŸ’” æ²’æœ‰é…å°æˆåŠŸ...');
            }
            
            updateUI();
            renderSocial();
        }

        function addFriend() {
            const names = ['å°æ', 'å°ç‹', 'å°é™³', 'å°æ—', 'Amy', 'David'];
            const name = names[Math.floor(Math.random() * names.length)];
            
            Game.relationships.push({
                id: 'friend_' + Date.now(),
                name: name,
                type: 'friend',
                relation: 60,
                role: 'æœ‹å‹'
            });
            
            log(`ğŸ‘¥ å’Œ ${name} æˆç‚ºæœ‹å‹`);
            checkAchievements();
        }

        // ==========================================
        // ğŸ”´ å•†åº—ç³»çµ±
        // ==========================================
        
        const CARS = [
            { id: 'car1', name: 'åœ‹ç”¢è»Š', price: 500000, charm: 3 },
            { id: 'car2', name: 'é€²å£è»Š', price: 1500000, charm: 10 },
            { id: 'car3', name: 'è¶…è·‘', price: 8000000, charm: 30 }
        ];
        
        const HOUSES = [
            { id: 'house1', name: 'å¥—æˆ¿', price: 3000000, happy: 5, passive: 5000 },
            { id: 'house2', name: 'å…¬å¯“', price: 8000000, happy: 15, passive: 15000 },
            { id: 'house3', name: 'åˆ¥å¢…', price: 50000000, happy: 40, passive: 80000 }
        ];

        function renderShop() {
            let carHtml = '';
            CARS.forEach(car => {
                const owned = Game.inventory.includes(car.id);
                carHtml += `
                    <div class="job-card">
                        <div class="job-name">${car.name} ${owned ? '(å·²æ“æœ‰)' : ''}</div>
                        <div class="job-salary">âœ¨ é­…åŠ› +${car.charm}</div>
                        <div style="margin-top: 8px;">
                            <button class="btn-buy" onclick="buyItem('${car.id}')" ${owned ? 'disabled' : ''}>
                                è³¼è²· $${(car.price / 10000).toFixed(0)}è¬
                            </button>
                        </div>
                    </div>
                `;
            });
            
            let houseHtml = '';
            HOUSES.forEach(house => {
                const owned = Game.inventory.includes(house.id);
                houseHtml += `
                    <div class="job-card">
                        <div class="job-name">${house.name} ${owned ? '(å·²æ“æœ‰)' : ''}</div>
                        <div class="job-salary">ğŸ˜Š å¿«æ¨‚ +${house.happy} | ğŸ’° è¢«å‹•æ”¶å…¥ +${house.passive}/å¹´</div>
                        <div style="margin-top: 8px;">
                            <button class="btn-buy" onclick="buyItem('${house.id}')" ${owned ? 'disabled' : ''}>
                                è³¼è²· $${(house.price / 10000).toFixed(0)}è¬
                            </button>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('car-shop').innerHTML = carHtml;
            document.getElementById('house-shop').innerHTML = houseHtml;
        }

        function buyItem(id) {
            const car = CARS.find(c => c.id === id);
            const house = HOUSES.find(h => h.id === id);
            const item = car || house;
            
            if (!item) return;
            if (Game.inventory.includes(id)) return alert('å·²æ“æœ‰');
            if (Game.money < item.price) return alert('éŒ¢ä¸å¤ ');
            
            Game.money -= item.price;
            Game.inventory.push(id);
            
            if (car) {
                Game.skills.charm += car.charm;
                log(`ğŸï¸ è³¼è²·äº† ${car.name}`);
            } else {
                Game.happy += house.happy;
                log(`ğŸ˜ï¸ è³¼è²·äº† ${house.name}`);
            }
            
            checkAchievements();
            updateUI();
            renderShop();
        }

        // ==========================================
        // ğŸ”´ æˆå°±ç³»çµ±
        // ==========================================
        
        function checkAchievements() {
            ACHIEVEMENTS.forEach(ach => {
                if (Game.unlockedAchievements.includes(ach.id)) return;
                
                if (ach.check(Game)) {
                    Game.unlockedAchievements.push(ach.id);
                    showAchievementToast(ach.name);
                    log(`ğŸ† è§£é–æˆå°±ï¼š${ach.name}`);
                }
            });
            
            renderAchievements();
        }

        function renderAchievements() {
            let html = '';
            
            ACHIEVEMENTS.forEach(ach => {
                const unlocked = Game.unlockedAchievements.includes(ach.id);
                
                html += `
                    <div class="job-card" style="opacity: ${unlocked ? 1 : 0.4};">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="font-size: 2em;">${unlocked ? 'ğŸ†' : 'ğŸ”’'}</div>
                            <div>
                                <div class="job-name">${ach.name}</div>
                                <div style="font-size: 0.85em; color: var(--text-dim);">${ach.desc}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('achievement-list').innerHTML = html;
        }

        function showAchievementToast(name) {
            const toast = document.getElementById('achievement-toast');
            document.getElementById('toast-text').textContent = name;
            
            toast.style.display = 'block';
            toast.style.animation = 'slideInRight 0.5s forwards';
            
            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.5s forwards';
                setTimeout(() => {
                    toast.style.display = 'none';
                }, 500);
            }, 3000);
        }

        // ==========================================
        // ğŸ”´ çµå±€ç³»çµ±
        // ==========================================
        
        function showEnding() {
            const endings = [
                { 
                    id: 'rich', 
                    icon: 'ğŸ’°', 
                    title: 'å¯Œè±ªçµå±€', 
                    desc: 'ä½ æˆç‚ºäº†å„„è¬å¯Œç¿ï¼Œéè‘—å¥¢è¯çš„ç”Ÿæ´»ã€‚é‡‘éŒ¢é›–ç„¶ä¸èƒ½è²·åˆ°ä¸€åˆ‡ï¼Œä½†ç¢ºå¯¦è®“äººç”Ÿå°‘äº†å¾ˆå¤šç…©æƒ±ã€‚',
                    check: (g) => g.money >= 100000000
                },
                {
                    id: 'scholar',
                    icon: 'ğŸ“',
                    title: 'å­¸è€…çµå±€',
                    desc: 'ä½ æˆç‚ºäº†å—äººå°Šæ•¬çš„å­¸è€…ï¼Œç”¨çŸ¥è­˜æ”¹è®Šäº†ä¸–ç•Œã€‚æ™ºæ…§æ˜¯æ°¸æ†çš„è²¡å¯Œã€‚',
                    check: (g) => g.intel >= 150
                },
                {
                    id: 'social',
                    icon: 'ğŸ’–',
                    title: 'ç¤¾äº¤é”äºº',
                    desc: 'ä½ æ“æœ‰ç„¡æ•¸æœ‹å‹å’Œè‰¯å¥½çš„äººéš›é—œä¿‚ï¼Œåœ¨ç¤¾äº¤åœˆå¦‚é­šå¾—æ°´ã€‚äººè„ˆå°±æ˜¯è³‡ç”¢ã€‚',
                    check: (g) => g.relationships.length >= 10
                },
                {
                    id: 'family',
                    icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦',
                    title: 'å¹¸ç¦å®¶åº­',
                    desc: 'ä½ æ“æœ‰ç¾æ»¿çš„å®¶åº­ï¼Œå¦»å­/ä¸ˆå¤«å’Œå­©å­å€‘éƒ½å¾ˆæ„›ä½ ã€‚å¹³å‡¡çš„å¹¸ç¦æ‰æ˜¯æœ€çè²´çš„ã€‚',
                    check: (g) => g.relationships.some(r => r.type === 'spouse') && g.relationships.some(r => r.type === 'child')
                },
                {
                    id: 'healthy',
                    icon: 'ğŸ’ª',
                    title: 'å¥åº·é•·å£½',
                    desc: 'ä½ æ´»åˆ°äº†é«˜é½¡ï¼Œè€Œä¸”èº«é«”ä¾ç„¶ç¡¬æœ—ã€‚å¥åº·æ˜¯äººç”Ÿæœ€å¤§çš„è²¡å¯Œã€‚',
                    check: (g) => g.age >= 80 && g.health > 60
                },
                {
                    id: 'lonely',
                    icon: 'ğŸ’”',
                    title: 'å­¤ç¨çµ‚è€',
                    desc: 'ä½ ä¸€ç”Ÿéƒ½åœ¨è¿½é€æŸäº›æ±è¥¿ï¼Œå»å¿½ç•¥äº†èº«é‚Šçš„äººã€‚æœ€å¾Œå­¤ç¨åœ°é›¢é–‹äººä¸–ã€‚',
                    check: (g) => g.relationships.every(r => r.relation < 20)
                },
                {
                    id: 'poor',
                    icon: 'ğŸ˜¢',
                    title: 'å›°é “ä¸€ç”Ÿ',
                    desc: 'ä½ çš„äººç”Ÿå……æ»¿äº†è‰±è¾›å’Œå›°é›£ï¼Œå§‹çµ‚ç„¡æ³•æ“ºè„«è²§å›°ã€‚ä½†ä½ ä¾ç„¶åŠªåŠ›æ´»è‘—ã€‚',
                    check: (g) => g.money < 0
                },
                {
                    id: 'average',
                    icon: 'ğŸƒ',
                    title: 'å¹³å‡¡äººç”Ÿ',
                    desc: 'ä½ éè‘—æ™®é€šå¹³å‡¡çš„ç”Ÿæ´»ï¼Œæ²’æœ‰å¤§èµ·å¤§è½ã€‚å¹³æ·¡ä¹Ÿæ˜¯ä¸€ç¨®å¹¸ç¦ã€‚',
                    check: (g) => true // é è¨­çµå±€
                }
            ];
            
            let finalEnding = endings[endings.length - 1]; // é è¨­
            
            for (let ending of endings) {
                if (ending.check(Game)) {
                    finalEnding = ending;
                    break;
                }
            }
            
            document.getElementById('ending-icon').textContent = finalEnding.icon;
            document.getElementById('ending-title').textContent = finalEnding.title;
            document.getElementById('ending-desc').textContent = finalEnding.desc;
            
            document.getElementById('ending-stats').innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; text-align: left;">
                    <div>ğŸ‘¤ å§“å: ${Game.name}</div>
                    <div>ğŸ‚ äº«å¹´: ${Game.age}æ­²</div>
                    <div>ğŸ’° è³‡ç”¢: $${Game.money.toLocaleString()}</div>
                    <div>ğŸ§  æ™ºåŠ›: ${Math.floor(Game.intel)}</div>
                    <div>ğŸ’¼ è·æ¥­: ${JOBS.find(j => j.id === Game.jobId).name}</div>
                    <div>ğŸ‘¥ é—œä¿‚: ${Game.relationships.length}äºº</div>
                    <div>ğŸ† æˆå°±: ${Game.unlockedAchievements.length}/${ACHIEVEMENTS.length}</div>
                    <div>â­ è©•åƒ¹: ${calculateScore()}/100</div>
                </div>
            `;
            
            document.getElementById('ending-overlay').style.display = 'flex';
        }

        function calculateScore() {
            let score = 0;
            
            score += Math.min(20, Game.money / 5000000
