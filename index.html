<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™‚äº‹äººç”Ÿ V13.1ï¼šä¿®å¾©ç‰ˆ</title>
    <style>
        :root { --bg: #121212; --card: #1e1e1e; --accent: #bb86fc; --text: #e0e0e0; --green: #03dac6; --red: #cf6679; --gold: #ffd700; --blue: #2196f3; }
        body { font-family: 'å¾®è»Ÿæ­£é»‘é«”', sans-serif; background: var(--bg); color: var(--text); max-width: 600px; margin: 0 auto; padding-bottom: 80px; user-select: none; overflow-x: hidden; }
        
        /* ä»‹é¢æ¨£å¼ */
        .header { background: #2c2c2c; padding: 10px 15px; position: sticky; top: 0; z-index: 50; box-shadow: 0 2px 8px rgba(0,0,0,0.6); }
        
        /* æ•¸å€¼ç¶²æ ¼ï¼šæ”¹ç‚º 3 æ¬„ï¼Œè®“æ•¸å€¼æ›´å¥½çœ‹ */
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; font-size: 0.9em; text-align: center; align-items: center; }
        
        .big-stat { font-size: 1.3em; font-weight: bold; color: var(--gold); grid-column: span 3; margin-bottom: 5px; transition: color 0.3s; }
        .big-stat.debt { color: var(--red); animation: shake 0.5s; }
        
        .school-badge { grid-column: span 3; background: #3f51b5; color: white; padding: 5px; border-radius: 4px; margin-bottom: 5px; font-weight: bold; display: none; }
        .status-alert { grid-column: span 3; color: white; font-weight: bold; font-size: 0.8em; padding: 5px; border-radius: 4px; display: none; margin-bottom:5px; text-align:center;}
        .alert-red { background: #b00020; animation: pulseRed 1s infinite; }
        .alert-orange { background: #ff9800; }

        .stamina-container { grid-column: span 3; margin-top: 5px; text-align: left; }
        .stamina-label { font-size: 0.8em; color: var(--blue); margin-bottom: 2px; display: flex; justify-content: space-between; }
        .progress-bg { background: #444; height: 8px; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--blue); transition: width 0.3s ease; }
        .progress-fill.low { background: var(--red); }

        .card { background: var(--card); border-radius: 10px; margin: 15px 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); overflow: hidden; }
        .card-body { padding: 15px; }
        .card h3 { margin-top: 0; color: var(--accent); border-bottom: 1px solid #333; padding-bottom: 10px; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        button { background: #333; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; transition: 0.2s; font-size: 1em; position: relative; overflow: hidden; }
        button:hover { background: #444; filter: brightness(1.2); }
        button:disabled { opacity: 0.3; cursor: not-allowed; filter: grayscale(1); }
        
        .btn-special { background: linear-gradient(45deg, #6200ea, #b388ff); border: 1px solid var(--accent); display:none; }
        .btn-main { background: var(--accent); color: black; font-weight: bold; width: 100%; margin-top: 10px; font-size: 1.1em; }
        .btn-buy { background: var(--green); color: black; font-weight: bold; }
        .btn-risk { background: var(--red); color: white; }
        .cost-tag { font-size: 0.7em; color: #ccc; display: block; margin-top: 2px; }
        
        .img-banner { width: 100%; height: 150px; object-fit: cover; border-radius: 8px 8px 0 0; display: block; background: #333; }
        .item-img { width: 60px; height: 60px; object-fit: cover; border-radius: 8px; margin-right: 10px; background: #333; }

        #scene-creation { padding: 20px; text-align: center; }
        .input-group { margin-bottom: 15px; text-align: left; }
        .input-group input, .input-group select { width: 95%; padding: 10px; background: #222; border: 1px solid #444; color: white; border-radius: 5px; }
        .origin-card { background: #222; border: 2px solid #333; border-radius: 8px; padding: 15px; margin-bottom: 10px; cursor: pointer; text-align: left; }
        .origin-card.selected { border-color: var(--accent); background: #2a2a2a; box-shadow: 0 0 10px rgba(187, 134, 252, 0.5); }
        .origin-name { font-weight: bold; color: var(--gold); font-size: 1.1em; }
        .origin-parents { font-size: 0.8em; color: #aaa; margin-top: 5px; font-style: italic; }
        
        #scene-game { display: none; }
        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: #000; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #333; z-index: 50; }
        .nav-item { color: #888; cursor: pointer; text-align: center; font-size: 0.8em; }
        .nav-item.active { color: var(--accent); font-weight: bold; }
        .nav-icon { display: block; font-size: 1.5em; margin-bottom: 2px; }
        .page { display: none; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        
        /* å¤©è³¦æ¨™ç±¤ */
        .talent-tag { display: inline-block; background: var(--gold); color: black; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; margin-right: 5px; font-weight: bold; }
        .talent-bad { background: var(--red); color: white; }

        .log-box { height: 120px; overflow-y: auto; background: #111; padding: 10px; border-radius: 5px; font-size: 0.9em; color: #ccc; border: 1px solid #333; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 100; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-box { background: var(--card); width: 85%; max-width: 400px; padding: 20px; border-radius: 12px; border: 1px solid var(--accent); text-align: center; }
        .modal-btn { width: 100%; margin-bottom: 10px; padding: 15px; border: 1px solid #444; }

        @keyframes pulseRed { 0% { opacity: 0.8; } 50% { opacity: 1; } 100% { opacity: 0.8; } }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 100% { transform: translateX(0); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="scene-creation">
        <h1 style="color:var(--accent)">ğŸ§¬ æŠ•èƒæ¨¡æ“¬å™¨</h1>
        <div class="card"><div class="card-body">
            <div class="input-group"><label>å§“å</label><input type="text" id="inp-name" placeholder="è¼¸å…¥å§“å" maxlength="6"></div>
            <div class="input-group"><label>æ€§åˆ¥</label><select id="inp-gender"><option value="ç”·">ğŸ‘¨ ç”·ç”Ÿ</option><option value="å¥³">ğŸ‘© å¥³ç”Ÿ</option><option value="å…¶ä»–">ğŸŒˆ å…¶ä»–</option></select></div>
        </div></div>
        <h3 style="text-align:left;margin-left:10px;color:var(--gold)">å‡ºèº«èƒŒæ™¯</h3>
        <div id="origin-list"></div>
        <button class="btn-main" onclick="startGame()">ğŸš€ é–‹å§‹äººç”Ÿ</button>
    </div>

    <div id="scene-game">
        <div class="header">
            <div class="stat-grid">
                <div class="big-stat" id="money-display">$0</div>
                
                <div id="school-badge" class="school-badge">ğŸ’ å°å­¸ç”Ÿ</div>
                <div id="alert-debt" class="status-alert alert-red">âš ï¸ è² å‚µè­¦å‘Šï¼</div>
                <div id="alert-depression" class="status-alert alert-orange">â˜ï¸ æ†‚é¬±ç‹€æ…‹</div>
                <div id="alert-sick" class="status-alert alert-red">ğŸ¥ é‡ç—…è­¦å‘Š</div>
                
                <div style="grid-column: span 3; font-size:0.8em; color:#aaa; margin-bottom:5px; text-align:left;">
                    <span id="player-name"></span> | ğŸ“ <span id="edu-level">æ–‡ç›²</span><br>
                    <span id="player-origin" style="color:var(--gold)"></span>
                    <div id="talent-display" style="margin-top:3px;"></div>
                </div>
                
                <div>ğŸ“… <span id="year">0</span></div>
                <div>â¤ï¸ <span id="health">100</span></div>
                <div>ğŸ˜Š <span id="happy">80</span></div>
                
                <div>ğŸ§  <span id="intel">0</span></div>
                <div>âœ¨ <span id="charm">0</span></div>
                <div></div> <div class="stamina-container">
                    <div class="stamina-label"><span>âš¡ é«”åŠ›</span><span id="stamina-text">100/100</span></div>
                    <div class="progress-bg"><div id="stamina-bar" class="progress-fill" style="width: 100%;"></div></div>
                </div>
            </div>
        </div>

        <div id="page-home" class="page active">
            <div class="card">
                <img src="images/banner-home.jpg" class="img-banner" onerror="this.src='https://images.unsplash.com/photo-1519689680058-324335c77eba?w=600'">
                <div class="card-body">
                    <h3>ğŸ“ å¹´åº¦è¡Œå‹•</h3>
                    <div class="btn-grid">
                        <button onclick="action('work')" id="btn-work">ğŸ’¼ å·¥ä½œ</button>
                        <button onclick="action('study')" id="btn-study">ğŸ“š é€²ä¿®</button>
                        <button onclick="action('play')" id="btn-play">ğŸ® ç©æ¨‚</button>
                        <button onclick="action('gym')" id="btn-gym">ğŸ‹ï¸ å¥èº«</button>
                        <button onclick="action('dev_app')" id="btn-dev" class="btn-special">ğŸ’» é–‹ç™¼AI</button>
                        <button onclick="action('stream')" id="btn-stream" class="btn-special">ğŸ¤³ ç›´æ’­å¸¶è²¨</button>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-body">
                    <h3>ğŸ“œ äººç”Ÿå‹•æ…‹</h3>
                    <div id="game-log" class="log-box"></div>
                    <button class="btn-main" id="btn-nextyear" onclick="nextYear()">ğŸ‚ ä¸‹ä¸€æ­²</button>
                </div>
            </div>
        </div>

        <div id="page-assets" class="page"><div class="card"><div class="card-body"><h3>ğŸï¸ è»Šåº«</h3><div id="car-shop"></div></div></div><div class="card"><div class="card-body"><h3>ğŸ˜ï¸ æˆ¿ç”¢</h3><div id="house-shop"></div></div></div></div>
        <div id="page-casino" class="page"><div class="card"><div class="card-body"><h3>ğŸ° è³­å ´</h3><div id="casino-area"><input type="number" id="bet-amount" placeholder="é‡‘é¡" style="width:90%;padding:10px;margin-bottom:10px"><div class="btn-grid"><button class="btn-risk" onclick="gamble('big')">å¤§</button><button class="btn-risk" onclick="gamble('small')">å°</button></div><p id="casino-msg"></p></div></div></div></div>
        <div id="page-profile" class="page"><div class="card"><div class="card-body"><h3>ğŸ† æˆå°±</h3><div id="achievement-list"></div><button onclick="restartGame()" style="width:100%;margin-top:20px">é‡ä¾†</button></div></div></div>

        <div class="nav-bar">
            <div class="nav-item active" onclick="nav('home')"><span class="nav-icon">ğŸ </span>ç”Ÿæ´»</div>
            <div class="nav-item" onclick="nav('assets')"><span class="nav-icon">ğŸï¸</span>è³‡ç”¢</div>
            <div class="nav-item" onclick="nav('casino')"><span class="nav-icon">ğŸ°</span>è³­å ´</div>
            <div class="nav-item" onclick="nav('profile')"><span class="nav-icon">ğŸ†</span>æˆå°±</div>
        </div>
    </div>

    <div id="event-modal" class="modal-overlay"><div class="modal-box"><div class="modal-title" id="ev-title"></div><div id="ev-desc" style="margin-bottom:20px;"></div><button class="modal-btn" id="btn-choice-a">A</button><button class="modal-btn" id="btn-choice-b">B</button></div></div>

    <script>
        // ==========================================
        // ğŸ”´ 1. è³‡æ–™åº« (Origins, Talents, Assets, Events)
        // ==========================================
        const TALENTS = [
            { id: 't1', name: 'éç›®ä¸å¿˜', desc: 'è®€æ›¸æ•ˆç‡+50%', type: 'good' },
            { id: 't2', name: 'å¤©ç”Ÿç¥åŠ›', desc: 'å¥åº·è‡ªç„¶è¡°é€€æ¸›åŠ', type: 'good' },
            { id: 't3', name: 'è¬äººè¿·', desc: 'åˆå§‹é­…åŠ›+20ï¼Œç¤¾äº¤æ•ˆæœ+20%', type: 'good' },
            { id: 't4', name: 'æŠ•è³‡çœ¼', desc: 'è³­åš/æŠ•è³‡å‹ç‡å¾®å¹…æå‡', type: 'good' },
            { id: 't5', name: 'ç»ç’ƒå¿ƒ', desc: 'å¿«æ¨‚å€¼ä¸‹é™é€Ÿåº¦åŠ å€', type: 'bad' },
            { id: 't6', name: 'ç—…ä»¥æ­¤ç”Ÿ', desc: 'åˆå§‹å¥åº·-20ï¼Œå®¹æ˜“ç”Ÿç—…', type: 'bad' },
            { id: 't7', name: 'é‚Šç·£äºº', desc: 'åˆå§‹é­…åŠ›-20', type: 'bad' }
        ];

        const ORIGIN_DATA = [
            { id: 'common', name: 'å¹³å‡¡å®¶åº­', desc: 'æ™®æ™®é€šé€šï¼Œå¹¸ç¦å®‰åº·ã€‚', parents: 'çˆ¶:å…¬å‹™å“¡ / æ¯:è€å¸«', money: 0, intel: 50, charm: 50, happy: 80, yearlyMoney: 500, buff: 'å¹³è¡¡ç™¼å±•' },
            { id: 'rich', name: 'å¯ŒäºŒä»£', desc: 'å«è‘—é‡‘æ¹¯åŒ™å‡ºç”Ÿã€‚', parents: 'çˆ¶:é›†åœ˜è‘£äº‹ / æ¯:ååª›', money: 500000, intel: 30, charm: 70, happy: 90, yearlyMoney: 50000, buff: 'é–‹å±€é‰…æ¬¾ + é«˜é¡é›¶ç”¨éŒ¢' },
            { id: 'genius', name: 'å¯’é–€å¤©æ‰', desc: 'å®¶å¾’å››å£ï¼Œä½†æ™ºå•†é©šäººã€‚', parents: 'çˆ¶:è‡¨æ™‚å·¥ / æ¯:æ¸…æ½”å“¡', money: -10000, intel: 95, charm: 30, happy: 60, yearlyMoney: 0, buff: 'æ™ºåŠ›æ¥µé«˜ï¼Œä½†é–‹å±€è² å‚µ' },
            { id: 'mafia', name: 'é»‘é“ä¸–å®¶', desc: 'å¾å°åœ¨åˆ€å…‰åŠå½±ä¸­é•·å¤§ã€‚', parents: 'çˆ¶:è§’é ­è€å¤§ / æ¯:é…’åº—ç¶“ç†', money: 100000, intel: 40, charm: 80, happy: 50, health: 120, yearlyMoney: 10000, buff: 'åˆå§‹å¥åº·é«˜ï¼Œé­…åŠ›é«˜' },
            { id: 'star', name: 'æ¼”è—ä¸–å®¶', desc: 'çˆ¶æ¯éƒ½æ˜¯å¤§æ˜æ˜Ÿã€‚', parents: 'çˆ¶:å½±å¸ / æ¯:æ­Œå', money: 50000, intel: 40, charm: 100, happy: 50, yearlyMoney: 5000, buff: 'é­…åŠ›æ»¿é»' }
        ];

        const CAR_DATA = [
            { id: 'toyota', name: "åœ‹ç”¢ä»£æ­¥è»Š", price: 600000, charm: 2, img: "images/toyota.jpg" },
            { id: 'tesla', name: "ç‰¹æ–¯æ‹‰ Model 3", price: 1800000, charm: 10, img: "images/tesla.jpg" },
            { id: 'porsche', name: "ä¿æ™‚æ· 911", price: 6000000, charm: 30, img: "images/porsche.jpg" },
            { id: 'ferrari', name: "æ³•æ‹‰åˆ© F8", price: 15000000, charm: 60, img: "images/ferrari.jpg" }
        ];
        const HOUSE_DATA = [
            { id: 'apt', name: "å–®èº«å…¬å¯“", price: 3000000, happy: 2, img: "images/apartment.jpg" },
            { id: 'mansion', name: "å¸‚ä¸­å¿ƒè±ªå®…", price: 20000000, happy: 10, img: "images/mansion.jpg" },
            { id: 'villa', name: "ç§äººæµ·æ™¯åˆ¥å¢…", price: 100000000, happy: 30, img: "images/villa.jpg" }
        ];

        const EVENT_DATA = [
            { prob: 100, title: "å¿˜è¨˜å¸¶ä½œæ¥­", desc: "æ…˜äº†ï¼æ˜¨æ™šæ‰“é›»å‹•æ‰“å¤ªæ™š...", choices: [{ txt: "èª å¯¦æ‹›èª (å¿«æ¨‚-5)", effect: (p) => { p.happy-=5; return "è¢«å”¸äº†ä¸€é “ã€‚"; } }, { txt: "èªªè¬Š (é­…åŠ›æª¢å®š)", effect: (p) => { if(p.charm>50){p.charm+=2; return "è€å¸«ä¿¡äº†ï¼"; } else {p.intel-=2; return "è¢«è­˜ç ´ç½°ç«™ã€‚"; } } }] },
            { prob: 80, title: "ç‡Ÿé¤Šåˆé¤", desc: "åˆé¤å‡ºç¾å¥‡æ€ªç”Ÿç‰©...", choices: [{ txt: "åƒ (å¥åº·-10)", effect: (p) => { p.health-=10; return "æ‹‰è‚šå­..."; } }, { txt: "å€’æ‰", effect: (p) => { return "é¤“è‚šå­ä¸Šèª²ã€‚"; } }] },
            { prob: 50, title: "æ ¡æ…¶è¡¨æ¼”", desc: "æ¨é¸äººä¸Šå°è¡¨æ¼”ã€‚", choices: [{ txt: "æˆ‘ä¾† (éœ€é­…åŠ›60)", effect: (p) => { if(p.charm>=60){p.charm+=10;p.happy+=10;return "å…¨å ´æ­¡å‘¼ï¼";}else{p.happy-=20;return "ç ´éŸ³å¥½å°·å°¬...";} } }, { txt: "ç•¶è§€çœ¾", effect: (p) => { p.happy+=2; return "å¿«æ¨‚çœ‹æˆ²ã€‚"; } }] },
            { prob: 40, title: "è½‰å­¸ç”Ÿ", desc: "ä¾†äº†å€‹å¯æ„›è½‰å­¸ç”Ÿã€‚", choices: [{ txt: "æ­è¨• (éœ€é­…åŠ›50)", effect: (p) => { if(p.charm>50){p.happy+=15;return "èŠå¾—å¾ˆé–‹å¿ƒï¼";}else{p.happy-=5;return "å°æ–¹ä¸æƒ³ç†ä½ ã€‚";} } }, { txt: "å€Ÿç­†è¨˜ (æ™ºåŠ›+2)", effect: (p) => { p.intel+=2; return "å±•ç¾å­¸éœ¸é¢¨ç¯„ã€‚"; } }] },
            { prob: 30, title: "ä½œå¼Šé¢¨æ³¢", desc: "åŒå­¸ä¸Ÿå°æŠ„çµ¦ä½ ...", choices: [{ txt: "ç”¨ (é¢¨éšª)", effect: (p) => { if(Math.random()>0.7){p.intel-=10;p.happy-=20;return "è¢«æŠ“åˆ°è¨˜å¤§éï¼";}else{p.intel+=10;return "ç¥ä¸çŸ¥é¬¼ä¸è¦ºæ»¿åˆ†ï¼";} } }, { txt: "æ’•æ‰ (é­…åŠ›+5)", effect: (p) => { p.charm+=5; return "å …æŒèª å¯¦ã€‚"; } }] },
            { prob: 100, title: "æ¨éŠ·é›»è©±", desc: "æœ‰è½éè²¸æ¬¾å—ï¼Ÿ", choices: [{ txt: "æ›æ–·", effect: (p) => { return "æ›æ–·äº†ã€‚"; } }, { txt: "èŠå¤© (å¿«æ¨‚+5)", effect: (p) => { p.happy+=5; return "æµªè²»è©é¨™é›†åœ˜æ™‚é–“ã€‚"; } }] },
            { prob: 60, title: "è‚¡ç¥¨æ˜ç‰Œ", desc: "åŒäº‹å ±æ˜ç‰Œã€‚", choices: [{ txt: "æ¢­å“ˆ (é¢¨éšª)", effect: (p) => { if(Math.random()>0.5){p.money+=20000;return "è³ºç¿»äº†ï¼";}else{p.money-=10000;p.happy-=20;return "æ…˜è³ ...";} } }, { txt: "ä¸ç†æœƒ (æ™ºåŠ›+2)", effect: (p) => { p.intel+=2; return "ç©©å¥ç†è²¡ã€‚"; } }] },
            { prob: 30, title: "æ…£è€é—†", desc: "è€é—†è¦ä½ ç„¡è–ªåŠ ç­ã€‚", choices: [{ txt: "å›å˜´ (é‡‘éŒ¢-2000, å¿«æ¨‚+20)", effect: (p) => { p.money-=2000;p.happy+=20;return "å—†çˆ†è€é—†ï¼Œçˆ½ï¼"; } }, { txt: "åå¿", effect: (p) => { p.happy-=5; return "ç¤¾ç•œæ—¥å¸¸ã€‚"; } }] },
            { prob: 20, title: "é€šå‹¤åœ°ç„", desc: "æ·é‹æ•…éšœå¿«é²åˆ°äº†ã€‚", choices: [{ txt: "æ­è¨ˆç¨‹è»Š ($-500)", effect: (p) => { p.money-=500; return "èŠ±éŒ¢æ¶ˆç½ã€‚"; } }, { txt: "è«‹å‡ (å¿«æ¨‚+5)", effect: (p) => { p.happy+=5; return "å»åƒæ—©åˆé¤å¥½äº†ã€‚"; } }] },
            { prob: 50, title: "æµæ„Ÿ", desc: "å–‰åš¨ç—›ç—›çš„ã€‚", choices: [{ txt: "çœ‹é†«ç”Ÿ ($-500)", effect: (p) => { p.money-=500;p.health+=2; return "åƒè—¥å¥½å¤šäº†ã€‚"; } }, { txt: "å–ç†±æ°´ (æª¢å®š)", effect: (p) => { if(p.health>80){return "è‡ªç™’äº†ï¼";}else{p.health-=15;return "ç™¼é«˜ç‡’ä¸‰å¤©...";} } }] },
            { prob: 20, title: "è»Šç¦", desc: "æ©Ÿè»Šè¡éä¾†ï¼", choices: [{ txt: "é–ƒé¿ (å¥åº·-10)", effect: (p) => { p.health-=10; return "å—äº†çš®è‚‰å‚·ã€‚"; } }, { txt: "ç´¢è³  (æ™ºåŠ›æª¢å®š)", effect: (p) => { if(p.intel>60){p.money+=3000;return "å°æ–¹è³ éŒ¢äº†ã€‚";}else{p.money-=1000;return "çµæœæ˜¯ä½ é•è¦...";} } }] },
            { prob: 5, title: "ä¸­çç™¼ç¥¨", desc: "ç™¼ç¾æ²’å°çš„ç™¼ç¥¨ã€‚", choices: [{ txt: "å°ç", effect: (p) => { p.money+=40000;p.happy+=20;return "ä¸­äºŒçäº†ï¼"; } }, { txt: "æè´ˆ (é­…åŠ›+20)", effect: (p) => { p.charm+=20; return "åšå–„äº‹ã€‚"; } }] },
            { prob: 1, title: "æ¨‚é€é ­ç", desc: "éš¨æ‰‹è²·çš„å½©åˆ¸...", choices: [{ txt: "å…Œç", effect: (p) => { p.money+=100000000;p.happy=100;return "ä¸­ä¸€å„„å…ƒï¼ï¼"; } }, { txt: "ä½èª¿", effect: (p) => { p.money+=100000000;p.intel+=10;return "å†·éœé ˜çã€‚"; } }] }
        ];

        // ==========================================
        // ğŸ”´ 2. éŠæˆ²é‚è¼¯å€
        // ==========================================
        let Game = { 
            name: "", origin: "", age: 0, money: 0, health: 100, happy: 80, intel: 0, charm: 0, 
            stamina: 100, debtYears: 0, inventory: [], achievements: [],
            schoolStatus: "", eduMultiplier: 1.0, eduLevelName: "æ–‡ç›²",
            yearlyMoney: 0, talents: []
        };
        
        const COSTS = { work: 30, study: 20, play: 10, gym: 25, dev_app: 50, stream: 40, cram: 30, club: 20 };
        let activeEvent = null, selectedOriginId = null;

        function initCreation() {
            let html = ""; 
            ORIGIN_DATA.forEach(o => {
                html += `<div class="origin-card" onclick="selectOrigin('${o.id}', this)">
                    <div class="origin-name">${o.name}</div>
                    <div class="origin-parents">${o.parents}</div>
                    <div style="font-size:0.9em;color:#aaa;margin-top:2px;">${o.desc}</div>
                    <div style="font-size:0.8em;color:var(--green)">âœ¨ ${o.buff} | ğŸ’° é›¶ç”¨éŒ¢:${o.yearlyMoney}/å¹´</div>
                </div>`;
            });
            document.getElementById('origin-list').innerHTML = html;
            selectOrigin(ORIGIN_DATA[0].id, document.querySelector('.origin-card'));
        }
        function selectOrigin(id, el) { selectedOriginId = id; document.querySelectorAll('.origin-card').forEach(c => c.classList.remove('selected')); if(el) el.classList.add('selected'); }

        function startGame() {
            let name = document.getElementById('inp-name').value;
            if(!name) return alert("è«‹è¼¸å…¥åå­—");
            let o = ORIGIN_DATA.find(x => x.id === selectedOriginId);
            
            let myTalents = [];
            let talentPool = [...TALENTS];
            let count = Math.random() > 0.5 ? 2 : 1; 
            for(let i=0; i<count; i++) {
                let idx = Math.floor(Math.random() * talentPool.length);
                myTalents.push(talentPool[idx]);
                talentPool.splice(idx, 1);
            }

            Game = { 
                ...Game, 
                name: name, origin: o.name, money: o.money, intel: o.intel, charm: o.charm, happy: o.happy, 
                health: o.health || 100, age: 0, yearlyMoney: o.yearlyMoney, talents: myTalents
            };

            Game.talents.forEach(t => {
                if(t.id === 't6') Game.health -= 20;
                if(t.id === 't7') Game.charm -= 20;
                if(t.id === 't3') Game.charm += 20;
            });

            document.getElementById('scene-creation').style.display='none'; document.getElementById('scene-game').style.display='block';
            document.getElementById('player-name').innerText = Game.name; document.getElementById('player-origin').innerText = Game.origin;
            
            renderShop(); updateUI(); 
            log(`ğŸ‘¶ ${Game.name} å‡ºç”Ÿäº†ï¼èƒŒæ™¯ï¼š${Game.origin}`);
            log(`ğŸ§¬ å¤©è³¦ï¼š${Game.talents.map(t=>t.name).join(', ')}`);
        }

        function updateUI() {
            // ğŸ”¥ ä¿®å¾©ï¼šåŠ ä¸Šå° intel å’Œ charm çš„æ›´æ–°ï¼Œå› ç‚ºç¾åœ¨ HTML è£¡æœ‰é€™å…©å€‹ id äº†
            ['age', 'health', 'happy', 'intel', 'charm'].forEach(k => { 
                let el = document.getElementById(k);
                if(el) el.innerText = Game[k]; 
            });
            
            document.getElementById('year').innerText = new Date().getFullYear() + Game.age;
            let mEl = document.getElementById('money-display'); mEl.innerText = "$"+Game.money.toLocaleString();
            document.getElementById('edu-level').innerText = Game.eduLevelName;

            let tHtml = "";
            Game.talents.forEach(t => {
                let colorClass = t.type === 'bad' ? 'talent-bad' : '';
                tHtml += `<span class="talent-tag ${colorClass}" title="${t.desc}">${t.name}</span>`;
            });
            document.getElementById('talent-display').innerHTML = tHtml;

            document.getElementById('alert-debt').style.display = (Game.money < 0) ? 'block' : 'none';
            if(Game.money < 0) { mEl.classList.add('debt'); document.getElementById('alert-debt').innerText = `âš ï¸ è² å‚µï¼å‰© ${3-Game.debtYears} å¹´`; } else mEl.classList.remove('debt');
            let isDepressed = Game.happy < 20;
            document.getElementById('alert-depression').style.display = isDepressed ? 'block' : 'none';
            document.getElementById('alert-sick').style.display = (Game.health < 30) ? 'block' : 'none';

            let badge = document.getElementById('school-badge');
            if(Game.schoolStatus) { badge.style.display = 'block'; badge.innerText = "ğŸ’ " + Game.schoolStatus; } else { badge.style.display = 'none'; }

            let bar = document.getElementById('stamina-bar');
            if(Game.stamina < 0) Game.stamina = 0;
            bar.style.width = Game.stamina + "%"; document.getElementById('stamina-text').innerText = Game.stamina+"/100";
            if(Game.stamina < 20) bar.classList.add('low'); else bar.classList.remove('low');

            updateActionButtons(isDepressed);
            document.getElementById('btn-dev').style.display = (Game.age >= 18 && Game.intel >= 80) ? 'block' : 'none';
            document.getElementById('btn-stream').style.display = (Game.age >= 18 && Game.charm >= 80) ? 'block' : 'none';

            let nextBtn = document.getElementById('btn-nextyear');
            if(Game.stamina < 10) nextBtn.classList.add('pulse'); else nextBtn.classList.remove('pulse');
            document.getElementById('casino-area').style.display = (Game.age < 18) ? 'none' : 'block';
        }

        function updateActionButtons(isDepressed) {
            let b1=document.getElementById('btn-work'), b2=document.getElementById('btn-study'), b3=document.getElementById('btn-play'), b4=document.getElementById('btn-gym');
            
            // é‡ç½®æŒ‰éˆ•ä»¥æ¸…é™¤èˆŠçš„ç›£è½å™¨
            let resetBtn = (btn) => { let newBtn = btn.cloneNode(true); btn.parentNode.replaceChild(newBtn, btn); return newBtn; };
            b1 = resetBtn(b1); b2 = resetBtn(b2); b3 = resetBtn(b3); b4 = resetBtn(b4);

            if(Game.age >= 6 && Game.age < 18) {
                b1.innerHTML = `ğŸ« å°ˆå¿ƒè½è¬› <span class="cost-tag">âš¡ -30</span>`; b1.onclick = () => action('school_study');
                b2.innerHTML = `ğŸ“– è£œç¿’ç­ <span class="cost-tag">âš¡ -30 / $-1000</span>`; b2.onclick = () => action('cram_school');
                b3.innerHTML = `âš½ åƒåŠ ç¤¾åœ˜ <span class="cost-tag">âš¡ -20</span>`; b3.onclick = () => action('club');
                b4.innerHTML = `ğŸ® å·çœ‹æ¼«ç•« <span class="cost-tag">âš¡ -10</span>`; b4.onclick = () => action('play');
            } else if (Game.age >= 18 && Game.age <= 22 && Game.schoolStatus === "å¤§å­¸ç”Ÿ") {
                b1.innerHTML = `ğŸ“ å°ˆæ¥­èª²ç¨‹ <span class="cost-tag">âš¡ -30</span>`; b1.onclick = () => action('uni_study');
                b2.innerHTML = `ğŸ¥¤ æ‰“å·¥ <span class="cost-tag">âš¡ -30 / +$</span>`; b2.onclick = () => action('part_time');
                b3.innerHTML = `ğŸ‰ è¯èª¼ <span class="cost-tag">âš¡ -20 / $$</span>`; b3.onclick = () => action('social');
                b4.innerHTML = `ğŸ‹ï¸ å¥èº« <span class="cost-tag">âš¡ -25</span>`; b4.onclick = () => action('gym');
            } else {
                if(Game.age <= 5) {
                    b1.innerHTML = `ğŸ¼ å–å¥¶ <span class="cost-tag">âš¡ -30</span>`; b1.onclick = () => action('baby_sleep');
                    b2.innerHTML = `ğŸ—£ï¸ å­¸èªªè©± <span class="cost-tag">âš¡ -20</span>`; b2.onclick = () => action('baby_learn');
                    b3.innerHTML = `ğŸ§¸ ç©ç©å…· <span class="cost-tag">âš¡ -10</span>`; b3.onclick = () => action('baby_play');
                    b4.innerHTML = `ğŸ¢ çˆ¬è¡Œ <span class="cost-tag">âš¡ -25</span>`; b4.onclick = () => action('baby_crawl');
                } else {
                    b1.innerHTML = `ğŸ’¼ å·¥ä½œ <span class="cost-tag">âš¡ -30</span>`; b1.onclick = () => action('work');
                    b2.innerHTML = `ğŸ“š é€²ä¿® <span class="cost-tag">âš¡ -20</span>`; b2.onclick = () => action('study');
                    b3.innerHTML = `ğŸ® ç©æ¨‚ <span class="cost-tag">âš¡ -10</span>`; b3.onclick = () => action('play');
                    b4.innerHTML = `ğŸ‹ï¸ å¥èº« <span class="cost-tag">âš¡ -25</span>`; b4.onclick = () => action('gym');
                }
            }
            [b1, b2, b3, b4].forEach(btn => { if(isDepressed) btn.disabled = true; else btn.disabled = (Game.stamina < 10); });
        }

        function action(type) {
            if(Game.health <= 0) return alert("å·²æ­»äº¡");
            let cost = 30;
            if(['play','baby_play'].includes(type)) cost=10; 
            if(['gym','baby_crawl'].includes(type)) cost=25; 
            if(['club','baby_learn','study'].includes(type)) cost=20;
            if(type==='dev_app') cost=50; if(type==='stream') cost=40;

            if(Game.stamina < cost) return alert("é«”åŠ›ä¸è¶³ï¼");
            Game.stamina -= cost;

            let intelBonus = 0;
            if(Game.talents.some(t => t.id === 't1')) intelBonus += 2;

            // ğŸ”¥ å¬°å…’é‚è¼¯ (ç¢ºèªé€™æ®µå­˜åœ¨ï¼)
            if(type === 'baby_sleep') { Game.health+=2; Game.happy+=2; log("ğŸ¼ å–é£½äº†å¥¶ç¡å¾—å¾ˆé¦™ã€‚"); }
            else if(type === 'baby_learn') { Game.intel += (4 + intelBonus); log(`ğŸ—£ï¸ å­¸èªªè©± (æ™ºåŠ›+${4+intelBonus})`); }
            else if(type === 'baby_play') { Game.happy+=12; log("ğŸ§¸ ç©ç©å…·å¾ˆé–‹å¿ƒã€‚"); }
            else if(type === 'baby_crawl') { Game.health+=5; log("ğŸ¢ åˆ°è™•çˆ¬è¡Œã€‚"); }

            // å­¸ç”Ÿ
            else if(type === 'school_study') { Game.intel += (2 + intelBonus); log(`èªçœŸè½è¬› (æ™ºåŠ›+${2+intelBonus})`); }
            else if(type === 'cram_school') { if(Game.money >= 1000) { Game.money -= 1000; Game.intel += (5+intelBonus); log("è£œç¿’è¡åˆº (æ™ºåŠ›UP)"); } else { log("æ²’éŒ¢è£œç¿’..."); Game.stamina += cost; } }
            else if(type === 'club') { Game.charm += 2; Game.happy += 5; log("ç¤¾åœ˜æ´»å‹•ã€‚"); }
            
            // å¤§å­¸
            else if(type === 'uni_study') { Game.intel += (3+intelBonus); log("é‘½ç ”å°ˆæ¥­ã€‚"); }
            else if(type === 'part_time') { Game.money += 800; Game.happy -= 5; log("æ‰“å·¥è³ºäº† $800"); }
            else if(type === 'social') { Game.money -= 2000; Game.charm += 3; Game.happy += 10; log("è¯èª¼ã€‚"); }
            
            // æˆäºº
            else if(type === 'work') { 
                let base = 25000 + (Game.intel * 800);
                let finalSalary = Math.floor(base * Game.eduMultiplier);
                Game.money += finalSalary; Game.health -= 3; Game.happy -= 5; 
                log(`å·¥ä½œè³ºäº† $${finalSalary}`); 
            }
            else if(type === 'study') { Game.intel += (4+intelBonus); Game.money -= 2000; log("é€²ä¿®ã€‚"); }
            else if(type === 'play') { Game.happy += 12; Game.money -= 4000; log("ç©æ¨‚ã€‚"); }
            else if(type === 'gym') { Game.health += 5; Game.charm += 2; Game.money -= 800; log("å¥èº«ã€‚"); }
            
            // ç‰¹æ®Š
            else if(type === 'dev_app') { Game.stamina-=20; let s=Math.random()<(Game.intel/150); if(s){let p=100000+Game.intel*2000;Game.money+=p;log(`é–‹ç™¼è³º $${p}`);}else{Game.happy-=10;log("é–‹ç™¼å¤±æ•—");} }
            else if(type === 'stream') { Game.stamina-=10; let inc=Game.charm*1000+Math.random()*50000; Game.money+=Math.floor(inc); log(`ç›´æ’­è³º $${Math.floor(inc)}`); }

            updateUI();
        }

        function nextYear() {
            if(Game.health <= 0) return;
            Game.age++; Game.health -= 3; Game.stamina = 100; 
            
            if(Game.talents.some(t=>t.id==='t2')) Game.health += 1; 
            if(Game.talents.some(t=>t.id==='t5')) Game.happy -= 5;

            if(Game.age < 18 && Game.yearlyMoney > 0) { Game.money += Game.yearlyMoney; log(`ğŸ§§ é ˜åˆ°é›¶ç”¨éŒ¢ $${Game.yearlyMoney}`); }

            log(`ğŸ‚ ${Game.age} æ­²äº†`);
            
            if(Game.age == 6) { Game.schoolStatus = "å°å­¸ç”Ÿ"; log("ğŸ’ é–‹å§‹ä¸Šå°å­¸ï¼"); }
            if(Game.age == 13) { Game.schoolStatus = "ä¸­å­¸ç”Ÿ"; log("ğŸ« å‡ä¸Šä¸­å­¸ã€‚"); }
            
            if(Game.age == 18) {
                let score = Game.intel + (Math.random() * 20);
                if(Game.talents.some(t=>t.id==='t1')) score += 10;
                let result = "";
                if(score >= 100) { Game.eduMultiplier = 1.5; Game.eduLevelName = "é ‚å°–å¤§å­¸"; Game.schoolStatus = "å¤§å­¸ç”Ÿ"; result = "ğŸ‰ è€ƒä¸Šé ‚å°–å¤§å­¸ï¼(è–ªæ°´+50%)"; } 
                else if(score >= 60) { Game.eduMultiplier = 1.2; Game.eduLevelName = "æ™®é€šå¤§å­¸"; Game.schoolStatus = "å¤§å­¸ç”Ÿ"; result = "ğŸ‘ è€ƒä¸Šæ™®é€šå¤§å­¸ã€‚(è–ªæ°´+20%)"; } 
                else { Game.eduMultiplier = 1.0; Game.eduLevelName = "é«˜ä¸­ç•¢æ¥­"; Game.schoolStatus = ""; result = "ğŸ‚ è½æ¦œäº†ï¼Œç›´æ¥å·¥ä½œã€‚"; }
                activeEvent = { choices: [{ effect: () => result }] };
                showModal("ğŸ“ å¤§å­¸æ”¾æ¦œ", `åˆ†æ•¸ï¼š${Math.floor(score)}\n\n${result}`, "ç¢ºèª", "ç¢ºèª", 0, 0);
            }

            if(Game.age == 22 && Game.schoolStatus === "å¤§å­¸ç”Ÿ") { Game.schoolStatus = ""; log("ğŸ“ å¤§å­¸ç•¢æ¥­ï¼"); }
            if(Game.money < 0) { Game.debtYears++; if(Game.debtYears > 3) triggerDebtPunishment(); } else Game.debtYears=0;
            if(Game.health < 30) { Game.money -= 50000; log("ğŸ¥ ä½é™¢ -$50000"); }
            Game.inventory.forEach(id => { let c=CAR_DATA.find(x=>x.id==id);if(c)Game.charm+=1; let h=HOUSE_DATA.find(x=>x.id==id);if(h)Game.happy+=2; });
            
            if(Math.random() < 0.3) {
                let totalWeight = 0;
                EVENT_DATA.forEach(evt => totalWeight += (evt.prob || 10));
                let randomVal = Math.floor(Math.random() * totalWeight);
                for(let i = 0; i < EVENT_DATA.length; i++) {
                    let evt = EVENT_DATA[i];
                    let weight = evt.prob || 10;
                    if(randomVal < weight) { activeEvent = evt; break; }
                    randomVal -= weight;
                }
                showModal(activeEvent.title, activeEvent.desc, activeEvent.choices[0].txt, activeEvent.choices[1].txt, 0, 1);
            }
            if(Game.health <= 0) { Game.health = 0; log("ğŸ’€ æ­»äº¡"); }
            updateUI();
        }

        function showModal(t, d, b1, b2, i1, i2) { document.getElementById('ev-title').innerText=t; document.getElementById('ev-desc').innerText=d; let ba=document.getElementById('btn-choice-a'), bb=document.getElementById('btn-choice-b'); ba.onclick=()=>resolveEvent(i1); bb.onclick=()=>resolveEvent(i2); ba.innerText=b1; bb.innerText=b2; document.getElementById('event-modal').style.display='flex'; }
        function resolveEvent(i) { let r=activeEvent.choices[i].effect(Game); log(`âš¡ ${r}`); document.getElementById('event-modal').style.display='none'; updateUI(); }
        function triggerDebtPunishment() { Game.inventory=[]; Game.money=0; Game.happy-=50; activeEvent={choices:[{effect:()=>"è³‡ç”¢å……å…¬"}]}; showModal("ç ´ç”¢", "æœŸé™å·²åˆ°ï¼Œå¼·åˆ¶é‚„æ¬¾", "èªå‘½", "èªå‘½", 0, 0); }
        function renderShop() { let ch="", hh=""; CAR_DATA.forEach(c=>ch+=renderItem(c,'car')); HOUSE_DATA.forEach(h=>hh+=renderItem(h,'house')); document.getElementById('car-shop').innerHTML=ch; document.getElementById('house-shop').innerHTML=hh; }
        function renderItem(i,t) { return `<div style="display:flex;justify-content:space-between;margin-bottom:10px;border-bottom:1px solid #333;"><div style="display:flex;"><img src="${i.img}" class="item-img" onerror="this.style.display='none'"><div><b>${i.name}</b><br><span style="color:#888;font-size:0.8em">${t=='car'?'é­…åŠ›+'+i.charm:'å¿«æ¨‚+'+i.happy}</span></div></div><button class="btn-buy" onclick="buy('${t}','${i.id}')">$${i.price/10000}è¬</button></div>`; }
        function buy(t,id) { let i = t=='car'?CAR_DATA.find(x=>x.id==id):HOUSE_DATA.find(x=>x.id==id); if(Game.inventory.includes(id))return alert("å·²æ“æœ‰"); if(Game.money>=i.price){Game.money-=i.price;Game.inventory.push(id);log(`è³¼è²· ${i.name}`);updateUI();}else alert("éŒ¢ä¸å¤ "); }
        function gamble(c) { let v=parseInt(document.getElementById('bet-amount').value); if(!v)return; if(Game.stamina<5)return alert("é«”åŠ›ä¸è¶³"); Game.stamina-=5; let d=Math.floor(Math.random()*10), r=d>=5?'big':'small'; if(c==r){Game.money+=v;log(`è´ $${v}`);}else{Game.money-=v;log(`è¼¸ $${v}`);} updateUI(); }
        function nav(p){ document.querySelectorAll('.page').forEach(e=>e.classList.remove('active')); document.getElementById('page-'+p).classList.add('active'); }
        function restartGame(){ location.reload(); }

        initCreation();
    </script>
</body>
</html>
