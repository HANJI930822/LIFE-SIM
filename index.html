<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ™‚äº‹äººç”Ÿ V17.0ï¼šçµ‚æ¥µç‰ˆ</title>
    <style>
      :root {
        --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --bg-dark: #0f0f23;
        --card: linear-gradient(135deg, #1e1e2e 0%, #2a2a3e 100%);
        --accent: #bb86fc;
        --accent-glow: rgba(187, 134, 252, 0.3);
        --text: #ffffff;
        --text-dim: #b0b0b0;
        --green: #03dac6;
        --red: #cf6679;
        --gold: #ffd700;
        --blue: #2196f3;
        --orange: #ff9800;
        --purple: #9c27b0;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "å¾®è»Ÿæ­£é»‘é«”", "Noto Sans TC", sans-serif;
        background: var(--bg-dark);
        color: var(--text);
        max-width: 100%;
        width: 100%;
        margin: 0 auto;
        padding: 0;
        padding-bottom: 80px;
        overflow-x: hidden;
        position: relative;
        min-height: 100vh;
      }

      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 300px;
        background: var(--bg-primary);
        z-index: -1;
        opacity: 0.3;
        pointer-events: none; /* ç¢ºä¿ä¸æ“‹ä½é»æ“Š */
      }

      /* ===== HEADER ===== */
      .header {
        background: linear-gradient(135deg, #1e1e2e 0%, #2a2a3e 100%);
        padding: 15px;
        position: sticky;
        top: 0;
        z-index: 100; /* æé«˜å±¤ç´š */
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        border-bottom: 2px solid var(--accent);
      }

      .player-info {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        gap: 10px;
      }

      .player-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--bg-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5em;
        box-shadow: 0 0 15px var(--accent-glow);
      }

      .player-details {
        flex: 1;
      }

      .player-name-line {
        font-size: 1.2em;
        font-weight: bold;
        color: var(--gold);
      }

      .player-subtitle {
        font-size: 0.8em;
        color: var(--text-dim);
      }

      .big-stat {
        font-size: 1.5em;
        font-weight: bold;
        color: var(--gold);
        text-align: center;
        margin: 10px 0;
        text-shadow: 0 0 10px var(--gold);
      }

      .stat-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        font-size: 0.85em;
        text-align: center;
      }

      .stat-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 8px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .stat-value {
        font-size: 1.2em;
        font-weight: bold;
        display: block;
        color: var(--text);
      }

      .status-alerts {
        margin-top: 10px;
        display: flex;
        flex-direction: column;
        gap: 5px;
      }

      .status-alert {
        padding: 8px;
        border-radius: 8px;
        font-size: 0.8em;
        font-weight: bold;
        text-align: center;
        animation: slideIn 0.3s;
      }

      .alert-red {
        background: linear-gradient(135deg, #b00020, #d32f2f);
        color: #fff;
      }
      .alert-orange {
        background: linear-gradient(135deg, #ff9800, #fb8c00);
        color: #fff;
      }
      .alert-blue {
        background: linear-gradient(135deg, #2196f3, #1976d2);
        color: #fff;
      }

      /* ===== SKILLS ===== */
      .skills-container {
        margin-top: 10px;
        background: rgba(0, 0, 0, 0.3);
        padding: 10px;
        border-radius: 8px;
      }

      .skill-item {
        margin-bottom: 8px;
      }

      .skill-header {
        display: flex;
        justify-content: space-between;
        font-size: 0.8em;
        margin-bottom: 3px;
        color: var(--text);
      }

      .skill-bar-bg {
        background: #333;
        height: 6px;
        border-radius: 3px;
        overflow: hidden;
      }

      .skill-bar-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--blue), var(--green));
        transition: width 0.5s ease;
      }

      /* ===== STAMINA ===== */
      .stamina-container {
        margin-top: 10px;
      }

      .stamina-label {
        font-size: 0.85em;
        color: var(--blue);
        margin-bottom: 5px;
        display: flex;
        justify-content: space-between;
      }

      .progress-bg {
        background: #444;
        height: 12px;
        border-radius: 6px;
        overflow: hidden;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #2196f3, #03dac6);
        width: 100%;
        transform-origin: left;
        transform: scaleX(1);
        transition: transform 0.3s ease;
        box-shadow: 0 0 10px rgba(33, 150, 243, 0.6);
      }

      .progress-fill.low {
        background: linear-gradient(90deg, #cf6679, #f44336);
      }

      /* ===== CARDS ===== */
      .card {
        background: var(--card);
        border-radius: 15px;
        margin: 15px 10px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.1);
        animation: fadeIn 0.4s;
        position: relative; /* ç¢ºä¿å±¤ç´šæ­£ç¢º */
        z-index: 1;
      }

      .card-header {
        padding: 15px;
        background: rgba(187, 134, 252, 0.15);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .card-title {
        font-size: 1.1em;
        font-weight: bold;
        color: var(--accent);
      }

      .card-body {
        padding: 15px;
        position: relative;
        z-index: 2;
      }

      /* ===== BUTTONS ä¿®å¾©é»æ“Šå•é¡Œ ===== */
      .btn-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        position: relative;
        z-index: 10; /* ç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
      }

      button {
        background: linear-gradient(135deg, #444, #555);
        color: white;
        border: none;
        padding: 12px;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 0.95em;
        font-weight: 500;
        border: 1px solid rgba(255, 255, 255, 0.2);
        position: relative;
        overflow: hidden;
        z-index: 10; /* ç¢ºä¿å¯é»æ“Š */
        pointer-events: auto; /* å¼·åˆ¶å•Ÿç”¨é»æ“Š */
      }

      /* ä¿®å¾© ::before å½å…ƒç´ æ“‹ä½é»æ“Šçš„å•é¡Œ */
      button::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        transform: translate(-50%, -50%);
        transition:
          width 0.6s,
          height 0.6s;
        pointer-events: none; /* é—œéµï¼šè®“å½å…ƒç´ ä¸æ“‹ä½é»æ“Š */
        z-index: -1; /* æ”¾åˆ°æŒ‰éˆ•æ–‡å­—ä¸‹æ–¹ */
      }

      button:hover::before {
        width: 300px;
        height: 300px;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(187, 134, 252, 0.4);
      }

      button:active {
        transform: translateY(0);
        box-shadow: 0 2px 8px rgba(187, 134, 252, 0.3);
      }

      button:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        filter: grayscale(1);
        pointer-events: none; /* disabled æ™‚æ‰ç¦ç”¨é»æ“Š */
      }

      .btn-main {
        background: linear-gradient(135deg, var(--accent), #9c27b0);
        color: white;
        font-weight: bold;
        width: 100%;
        margin-top: 10px;
        font-size: 1.1em;
        box-shadow: 0 4px 15px var(--accent-glow);
      }

      .btn-job {
        background: linear-gradient(135deg, #2196f3, #1976d2);
      }

      .btn-buy {
        background: linear-gradient(135deg, var(--green), #00897b);
        color: black;
        font-weight: bold;
      }

      .btn-risk {
        background: linear-gradient(135deg, var(--red), #c62828);
      }

      .cost-tag {
        font-size: 0.7em;
        color: #ddd;
        display: block;
        margin-top: 3px;
        pointer-events: none; /* ä¸æ“‹ä½æŒ‰éˆ•é»æ“Š */
      }

      /* ===== ORIGIN SELECTION ===== */
      #scene-creation {
        padding: 20px;
        text-align: center;
        position: relative;
        z-index: 10;
      }

      .creation-title {
        font-size: 2em;
        background: var(--bg-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 20px;
        font-weight: bold;
      }

      .origin-card {
        background: linear-gradient(135deg, #2a2a3e, #3a3a4e);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 12px;
        cursor: pointer;
        text-align: left;
        transition: all 0.3s;
        position: relative;
        z-index: 10; /* ç¢ºä¿å¯é»æ“Š */
        pointer-events: auto;
      }

      .origin-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(187, 134, 252, 0.3);
        border-color: rgba(187, 134, 252, 0.5);
      }

      .origin-card.selected {
        border-color: var(--accent);
        background: linear-gradient(135deg, #3a3a5e, #4a4a6e);
        box-shadow: 0 0 25px var(--accent-glow);
      }

      .origin-card.selected::before {
        content: "âœ“";
        position: absolute;
        top: 10px;
        right: 10px;
        width: 30px;
        height: 30px;
        background: var(--accent);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 1.2em;
        z-index: 20;
        pointer-events: none;
      }

      .origin-name {
        font-weight: bold;
        color: var(--gold);
        font-size: 1.2em;
        margin-bottom: 5px;
      }

      .origin-desc {
        font-size: 0.9em;
        color: var(--text-dim);
        margin: 5px 0;
        line-height: 1.4;
      }

      .origin-parents {
        font-size: 0.85em;
        color: #888;
        margin: 5px 0;
        font-style: italic;
      }

      .origin-stats {
        color: var(--green);
        font-size: 0.85em;
        margin-top: 8px;
        line-height: 1.5;
      }

      /* ===== INPUT GROUPS ===== */
      .input-group {
        margin-bottom: 15px;
        text-align: left;
      }

      .input-group label {
        display: block;
        margin-bottom: 5px;
        color: var(--text);
        font-weight: bold;
        font-size: 0.95em;
      }

      .input-group input,
      .input-group select {
        width: 100%;
        padding: 12px;
        background: rgba(255, 255, 255, 0.15);
        border: 2px solid rgba(255, 255, 255, 0.3);
        color: var(--text);
        border-radius: 8px;
        font-size: 1em;
        font-family: inherit;
        position: relative;
        z-index: 10;
        pointer-events: auto;
      }

      .input-group input::placeholder {
        color: rgba(255, 255, 255, 0.5);
      }

      .input-group input:focus,
      .input-group select:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 10px var(--accent-glow);
      }

      /* ===== MODAL ===== */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        z-index: 300; /* æœ€é«˜å±¤ç´š */
        display: none;
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(10px);
        animation: fadeIn 0.3s;
      }

      .modal-box {
        background: var(--card);
        width: 90%;
        max-width: 450px;
        padding: 25px;
        border-radius: 15px;
        border: 2px solid var(--accent);
        text-align: center;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
        animation: slideUp 0.4s;
        position: relative;
        z-index: 310;
      }

      .modal-title {
        font-size: 1.5em;
        font-weight: bold;
        color: var(--gold);
        margin-bottom: 15px;
      }

      .modal-desc {
        margin-bottom: 20px;
        line-height: 1.6;
        color: var(--text);
        white-space: pre-wrap;
      }

      .modal-btn {
        width: 100%;
        margin-bottom: 10px;
        padding: 15px;
        position: relative;
        z-index: 320;
      }

      /* ===== NAV BAR ===== */
      .nav-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        max-width: 100%;
        background: linear-gradient(135deg, #1e1e2e, #000);
        display: flex;
        justify-content: space-around;
        padding: 8px 0;
        border-top: 2px solid var(--accent);
        z-index: 200; /* é«˜å±¤ç´šä½†ä½æ–¼ modal */
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5);
      }

      .nav-item {
        color: #888;
        cursor: pointer;
        text-align: center;
        font-size: 0.75em;
        padding: 5px;
        transition: all 0.3s;
        flex: 1;
        position: relative;
        z-index: 210;
        pointer-events: auto;
      }

      .nav-item:hover {
        color: var(--accent);
      }

      .nav-item:active {
        transform: scale(0.95);
      }

      .nav-item.active {
        color: var(--accent);
        font-weight: bold;
      }

      .nav-icon {
        display: block;
        font-size: 1.8em;
        margin-bottom: 2px;
      }

      .page {
        display: none;
        animation: fadeIn 0.3s;
        position: relative;
        z-index: 1;
      }

      .page.active {
        display: block;
      }

      /* ===== TALENT TAGS ===== */
      .talent-tag {
        display: inline-block;
        background: linear-gradient(135deg, var(--gold), #ffa000);
        color: black;
        padding: 3px 8px;
        border-radius: 5px;
        font-size: 0.75em;
        margin-right: 5px;
        margin-top: 3px;
        font-weight: bold;
        box-shadow: 0 2px 5px rgba(255, 215, 0, 0.3);
        pointer-events: none;
      }

      .talent-bad {
        background: linear-gradient(135deg, var(--red), #c62828);
        color: white;
      }

      /* ===== LOG BOX ===== */
      .log-box {
        height: 150px;
        overflow-y: auto;
        background: rgba(0, 0, 0, 0.4);
        padding: 10px;
        border-radius: 8px;
        font-size: 0.85em;
        color: #ddd;
        border: 1px solid rgba(255, 255, 255, 0.1);
        line-height: 1.6;
      }

      .log-box::-webkit-scrollbar {
        width: 6px;
      }

      .log-box::-webkit-scrollbar-track {
        background: #222;
      }

      .log-box::-webkit-scrollbar-thumb {
        background: var(--accent);
        border-radius: 3px;
      }

      /* ===== JOB/ITEM CARD ===== */
      .job-card {
        background: rgba(255, 255, 255, 0.08);
        padding: 12px;
        border-radius: 10px;
        margin-bottom: 10px;
        border: 1px solid rgba(255, 255, 255, 0.15);
        cursor: pointer;
        transition: all 0.3s;
        position: relative;
        z-index: 5;
        pointer-events: auto;
      }

      .job-card:hover {
        background: rgba(255, 255, 255, 0.12);
        transform: translateX(5px);
      }

      .job-card:active {
        transform: translateX(3px);
      }

      .job-name {
        font-weight: bold;
        color: var(--blue);
        font-size: 1.1em;
      }

      .job-salary {
        color: var(--green);
        font-size: 0.9em;
      }

      .job-requirement {
        color: var(--text-dim);
        font-size: 0.8em;
        margin-top: 3px;
      }

      /* ===== ANIMATIONS ===== */
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes slideIn {
        from {
          transform: translateY(-20px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      @keyframes slideUp {
        from {
          transform: translateY(50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .section-title {
        font-size: 1.2em;
        color: var(--gold);
        margin: 20px 10px 10px;
        text-align: left;
        font-weight: bold;
      }

      /* éŠæˆ²å ´æ™¯é è¨­éš±è— */
      #scene-game {
        display: none !important; /* âœ… åŠ ä¸Š !important å¼·åˆ¶å„ªå…ˆ */
      }

      /* éŠæˆ²é–‹å§‹å¾Œæ‰é¡¯ç¤º */
      #scene-game.active {
        display: block !important;
      }

      /* ç¢ºä¿æ‰€æœ‰å¯äº’å‹•å…ƒç´ éƒ½åœ¨æ­£ç¢ºå±¤ç´š */
      input,
      select,
      button,
      .origin-card,
      .job-card,
      .nav-item {
        -webkit-tap-highlight-color: rgba(187, 134, 252, 0.3);
        touch-action: manipulation;
      }
      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.02);
        }
      }
      @keyframes popIn {
        0% {
          transform: translate(-50%, -50%) scale(0.5);
          opacity: 0;
        }
        50% {
          transform: translate(-50%, -50%) scale(1.05);
        }
        100% {
          transform: translate(-50%, -50%) scale(1);
          opacity: 1;
        }
      }

      @keyframes fadeOut {
        to {
          opacity: 0;
          transform: translate(-50%, -60%) scale(0.9);
        }
      }
      /* ===== ğŸ“± å“åº”å¼å¸ƒå±€ ===== */

      /* å®¹å™¨åŒ…è£… */
      #scene-creation,
      #scene-game {
        max-width: 100%;
        width: 100%;
        margin: 0 auto;
      }

      /* === æ¡Œé¢ç«¯ (å¤§äº 1024px) === */
      @media (min-width: 1025px) {
        body {
          max-width: 800px;
        }

        .header {
          padding: 20px;
        }

        .card {
          margin: 20px 15px;
        }

        .btn-grid {
          grid-template-columns: repeat(3, 1fr);
          gap: 15px;
        }

        .stat-grid {
          grid-template-columns: repeat(4, 1fr);
        }

        .origin-card {
          padding: 20px;
        }

        .modal-box {
          max-width: 600px;
        }
      }

      /* === å¹³æ¿ç«¯ (768px - 1024px) === */
      @media (min-width: 768px) and (max-width: 1024px) {
        body {
          max-width: 100%;
          padding: 0 20px 80px 20px;
        }

        .header {
          padding: 15px 20px;
        }

        .card {
          margin: 15px 0;
        }

        .btn-grid {
          grid-template-columns: repeat(3, 1fr);
          gap: 12px;
        }

        .stat-grid {
          grid-template-columns: repeat(3, 1fr);
        }

        button {
          font-size: 1em;
          padding: 14px;
        }

        .nav-bar {
          padding: 10px 0;
        }

        .nav-item {
          font-size: 0.8em;
        }

        .nav-icon {
          font-size: 2em;
        }
      }

      /* === æ‰‹æœºç«¯ (å°äº 768px) === */
      @media (max-width: 767px) {
        body {
          max-width: 100%;
          padding: 0 10px 80px 10px;
        }

        .header {
          padding: 12px 10px;
        }

        .player-avatar {
          width: 45px;
          height: 45px;
          font-size: 1.3em;
        }

        .player-name-line {
          font-size: 1em;
        }

        .player-subtitle {
          font-size: 0.75em;
        }

        .big-stat {
          font-size: 1.3em;
        }

        .stat-grid {
          grid-template-columns: repeat(3, 1fr);
          gap: 6px;
          font-size: 0.8em;
        }

        .stat-item {
          padding: 6px;
        }

        .card {
          margin: 12px 0;
          border-radius: 12px;
        }

        .card-header {
          padding: 12px;
        }

        .card-body {
          padding: 12px;
        }

        .card-title {
          font-size: 1em;
        }

        .btn-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 8px;
        }

        button {
          padding: 10px;
          font-size: 0.85em;
          border-radius: 8px;
        }

        .btn-main {
          font-size: 1em;
          padding: 12px;
        }

        .cost-tag {
          font-size: 0.65em;
        }

        .talent-tag {
          font-size: 0.7em;
          padding: 2px 6px;
          margin-right: 4px;
        }

        .log-box {
          height: 120px;
          font-size: 0.8em;
          padding: 8px;
        }

        .nav-bar {
          padding: 6px 0;
        }

        .nav-item {
          font-size: 0.7em;
          padding: 4px;
        }

        .nav-icon {
          font-size: 1.6em;
          margin-bottom: 1px;
        }

        /* æŠ€èƒ½æ¡ */
        .skills-container {
          padding: 8px;
        }

        .skill-header {
          font-size: 0.75em;
        }

        /* çŠ¶æ€è­¦å‘Š */
        .status-alert {
          padding: 6px;
          font-size: 0.75em;
        }

        /* åˆ›è§’ç”»é¢ */
        #scene-creation {
          padding: 15px 10px;
        }

        .creation-title {
          font-size: 1.6em;
          margin-bottom: 15px;
        }

        .origin-card {
          padding: 12px;
          margin-bottom: 10px;
        }

        .origin-name {
          font-size: 1em;
        }

        .origin-desc {
          font-size: 0.85em;
        }

        .origin-stats {
          font-size: 0.8em;
        }

        .input-group input,
        .input-group select {
          padding: 10px;
          font-size: 0.95em;
        }

        /* å¼¹çª— */
        .modal-box {
          width: 95%;
          padding: 20px;
        }

        .modal-title {
          font-size: 1.3em;
        }

        .modal-desc {
          font-size: 0.9em;
        }

        .modal-btn {
          padding: 12px;
          font-size: 0.9em;
        }

        /* èŒä¸šå¡ç‰‡ */
        .job-card {
          padding: 10px;
          margin-bottom: 8px;
        }

        .job-name {
          font-size: 1em;
        }

        .job-salary {
          font-size: 0.85em;
        }

        .job-requirement {
          font-size: 0.75em;
        }

        /* æ•°å€¼å˜åŒ–æç¤º */
        .change-popup {
          min-width: 200px;
          padding: 20px 25px;
        }
      }

      /* === æå°å±å¹• (å°äº 375px) === */
      @media (max-width: 374px) {
        .player-name-line {
          font-size: 0.9em;
        }

        .stat-grid {
          font-size: 0.75em;
        }

        .btn-grid {
          gap: 6px;
        }

        button {
          padding: 8px;
          font-size: 0.8em;
        }

        .nav-item {
          font-size: 0.65em;
        }

        .nav-icon {
          font-size: 1.4em;
        }

        .card {
          margin: 10px 0;
        }

        .talent-tag {
          font-size: 0.65em;
          padding: 2px 5px;
        }
      }

      /* === æ¨ªå±æ¨¡å¼ä¼˜åŒ– === */
      @media (max-height: 600px) and (orientation: landscape) {
        .header {
          position: sticky;
          top: 0;
          z-index: 100;
        }

        .log-box {
          height: 100px;
        }

        .modal-box {
          max-height: 90vh;
          overflow-y: auto;
        }

        .card {
          margin: 10px 0;
        }
      }

      /* === è§¦æ§ä¼˜åŒ– === */
      @media (hover: none) and (pointer: coarse) {
        button {
          min-height: 44px;
          min-width: 44px;
        }

        .nav-item {
          min-height: 48px;
        }

        .origin-card {
          min-height: 60px;
        }

        .job-card {
          min-height: 60px;
        }
      }

      /* === å¯¼èˆªæ å“åº”å¼ === */
      .nav-bar {
        left: 0;
        right: 0;
        margin: 0 auto;
      }

      @media (min-width: 768px) {
        .nav-bar {
          max-width: 100%;
        }
      }

      @media (min-width: 1025px) {
        .nav-bar {
          max-width: 800px;
        }
      }

      /* === å‡ºèº«é€‰æ‹©å“åº”å¼ === */
      @media (max-width: 767px) {
        /* å‡ºèº«é€‰æ‹©çš„å·¦å³ç®­å¤´ */
        button[onclick="prevOrigin()"],
        button[onclick="nextOrigin()"] {
          width: 45px !important;
          height: 45px !important;
          font-size: 1.5em !important;
          left: 5px !important;
        }

        button[onclick="nextOrigin()"] {
          right: 5px !important;
          left: auto !important;
        }

        /* å‡ºèº«å¡ç‰‡å†…è¾¹è· */
        div[style*="padding: 0 80px"] {
          padding: 0 55px !important;
        }
      }

      /* === ç‰¹è´¨é€‰æ‹©å“åº”å¼ === */
      @media (max-width: 767px) {
        #trait-options .origin-card {
          max-width: 100% !important;
          margin: 10px 0 !important;
        }
      }

      /* === èŒä¸šé€‰æ‹©å“åº”å¼ === */
      @media (max-width: 767px) {
        button[onclick="prevJob()"],
        button[onclick="nextJob()"] {
          width: 40px !important;
          height: 40px !important;
          font-size: 1.2em !important;
          left: -5px !important;
        }

        button[onclick="nextJob()"] {
          right: -5px !important;
          left: auto !important;
        }
      }

      /* === æ•°å€¼å˜åŒ–æç¤ºå“åº”å¼ === */
      @media (max-width: 767px) {
        div[style*="position: fixed"][style*="top: 20%"] {
          top: 15% !important;
          min-width: 220px !important;
          padding: 20px 25px !important;
        }
      }
    </style>
  </head>
  <body>
    <!-- å‰µè§’ç•«é¢ -->
    <div id="scene-creation">
      <h1 class="creation-title">ğŸ§¬ æŠ•èƒæ¨¡æ“¬å™¨ V17.0</h1>

      <div class="card">
        <div class="card-body">
          <div class="input-group">
            <label>âœï¸ å§“å</label>
            <input
              type="text"
              id="inp-name"
              placeholder="è¼¸å…¥å§“å"
              maxlength="8"
              value="æ¸¬è©¦ç©å®¶"
            />
          </div>
          <div class="input-group">
            <label>ğŸš» æ€§åˆ¥</label>
            <select id="inp-gender">
              <option value="ç”·">ğŸ‘¨ ç”·ç”Ÿ</option>
              <option value="å¥³">ğŸ‘© å¥³ç”Ÿ</option>
              <option value="å…¶ä»–">ğŸŒˆ å…¶ä»–</option>
            </select>
          </div>
        </div>
      </div>

      <h3 class="section-title">ğŸ² é¸æ“‡å‡ºèº«èƒŒæ™¯ (é»æ“Šå¡ç‰‡é¸æ“‡)</h3>
      <div id="origin-list"></div>

      <button class="btn-main" onclick="startGame()">ğŸš€ é–‹å§‹äººç”Ÿå†’éšª</button>
    </div>

    <!-- éŠæˆ²ä¸»ç•«é¢ -->
    <div id="scene-game">
      <div class="header">
        <div class="player-info">
          <div class="player-avatar" id="player-avatar">ğŸ‘¶</div>
          <div class="player-details">
            <div class="player-name-line">
              <span id="player-name">???</span>
              <span style="font-size: 0.8em; color: var(--text-dim)">
                <span id="age-display">0</span>æ­²</span
              >
            </div>
            <div class="player-subtitle">
              <span id="player-origin"></span> | <span id="player-job"></span>
            </div>
            <!-- å¤©è³¦é¡¯ç¤º -->
            <div id="talent-display" style="margin-top: 5px"></div>
            <!-- âœ… ç‰¹è³ªé¡¯ç¤º -->
            <div id="trait-display" style="margin-top: 5px"></div>
          </div>
        </div>

        <div class="big-stat" id="money-display">$0</div>

        <div class="stat-grid">
          <div class="stat-item">
            <span>â¤ï¸ å¥åº·</span>
            <span class="stat-value" id="health">100</span>
          </div>
          <div class="stat-item">
            <span>ğŸ˜Š å¿«æ¨‚</span>
            <span class="stat-value" id="happy">80</span>
          </div>
          <div class="stat-item">
            <span>ğŸ§  æ™ºåŠ›</span>
            <span class="stat-value" id="intel">50</span>
          </div>
        </div>

        <div class="skills-container" id="skills-container"></div>

        <div class="stamina-container">
          <div class="stamina-label">
            <span>âš¡ é«”åŠ›</span>
            <span id="stamina-text">100/100</span>
          </div>
          <div class="progress-bg">
            <div id="stamina-bar" class="progress-fill"></div>
          </div>
        </div>

        <div class="status-alerts" id="status-alerts"></div>
      </div>

      <!-- é¦–é ï¼šç”Ÿæ´» -->
      <div id="page-home" class="page active">
        <div class="card">
          <div class="card-header">
            <span class="card-title"
              >ğŸ“… äººç”Ÿéšæ®µï¼š<span id="life-stage">å¬°å…’æœŸ</span></span
            >
          </div>
          <div class="card-body">
            <div class="btn-grid" id="action-buttons">
              <!-- å‹•æ…‹ç”Ÿæˆ -->
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ“œ äººç”Ÿå‹•æ…‹</span>
          </div>
          <div class="card-body">
            <div id="game-log" class="log-box"></div>
            <button class="btn-main" onclick="nextYear()">
              ğŸ‚ ä¸‹ä¸€æ­² (é«”åŠ›å›æ»¿)
            </button>
          </div>
        </div>
      </div>

      <!-- è·æ¥­é  -->
      <div id="page-career" class="page">
        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ’¼ è·æ¥­é¸æ“‡</span>
          </div>
          <div class="card-body">
            <div
              style="
                color: var(--text-dim);
                margin-bottom: 15px;
                font-size: 0.9em;
              "
            >
              ğŸ’¡ é¸æ“‡è·æ¥­å¾Œæ¯å¹´è‡ªå‹•ç²å¾—è–ªæ°´ï¼Œä¸åŒè·æ¥­æœ‰ä¸åŒç‰¹æ®Šæ•ˆæœ
            </div>
            <div id="job-list"></div>
          </div>
        </div>
      </div>

      <!-- è³‡ç”¢é  -->
      <div id="page-assets" class="page">
        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸï¸ è»Šåº«</span>
          </div>
          <div class="card-body" id="car-shop"></div>
        </div>
        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ˜ï¸ æˆ¿ç”¢</span>
          </div>
          <div class="card-body" id="house-shop"></div>
        </div>
        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ’ å¥¢ä¾ˆå“</span>
          </div>
          <div class="card-body" id="luxury-shop"></div>
        </div>
      </div>

      <!-- ç¤¾äº¤é  -->
      <div id="page-social" class="page">
        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ’– äººéš›é—œä¿‚</span>
          </div>
          <div class="card-body">
            <div id="npc-list"></div>
            <div id="find-partner-area" style="margin-top: 15px; display: none">
              <button class="btn-main" onclick="findPartner()">
                ğŸ“± ä½¿ç”¨äº¤å‹è»Ÿé«” ($500)
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- æˆå°±é  -->
      <div id="page-profile" class="page">
        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ† æˆå°±ç³»çµ±</span>
          </div>
          <div class="card-body">
            <div id="achievement-list"></div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ“Š äººç”Ÿçµ±è¨ˆ</span>
          </div>
          <div class="card-body" id="stats-panel">
            <!-- å‹•æ…‹ç”Ÿæˆ -->
          </div>
        </div>

        <div class="card">
          <div class="card-body">
            <button class="btn-main" onclick="restartGame()">
              ğŸ”„ é‡æ–°é–‹å§‹äººç”Ÿ
            </button>
          </div>
        </div>
      </div>

      <!-- åº•éƒ¨å°èˆª -->
      <div class="nav-bar">
        <div class="nav-item active" onclick="nav('home', event)">
          <span class="nav-icon">ğŸ </span>
          ç”Ÿæ´»
        </div>
        <div class="nav-item" onclick="nav('career', event)">
          <span class="nav-icon">ğŸ’¼</span>
          è·æ¥­
        </div>
        <div class="nav-item" onclick="nav('assets', event)">
          <span class="nav-icon">ğŸï¸</span>
          è³‡ç”¢
        </div>
        <div class="nav-item" onclick="nav('social', event)">
          <span class="nav-icon">ğŸ’–</span>
          ç¤¾äº¤
        </div>
        <div class="nav-item" onclick="nav('profile', event)">
          <span class="nav-icon">ğŸ†</span>
          æˆå°±
        </div>
      </div>
    </div>

    <!-- äº‹ä»¶å½ˆçª— -->
    <div
      id="event-modal"
      class="modal-overlay"
      onclick="if (event.target === this) closeModal();"
    >
      <div class="modal-box">
        <div class="modal-title" id="ev-title"></div>
        <div class="modal-desc" id="ev-desc"></div>
        <button class="modal-btn" id="btn-choice-a">A</button>
        <button class="modal-btn" id="btn-choice-b">B</button>
      </div>
    </div>

    <script>
      // ==========================================
      // ğŸ”´ è³‡æ–™å®šç¾©
      // ==========================================

      const TALENTS = [
        {
          id: "t1",
          name: "éç›®ä¸å¿˜",
          desc: "å­¸ç¿’æ•ˆç‡+50%",
          type: "good",
          effect: (g) => {
            g.learnBonus = 1.5;
          },
        },
        {
          id: "t2",
          name: "å¤©ç”Ÿç¥åŠ›",
          desc: "å¥åº·è¡°é€€æ¸›åŠ",
          type: "good",
          effect: (g) => {
            g.healthDecay = 0.5;
          },
        },
        {
          id: "t3",
          name: "è¬äººè¿·",
          desc: "é­…åŠ›+20ï¼Œç¤¾äº¤æ•ˆæœ+30%",
          type: "good",
          effect: (g) => {
            g.skills.charm += 20;
            g.socialBonus = 1.3;
          },
        },
        {
          id: "t4",
          name: "æŠ•è³‡çœ¼å…‰",
          desc: "è¢«å‹•æ”¶å…¥+20%",
          type: "good",
          effect: (g) => {
            g.incomeBonus = 1.2;
          },
        },
        {
          id: "t5",
          name: "ç»ç’ƒå¿ƒ",
          desc: "å¿«æ¨‚å€¼ä¸‹é™åŠ å€",
          type: "bad",
          effect: (g) => {
            g.happyDecay = 2;
          },
        },
        {
          id: "t6",
          name: "é«”å¼±å¤šç—…",
          desc: "åˆå§‹å¥åº·-20",
          type: "bad",
          effect: (g) => {
            g.health -= 20;
          },
        },
        {
          id: "t7",
          name: "ç¤¾äº¤ææ‡¼",
          desc: "é­…åŠ›-15",
          type: "bad",
          effect: (g) => {
            g.skills.charm -= 15;
          },
        },
        {
          id: "t8",
          name: "å¯ŒäºŒä»£å¿ƒæ…‹",
          desc: "å·¥ä½œæ”¶å…¥-30%",
          type: "bad",
          effect: (g) => {
            g.workPenalty = 0.7;
          },
        },
        {
          id: "t9",
          name: "å¤©è³¦ç•°ç¨Ÿ",
          desc: "æ‰€æœ‰æŠ€èƒ½æˆé•·+20%",
          type: "good",
          effect: (g) => {
            g.skillBonus = 1.2;
          },
        },
        {
          id: "t10",
          name: "å¹¸é‹æ˜Ÿ",
          desc: "éš¨æ©Ÿäº‹ä»¶æ­£é¢çµæœ+10%",
          type: "good",
          effect: (g) => {
            g.luckBonus = 0.1;
          },
        },
      ];
      // ===== å€‹äººç‰¹è³ªç³»çµ± =====
      const TRAITS = [
        // === æ€§æ ¼é¡ç‰¹è³ª ===
        {
          id: "optimistic",
          name: "ğŸŒŸ æ¨‚è§€ä¸»ç¾©è€…",
          desc: "ç¸½æ˜¯çœ‹åˆ°äº‹æƒ…å…‰æ˜çš„ä¸€é¢",
          category: "personality",
          effect: (g) => {
            g.happyDecay *= 0.7;
            g.happy += 10;
          },
          unlock: "default",
        },
        {
          id: "pessimistic",
          name: "ğŸŒ§ï¸ æ‚²è§€ä¸»ç¾©è€…",
          desc: "å®¹æ˜“é™·å…¥è² é¢æƒ…ç·’",
          category: "personality",
          effect: (g) => {
            g.happyDecay *= 1.3;
            g.intel += 5;
          },
          unlock: "default",
        },
        {
          id: "extrovert",
          name: "ğŸ‰ å¤–å‘",
          desc: "å–„æ–¼ç¤¾äº¤ï¼Œå®¹æ˜“äº¤æœ‹å‹",
          category: "personality",
          effect: (g) => {
            g.socialBonus *= 1.5;
            g.skills.charm += 10;
          },
          unlock: "default",
        },
        {
          id: "introvert",
          name: "ğŸ“š å…§å‘",
          desc: "å–œæ­¡ç¨è™•ï¼Œå°ˆæ³¨å­¸ç¿’",
          category: "personality",
          effect: (g) => {
            g.learnBonus *= 1.3;
            g.skills.communication -= 5;
          },
          unlock: "default",
        },
        {
          id: "brave",
          name: "ğŸ¦ å‹‡æ•¢",
          desc: "é¢å°æŒ‘æˆ°ä¸ç•æ‡¼",
          category: "personality",
          effect: (g) => {
            g.health += 10;
            g.skills.charm += 5;
          },
          unlock: "default",
        },
        {
          id: "cautious",
          name: "ğŸ›¡ï¸ è¬¹æ…",
          desc: "å°å¿ƒè¡Œäº‹ï¼Œé™ä½é¢¨éšª",
          category: "personality",
          effect: (g) => {
            g.healthDecay *= 0.8;
            g.happy -= 5;
          },
          unlock: "default",
        },

        // === èƒ½åŠ›é¡ç‰¹è³ª ===
        {
          id: "quick_learner",
          name: "ğŸ“– å­¸ç¿’å¤©æ‰",
          desc: "å­¸ç¿’é€Ÿåº¦æ¯”å¸¸äººå¿«",
          category: "ability",
          effect: (g) => {
            g.learnBonus *= 1.4;
          },
          unlock: "default",
        },
        {
          id: "athletic",
          name: "âš¡ é‹å‹•å¥å°‡",
          desc: "é«”åŠ›å……æ²›ï¼Œèº«é«”å¼·å£¯",
          category: "ability",
          effect: (g) => {
            g.health += 15;
            g.maxStamina = 120;
            g.stamina = 120;
          },
          unlock: "default",
        },
        {
          id: "artistic",
          name: "ğŸ¨ è—è¡“å¤©è³¦",
          desc: "å°è—è¡“æœ‰ç¨ç‰¹çš„æ•æ„Ÿåº¦",
          category: "ability",
          effect: (g) => {
            g.skills.art += 20;
            g.skillBonus *= 1.2;
          },
          unlock: "default",
        },
        {
          id: "charismatic",
          name: "ğŸ’« é­…åŠ›å››å°„",
          desc: "å¤©ç”Ÿå…·æœ‰å¸å¼•åŠ›",
          category: "ability",
          effect: (g) => {
            g.skills.charm += 15;
            g.socialBonus *= 1.3;
          },
          unlock: "default",
        },
        {
          id: "business_mind",
          name: "ğŸ’¼ å•†æ¥­é ­è…¦",
          desc: "æ“…é•·è³ºéŒ¢å’Œç†è²¡",
          category: "ability",
          effect: (g) => {
            g.incomeBonus *= 1.3;
            g.skills.finance += 15;
          },
          unlock: "default",
        },
        {
          id: "tech_savvy",
          name: "ğŸ’» ç§‘æŠ€é”äºº",
          desc: "å°ç§‘æŠ€ç”¢å“ç‰¹åˆ¥æ•éŠ³",
          category: "ability",
          effect: (g) => {
            g.skills.programming += 20;
            g.intel += 5;
          },
          unlock: "default",
        },

        // === ç‰¹æ®Šé¡ç‰¹è³ªï¼ˆéŠæˆ²ä¸­è§£é–ï¼‰ ===
        {
          id: "lucky",
          name: "ğŸ€ å¹¸é‹å…’",
          desc: "é‹æ°£ç¸½æ˜¯ç‰¹åˆ¥å¥½",
          category: "special",
          effect: (g) => {
            g.luckBonus += 0.2;
          },
          unlock: "event", // é€šééš¨æ©Ÿäº‹ä»¶ç²å¾—
        },
        {
          id: "workaholic",
          name: "ğŸ’ª å·¥ä½œç‹‚",
          desc: "å°å·¥ä½œå……æ»¿ç†±æƒ…",
          category: "special",
          effect: (g) => {
            g.incomeBonus *= 1.4;
            g.healthDecay *= 1.3;
          },
          unlock: "achievement", // å·¥ä½œ20å¹´è§£é–
        },
        {
          id: "immortal",
          name: "â³ é•·å£½åŸºå› ",
          desc: "è¡°è€é€Ÿåº¦è®Šæ…¢",
          category: "special",
          effect: (g) => {
            g.healthDecay *= 0.5;
          },
          unlock: "age", // æ´»åˆ°80æ­²è§£é–
        },
        {
          id: "genius_mind",
          name: "ğŸ§  è¶…ç´šå¤©æ‰",
          desc: "æ™ºåŠ›é è¶…å¸¸äºº",
          category: "special",
          effect: (g) => {
            g.intel += 30;
            g.learnBonus *= 1.5;
          },
          unlock: "achievement", // æ™ºåŠ›é”150è§£é–
        },
        {
          id: "social_master",
          name: "ğŸ­ ç¤¾äº¤é”äºº",
          desc: "äººéš›é—œä¿‚çš„å°ˆå®¶",
          category: "special",
          effect: (g) => {
            g.skills.communication += 30;
            g.skills.charm += 20;
          },
          unlock: "achievement", // æœ‰5å€‹æœ‹å‹è§£é–
        },
        {
          id: "wealthy",
          name: "ğŸ’° å¯Œè±ª",
          desc: "è²¡å¯Œè‡ªç”±ï¼Œé‡‘éŒ¢ä¸æ˜¯å•é¡Œ",
          category: "special",
          effect: (g) => {
            g.incomeBonus *= 2;
            g.happy += 20;
          },
          unlock: "achievement", // é”åˆ°1å„„è³‡ç”¢è§£é–
        },
      ];

      const ORIGINS = [
        {
          id: "common",
          name: "å¹³å‡¡å®¶åº­",
          desc: "çˆ¶æ¯éƒ½æ˜¯æ™®é€šä¸Šç­æ—ï¼Œç”Ÿæ´»å®‰ç©©å¹³å‡¡ï¼Œæ²’æœ‰å¤§èµ·å¤§è½ã€‚",
          parents: "çˆ¶:å…¬å‹™å“¡ / æ¯:æ•™å¸«",
          money: 50000,
          intel: 50,
          happy: 80,
          yearlyMoney: 1000,
          buff: "å¹³è¡¡ç™¼å±•ï¼Œç„¡ç‰¹æ®ŠåŠ æˆ",
        },
        {
          id: "rich",
          name: "å¯ŒäºŒä»£",
          desc: "å«è‘—é‡‘æ¹¯åŒ™å‡ºç”Ÿï¼Œå®¶æ—ä¼æ¥­é¾å¤§ï¼Œä¸æ„åƒç©¿ã€‚å¾å°åœ¨è±ªå®…é•·å¤§ã€‚",
          parents: "çˆ¶:é›†åœ˜è‘£äº‹é•· / æ¯:ç å¯¶è¨­è¨ˆå¸«",
          money: 5000000,
          intel: 40,
          happy: 90,
          yearlyMoney: 100000,
          buff: "ğŸ’° é–‹å±€500è¬ + å¹´é ˜10è¬é›¶ç”¨éŒ¢",
        },
        {
          id: "genius",
          name: "å¯’é–€å¤©æ‰",
          desc: "å®¶å¢ƒæ¸…å¯’ä½åœ¨è€èˆŠå…¬å¯“ï¼Œä½†å¤©ç”Ÿæ™ºå•†é©šäººï¼Œæ˜¯æ”¹è®Šå‘½é‹çš„å¸Œæœ›ã€‚",
          parents: "çˆ¶:å·¥åœ°å·¥äºº / æ¯:æ¸…æ½”å“¡",
          money: -50000,
          intel: 120,
          happy: 60,
          yearlyMoney: 0,
          buff: "ğŸ§  æ™ºåŠ›120ä½†è² å‚µ5è¬",
        },
        {
          id: "star",
          name: "æ¼”è—ä¸–å®¶",
          desc: "çˆ¶æ¯éƒ½æ˜¯å¨›æ¨‚åœˆå¤§å’–ï¼Œå¾å°åœ¨é‚å…‰ç‡ˆä¸‹é•·å¤§ï¼Œäººè„ˆéå¸ƒæ¼”è—åœˆã€‚",
          parents: "çˆ¶:å½±å¸ / æ¯:å¤©å",
          money: 1000000,
          intel: 50,
          happy: 70,
          yearlyMoney: 50000,
          buff: "âœ¨ é­…åŠ›çˆ†è¡¨ + æ¼”è—è³‡æº",
        },
        {
          id: "scholar",
          name: "æ›¸é¦™é–€ç¬¬",
          desc: "å®¶æ—ä¸‰ä»£éƒ½æ˜¯çŸ¥è­˜ä»½å­ï¼Œå®¶è£¡è—æ›¸è¬å·ï¼Œé‡è¦–æ•™è‚²å‹éä¸€åˆ‡ã€‚",
          parents: "çˆ¶:å¤§å­¸æ•™æˆ / æ¯:å¾‹å¸«",
          money: 200000,
          intel: 80,
          happy: 75,
          yearlyMoney: 5000,
          buff: "ğŸ“š é«˜å­¸ç¿’åŠ› + æ•™è‚²è³‡æºè±å¯Œ",
        },
        {
          id: "military",
          name: "è»äººä¸–å®¶",
          desc: "ç¥–çˆ¶æ˜¯é€€å½¹å°‡è»ï¼Œçˆ¶è¦ªç¾å½¹è»å®˜ï¼Œå®¶é¢¨ç´€å¾‹åš´æ˜ã€‚",
          parents: "çˆ¶:è»å®˜ / æ¯:è»é†«",
          money: 150000,
          intel: 60,
          happy: 70,
          yearlyMoney: 3000,
          buff: "ğŸ’ª åˆå§‹å¥åº·+20ï¼Œç´€å¾‹åš´æ ¼",
        },
        {
          id: "doctor",
          name: "é†«ç”Ÿä¸–å®¶",
          desc: "çˆ¶æ¯éƒ½æ˜¯é†«ç”Ÿï¼Œå¾å°åœ¨é†«é™¢é•·å¤§ï¼Œè€³æ¿¡ç›®æŸ“é†«å­¸çŸ¥è­˜ã€‚",
          parents: "çˆ¶:å¤–ç§‘ä¸»ä»» / æ¯:å©¦ç”¢ç§‘é†«å¸«",
          money: 800000,
          intel: 85,
          happy: 75,
          yearlyMoney: 10000,
          buff: "âš•ï¸ é†«ç™‚æŠ€èƒ½+30ï¼Œå¥åº·çŸ¥è­˜è±å¯Œ",
        },
        {
          id: "farmer",
          name: "è¾²å®¶å­å¼Ÿ",
          desc: "ä¸–ä»£å‹™è¾²ï¼Œå®¶è£¡æœ‰å¹¾ç”²è¾²åœ°ï¼Œéè‘—æ—¥å‡ºè€Œä½œæ—¥è½è€Œæ¯çš„ç”Ÿæ´»ã€‚",
          parents: "çˆ¶:è¾²å¤« / æ¯:æœè¾²",
          money: 20000,
          intel: 40,
          happy: 85,
          yearlyMoney: 500,
          buff: "ğŸŒ¾ å¥åº·+15ï¼Œå¿«æ¨‚+5ï¼Œç´”æ¨¸ç”Ÿæ´»",
        },
        {
          id: "fisher",
          name: "æ¼æ‘ä¸–å®¶",
          desc: "ç¥–å…ˆä¸–ä»£æ•é­šï¼Œç†Ÿæ‚‰æµ·æ´‹ï¼Œèˆ‡å¤§æµ·ç‚ºä¼ã€‚é¢±é¢¨æ˜¯æœ€å¤§çš„æ•µäººã€‚",
          parents: "çˆ¶:æ¼èˆ¹èˆ¹é•· / æ¯:é­šè²©",
          money: 30000,
          intel: 45,
          happy: 80,
          yearlyMoney: 1000,
          buff: "ğŸŸ å¥åº·+10ï¼Œè²¡å¯Œæ³¢å‹•å¤§",
        },
        {
          id: "aboriginal",
          name: "åŸä½æ°‘éƒ¨è½",
          desc: "åœ¨å±±ä¸Šéƒ¨è½é•·å¤§ï¼Œèƒ½æ­Œå–„èˆï¼Œèˆ‡å¤§è‡ªç„¶å…±ç”Ÿã€‚ä¿æœ‰å‚³çµ±æ–‡åŒ–ã€‚",
          parents: "çˆ¶:éƒ¨è½çµäºº / æ¯:ç·¨ç¹”å·¥è—å¸«",
          money: 10000,
          intel: 45,
          happy: 90,
          yearlyMoney: 500,
          buff: "ğŸµ é­…åŠ›+15ï¼Œè—è¡“+20ï¼Œå¿«æ¨‚+10",
        },
        {
          id: "immigrant",
          name: "æ–°ä½æ°‘å®¶åº­",
          desc: "æ¯è¦ªæ˜¯æ–°ç§»æ°‘ï¼Œæœƒèªªå¤šç¨®èªè¨€ï¼Œå®¶è£¡èåˆå…©åœ‹æ–‡åŒ–ã€‚",
          parents: "çˆ¶:å·¥å» ä½œæ¥­å“¡ / æ¯:è¶Šå—æ–°ä½æ°‘",
          money: 30000,
          intel: 55,
          happy: 75,
          yearlyMoney: 800,
          buff: "ğŸŒ æºé€š+20ï¼Œå¤šå…ƒæ–‡åŒ–è¦–é‡",
        },
        {
          id: "single_parent",
          name: "å–®è¦ªå®¶åº­",
          desc: "çˆ¶æ¯é›¢ç•°ï¼Œè·Ÿè‘—æ¯è¦ªè¾›è‹¦é•·å¤§ã€‚é›–ç„¶è¾›è‹¦ä½†æ¯æ„›æ»¿æ»¿ã€‚",
          parents: "æ¯:é¤å»³æœå‹™å“¡",
          money: -20000,
          intel: 55,
          happy: 65,
          yearlyMoney: 0,
          buff: "ğŸ’” è² å‚µä½†æ›´ç¨ç«‹å …å¼·",
        },
        {
          id: "tech",
          name: "ç§‘æŠ€æ–°è²´",
          desc: "çˆ¶æ¯éƒ½åœ¨ç«¹ç§‘å·¥ä½œï¼Œå¾å°æ¥è§¸æœ€æ–°ç§‘æŠ€ç”¢å“ï¼Œå®¶è£¡å…¨æ˜¯3Cã€‚",
          parents: "çˆ¶:å·¥ç¨‹å¸« / æ¯:PM",
          money: 500000,
          intel: 75,
          happy: 70,
          yearlyMoney: 15000,
          buff: "ğŸ’» ç¨‹å¼è¨­è¨ˆ+30ï¼Œç§‘æŠ€è³‡æºè±å¯Œ",
        },
        {
          id: "artist",
          name: "è—è¡“å®¶æ—",
          desc: "çˆ¶è¦ªæ˜¯ç•«å®¶ï¼Œæ¯è¦ªæ˜¯é‹¼ç´å®¶ï¼Œå®¶è£¡å……æ»¿è—è¡“æ°£æ¯ã€‚",
          parents: "çˆ¶:ç•«å®¶ / æ¯:é‹¼ç´å®¶",
          money: 80000,
          intel: 65,
          happy: 85,
          yearlyMoney: 2000,
          buff: "ğŸ¨ è—è¡“+40ï¼Œé­…åŠ›+10ï¼Œæ”¶å…¥ä¸ç©©",
        },
        {
          id: "politician",
          name: "æ”¿æ²»ä¸–å®¶",
          desc: "çˆ¶è¦ªæ˜¯ç«‹å§”ï¼Œçˆºçˆºæ˜¯å‰å¸‚é•·ï¼Œå®¶æ—åœ¨æ”¿å£‡æœ‰å½±éŸ¿åŠ›ã€‚",
          parents: "çˆ¶:ç«‹æ³•å§”å“¡ / æ¯:åŸºé‡‘æœƒåŸ·è¡Œé•·",
          money: 2000000,
          intel: 70,
          happy: 75,
          yearlyMoney: 30000,
          buff: "ğŸ›ï¸ æºé€š+25ï¼Œäººè„ˆå»£ï¼Œåˆå§‹è³‡é‡‘è±åš",
        },
        {
          id: "orphan",
          name: "å­¤å…’é™¢",
          desc: "å¾å°åœ¨å­¤å…’é™¢é•·å¤§ï¼Œæ²’æœ‰è¦ªäººï¼Œåªèƒ½é è‡ªå·±ã€‚æ›´æ‡‚å¾—çæƒœã€‚",
          parents: "ç„¡",
          money: 0,
          intel: 50,
          happy: 50,
          yearlyMoney: 0,
          buff: "ğŸ˜¢ ç„¡çˆ¶æ¯ä½†æ„å¿—åŠ›+30ï¼Œæ›´ç¨ç«‹",
        },
        {
          id: "temple",
          name: "å»Ÿå®‡ä¸–å®¶",
          desc: "å®¶æ—ä¸–ä»£ç®¡ç†åœ°æ–¹å¤§å»Ÿï¼Œå¾å°åƒèˆ‡å»Ÿæœƒæ´»å‹•ï¼Œç†Ÿæ‚‰æ°‘ä¿—æ–‡åŒ–ã€‚",
          parents: "çˆ¶:å»Ÿå®‡ä¸»å§” / æ¯:ä¹©ç«¥",
          money: 300000,
          intel: 50,
          happy: 80,
          yearlyMoney: 5000,
          buff: "ğŸ® æºé€š+15ï¼Œå¿«æ¨‚+5ï¼Œåœ°æ–¹äººè„ˆå»£",
        },
        {
          id: "mafia",
          name: "é»‘é“ä¸–å®¶",
          desc: "çˆ¶è¦ªæ˜¯è§’é ­ï¼Œå®¶æ—åœ¨åœ°æ–¹æœ‰å‹¢åŠ›ã€‚å¾å°åœ¨åˆ€å…‰åŠå½±ä¸­é•·å¤§ã€‚",
          parents: "çˆ¶:è§’é ­è€å¤§ / æ¯:é…’åº—ç¶“ç†",
          money: 500000,
          intel: 45,
          happy: 60,
          yearlyMoney: 20000,
          buff: "ğŸ—¡ï¸ é­…åŠ›+20ï¼Œå¥åº·+15ï¼Œä½†é¢¨éšªé«˜",
        },

        {
          id: "royal",
          name: "çš‡å®¤è²´æ—",
          desc: "é™é åœ‹åº¦çš„çš‡å®¤å¾Œè£”ï¼Œæµè½æ°‘é–“ä½†è¡€çµ±é«˜è²´ã€‚å¾å°å—è²´æ—ç¦®å„€æ•™è‚²ã€‚",
          parents: "çˆ¶:æµäº¡ç‹å­ / æ¯:ä¼¯çˆµåƒé‡‘",
          money: 10000000,
          intel: 70,
          happy: 60,
          yearlyMoney: 200000,
          buff: "ğŸ‘‘ åˆå§‹1000è¬ + è¶…é«˜é­…åŠ› + ç¤¾äº¤åœˆç‰¹æ®Š",
          special: "royal", // ç‰¹æ®Šæ¨™è¨˜
        },
        {
          id: "hacker",
          name: "é§­å®¢ä¸–å®¶",
          desc: "çˆ¶æ¯éƒ½æ˜¯é ‚å°–è³‡å®‰å°ˆå®¶ï¼Œå®¶è£¡ä¸‰å°ä¼ºæœå™¨24å°æ™‚é‹è½‰ã€‚å¾å°æ¥è§¸æš—ç¶²ã€‚",
          parents: "çˆ¶:ç™½å¸½é§­å®¢ / æ¯:è³‡å®‰å°ˆå®¶",
          money: 300000,
          intel: 100,
          happy: 65,
          yearlyMoney: 8000,
          buff: "ğŸ’» ç¨‹å¼è¨­è¨ˆ+50 + é§­å®¢æŠ€èƒ½è§£é–",
          special: "hacker",
        },
        {
          id: "detective",
          name: "åµæ¢ä¸–å®¶",
          desc: "ç¥–çˆ¶æ˜¯ååµæ¢ï¼Œçˆ¶è¦ªæ˜¯åˆ‘è­¦ï¼Œå¾å°è€³æ¿¡ç›®æŸ“ç ´æ¡ˆæŠ€å·§èˆ‡æ¨ç†èƒ½åŠ›ã€‚",
          parents: "çˆ¶:åˆ‘è­¦ / æ¯:æ³•é†«",
          money: 180000,
          intel: 90,
          happy: 70,
          yearlyMoney: 4000,
          buff: "ğŸ” æ™ºåŠ›+40 + è§€å¯ŸåŠ›è¶…ç¾¤",
          special: "detective",
        },
        {
          id: "chef_family",
          name: "ç±³å…¶æ—ä¸–å®¶",
          desc: "å®¶æ—ç¶“ç‡Ÿç±³å…¶æ—ä¸‰æ˜Ÿé¤å»³ï¼Œå¾å°åœ¨å»šæˆ¿é•·å¤§ï¼Œå°ç¾é£Ÿæœ‰æ¥µè‡´è¿½æ±‚ã€‚",
          parents: "çˆ¶:ä¸»å»š / æ¯:ç”œé»å¸«",
          money: 500000,
          intel: 60,
          happy: 85,
          yearlyMoney: 12000,
          buff: "ğŸ³ çƒ¹é£ª+60 + è—è¡“+20 + é¤é£²äººè„ˆ",
          special: "chef",
        },
        {
          id: "monk",
          name: "å¯ºå»Ÿä¿®è¡Œ",
          desc: "åœ¨æ·±å±±å¤å¯ºé•·å¤§ï¼Œè‡ªå¹¼è·Ÿéš¨å¸«çˆ¶ä¿®è¡Œï¼Œé é›¢ç´…å¡µå–§å›‚ã€‚",
          parents: "å¸«çˆ¶:ä½æŒ",
          money: 5000,
          intel: 75,
          happy: 90,
          yearlyMoney: 0,
          buff: "ğŸ™ å¥åº·+25 + å¿«æ¨‚+10 + å¿ƒå¢ƒå¹³å’Œ",
          special: "monk",
        },
        {
          id: "circus",
          name: "é¦¬æˆ²åœ˜å®¶æ—",
          desc: "çˆ¶æ¯éƒ½æ˜¯é¦¬æˆ²åœ˜è¡¨æ¼”è€…ï¼Œå¾å°å­¸ç¿’é›œæŠ€èˆ‡è¡¨æ¼”ï¼Œå››è™•å·¡è¿´æ¼”å‡ºã€‚",
          parents: "çˆ¶:ç©ºä¸­é£›äºº / æ¯:é­”è¡“å¸«",
          money: 50000,
          intel: 50,
          happy: 80,
          yearlyMoney: 2000,
          buff: "ğŸª é­…åŠ›+25 + å¥åº·+10 + è¡¨æ¼”æŠ€å·§",
          special: "circus",
        },
        {
          id: "diplomat",
          name: "å¤–äº¤å®˜å®¶åº­",
          desc: "çˆ¶è¦ªæ˜¯é§å¤–å¤§ä½¿ï¼Œå¾å°åœ¨å„åœ‹ä½¿é¤¨é•·å¤§ï¼Œç²¾é€šå¤šåœ‹èªè¨€ã€‚",
          parents: "çˆ¶:å¤–äº¤å®˜ / æ¯:ç¿»è­¯å®˜",
          money: 1200000,
          intel: 85,
          happy: 75,
          yearlyMoney: 25000,
          buff: "ğŸŒ æºé€š+35 + åœ‹éš›è¦–é‡ + èªè¨€å¤©è³¦",
          special: "diplomat",
        },
        {
          id: "esports",
          name: "é›»ç«¶ä¸–å®¶",
          desc: "çˆ¶æ¯éƒ½æ˜¯é€€å½¹é›»ç«¶é¸æ‰‹ï¼Œç¾ç¶“ç‡Ÿé›»ç«¶æˆ°éšŠã€‚å®¶è£¡å°±æ˜¯è¨“ç·´åŸºåœ°ã€‚",
          parents: "çˆ¶:å‰ä¸–ç•Œå† è» / æ¯:æˆ°éšŠæ•™ç·´",
          money: 600000,
          intel: 65,
          happy: 85,
          yearlyMoney: 15000,
          buff: "ğŸ® åæ‡‰åŠ›è¶…ç¾¤ + éŠæˆ²ç”¢æ¥­äººè„ˆ",
          special: "esports",
        },
        {
          id: "spy",
          name: "æƒ…å ±å“¡å¾Œä»£",
          desc: "çˆ¶è¦ªçš„çœŸå¯¦èº«ä»½æ˜¯ç‰¹å‹™ï¼Œæ¯è¦ªæ˜¯å¯†ç¢¼å°ˆå®¶ã€‚å®¶æ—æ­·å²å……æ»¿è¬åœ˜ã€‚",
          parents: "çˆ¶:æƒ…å ±å“¡ / æ¯:å¯†ç¢¼å°ˆå®¶",
          money: 800000,
          intel: 95,
          happy: 60,
          yearlyMoney: 20000,
          buff: "ğŸ•µï¸ æ™ºåŠ›+45 + éš±å¯†æŠ€èƒ½ + å±éšªæ„ŸçŸ¥",
          special: "spy",
        },
        {
          id: "archaeologist",
          name: "è€ƒå¤å­¸å®¶æ—",
          desc: "çˆ¶æ¯éƒ½æ˜¯è€ƒå¤å­¸å®¶ï¼Œå¾å°è·Ÿè‘—å»ä¸–ç•Œå„åœ°æŒ–æ˜å¤æ–‡æ˜éºè·¡ã€‚",
          parents: "çˆ¶:è€ƒå¤æ•™æˆ / æ¯:åšç‰©é¤¨é¤¨é•·",
          money: 250000,
          intel: 88,
          happy: 78,
          yearlyMoney: 6000,
          buff: "ğŸº æ™ºåŠ›+38 + æ­·å²çŸ¥è­˜è±å¯Œ",
          special: "archaeologist",
        },
        {
          id: "fashion",
          name: "æ™‚å°šåé–€",
          desc: "å®¶æ—ç¶“ç‡Ÿç²¾å“æ™‚å°šå“ç‰Œï¼Œå¾å°åƒåŠ æ™‚è£é€±ï¼Œèµ°åœ¨æ½®æµå°–ç«¯ã€‚",
          parents: "çˆ¶:æ™‚å°šè¨­è¨ˆå¸« / æ¯:åæ¨¡",
          money: 3000000,
          intel: 60,
          happy: 80,
          yearlyMoney: 50000,
          buff: "ğŸ‘— é­…åŠ›+35 + è—è¡“+25 + æ™‚å°šåœˆäººè„ˆ",
          special: "fashion",
        },
        {
          id: "scientist_family",
          name: "è«¾è²çˆ¾ä¸–å®¶",
          desc: "ç¥–çˆ¶æ˜¯è«¾è²çˆ¾çå¾—ä¸»ï¼Œçˆ¶æ¯éƒ½æ˜¯é ‚å°–ç§‘å­¸å®¶ï¼Œå®¶æ—åŸºå› å„ªç•°ã€‚",
          parents: "çˆ¶:ç‰©ç†å­¸å®¶ / æ¯:åŒ–å­¸å®¶",
          money: 1500000,
          intel: 130,
          happy: 70,
          yearlyMoney: 30000,
          buff: "ğŸ”¬ æ™ºåŠ›+80 + ç§‘ç ”è³‡æºç„¡é™",
          special: "scientist",
        },
      ];

      const JOBS = [
        {
          id: "none",
          name: "ç„¡æ¥­",
          salary: 0,
          requirement: {},
          effect: null,
          desc: "å¾…æ¥­ä¸­",
        },
        {
          id: "clerk",
          name: "ä¸€èˆ¬è·å“¡",
          salary: 35000,
          requirement: { intel: 40 },
          effect: (g) => {
            g.happy -= 2;
          },
          desc: "æœä¹æ™šäº”çš„è¾¦å…¬å®¤å·¥ä½œ",
        },
        {
          id: "engineer",
          name: "è»Ÿé«”å·¥ç¨‹å¸«",
          salary: 80000,
          requirement: { intel: 80, programming: 60 },
          effect: (g) => {
            g.skills.programming += 2;
            g.happy -= 5;
            g.health -= 3;
          },
          desc: "é«˜è–ªä½†å£“åŠ›å¤§ï¼Œå¸¸åŠ ç­",
        },
        {
          id: "doctor",
          name: "é†«ç”Ÿ",
          salary: 180000,
          requirement: { intel: 120, medical: 80 },
          effect: (g) => {
            g.health -= 5;
            g.skills.medical += 3;
          },
          desc: "æ•‘æ­»æ‰¶å‚·ï¼Œæ”¶å…¥è±åšä½†è¾›è‹¦",
        },
        {
          id: "artist",
          name: "è—è¡“å®¶",
          salary: 40000,
          requirement: { art: 70, charm: 60 },
          effect: (g) => {
            g.happy += 10;
            g.skills.art += 3;
          },
          desc: "æ”¶å…¥ä¸ç©©ä½†è¿½æ±‚å¤¢æƒ³",
        },
        {
          id: "teacher",
          name: "æ•™å¸«",
          salary: 55000,
          requirement: { intel: 70, communication: 60 },
          effect: (g) => {
            g.happy += 5;
            g.skills.communication += 2;
          },
          desc: "ç©©å®šä¸”æœ‰æ„ç¾©çš„å·¥ä½œ",
        },
        {
          id: "entrepreneur",
          name: "å‰µæ¥­å®¶",
          salary: 120000,
          requirement: { intel: 90, finance: 70, charm: 70 },
          effect: (g) => {
            const fluctuation = Math.floor(Math.random() * 150000 - 50000);
            g.money += fluctuation;
            g.happy -= 15;
            g.health -= 8;
            if (fluctuation > 0)
              log(`ğŸ’° äº‹æ¥­æœ‰æˆï¼Œé¡å¤–è³ºäº† $${fluctuation.toLocaleString()}`);
            else log(`ğŸ“‰ äº‹æ¥­è™§æ $${Math.abs(fluctuation).toLocaleString()}`);
          },
          desc: "é«˜é¢¨éšªé«˜å›å ±ï¼Œæ”¶å…¥æ³¢å‹•å¤§",
        },
        {
          id: "influencer",
          name: "ç¶²ç´…/ç›´æ’­ä¸»",
          salary: 90000,
          requirement: { charm: 90, communication: 70 },
          effect: (g) => {
            g.skills.charm += 2;
            g.happy += 8;
            g.money += Math.floor(Math.random() * 50000);
          },
          desc: "é ç²‰çµ²ç¶“æ¿Ÿè³ºéŒ¢ï¼Œæ”¶å…¥ä¸ç©©",
        },
        {
          id: "scientist",
          name: "ç ”ç©¶å“¡",
          salary: 95000,
          requirement: { intel: 110 },
          effect: (g) => {
            g.intel += 5;
            g.happy += 3;
          },
          desc: "æ¢ç´¢æœªçŸ¥çš„é‚Šç•Œ",
        },
        {
          id: "lawyer",
          name: "å¾‹å¸«",
          salary: 150000,
          requirement: { intel: 100, communication: 80 },
          effect: (g) => {
            g.skills.communication += 3;
            g.happy -= 8;
          },
          desc: "é«˜æ”¶å…¥ä½†å·¥ä½œå£“åŠ›å¤§",
        },
        {
          id: "chef",
          name: "ä¸»å»š",
          salary: 60000,
          requirement: { cooking: 80, art: 40 },
          effect: (g) => {
            g.skills.cooking += 3;
            g.happy += 5;
          },
          desc: "ç”¨ç¾é£Ÿç™‚ç™’äººå¿ƒ",
        },
        {
          id: "pilot",
          name: "æ©Ÿå¸«",
          salary: 200000,
          requirement: { intel: 90, health: 80 },
          effect: (g) => {
            g.health -= 5;
            g.happy += 3;
          },
          desc: "ç¿±ç¿”å¤©éš›ï¼Œé«˜è–ªä½†é«”åŠ›æ¶ˆè€—å¤§",
        },
        {
          id: "athlete",
          name: "è·æ¥­é‹å‹•å“¡",
          salary: 100000,
          requirement: { health: 90, charm: 60 },
          effect: (g) => {
            g.health += 3;
            if (g.age > 35) {
              g.happy -= 10;
              log("âš ï¸ å¹´ç´€æ¼¸é•·ï¼Œè·æ¥­ç”Ÿæ¶¯æ¥è¿‘å°¾è²");
            }
          },
          desc: "åƒé’æ˜¥é£¯ï¼Œ35æ­²å¾Œæ€¥é½è¡°é€€",
        },
        {
          id: "police",
          name: "è­¦å¯Ÿ",
          salary: 65000,
          requirement: { health: 70, communication: 50 },
          effect: (g) => {
            g.health -= 3;
            g.happy -= 5;
          },
          desc: "ç¶­è­·ç¤¾æœƒæ²»å®‰ï¼Œä½†æœ‰è·æ¥­é¢¨éšª",
        },
        {
          id: "designer",
          name: "è¨­è¨ˆå¸«",
          salary: 70000,
          requirement: { art: 80, programming: 40 },
          effect: (g) => {
            g.skills.art += 3;
            g.happy += 3;
          },
          desc: "ç™¼æ®å‰µæ„ï¼Œå·¥ä½œè‡ªç”±åº¦é«˜",
        },
        {
          id: "hacker_pro",
          name: "è·æ¥­é§­å®¢",
          salary: 250000,
          requirement: { intel: 100, programming: 100 },
          originRequired: "hacker", // åªæœ‰é§­å®¢ä¸–å®¶èƒ½é¸
          effect: (g) => {
            g.skills.programming += 5;
            g.money += Math.floor(Math.random() * 500000);
          },
          desc: "æš—ç¶²æ¥æ¡ˆï¼Œæ”¶å…¥æ¥µé«˜ä½†æœ‰é¢¨éšª",
        },

        {
          id: "royal_advisor",
          name: "çš‡å®¤é¡§å•",
          salary: 300000,
          requirement: { intel: 110, communication: 90 },
          originRequired: "royal",
          effect: (g) => {
            g.skills.charm += 3;
            g.happy += 10;
          },
          desc: "ç‚ºçš‡å®¤æä¾›è«®è©¢æœå‹™",
        },

        {
          id: "esports_player",
          name: "é›»ç«¶é¸æ‰‹",
          salary: 150000,
          requirement: { intel: 70 },
          originRequired: "esports",
          effect: (g) => {
            if (g.age > 28) {
              g.happy -= 15;
              log("âš ï¸ å¹´é½¡æ¼¸é•·ï¼Œç«¶æŠ€ç‹€æ…‹ä¸‹æ»‘");
            }
            g.happy += 15;
          },
          desc: "è·æ¥­é›»ç«¶ï¼Œ25æ­²å‰é»ƒé‡‘æœŸ",
        },

        {
          id: "spy_agent",
          name: "ç‰¹å‹™",
          salary: 200000,
          requirement: { intel: 100, health: 80 },
          originRequired: "spy",
          effect: (g) => {
            g.health -= 8;
            g.money += Math.floor(Math.random() * 300000);
          },
          desc: "åŸ·è¡Œå±éšªä»»å‹™ï¼Œé«˜é¢¨éšªé«˜å›å ±",
        },

        {
          id: "michelin_chef",
          name: "ç±³å…¶æ—ä¸»å»š",
          salary: 180000,
          requirement: { cooking: 100, art: 60 },
          originRequired: "chef_family",
          effect: (g) => {
            g.skills.cooking += 5;
            g.skills.art += 2;
            g.happy += 8;
          },
          desc: "ã€ç±³å…¶æ—ä¸–å®¶é™å®šã€‘é ‚ç´šæ–™ç†äºº",
        },
      ];

      const ACHIEVEMENTS = [
        {
          id: "first_job",
          name: "åˆå…¥è·å ´",
          desc: "ç²å¾—ç¬¬ä¸€ä»½å·¥ä½œ",
          icon: "ğŸ’¼",
          check: (g) => g.jobId !== "none",
        },
        {
          id: "millionaire",
          name: "ç™¾è¬å¯Œç¿",
          desc: "è³‡ç”¢é”åˆ°100è¬",
          icon: "ğŸ’°",
          check: (g) => g.money >= 1000000,
        },
        {
          id: "ten_million",
          name: "åƒè¬å¯Œè±ª",
          desc: "è³‡ç”¢é”åˆ°1000è¬",
          icon: "ğŸ’",
          check: (g) => g.money >= 10000000,
        },
        {
          id: "billionaire",
          name: "å„„è¬å¯Œç¿",
          desc: "è³‡ç”¢é”åˆ°1å„„",
          icon: "ğŸ†",
          check: (g) => g.money >= 100000000,
        },
        {
          id: "genius",
          name: "å¤©æ‰",
          desc: "æ™ºåŠ›é”åˆ°150",
          icon: "ğŸ§ ",
          check: (g) => g.intel >= 150,
        },
        {
          id: "charming",
          name: "è¬äººè¿·",
          desc: "é­…åŠ›é”åˆ°120",
          icon: "âœ¨",
          check: (g) => g.skills.charm >= 120,
        },
        {
          id: "healthy",
          name: "å¥åº·é”äºº",
          desc: "60æ­²æ™‚å¥åº·ä»>80",
          icon: "ğŸ’ª",
          check: (g) => g.age >= 60 && g.health > 80,
        },
        {
          id: "happy_life",
          name: "å¿«æ¨‚äººç”Ÿ",
          desc: "ä¿æŒå¿«æ¨‚å€¼>80é”30å¹´",
          icon: "ğŸ˜Š",
          check: (g) => g.happyYears >= 30,
        },
        {
          id: "social_master",
          name: "ç¤¾äº¤é”äºº",
          desc: "æ“æœ‰5å€‹ä»¥ä¸Šå¥½å‹",
          icon: "ğŸ‘¥",
          check: (g) =>
            g.relationships.filter((r) => r.type === "friend").length >= 5,
        },
        {
          id: "married",
          name: "åŸ·å­ä¹‹æ‰‹",
          desc: "æˆåŠŸçµå©š",
          icon: "ğŸ’",
          check: (g) => g.relationships.some((r) => r.id.startsWith("spouse")),
        },
        {
          id: "parent",
          name: "ç‚ºäººçˆ¶æ¯",
          desc: "æ“æœ‰å­å¥³",
          icon: "ğŸ‘¶",
          check: (g) => g.relationships.some((r) => r.type === "child"),
        },
        {
          id: "house_owner",
          name: "æœ‰æˆ¿ä¸€æ—",
          desc: "è³¼è²·ç¬¬ä¸€é–“æˆ¿ç”¢",
          icon: "ğŸ˜ï¸",
          check: (g) => g.inventory.some((i) => i.startsWith("house")),
        },
        {
          id: "car_owner",
          name: "æœ‰è»Šä¸€æ—",
          desc: "è³¼è²·ç¬¬ä¸€è¼›è»Š",
          icon: "ğŸï¸",
          check: (g) => g.inventory.some((i) => i.startsWith("car")),
        },
        {
          id: "skill_master",
          name: "å…¨èƒ½å¤©æ‰",
          desc: "æ‰€æœ‰æŠ€èƒ½é”åˆ°80",
          icon: "ğŸŒŸ",
          check: (g) => Object.values(g.skills).every((v) => v >= 80),
        },
        {
          id: "elder",
          name: "é•·å£½",
          desc: "æ´»åˆ°80æ­²",
          icon: "ğŸ‚",
          check: (g) => g.age >= 80,
        },
        {
          id: "centenarian",
          name: "äººç‘",
          desc: "æ´»åˆ°100æ­²",
          icon: "ğŸŠ",
          check: (g) => g.age >= 100,
        },
        {
          id: "perfect",
          name: "å®Œç¾äººç”Ÿ",
          desc: "60æ­²æ™‚å¥åº·/å¿«æ¨‚/é‡‘éŒ¢éƒ½>é«˜æ¨™",
          icon: "ğŸ‘‘",
          check: (g) =>
            g.age >= 60 && g.health > 80 && g.happy > 80 && g.money > 10000000,
        },
        {
          id: "workaholic",
          name: "å·¥ä½œç‹‚",
          desc: "åœ¨åŒä¸€è·ä½å·¥ä½œè¶…é20å¹´",
          icon: "ğŸ“Š",
          check: (g) => g.jobYears >= 20,
        },
        {
          id: "debt_free",
          name: "ç„¡å‚µä¸€èº«è¼•",
          desc: "å¾è² å‚µç‹€æ…‹ç¿»èº«åˆ°è³‡ç”¢100è¬",
          icon: "ğŸ¯",
          check: (g) => g.hasBeenInDebt && g.money >= 1000000,
        },
        {
          id: "rags_to_riches",
          name: "å±Œçµ²é€†è¥²",
          desc: "å¾è²§å›°å‡ºèº«æˆç‚ºå„„è¬å¯Œç¿",
          icon: "ğŸš€",
          check: (g) =>
            ["genius", "single_parent", "orphan", "farmer"].includes(
              g.originId,
            ) && g.money >= 100000000,
        },

        {
          id: "royal_glory",
          name: "ç‹è€…æ­¸ä¾†",
          desc: "ã€çš‡å®¤è²´æ—ã€‘è³‡ç”¢é”10å„„",
          icon: "ğŸ‘‘",
          check: (g) => g.originId === "royal" && g.money >= 1000000000,
        },

        {
          id: "hacker_legend",
          name: "æš—ç¶²å‚³èªª",
          desc: "ã€é§­å®¢ä¸–å®¶ã€‘ç¨‹å¼è¨­è¨ˆé”180",
          icon: "ğŸ’»",
          check: (g) => g.originId === "hacker" && g.skills.programming >= 180,
        },

        {
          id: "monk_enlightenment",
          name: "å¾—é“é«˜åƒ§",
          desc: "ã€å¯ºå»Ÿä¿®è¡Œã€‘80æ­²æ™‚å¿«æ¨‚>90",
          icon: "ğŸ™",
          check: (g) => g.originId === "monk" && g.age >= 80 && g.happy > 90,
        },

        {
          id: "mafia_boss",
          name: "é»‘é“æ•™çˆ¶",
          desc: "ã€é»‘é“ä¸–å®¶ã€‘é­…åŠ›150+è³‡ç”¢5000è¬",
          icon: "ğŸ—¡ï¸",
          check: (g) =>
            g.originId === "mafia" &&
            g.skills.charm >= 150 &&
            g.money >= 50000000,
        },

        {
          id: "esports_champion",
          name: "é›»ç«¶å† è»",
          desc: "ã€é›»ç«¶ä¸–å®¶ã€‘30æ­²å‰è³‡ç”¢3000è¬",
          icon: "ğŸ®",
          check: (g) =>
            g.originId === "esports" && g.age <= 30 && g.money >= 30000000,
        },

        {
          id: "spy_master",
          name: "è«œå ±å¤§å¸«",
          desc: "ã€æƒ…å ±å“¡å¾Œä»£ã€‘æ™ºåŠ›150+å¥åº·80",
          icon: "ğŸ•µï¸",
          check: (g) =>
            g.originId === "spy" && g.intel >= 150 && g.health >= 80,
        },

        {
          id: "fashion_icon",
          name: "æ™‚å°šæ•™ä¸»",
          desc: "ã€æ™‚å°šåé–€ã€‘é­…åŠ›160+è³‡ç”¢5000è¬",
          icon: "ğŸ‘—",
          check: (g) =>
            g.originId === "fashion" &&
            g.skills.charm >= 160 &&
            g.money >= 50000000,
        },
      ];

      const LIFE_STAGES = [
        { min: 0, max: 2, name: "å¬°å…’æœŸ", icon: "ğŸ‘¶" },
        { min: 3, max: 5, name: "å¹¼å…’æœŸ", icon: "ğŸ§’" },
        { min: 6, max: 12, name: "å…’ç«¥æœŸ", icon: "ğŸ‘¦" },
        { min: 13, max: 17, name: "é’å°‘å¹´", icon: "ğŸ§‘" },
        { min: 18, max: 25, name: "é’å¹´æœŸ", icon: "ğŸ‘¨" },
        { min: 26, max: 40, name: "å£¯å¹´æœŸ", icon: "ğŸ‘¨â€ğŸ’¼" },
        { min: 41, max: 60, name: "ä¸­å¹´æœŸ", icon: "ğŸ‘¨â€ğŸ¦³" },
        { min: 61, max: 999, name: "è€å¹´æœŸ", icon: "ğŸ‘´" },
      ];
      // ===== ğŸ« æ•™è‚²ç³»çµ± =====
      // ===== ğŸ« æ•™è‚²ç³»çµ±ï¼ˆå°ç£å­¸æ ¡ç‰ˆï¼‰=====
      const EDUCATION_LEVELS = [
        { id: "none", name: "ç„¡å­¸æ­·", minAge: 0, unlock: true },
        {
          id: "kindergarten",
          name: "å¹¼å…’åœ’",
          minAge: 3,
          unlock: true,
          bonus: { intel: 2 },
        },
        {
          id: "elementary",
          name: "å°å­¸",
          minAge: 6,
          unlock: true,
          bonus: { intel: 5, "skills.communication": 5 },
        },
        {
          id: "middle",
          name: "åœ‹ä¸­",
          minAge: 13,
          unlock: true,
          bonus: { intel: 10, "skills.communication": 10 },
        },
        {
          id: "high",
          name: "é«˜ä¸­",
          minAge: 16,
          unlock: false,
          requirement: { intel: 40 },
          bonus: { intel: 15, "skills.communication": 15 },
        },
        {
          id: "university",
          name: "å¤§å­¸",
          minAge: 19,
          unlock: false,
          requirement: { intel: 60 },
          bonus: { intel: 25, "skills.communication": 20 },
          cost: 200000,
        },
        {
          id: "master",
          name: "ç¢©å£«",
          minAge: 23,
          unlock: false,
          requirement: { intel: 80 },
          bonus: { intel: 35, "skills.communication": 25 },
          cost: 300000,
        },
        {
          id: "phd",
          name: "åšå£«",
          minAge: 26,
          unlock: false,
          requirement: { intel: 100 },
          bonus: { intel: 50, "skills.communication": 30 },
          cost: 500000,
        },
      ];

      // å°ç£å¯¦éš›å­¸æ ¡åå–®
      const TAIWAN_SCHOOLS = {
        kindergarten: [
          "ä½•å˜‰ä»å¹¼å…’åœ’",
          "åº·æ©‹å¹¼å…’åœ’",
          "èŠéº»è¡—ç¾èªå¹¼å…’åœ’",
          "å‰çš„å ¡å¹¼å…’åœ’",
          "å°å“ˆä½›å¹¼å…’åœ’",
          "é“ç¦¾å¹¼å…’åœ’",
          "ä¿¡èª¼å¹¼å…’åœ’",
          "å¸‚ç«‹å¹¼å…’åœ’",
        ],
        elementary: [
          "å°åŒ—å¸‚ç«‹åœ‹èªå¯¦å°",
          "æ–°åŒ—å¸‚æ¿æ©‹åœ‹å°",
          "æ¡ƒåœ’å¸‚ä¸­å£¢åœ‹å°",
          "å°ä¸­å¸‚åŠ›è¡Œåœ‹å°",
          "å°å—å¸‚å‹åˆ©åœ‹å°",
          "é«˜é›„å¸‚é¼“å±±åœ‹å°",
          "æ–°ç«¹å¸‚æ±é–€åœ‹å°",
          "å°åŒ—å¸‚æ•¦åŒ–åœ‹å°",
        ],
        middle: [
          "å°åŒ—å¸‚ç«‹é‡‘è¯åœ‹ä¸­",
          "æ–°åŒ—å¸‚ç«‹æ¿æ©‹åœ‹ä¸­",
          "æ¡ƒåœ’å¸‚ç«‹é’æºªåœ‹ä¸­",
          "å°ä¸­å¸‚ç«‹å±…ä»åœ‹ä¸­",
          "å°å—å¸‚ç«‹å»ºèˆˆåœ‹ä¸­",
          "é«˜é›„å¸‚ç«‹æ˜è¯åœ‹ä¸­",
          "æ–°ç«¹å¸‚ç«‹å»ºè¯åœ‹ä¸­",
          "å°åŒ—å¸‚ç«‹ä¸­æ­£åœ‹ä¸­",
        ],
        high: [
          // é ‚å°–é«˜ä¸­ï¼ˆéœ€è¦é«˜æ™ºåŠ›ï¼‰
          { name: "å°åŒ—å¸‚ç«‹å»ºåœ‹ä¸­å­¸", requirement: 90, prestige: "top" },
          { name: "å°åŒ—å¸‚ç«‹åŒ—ä¸€å¥³ä¸­", requirement: 90, prestige: "top" },
          { name: "åœ‹ç«‹å¸«å¤§é™„ä¸­", requirement: 85, prestige: "top" },
          { name: "å°ä¸­å¸‚ç«‹å°ä¸­ä¸€ä¸­", requirement: 85, prestige: "top" },
          { name: "å°å—å¸‚ç«‹å°å—ä¸€ä¸­", requirement: 85, prestige: "top" },
          { name: "é«˜é›„å¸‚ç«‹é«˜é›„ä¸­å­¸", requirement: 85, prestige: "top" },

          // å„ªè³ªé«˜ä¸­
          { name: "å°åŒ—å¸‚ç«‹æˆåŠŸé«˜ä¸­", requirement: 75, prestige: "good" },
          { name: "å°åŒ—å¸‚ç«‹ä¸­å±±å¥³ä¸­", requirement: 75, prestige: "good" },
          { name: "æ–°åŒ—å¸‚ç«‹æ¿æ©‹é«˜ä¸­", requirement: 70, prestige: "good" },
          { name: "æ¡ƒåœ’å¸‚ç«‹æ­¦é™µé«˜ä¸­", requirement: 80, prestige: "good" },
          { name: "æ–°ç«¹å¸‚ç«‹æ–°ç«¹é«˜ä¸­", requirement: 75, prestige: "good" },
          { name: "å°ä¸­å¸‚ç«‹å°ä¸­å¥³ä¸­", requirement: 80, prestige: "good" },

          // ä¸€èˆ¬é«˜ä¸­
          { name: "å°åŒ—å¸‚ç«‹æ¾å±±é«˜ä¸­", requirement: 60, prestige: "normal" },
          { name: "æ–°åŒ—å¸‚ç«‹æ–°èŠé«˜ä¸­", requirement: 55, prestige: "normal" },
          { name: "æ¡ƒåœ’å¸‚ç«‹ä¸­å£¢é«˜ä¸­", requirement: 60, prestige: "normal" },
          { name: "å°ä¸­å¸‚ç«‹æƒ æ–‡é«˜ä¸­", requirement: 65, prestige: "normal" },
          { name: "å°å—å¸‚ç«‹å°å—äºŒä¸­", requirement: 60, prestige: "normal" },
          { name: "é«˜é›„å¸‚ç«‹æ–°èŠé«˜ä¸­", requirement: 55, prestige: "normal" },
        ],
        university: [
          // é ‚å°–å¤§å­¸
          { name: "åœ‹ç«‹å°ç£å¤§å­¸", requirement: 85, prestige: "top" },
          { name: "åœ‹ç«‹æ¸…è¯å¤§å­¸", requirement: 80, prestige: "top" },
          { name: "åœ‹ç«‹é™½æ˜äº¤é€šå¤§å­¸", requirement: 80, prestige: "top" },
          { name: "åœ‹ç«‹æˆåŠŸå¤§å­¸", requirement: 75, prestige: "top" },

          // å„ªè³ªå¤§å­¸
          { name: "åœ‹ç«‹æ”¿æ²»å¤§å­¸", requirement: 70, prestige: "good" },
          { name: "åœ‹ç«‹ä¸­å¤®å¤§å­¸", requirement: 68, prestige: "good" },
          { name: "åœ‹ç«‹ä¸­èˆˆå¤§å­¸", requirement: 65, prestige: "good" },
          { name: "åœ‹ç«‹ä¸­å±±å¤§å­¸", requirement: 65, prestige: "good" },
          { name: "åœ‹ç«‹å°ç£å¸«ç¯„å¤§å­¸", requirement: 70, prestige: "good" },

          // ä¸€èˆ¬å¤§å­¸
          { name: "åœ‹ç«‹å°åŒ—å¤§å­¸", requirement: 60, prestige: "normal" },
          { name: "åœ‹ç«‹å°ç£ç§‘æŠ€å¤§å­¸", requirement: 65, prestige: "normal" },
          { name: "åœ‹ç«‹å°åŒ—ç§‘æŠ€å¤§å­¸", requirement: 63, prestige: "normal" },
          { name: "è¼”ä»å¤§å­¸", requirement: 60, prestige: "normal" },
          { name: "æ±å³å¤§å­¸", requirement: 58, prestige: "normal" },
          { name: "æ·¡æ±Ÿå¤§å­¸", requirement: 55, prestige: "normal" },
          { name: "é€¢ç”²å¤§å­¸", requirement: 58, prestige: "normal" },
        ],
      };
      const MAJORS = {
        university: [
          {
            id: "cs",
            name: "è³‡è¨Šå·¥ç¨‹å­¸ç³»",
            skills: { programming: 30 },
            intel: 10,
          },
          {
            id: "business",
            name: "ä¼æ¥­ç®¡ç†å­¸ç³»",
            skills: { finance: 30, communication: 20 },
            intel: 5,
          },
          {
            id: "medicine",
            name: "é†«å­¸ç³»",
            skills: { medical: 40 },
            intel: 20,
            requirement: 85,
          },
          {
            id: "art",
            name: "è—è¡“å­¸ç³»",
            skills: { art: 35, charm: 15 },
            intel: 5,
          },
          {
            id: "engineering",
            name: "é›»æ©Ÿå·¥ç¨‹å­¸ç³»",
            skills: { programming: 20, communication: 10 },
            intel: 15,
          },
          {
            id: "education",
            name: "æ•™è‚²å­¸ç³»",
            skills: { communication: 30 },
            intel: 10,
          },
          {
            id: "law",
            name: "æ³•å¾‹å­¸ç³»",
            skills: { communication: 25 },
            intel: 15,
          },
          {
            id: "economics",
            name: "ç¶“æ¿Ÿå­¸ç³»",
            skills: { finance: 35 },
            intel: 12,
          },
        ],
        master: [
          {
            id: "mba",
            name: "MBA ä¼ç®¡ç¢©å£«",
            skills: { finance: 40, communication: 30 },
            intel: 15,
          },
          {
            id: "cs_master",
            name: "è³‡å·¥ç¢©å£«",
            skills: { programming: 45 },
            intel: 20,
          },
          {
            id: "med_master",
            name: "é†«å­¸ç¢©å£«",
            skills: { medical: 55 },
            intel: 25,
          },
        ],
        phd: [
          {
            id: "cs_phd",
            name: "è³‡å·¥åšå£«",
            skills: { programming: 60 },
            intel: 30,
          },
          {
            id: "med_phd",
            name: "é†«å­¸åšå£«",
            skills: { medical: 70 },
            intel: 35,
          },
        ],
      };
      const CARS = [
        {
          id: "car1",
          name: "åœ‹ç”¢ä»£æ­¥è»Š",
          price: 500000,
          charm: 3,
          desc: "é®é¢¨é¿é›¨å°±å¥½",
        },
        {
          id: "car2",
          name: "Toyota Camry",
          price: 1200000,
          charm: 8,
          desc: "å¯é è€ç”¨çš„ä¸­å‹æˆ¿è»Š",
        },
        {
          id: "car3",
          name: "Tesla Model 3",
          price: 1800000,
          charm: 15,
          desc: "é›»å‹•è»Šæ–°æ½®æµ",
        },
        {
          id: "car4",
          name: "BMW 5ç³»åˆ—",
          price: 3500000,
          charm: 25,
          desc: "è±ªè¯å“ç‰Œè±¡å¾µ",
        },
        {
          id: "car5",
          name: "ä¿æ™‚æ· 911",
          price: 7000000,
          charm: 40,
          desc: "ç¶“å…¸è·‘è»Š",
        },
        {
          id: "car6",
          name: "æ³•æ‹‰åˆ© F8",
          price: 15000000,
          charm: 70,
          desc: "çµ‚æ¥µå¤¢å¹»è·‘è»Š",
        },
      ];

      const HOUSES = [
        {
          id: "house1",
          name: "å¥—æˆ¿",
          price: 2500000,
          happy: 5,
          passive: 3000,
          desc: "å°è€Œæº«é¦¨çš„èµ·é»",
        },
        {
          id: "house2",
          name: "å…©æˆ¿å…¬å¯“",
          price: 6000000,
          happy: 12,
          passive: 8000,
          desc: "é©åˆå°å®¶åº­",
        },
        {
          id: "house3",
          name: "é›»æ¢¯å¤§æ¨“",
          price: 12000000,
          happy: 20,
          passive: 15000,
          desc: "ç”Ÿæ´»æ©Ÿèƒ½å®Œå–„",
        },
        {
          id: "house4",
          name: "é€å¤©å",
          price: 25000000,
          happy: 30,
          passive: 30000,
          desc: "ç¨é–€ç¨æˆ¶çš„è‡ªç”±",
        },
        {
          id: "house5",
          name: "å¸å¯¶è±ªå®…",
          price: 80000000,
          happy: 50,
          passive: 80000,
          desc: "é ‚ç´šç”Ÿæ´»å“è³ª",
        },
        {
          id: "house6",
          name: "æµ·æ™¯åˆ¥å¢…",
          price: 200000000,
          happy: 80,
          passive: 200000,
          desc: "äººç”Ÿé ‚å³°çš„è±¡å¾µ",
        },
      ];

      const LUXURIES = [
        {
          id: "lux1",
          name: "å‹åŠ›å£«æ‰‹éŒ¶",
          price: 500000,
          charm: 10,
          desc: "æ™‚é–“çš„è—è¡“å“",
        },
        {
          id: "lux2",
          name: "åç‰ŒåŒ…",
          price: 300000,
          charm: 8,
          desc: "LVã€Gucciã€HermÃ¨s",
        },
        {
          id: "lux3",
          name: "é«˜ç´šéŸ³éŸ¿",
          price: 800000,
          happy: 10,
          desc: "äº«å—é ‚ç´šéŸ³è³ª",
        },
        {
          id: "lux4",
          name: "éŠè‰‡",
          price: 50000000,
          charm: 50,
          happy: 30,
          desc: "æµ·ä¸Šç§»å‹•åŸå ¡",
        },
        {
          id: "lux5",
          name: "ç§äººé£›æ©Ÿ",
          price: 300000000,
          charm: 100,
          happy: 50,
          desc: "çµ‚æ¥µå¥¢è¯",
        },
      ];
      // ===== ğŸ‘¥ NPC ç³»çµ± =====
      const NPC_TEMPLATES = {
        classmate: [
          { name: "é™³å¥•å®‰", personality: "friendly", baseRelation: 50 },
          { name: "æ—ä¿Šä½‘", personality: "quiet", baseRelation: 40 },
          { name: "ç‹é›²å“²", personality: "outgoing", baseRelation: 60 },
          { name: "å¼µåŠè¼", personality: "smart", baseRelation: 45 },
          { name: "åŠ‰è¬™åœ", personality: "athletic", baseRelation: 55 },
          { name: "è²·åç¿”", personality: "artistic", baseRelation: 50 },
          { name: "æ¥Šæ­£ç†™", personality: "leader", baseRelation: 65 },
          { name: "é„­é †å‰", personality: "kind", baseRelation: 70 },
          {
            name: "é™³é›…å©·",
            personality: "kind",
            baseRelation: 70,
            gender: "female",
          },
          {
            name: "æ—ä½³ç©",
            personality: "smart",
            baseRelation: 48,
            gender: "female",
          },
          {
            name: "é»ƒæ€¡å›",
            personality: "artistic",
            baseRelation: 50,
            gender: "female",
          },
          {
            name: "å¼µå¿ƒæ€¡",
            personality: "gentle",
            baseRelation: 60,
            gender: "female",
          },
          {
            name: "æè©©æ¶µ",
            personality: "quiet",
            baseRelation: 42,
            gender: "female",
          },
          {
            name: "ç‹é›…é›¯",
            personality: "outgoing",
            baseRelation: 62,
            gender: "female",
          },
          {
            name: "å³ä½©å›",
            personality: "kind",
            baseRelation: 68,
            gender: "female",
          },
          {
            name: "åŠ‰æ¬£æ€¡",
            personality: "cheerful",
            baseRelation: 58,
            gender: "female",
          },
          {
            name: "è”¡å®œåº­",
            personality: "artistic",
            baseRelation: 52,
            gender: "female",
          },
          {
            name: "æ¥Šéœæ€¡",
            personality: "gentle",
            baseRelation: 56,
            gender: "female",
          },
        ],
        colleague: [
          // ç”·æ€§åŒäº‹
          {
            name: "ç‹ç¶“ç†å¿—æ˜",
            personality: "strict",
            baseRelation: 30,
            gender: "male",
          },
          {
            name: "é™³å·¥ç¨‹å¸«å»ºåœ‹",
            personality: "quiet",
            baseRelation: 40,
            gender: "male",
          },
          {
            name: "æ—ä¸»ç®¡æ–‡é¾",
            personality: "competitive",
            baseRelation: 35,
            gender: "male",
          },
          {
            name: "å¼µå”ç†ä¿Šå®",
            personality: "leader",
            baseRelation: 45,
            gender: "male",
          },
          {
            name: "é»ƒè³‡æ·±å“¡å·¥å¿—è±ª",
            personality: "helpful",
            baseRelation: 60,
            gender: "male",
          },

          // å¥³æ€§åŒäº‹
          {
            name: "æå§æ·‘èŠ¬",
            personality: "helpful",
            baseRelation: 65,
            gender: "female",
          },
          {
            name: "åŠ‰å°å§é›…èŠ³",
            personality: "cheerful",
            baseRelation: 55,
            gender: "female",
          },
          {
            name: "å³ä¸»ä»»ç¾ç²",
            personality: "strict",
            baseRelation: 32,
            gender: "female",
          },
          {
            name: "é™³ç§˜æ›¸ä½©çŠ",
            personality: "kind",
            baseRelation: 58,
            gender: "female",
          },
          {
            name: "æ¥Šçµ„é•·æ·‘æƒ ",
            personality: "competitive",
            baseRelation: 38,
            gender: "female",
          },
        ],

        neighbor: [
          // ç”·æ€§é„°å±…
          {
            name: "éš”å£è€ç‹",
            personality: "nosy",
            baseRelation: 45,
            gender: "male",
          },
          {
            name: "æ¨“ä¸‹é™³ä¼¯ä¼¯",
            personality: "kind",
            baseRelation: 60,
            gender: "male",
          },
          {
            name: "å°é–€çš„å¤§å­¸ç”Ÿå°å‚‘",
            personality: "friendly",
            baseRelation: 50,
            gender: "male",
          },
          {
            name: "ä¸€æ¨“æ—å…ˆç”Ÿ",
            personality: "quiet",
            baseRelation: 42,
            gender: "male",
          },

          // å¥³æ€§é„°å±…
          {
            name: "æ¨“ä¸Šé™³å¤ªå¤ª",
            personality: "gossipy",
            baseRelation: 40,
            gender: "female",
          },
          {
            name: "ç‹åª½åª½",
            personality: "kind",
            baseRelation: 65,
            gender: "female",
          },
          {
            name: "ä¾¿åˆ©å•†åº—åº—å“¡å°ç¾",
            personality: "friendly",
            baseRelation: 55,
            gender: "female",
          },
          {
            name: "é„°å±…æé˜¿å§¨",
            personality: "helpful",
            baseRelation: 58,
            gender: "female",
          },
        ],

        romantic: [
          // é©åˆç•¶æˆ€æ„›å°è±¡çš„å¥³ç”Ÿ
          {
            name: "æ—å¿ƒå¦‚",
            personality: "gentle",
            baseRelation: 30,
            gender: "female",
            charm: 80,
          },
          {
            name: "é™³é›¨æ¶µ",
            personality: "artistic",
            baseRelation: 28,
            gender: "female",
            charm: 75,
          },
          {
            name: "å¼µè©©å©·",
            personality: "quiet",
            baseRelation: 25,
            gender: "female",
            charm: 78,
          },
          {
            name: "é»ƒæ€¡å®‰",
            personality: "cheerful",
            baseRelation: 32,
            gender: "female",
            charm: 82,
          },
          {
            name: "æé›…ç­‘",
            personality: "smart",
            baseRelation: 26,
            gender: "female",
            charm: 76,
          },
          {
            name: "ç‹æ€æ¶µ",
            personality: "kind",
            baseRelation: 30,
            gender: "female",
            charm: 79,
          },
          {
            name: "å³ä½³è“‰",
            personality: "outgoing",
            baseRelation: 35,
            gender: "female",
            charm: 77,
          },
          {
            name: "åŠ‰å©‰å©·",
            personality: "gentle",
            baseRelation: 28,
            gender: "female",
            charm: 81,
          },

          // é©åˆç•¶æˆ€æ„›å°è±¡çš„ç”·ç”Ÿ
          {
            name: "é™³æŸå®‡",
            personality: "confident",
            baseRelation: 28,
            gender: "male",
            charm: 78,
          },
          {
            name: "æ—å­è»’",
            personality: "mature",
            baseRelation: 25,
            gender: "male",
            charm: 80,
          },
          {
            name: "å¼µæ–‡å‡±",
            personality: "cheerful",
            baseRelation: 30,
            gender: "male",
            charm: 75,
          },
          {
            name: "é»ƒä¿Šå‡±",
            personality: "athletic",
            baseRelation: 32,
            gender: "male",
            charm: 77,
          },
          {
            name: "æå† å»·",
            personality: "smart",
            baseRelation: 26,
            gender: "male",
            charm: 76,
          },
          {
            name: "ç‹å®¥å‹",
            personality: "gentle",
            baseRelation: 28,
            gender: "male",
            charm: 79,
          },
          {
            name: "å³æ‰¿æ¾”",
            personality: "confident",
            baseRelation: 30,
            gender: "male",
            charm: 82,
          },
          {
            name: "åŠ‰å½¥å»·",
            personality: "mature",
            baseRelation: 27,
            gender: "male",
            charm: 81,
          },
        ],

        // é¡å¤–ï¼šè€å¸«/é•·è¼©
        teacher: [
          {
            name: "ç‹è€å¸«æ·‘è²",
            personality: "strict",
            baseRelation: 50,
            gender: "female",
          },
          {
            name: "é™³è€å¸«æ–‡é›„",
            personality: "kind",
            baseRelation: 60,
            gender: "male",
          },
          {
            name: "æ—è€å¸«ç¾æƒ ",
            personality: "helpful",
            baseRelation: 65,
            gender: "female",
          },
          {
            name: "å¼µè€å¸«å¿—æˆ",
            personality: "strict",
            baseRelation: 48,
            gender: "male",
          },
          {
            name: "é»ƒè€å¸«é›…èŠ³",
            personality: "gentle",
            baseRelation: 62,
            gender: "female",
          },
        ],

        // é¡å¤–ï¼šæœ‹å‹çš„æœ‹å‹
        friend: [
          {
            name: "é™³å“ç¿°",
            personality: "outgoing",
            baseRelation: 45,
            gender: "male",
          },
          {
            name: "æ—æ€å¦¤",
            personality: "cheerful",
            baseRelation: 50,
            gender: "female",
          },
          {
            name: "é»ƒå®‡è¾°",
            personality: "friendly",
            baseRelation: 48,
            gender: "male",
          },
          {
            name: "å¼µè© æ™´",
            personality: "kind",
            baseRelation: 52,
            gender: "female",
          },
          {
            name: "ææ‰¿ç¿°",
            personality: "athletic",
            baseRelation: 46,
            gender: "male",
          },
          {
            name: "ç‹èŠ·è±",
            personality: "artistic",
            baseRelation: 50,
            gender: "female",
          },
        ],
      };

      const NPC_INTERACTIONS = {
        chat: { cost: 10, relationChange: 5, moneyChange: 0, desc: "é–’èŠ" },
        help: {
          cost: 20,
          relationChange: 10,
          moneyChange: -1000,
          desc: "å¹«åŠ©å°æ–¹",
        },
        gift: {
          cost: 15,
          relationChange: 15,
          moneyChange: -3000,
          desc: "é€ç¦®ç‰©",
        },
        date: {
          cost: 25,
          relationChange: 20,
          moneyChange: -2000,
          desc: "ç´„æœƒ",
          requireRelation: 50,
        },
        argue: { cost: 5, relationChange: -20, moneyChange: 0, desc: "çˆ­åµ" },
      };

      // ==========================================
      // ğŸ”´ éŠæˆ²ç‹€æ…‹
      // ==========================================
      let currentOriginIndex = 0;
      let skillsCollapsed = false;
      let currentJobIndex = 0; // ç•¶å‰é¡¯ç¤ºçš„è·æ¥­ç´¢å¼•
      let Game = {
        name: "",
        origin: "",
        originId: "",
        education: "none",
        major: "",
        isStudying: false,
        studyProgress: 0,
        age: 0,
        gender: "ç”·",
        money: 0,
        health: 100,
        happy: 80,
        intel: 50,
        stamina: 100,
        maxStamina: 100,

        skills: {
          programming: 0,
          art: 0,
          medical: 0,
          cooking: 0,
          finance: 0,
          communication: 0,
          charm: 0,
        },

        jobId: "none",
        jobYears: 0,
        yearlyMoney: 0,

        inventory: [],
        relationships: [],
        npcs: [],
        metNPCs: [],
        talents: [],
        traits: [],
        unlockedTraits: [],
        unlockedAchievements: [],

        happyYears: 0,
        debtYears: 0,
        hasBeenInDebt: false,
        totalActions: 0,
        totalEvents: 0,

        // åŠ æˆä¿‚æ•¸
        learnBonus: 1,
        healthDecay: 1,
        happyDecay: 1,
        socialBonus: 1,
        incomeBonus: 1,
        workPenalty: 1,
        skillBonus: 1,
        luckBonus: 0,
      };

      let activeEvent = null;
      let selectedOriginId = "common";
      let currentTraitStep = 0;
      let selectedTraits = [];
      let traitChoices = [];
      // ==========================================
      // ğŸ”´ åˆå§‹åŒ–
      // ==========================================

      function initCreation() {
        renderOriginCard();
      }

      function renderOriginCard() {
        // ç¢ºä¿ç´¢å¼•åœ¨ç¯„åœå…§
        if (currentOriginIndex >= ORIGINS.length) currentOriginIndex = 0;
        if (currentOriginIndex < 0) currentOriginIndex = ORIGINS.length - 1;

        const o = ORIGINS[currentOriginIndex];

        let html = `
              <div style="position: relative; min-height: 450px;">
                  <!-- å·¦ç®­é ­ -->
                  <button onclick="prevOrigin()"
                          style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%);
                                 width: 60px; height: 60px; border-radius: 50%; font-size: 2em;
                                 background: linear-gradient(135deg, #444, #555); z-index: 100;
                                 border: 3px solid var(--accent); box-shadow: 0 4px 15px rgba(0,0,0,0.5);">
                      â—€
                  </button>

                  <!-- å³ç®­é ­ -->
                  <button onclick="nextOrigin()"
                          style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
                                 width: 60px; height: 60px; border-radius: 50%; font-size: 2em;
                                 background: linear-gradient(135deg, #444, #555); z-index: 100;
                                 border: 3px solid var(--accent); box-shadow: 0 4px 15px rgba(0,0,0,0.5);">
                      â–¶
                  </button>

                  <!-- å‡ºèº«å¡ç‰‡ -->
                  <div style="padding: 0 80px;">
                      <div class="origin-card selected"
                           style="transform: scale(1.05); box-shadow: 0 10px 30px rgba(187, 134, 252, 0.4);
                                  border-color: var(--accent); cursor: default;">
                          <div class="origin-name" style="font-size: 1.8em; text-align: center; margin-bottom: 10px; color: var(--gold);">
                              ${o.name}
                          </div>
                          <div class="origin-parents" style="text-align: center; font-size: 1em; margin-bottom: 15px; color: #888;">
                              ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ ${o.parents}
                          </div>
                          <div class="origin-desc" style="line-height: 1.6; margin: 15px 0; font-size: 0.95em; color: var(--text-dim);">
                              ${o.desc}
                          </div>
                          <div class="origin-stats" style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                              <div style="margin-bottom: 8px;">
                                  ğŸ’° åˆå§‹è³‡é‡‘: <span style="color: var(--gold); font-weight: bold;">$${o.money.toLocaleString()}</span>
                              </div>
                              <div style="margin-bottom: 8px;">
                                  ğŸ§  æ™ºåŠ›: ${o.intel} | ğŸ˜Š å¿«æ¨‚: ${o.happy}
                              </div>
                              <div style="margin-bottom: 8px;">
                                  ğŸ“… å¹´æ”¶å…¥: $${o.yearlyMoney.toLocaleString()}
                              </div>
                              <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.2); color: var(--green);">
                                  âœ¨ ${o.buff}
                              </div>
                          </div>
                      </div>

                      <!-- æŒ‡ç¤ºå™¨ -->
                      <div style="text-align: center; margin-top: 20px; color: var(--text-dim);">
                          <div style="font-size: 1.1em; margin-bottom: 5px;">
                              å‡ºèº« ${currentOriginIndex + 1} / ${ORIGINS.length}
                          </div>
                          <div style="font-size: 0.9em;">
                              ğŸ’¡ å·¦å³åˆ‡æ›æŸ¥çœ‹æ›´å¤šå‡ºèº«èƒŒæ™¯
                          </div>
                      </div>
                  </div>
              </div>
          `;

        document.getElementById("origin-list").innerHTML = html;

        // è‡ªå‹•é¸ä¸­ç•¶å‰å‡ºèº«
        selectOrigin(o.id);
      }

      function selectOrigin(id) {
        selectedOriginId = id;
      }
      function prevOrigin() {
        currentOriginIndex--;
        if (currentOriginIndex < 0) {
          currentOriginIndex = ORIGINS.length - 1;
        }
        renderOriginCard();
      }

      function nextOrigin() {
        currentOriginIndex++;
        if (currentOriginIndex >= ORIGINS.length) {
          currentOriginIndex = 0;
        }
        renderOriginCard();
      }
      function toggleSkills() {
        skillsCollapsed = !skillsCollapsed;
        updateUI();
      }
      function showChanges(changes) {
        const changeDiv = document.createElement("div");
        changeDiv.style.cssText = `
        position: fixed;
        top: 20%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.8);
        background: linear-gradient(135deg, rgba(30, 30, 46, 0.98), rgba(42, 42, 62, 0.98));
        border: 3px solid var(--accent);
        border-radius: 20px;
        padding: 25px 35px;
        z-index: 500;
        box-shadow: 0 15px 50px rgba(187, 134, 252, 0.4), 0 0 20px rgba(187, 134, 252, 0.2);
        min-width: 250px;
        text-align: center;
        animation: popIn 0.3s ease-out forwards;
    `;

        let html =
          '<div style="font-size: 1.3em; font-weight: bold; color: var(--gold); margin-bottom: 15px; text-shadow: 0 0 10px var(--gold);">âœ¨ æ•¸å€¼è®ŠåŒ–</div>';
        html +=
          '<div style="display: flex; flex-direction: column; gap: 8px;">';

        changes.forEach((change) => {
          const isPositive = change.includes("+");
          const color = isPositive ? "var(--green)" : "var(--red)";
          const icon = isPositive ? "â–²" : "â–¼";
          html += `
            <div style="font-size: 1.05em; padding: 8px 15px; background: rgba(0,0,0,0.3); 
                        border-radius: 8px; color: ${color}; font-weight: bold; 
                        border-left: 3px solid ${color};">
                ${icon} ${change}
            </div>
        `;
        });

        html += "</div>";
        changeDiv.innerHTML = html;
        document.body.appendChild(changeDiv);

        // 2 ç§’å¾Œæ·¡å‡º
        setTimeout(() => {
          changeDiv.style.animation = "fadeOut 0.3s ease-out forwards";
          setTimeout(() => changeDiv.remove(), 300);
        }, 2000);
      }

      function startGame() {
        const name = document.getElementById("inp-name").value.trim();
        if (!name) return alert("è«‹è¼¸å…¥å§“å");

        const origin = ORIGINS.find((o) => o.id === selectedOriginId);
        const gender = document.getElementById("inp-gender").value;

        // éš¨æ©Ÿå¤©è³¦
        let talentPool = [...TALENTS];
        let selectedTalents = [];
        const talentCount = Math.random() > 0.6 ? 2 : 1;
        for (let i = 0; i < talentCount; i++) {
          const idx = Math.floor(Math.random() * talentPool.length);
          selectedTalents.push(talentPool[idx]);
          talentPool.splice(idx, 1);
        }

        // åˆå§‹åŒ–éŠæˆ²ç‹€æ…‹
        Game = {
          ...Game,
          name,
          origin: origin.name,
          originId: origin.id,
          gender,
          money: origin.money,
          intel: origin.intel,
          happy: origin.happy,
          yearlyMoney: origin.yearlyMoney,
          talents: selectedTalents,
          age: 0,
          relationships: [],
        };

        // è¨˜éŒ„æ˜¯å¦è² å‚µé
        if (Game.money < 0) Game.hasBeenInDebt = true;

        // æ ¹æ“šå‡ºèº«æ·»åŠ çˆ¶æ¯é—œä¿‚
        if (origin.parents && origin.parents !== "ç„¡") {
          const parentsSplit = origin.parents.split(" / ");
          if (parentsSplit.length === 2) {
            Game.relationships.push(
              {
                id: "dad",
                name: "çˆ¸çˆ¸",
                type: "parent",
                relation: 80,
                role: parentsSplit[0],
              },
              {
                id: "mom",
                name: "åª½åª½",
                type: "parent",
                relation: 90,
                role: parentsSplit[1],
              },
            );
          } else if (parentsSplit.length === 1) {
            Game.relationships.push({
              id: "mom",
              name: "åª½åª½",
              type: "parent",
              relation: 95,
              role: parentsSplit[0],
            });
          }
        }

        // æ‡‰ç”¨å‡ºèº«ç‰¹æ®Šæ•ˆæœ
        if (origin.id === "military") Game.health += 20;
        if (origin.id === "doctor") Game.skills.medical += 30;
        if (origin.id === "farmer") {
          Game.health += 15;
          Game.happy += 5;
        }
        if (origin.id === "fisher") Game.health += 10;
        if (origin.id === "aboriginal") {
          Game.skills.charm += 15;
          Game.skills.art += 20;
          Game.happy += 10;
        }
        if (origin.id === "immigrant") Game.skills.communication += 20;
        if (origin.id === "tech") Game.skills.programming += 30;
        if (origin.id === "artist") {
          Game.skills.art += 40;
          Game.skills.charm += 10;
        }
        if (origin.id === "politician") Game.skills.communication += 25;
        if (origin.id === "temple") {
          Game.skills.communication += 15;
          Game.happy += 5;
        }
        if (origin.id === "mafia") {
          Game.skills.charm += 20;
          Game.health += 15;
        }
        if (origin.id === "star") Game.skills.charm += 30;
        switch (origin.id) {
          case "royal":
            Game.relationships.push({
              id: "butler",
              name: "ç®¡å®¶é˜¿çˆ¾å¼—é›·å¾·",
              type: "servant",
              relation: 80,
              role: "å¿ èª ç®¡å®¶",
            });
            Game.skills.charm += 30;
            break;
          case "mafia":
            Game.relationships.push({
              id: "bodyguard",
              name: "ä¿é‘£é˜¿å¼·",
              type: "subordinate",
              relation: 70,
              role: "è²¼èº«ä¿é‘£",
            });
            break;
          case "hacker":
            Game.relationships.push({
              id: "mentor",
              name: "é§­å®¢å°å¸« Ghost",
              type: "mentor",
              relation: 85,
              role: "æŠ€è¡“å°å¸«",
            });
            Game.skills.programming += 50;
            break;
          case "monk":
            Game.relationships.push({
              id: "master",
              name: "å¸«çˆ¶ç„ç©º",
              type: "master",
              relation: 95,
              role: "æˆæ¥­æ©å¸«",
            });
            Game.health += 25;
            Game.happy += 10;
            break;
          case "spy":
            Game.relationships.push({
              id: "handler",
              name: "æ¥é ­äºº Mr. Smith",
              type: "contact",
              relation: 60,
              role: "ç¥ç§˜æ¥é ­äºº",
            });
            break;
          case "chef_family":
            Game.relationships.push({
              id: "sous_chef",
              name: "å‰¯ä¸»å»šè€æ",
              type: "colleague",
              relation: 75,
              role: "å»šæˆ¿å¤¥ä¼´",
            });
            Game.skills.cooking += 60;
            Game.skills.art += 20;
            break;
          case "detective":
            Game.relationships.push({
              id: "partner",
              name: "æ­æª”è€ç‹",
              type: "partner",
              relation: 80,
              role: "æœ€ä½³æ‹æª”",
            });
            break;
          case "esports":
            Game.relationships.push({
              id: "coach",
              name: "æ•™ç·´",
              type: "coach",
              relation: 75,
              role: "æˆ°éšŠæ•™ç·´",
            });
            break;
          case "fashion":
            Game.relationships.push({
              id: "stylist",
              name: "é€ å‹å¸«",
              type: "stylist",
              relation: 70,
              role: "å¾¡ç”¨é€ å‹å¸«",
            });
            Game.skills.charm += 35;
            Game.skills.art += 25;
            break;
          case "scientist_family":
            Game.relationships.push({
              id: "lab_assistant",
              name: "å¯¦é©—åŠ©ç†",
              type: "assistant",
              relation: 75,
              role: "ç ”ç©¶åŠ©ç†",
            });
            break;
        }
        // æ‡‰ç”¨å¤©è³¦æ•ˆæœ
        // æ‡‰ç”¨å¤©è³¦æ•ˆæœ
        Game.talents.forEach((t) => t.effect(Game));

        // âœ… é–‹å§‹ç‰¹è³ªé¸æ“‡æµç¨‹
        currentTraitStep = 0;
        selectedTraits = [];
        showTraitSelection();
      }

      // âœ… æ–°å¢ç‰¹è³ªé¸æ“‡å‡½æ•¸
      function showTraitSelection() {
        // éš±è—å‰µè§’ç•«é¢
        document.getElementById("scene-creation").style.display = "none";

        // å‰µå»ºç‰¹è³ªé¸æ“‡ç•«é¢
        let selectionHtml = `
        <div style="padding: 20px; text-align: center; max-width: 600px; margin: 0 auto;">
            <h1 style="font-size: 2em; color: var(--gold); margin-bottom: 10px;">
                âœ¨ é¸æ“‡å€‹äººç‰¹è³ª
            </h1>
            <p style="color: var(--text-dim); margin-bottom: 20px;">
                ç¬¬ ${currentTraitStep + 1} / 3 å€‹ç‰¹è³ª
            </p>
            <div id="trait-options" style="margin-top: 20px;"></div>
        </div>
    `;

        document.getElementById("scene-creation").innerHTML = selectionHtml;
        // âœ… é¡¯ç¤ºç‰¹è³ª
        let traitHtml = "";
        Game.traits.forEach((t) => {
          traitHtml += `<span class="talent-tag" style="background: linear-gradient(135deg, #2196f3, #1976d2);" title="${t.desc}">${t.name}</span>`;
        });

        // å¦‚æœæœ‰ç‰¹è³ªé¡¯ç¤ºå€åŸŸå°±æ›´æ–°ï¼Œæ²’æœ‰å°±å‰µå»º
        if (!document.getElementById("trait-display")) {
          const talentDisplay = document.getElementById("talent-display");
          const traitDiv = document.createElement("div");
          traitDiv.id = "trait-display";
          traitDiv.style.marginTop = "5px";
          talentDisplay.parentNode.insertBefore(
            traitDiv,
            talentDisplay.nextSibling,
          );
        }
        document.getElementById("trait-display").innerHTML = traitHtml;
        document.getElementById("scene-creation").style.display = "block";

        // éš¨æ©Ÿç”Ÿæˆ3å€‹å¯é¸ç‰¹è³ª
        const availableTraits = TRAITS.filter(
          (t) => t.unlock === "default" && !selectedTraits.includes(t.id),
        );
        traitChoices = [];
        for (let i = 0; i < 3; i++) {
          const idx = Math.floor(Math.random() * availableTraits.length);
          traitChoices.push(availableTraits[idx]);
          availableTraits.splice(idx, 1);
        }

        renderTraitOptions();
      }

      function renderTraitOptions() {
        let html = "";

        traitChoices.forEach((trait, index) => {
          html += `
            <div class="origin-card" onclick="selectTrait(${index})" 
                 style="margin: 15px auto; max-width: 500px; cursor: pointer;">
                <div class="origin-name" style="font-size: 1.5em; margin-bottom: 10px;">
                    ${trait.name}
                </div>
                <div class="origin-desc" style="font-size: 1em; line-height: 1.5; color: var(--text-dim);">
                    ${trait.desc}
                </div>
                <div style="margin-top: 10px; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px; font-size: 0.9em; color: var(--green);">
                    é¡å‹ï¼š${trait.category === "personality" ? "æ€§æ ¼ç‰¹è³ª" : "èƒ½åŠ›ç‰¹è³ª"}
                </div>
            </div>
        `;
        });

        document.getElementById("trait-options").innerHTML = html;
      }

      function selectTrait(index) {
        const selectedTrait = traitChoices[index];
        selectedTraits.push(selectedTrait.id);
        currentTraitStep++;

        // å¦‚æœé‚„æ²’é¸å®Œ3å€‹ï¼Œç¹¼çºŒé¸æ“‡
        if (currentTraitStep < 3) {
          showTraitSelection();
        } else {
          // é¸å®Œäº†ï¼Œé–‹å§‹éŠæˆ²
          finishCharacterCreation();
        }
      }

      function finishCharacterCreation() {
        // å°‡é¸æ“‡çš„ç‰¹è³ªåŠ å…¥éŠæˆ²
        Game.traits = selectedTraits.map((id) =>
          TRAITS.find((t) => t.id === id),
        );
        Game.unlockedTraits = [...selectedTraits]; // è¨˜éŒ„å·²è§£é–

        // æ‡‰ç”¨ç‰¹è³ªæ•ˆæœ
        Game.traits.forEach((t) => t.effect(Game));

        // éš±è—å‰µè§’ç•«é¢ï¼Œé–‹å§‹éŠæˆ²
        document.getElementById("scene-creation").style.display = "none";
        const gameScene = document.getElementById("scene-game");
        gameScene.style.display = "block";
        gameScene.classList.add("active");

        updateUI();
        renderJobs();
        renderShop();
        renderSocial();
        renderAchievements();
        renderStats();

        log(`ğŸ‘¶ ${Game.name} å‡ºç”Ÿäº†ï¼`);
        log(`ğŸ  å‡ºèº«ï¼š${Game.origin}`);
        log(`ğŸ å¤©è³¦ï¼š${Game.talents.map((t) => t.name).join("ã€")}`);
        log(`âœ¨ ç‰¹è³ªï¼š${Game.traits.map((t) => t.name).join("ã€")}`);
      }

      // ==========================================
      // ğŸ”´ UI æ›´æ–°
      // ==========================================

      function log(msg, changes = null) {
        const box = document.getElementById("game-log");
        if (box) {
          const timestamp = `[${Game.age}æ­²]`;
          let logHtml = `<div style="margin-bottom: 8px; padding: 8px; background: rgba(0,0,0,0.2); border-radius: 5px;">`;
          logHtml += `<span style="color: var(--text-dim); font-size: 0.85em;">${timestamp}</span> `;
          logHtml += `<span style="color: var(--text);">${msg}</span>`;

          // å¦‚æœæœ‰è®ŠåŒ–æ•¸æ“šï¼Œé¡¯ç¤ºåœ¨åŒä¸€è¡Œ
          if (changes && changes.length > 0) {
            logHtml +=
              '<div style="margin-top: 5px; display: flex; flex-wrap: wrap; gap: 8px;">';
            changes.forEach((change) => {
              const isPositive = change.includes("+");
              const color = isPositive ? "var(--green)" : "var(--red)";
              const bgColor = isPositive
                ? "rgba(3, 218, 198, 0.15)"
                : "rgba(207, 102, 121, 0.15)";
              logHtml += `
                    <span style="font-size: 0.8em; padding: 2px 8px; background: ${bgColor}; 
                                 color: ${color}; border-radius: 4px; font-weight: bold;">
                        ${change}
                    </span>
                `;
            });
            logHtml += "</div>";
          }

          logHtml += "</div>";
          box.innerHTML += logHtml;
          box.scrollTop = box.scrollHeight;
        }
      }

      function updateUI() {
        // åŸºæœ¬è³‡è¨Š
        document.getElementById("player-name").textContent = Game.name;
        document.getElementById("age-display").textContent = Game.age;
        document.getElementById("player-origin").textContent = Game.origin;
        document.getElementById("player-job").textContent = JOBS.find(
          (j) => j.id === Game.jobId,
        ).name;
        document.getElementById("money-display").textContent =
          "$" + Game.money.toLocaleString();

        // æ•¸å€¼
        document.getElementById("health").textContent = Math.max(
          0,
          Math.floor(Game.health),
        );
        document.getElementById("happy").textContent = Math.max(
          0,
          Math.floor(Game.happy),
        );
        document.getElementById("intel").textContent = Math.floor(Game.intel);

        // é ­åƒ
        const stage = LIFE_STAGES.find(
          (s) => Game.age >= s.min && Game.age <= s.max,
        );
        document.getElementById("player-avatar").textContent = stage.icon;
        document.getElementById("life-stage").textContent = stage.name;

        // å¤©è³¦æ¨™ç±¤
        // å¤©è³¦é¡¯ç¤º
        let talentHtml = "";
        Game.talents.forEach((t) => {
          talentHtml += `<span class="talent-tag ${t.type === "bad" ? "talent-bad" : ""}" title="${t.desc}">${t.name}</span>`;
        });
        document.getElementById("talent-display").innerHTML = talentHtml;

        // âœ… ç‰¹è³ªé¡¯ç¤º
        let traitHtml = "";
        if (Game.traits && Game.traits.length > 0) {
          traitHtml =
            '<div style="font-size: 0.7em; color: var(--text-dim); margin-bottom: 3px; margin-top: 8px;">âœ¨ ç‰¹è³ª</div>';
          Game.traits.forEach((t) => {
            let bgColor = "";
            if (t.category === "personality") {
              bgColor =
                "background: linear-gradient(135deg, #2196f3, #1976d2);";
            } else if (t.category === "ability") {
              bgColor =
                "background: linear-gradient(135deg, #9c27b0, #7b1fa2);";
            } else if (t.category === "special") {
              bgColor =
                "background: linear-gradient(135deg, #ff9800, #f57c00);";
            }
            traitHtml += `<span class="talent-tag" style="${bgColor}" title="${t.desc}">${t.name}</span>`;
          });
        }
        document.getElementById("trait-display").innerHTML = traitHtml;

        // æŠ€èƒ½æ¢
        let skillHtml = `
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
              <span style="font-weight: bold; color: var(--accent);">ğŸ“Š æŠ€èƒ½æ•¸å€¼</span>
              <button onclick="toggleSkills()"
                      style="padding: 5px 12px; font-size: 0.85em; background: rgba(255,255,255,0.1);
                             border: 1px solid var(--accent); border-radius: 5px; cursor: pointer;">
                  ${skillsCollapsed ? "â–¼ å±•é–‹" : "â–² æ”¶èµ·"}
              </button>
          </div>
      `;

        if (!skillsCollapsed) {
          const skillNames = {
            programming: "ç¨‹å¼",
            art: "è—è¡“",
            medical: "é†«ç™‚",
            cooking: "çƒ¹é£ª",
            finance: "ç†è²¡",
            communication: "æºé€š",
            charm: "é­…åŠ›",
          };

          Object.keys(Game.skills).forEach((key) => {
            const val = Math.min(200, Math.floor(Game.skills[key]));
            const percent = (val / 200) * 100;
            skillHtml += `
                  <div class="skill-item">
                      <div class="skill-header">
                          <span>${skillNames[key]}</span>
                          <span>${val}</span>
                      </div>
                      <div class="skill-bar-bg">
                          <div class="skill-bar-fill" style="width: ${percent}%"></div>
                      </div>
                  </div>
              `;
          });
        }

        document.getElementById("skills-container").innerHTML = skillHtml;

        // é«”åŠ›æ¢
        const stamina = Math.max(0, Math.min(100, Game.stamina));
        const staminaRatio = stamina / 100;
        document.getElementById("stamina-bar").style.transform =
          `scaleX(${staminaRatio})`;
        document.getElementById("stamina-text").textContent =
          `${Math.floor(stamina)}/100`;

        if (stamina < 20) {
          document.getElementById("stamina-bar").classList.add("low");
        } else {
          document.getElementById("stamina-bar").classList.remove("low");
        }

        // ç‹€æ…‹è­¦å‘Š
        let alertHtml = "";
        if (Game.money < 0) {
          alertHtml += `<div class="status-alert alert-red">âš ï¸ è² å‚µè­¦å‘Šï¼å‰© ${3 - Game.debtYears} å¹´</div>`;
        }
        if (Game.happy < 20) {
          alertHtml += `<div class="status-alert alert-orange">â˜ï¸ æ†‚é¬±ç‹€æ…‹</div>`;
        }
        if (Game.health < 30) {
          alertHtml += `<div class="status-alert alert-red">ğŸ¥ é‡ç—…è­¦å‘Š</div>`;
        }
        if (Game.age >= 18 && Game.jobId === "none") {
          alertHtml += `<div class="status-alert alert-blue">ğŸ’¼ å°šæœªå°±æ¥­</div>`;
        }
        document.getElementById("status-alerts").innerHTML = alertHtml;

        // æ›´æ–°è¡Œå‹•æŒ‰éˆ•
        updateActionButtons();
      }

      function updateActionButtons() {
        const btns = document.getElementById("action-buttons");
        let html = "";
        const age = Game.age;

        if (age <= 2) {
          html = `
            <button onclick="action('cry')">ğŸ˜­ å“­é¬§<span class="cost-tag">âš¡-10</span></button>
            <button onclick="action('sleep')">ğŸ˜´ ç¡è¦º<span class="cost-tag">âš¡-20</span></button>
            <button onclick="action('play_toy')">ğŸ§¸ ç©ç©å…·<span class="cost-tag">âš¡-15</span></button>
            <button onclick="action('learn_speak')">ğŸ—£ï¸ ç‰™ç‰™å­¸èª<span class="cost-tag">âš¡-25</span></button>
            <button onclick="action('crawl')">ğŸ› çˆ¬è¡Œ<span class="cost-tag">âš¡-15</span></button>
            <button onclick="action('watch_mobile')">ğŸ‘€ çœ‹å¤§äººçš„æ‰‹æ©Ÿ<span class="cost-tag">âš¡-10</span></button>
        `;
        } else if (age <= 5) {
          html = `
            <button onclick="action('kindergarten')">ğŸ« ä¸Šå¹¼å…’åœ’<span class="cost-tag">âš¡-20</span></button>
            <button onclick="action('draw')">ğŸ–ï¸ ç•«ç•«<span class="cost-tag">âš¡-15</span></button>
            <button onclick="action('watch_tv')">ğŸ“º çœ‹é›»è¦–<span class="cost-tag">âš¡-10</span></button>
            <button onclick="action('make_friend')">ğŸ‘« äº¤æœ‹å‹<span class="cost-tag">âš¡-20</span></button>
            <button onclick="action('play_outside')">ğŸŒ³ æˆ¶å¤–ç©è€<span class="cost-tag">âš¡-20</span></button>
            <button onclick="action('learn_music')">ğŸµ å­¸æ‰è—<span class="cost-tag">âš¡-25 / $-5000</span></button>
        `;
        } else if (age <= 12) {
          html = `
            <button onclick="action('study_hard')">ğŸ“š èªçœŸè®€æ›¸<span class="cost-tag">âš¡-30</span></button>
            <button onclick="action('cram_school')">ğŸ“– è£œç¿’ç­<span class="cost-tag">âš¡-25 / $-2000</span></button>
            <button onclick="action('sports')">âš½ é‹å‹•<span class="cost-tag">âš¡-20</span></button>
            <button onclick="action('play_game')">ğŸ® æ‰“é›»å‹•<span class="cost-tag">âš¡-15</span></button>
            <button onclick="action('help_parent')">ğŸ  å¹«å¿™å®¶å‹™<span class="cost-tag">âš¡-20</span></button>
            <button onclick="action('read_book')">ğŸ“• çœ‹èª²å¤–æ›¸<span class="cost-tag">âš¡-25</span></button>
        `;
        } else if (age <= 17) {
          html = `
            <button onclick="action('exam_prep')">ğŸ“ æº–å‚™è€ƒè©¦<span class="cost-tag">âš¡-35</span></button>
            <button onclick="action('club')">ğŸ­ åƒåŠ ç¤¾åœ˜<span class="cost-tag">âš¡-20</span></button>
            <button onclick="action('date_crush')">ğŸ’• å’Œå–œæ­¡çš„äººç´„æœƒ<span class="cost-tag">âš¡-25 / $-500</span></button>
            <button onclick="action('rebel')">ğŸ˜¤ å›é€†æœŸ<span class="cost-tag">âš¡-15</span></button>
            <button onclick="action('part_time')">ğŸ’¼ æ‰“å·¥<span class="cost-tag">âš¡-30</span></button>
            <button onclick="action('learn_code')">ğŸ’» è‡ªå­¸ç¨‹å¼<span class="cost-tag">âš¡-35</span></button>
        `;
        } else {
          html = `
            <button onclick="action('work')">ğŸ’¼ å·¥ä½œ<span class="cost-tag">âš¡-35</span></button>
            <button onclick="action('study_skill')">ğŸ“– å­¸ç¿’æŠ€èƒ½<span class="cost-tag">âš¡-25 / $-3000</span></button>
            <button onclick="action('socialize')">ğŸ» ç¤¾äº¤æ´»å‹•<span class="cost-tag">âš¡-20 / $-2000</span></button>
            <button onclick="action('relax')">ğŸ® ä¼‘é–’å¨›æ¨‚<span class="cost-tag">âš¡-15 / $-1000</span></button>
            <button onclick="action('invest')">ğŸ“ˆ æŠ•è³‡ç†è²¡<span class="cost-tag">âš¡-20 / $-10000</span></button>
            <button onclick="action('exercise')">ğŸ’ª å¥èº«<span class="cost-tag">âš¡-25 / $-1500</span></button>
            <button onclick="action('volunteer')">ğŸ¤ å¿—å·¥æœå‹™<span class="cost-tag">âš¡-30</span></button>
            <button onclick="action('travel')">âœˆï¸ æ—…éŠ<span class="cost-tag">âš¡-30 / $-20000</span></button>
        `;
        }

        btns.innerHTML = html;

        const allBtns = btns.querySelectorAll("button");
        allBtns.forEach((btn) => {
          if (Game.stamina < 10 || Game.happy < 5 || Game.health <= 0) {
            btn.disabled = true;
          }
        });
      }

      function getActionName(type) {
        const actionNames = {
          // å¬°å…’æœŸ
          cry: "ğŸ˜­ å“­é¬§",
          sleep: "ğŸ˜´ ç¡è¦º",
          play_toy: "ğŸ§¸ ç©ç©å…·",
          learn_speak: "ğŸ—£ï¸ ç‰™ç‰™å­¸èª",
          crawl: "ğŸ› çˆ¬è¡Œ",
          watch_mobile: "ğŸ‘€ çœ‹æ‰‹æ©Ÿ",

          // å¹¼å…’æœŸ
          kindergarten: "ğŸ« ä¸Šå¹¼å…’åœ’",
          draw: "ğŸ–ï¸ ç•«ç•«",
          watch_tv: "ğŸ“º çœ‹é›»è¦–",
          make_friend: "ğŸ‘« äº¤æœ‹å‹",
          play_outside: "ğŸŒ³ æˆ¶å¤–ç©è€",
          learn_music: "ğŸµ å­¸æ‰è—",

          // å…’ç«¥æœŸ
          study_hard: "ğŸ“š èªçœŸè®€æ›¸",
          cram_school: "ğŸ“– è£œç¿’ç­",
          sports: "âš½ é‹å‹•",
          play_game: "ğŸ® æ‰“é›»å‹•",
          help_parent: "ğŸ  å¹«å¿™å®¶å‹™",
          read_book: "ğŸ“• çœ‹èª²å¤–æ›¸",

          // é’å°‘å¹´æœŸ
          exam_prep: "ğŸ“ æº–å‚™è€ƒè©¦",
          club: "ğŸ­ åƒåŠ ç¤¾åœ˜",
          date_crush: "ğŸ’• ç´„æœƒ",
          rebel: "ğŸ˜¤ å›é€†",
          part_time: "ğŸ’¼ æ‰“å·¥",
          learn_code: "ğŸ’» è‡ªå­¸ç¨‹å¼",

          // æˆå¹´æœŸ
          work: "ğŸ’¼ å·¥ä½œ",
          study_skill: "ğŸ“– å­¸ç¿’æŠ€èƒ½",
          socialize: "ğŸ» ç¤¾äº¤",
          relax: "ğŸ® ä¼‘é–’",
          invest: "ğŸ“ˆ æŠ•è³‡",
          exercise: "ğŸ’ª å¥èº«",
          volunteer: "ğŸ¤ å¿—å·¥",
          travel: "âœˆï¸ æ—…éŠ",
        };

        return actionNames[type] || "";
      }

      function action(type) {
        if (Game.health <= 0) {
          return alert("ğŸ’€ ä½ å·²ç¶“å»ä¸–äº†ï¼");
        }

        let cost = 20;
        let effects = {};

        switch (type) {
          // ===== å¬°å…’æœŸ (0-2æ­²) =====
          case "cry":
            cost = 10;
            effects = { happy: 5 };
            break;

          case "sleep":
            cost = 20;
            effects = { health: 3, happy: 2 };
            break;

          case "play_toy":
            cost = 15;
            effects = { happy: 8 };
            break;

          case "learn_speak":
            cost = 25;
            effects = {
              intel: 3 * Game.learnBonus,
              "skills.communication": 2 * Game.skillBonus,
            };
            break;

          case "crawl":
            cost = 15;
            effects = { health: 2, happy: 5 };
            break;

          case "watch_mobile":
            cost = 10;
            effects = { happy: 8, intel: -2 };
            break;

          // ===== å¹¼å…’æœŸ (3-5æ­²) =====
          case "kindergarten":
            cost = 20;
            effects = {
              intel: 2 * Game.learnBonus,
              "skills.communication": 3 * Game.skillBonus,
              happy: 5,
            };
            break;

          case "draw":
            cost = 15;
            effects = { "skills.art": 4 * Game.skillBonus, happy: 5 };
            break;

          case "watch_tv":
            cost = 10;
            effects = { happy: 10, intel: -1 };
            break;

          case "make_friend":
            cost = 20;
            effects = { "skills.communication": 5 * Game.skillBonus, happy: 8 };
            if (Math.random() > 0.7) addFriend();
            break;

          case "play_outside":
            cost = 20;
            effects = {
              health: 5,
              happy: 10,
              "skills.charm": 2 * Game.skillBonus,
            };
            break;

          case "learn_music":
            if (Game.money < 5000) return alert("ğŸ’¸ é›¶ç”¨éŒ¢ä¸å¤ ï¼");
            cost = 25;
            effects = {
              money: -5000,
              "skills.art": 5 * Game.skillBonus,
              happy: 5,
            };
            break;

          // ===== å…’ç«¥æœŸ (6-12æ­²) =====
          case "study_hard":
            cost = 30;
            effects = { intel: 5 * Game.learnBonus, happy: -3 };
            break;

          case "cram_school":
            if (Game.money < 2000) return alert("ğŸ’¸ è£œç¿’è²»ä¸å¤ ï¼");
            cost = 25;
            effects = { intel: 8 * Game.learnBonus, money: -2000, happy: -5 };
            break;
          case "attend_class":
            cost = 30;
            effects = { intel: 3 * Game.learnBonus, happy: -5 };
            if (Game.isStudying) {
              studyProgress();
            }
            break;

          case "go_to_school":
            cost = 25;
            effects = {
              intel: 4 * Game.learnBonus,
              "skills.communication": 3 * Game.skillBonus,
            };
            if (Game.isStudying) {
              studyProgress();
            }
            break;

          case "sports":
            cost = 20;
            effects = {
              health: 5,
              happy: 5,
              "skills.charm": 2 * Game.skillBonus,
            };
            break;

          case "play_game":
            cost = 15;
            effects = { happy: 12, intel: -2 };
            break;

          case "help_parent":
            cost = 20;
            effects = { happy: 5, "skills.communication": 3 * Game.skillBonus };
            Game.relationships.forEach((r) => {
              if (r.type === "parent")
                r.relation = Math.min(100, r.relation + 5);
            });
            break;

          case "read_book":
            cost = 25;
            effects = {
              intel: 4 * Game.learnBonus,
              "skills.communication": 2 * Game.skillBonus,
              happy: 3,
            };
            break;

          // ===== é’å°‘å¹´æœŸ (13-17æ­²) =====
          case "exam_prep":
            cost = 35;
            effects = { intel: 10 * Game.learnBonus, happy: -8 };
            break;

          case "club":
            cost = 20;
            effects = {
              "skills.communication": 5 * Game.skillBonus,
              "skills.charm": 3 * Game.skillBonus,
              happy: 10,
            };
            break;

          case "date_crush":
            if (Game.money < 500) return alert("ğŸ’¸ ç´„æœƒç¶“è²»ä¸è¶³ï¼");
            cost = 25;
            effects = {
              money: -500,
              happy: 15,
              "skills.charm": 5 * Game.skillBonus,
            };
            break;

          case "rebel":
            cost = 15;
            effects = { happy: 8, intel: -3 };
            Game.relationships.forEach((r) => {
              if (r.type === "parent") r.relation -= 5;
            });
            break;

          case "part_time":
            cost = 30;
            const partTimeSalary = Math.floor(10000 + Math.random() * 5000);
            effects = {
              money: partTimeSalary,
              happy: -5,
              "skills.communication": 3 * Game.skillBonus,
            };
            break;

          case "learn_code":
            cost = 35;
            effects = {
              intel: 5 * Game.learnBonus,
              "skills.programming": 8 * Game.skillBonus,
              happy: -5,
            };
            break;

          // ===== æˆå¹´æœŸ (18+æ­²) =====
          case "work":
            cost = 35;
            const job = JOBS.find((j) => j.id === Game.jobId);
            if (job && job.salary > 0) {
              const salary = Math.floor(
                job.salary * Game.incomeBonus * Game.workPenalty,
              );
              effects = { money: salary, happy: -5, health: -3 };
              if (job.effect) job.effect(Game);
              Game.jobYears++;
            } else {
              effects = { happy: -10 };
            }
            break;

          case "study_skill":
            if (Game.money < 3000) return alert("ğŸ’¸ å­¸è²»ä¸å¤ ï¼");
            cost = 25;
            const skillKeys = Object.keys(Game.skills);
            const randomSkill =
              skillKeys[Math.floor(Math.random() * skillKeys.length)];
            effects = { money: -3000, intel: 3 * Game.learnBonus };
            effects[`skills.${randomSkill}`] =
              8 * Game.learnBonus * Game.skillBonus;
            break;

          case "socialize":
            if (Game.money < 2000) return alert("ğŸ’¸ ç¤¾äº¤ç¶“è²»ä¸è¶³ï¼");
            cost = 20;
            effects = {
              money: -2000,
              happy: 10,
              "skills.communication": 5 * Game.skillBonus,
              "skills.charm": 3 * Game.skillBonus,
            };
            if (Math.random() > 0.6) addFriend();
            break;

          case "relax":
            if (Game.money < 1000) return alert("ğŸ’¸ å¨›æ¨‚ç¶“è²»ä¸è¶³ï¼");
            cost = 15;
            effects = { money: -1000, happy: 15 };
            break;

          case "invest":
            if (Game.money < 10000)
              return alert("ğŸ’¸ è³‡é‡‘ä¸è¶³ï¼è‡³å°‘éœ€è¦ $10,000");
            cost = 20;
            const investReturn =
              Math.random() > 0.5
                ? Math.floor(10000 * (1 + Math.random() * 0.3))
                : Math.floor(10000 * (1 - Math.random() * 0.2));
            const profit = investReturn - 10000;
            effects = {
              money: profit,
              "skills.finance": 5 * Game.skillBonus,
              happy: profit > 0 ? 10 : -15,
            };
            break;

          case "exercise":
            if (Game.money < 1500) return alert("ğŸ’¸ å¥èº«æˆ¿æœƒè²»ä¸å¤ ï¼");
            cost = 25;
            effects = {
              money: -1500,
              health: 8,
              "skills.charm": 3 * Game.skillBonus,
              happy: 5,
            };
            break;

          case "volunteer":
            cost = 30;
            effects = {
              happy: 15,
              "skills.communication": 5 * Game.skillBonus,
              "skills.charm": 3 * Game.skillBonus,
            };
            break;

          case "travel":
            if (Game.money < 20000) return alert("ğŸ’¸ æ—…éŠç¶“è²»ä¸è¶³ï¼");
            cost = 30;
            effects = {
              money: -20000,
              happy: 25,
              intel: 3,
              "skills.communication": 3 * Game.skillBonus,
            };
            break;

          default:
            return alert("âš ï¸ æœªçŸ¥çš„è¡Œå‹•");
        }

        // æª¢æŸ¥é«”åŠ›
        if (Game.stamina < cost) {
          return alert("âš¡ é«”åŠ›ä¸è¶³ï¼");
        }

        Game.stamina -= cost;
        Game.totalActions++;

        // è¨˜éŒ„è®ŠåŒ–
        const changes = [];
        const actionName = getActionName(type);

        Object.keys(effects).forEach((key) => {
          if (key.startsWith("skills.")) {
            const skillName = key.split(".")[1];
            const oldVal = Game.skills[skillName];
            Game.skills[skillName] = Math.max(
              0,
              Game.skills[skillName] + effects[key],
            );
            const change = Game.skills[skillName] - oldVal;
            if (change !== 0) {
              const skillNames = {
                programming: "ç¨‹å¼",
                art: "è—è¡“",
                medical: "é†«ç™‚",
                cooking: "çƒ¹é£ª",
                finance: "ç†è²¡",
                communication: "æºé€š",
                charm: "é­…åŠ›",
              };
              changes.push(
                `${skillNames[skillName]} ${change > 0 ? "+" : ""}${Math.floor(change)}`,
              );
            }
          } else {
            const oldVal = Game[key];
            Game[key] = Game[key] + effects[key];
            const change = Game[key] - oldVal;
            if (change !== 0) {
              const labels = {
                money: "ğŸ’°",
                health: "â¤ï¸",
                happy: "ğŸ˜Š",
                intel: "ğŸ§ ",
                stamina: "âš¡",
                charm: "ğŸ’«",
              };
              const label = labels[key] || key;
              if (key === "money") {
                changes.push(
                  `${label} ${change > 0 ? "+$" : "-$"}${Math.abs(change).toLocaleString()}`,
                );
              } else {
                changes.push(
                  `${label} ${change > 0 ? "+" : ""}${Math.floor(change)}`,
                );
              }
            }
          }
        });

        updateUI();

        // è¨˜éŒ„åˆ°äººç”Ÿå‹•æ…‹ï¼ˆå¸¶è®ŠåŒ–ï¼‰
        if (actionName) {
          log(actionName, changes);
        }

        // é¡¯ç¤ºå½ˆå‡ºè®ŠåŒ–æç¤º
        if (changes.length > 0) {
          showChanges(changes);
        }
      }

      function nextYear() {
        if (Game.health <= 0) {
          showEnding();
          return;
        }

        Game.age++;
        Game.stamina = 100;
        // è‡ªå‹•å‡å­¸æª¢æŸ¥
        if (Game.age === 3 && Game.education === "none") {
          const school =
            TAIWAN_SCHOOLS.kindergarten[
              Math.floor(Math.random() * TAIWAN_SCHOOLS.kindergarten.length)
            ];
          Game.education = "kindergarten";
          Game.currentSchool = school;
          log(`ğŸ’ é€²å…¥ ${school}`);
        }

        if (Game.age === 6 && Game.education === "kindergarten") {
          const school =
            TAIWAN_SCHOOLS.elementary[
              Math.floor(Math.random() * TAIWAN_SCHOOLS.elementary.length)
            ];
          Game.education = "elementary";
          Game.currentSchool = school;
          log(`ğŸ“š å°±è®€ ${school}`);

          // å…¥å­¸æ™‚èªè­˜æ–°åŒå­¸
          addNPC("classmate");
        }

        if (Game.age === 13 && Game.education === "elementary") {
          const school =
            TAIWAN_SCHOOLS.middle[
              Math.floor(Math.random() * TAIWAN_SCHOOLS.middle.length)
            ];
          Game.education = "middle";
          Game.currentSchool = school;
          log(`ğŸ“ å°±è®€ ${school}`);

          // å…¥å­¸æ™‚èªè­˜æ–°åŒå­¸
          addNPC("classmate");
        }

        if (Game.age === 16 && Game.education === "middle") {
          // æ ¹æ“šæ™ºåŠ›åˆ†é…é«˜ä¸­
          const availableHighSchools = TAIWAN_SCHOOLS.high.filter(
            (s) => Game.intel >= s.requirement,
          );

          if (availableHighSchools.length > 0) {
            // é¸æ“‡ç¬¦åˆæ¢ä»¶ä¸­æœ€å¥½çš„å­¸æ ¡
            availableHighSchools.sort((a, b) => b.requirement - a.requirement);
            const school = availableHighSchools[0];

            Game.education = "high";
            Game.currentSchool = school.name;

            if (school.prestige === "top") {
              log(`ğŸ† è€ƒä¸Šé ‚å°–é«˜ä¸­ï¼š${school.name}ï¼`);
              Game.intel += 5;
            } else if (school.prestige === "good") {
              log(`ğŸ“ è€ƒä¸Š ${school.name}`);
              Game.intel += 3;
            } else {
              log(`ğŸ“ å°±è®€ ${school.name}`);
            }

            // å…¥å­¸æ™‚èªè­˜æ–°åŒå­¸
            addNPC("classmate");
          } else {
            log("âš ï¸ åœ‹ä¸­ç•¢æ¥­ï¼Œæ™ºåŠ›ä¸è¶³ç„¡æ³•è€ƒä¸Šé«˜ä¸­");
          }
        }

        if (Game.age === 19 && Game.education === "high") {
          // æ ¹æ“šæ™ºåŠ›åˆ†é…å¤§å­¸
          const availableUniversities = TAIWAN_SCHOOLS.university.filter(
            (u) => Game.intel >= u.requirement,
          );

          if (availableUniversities.length > 0 && Game.money >= 200000) {
            availableUniversities.sort((a, b) => b.requirement - a.requirement);
            const university = availableUniversities[0];

            Game.currentSchool = university.name;

            let choices = [
              {
                text: "ä¸è®€äº†",
                action: () => {
                  log("æ±ºå®šä¸ä¸Šå¤§å­¸");
                  closeModal();
                },
              },
            ];

            MAJORS.university.forEach((major) => {
              if (!major.requirement || Game.intel >= major.requirement) {
                choices.unshift({
                  text: major.name,
                  action: () => {
                    enterEducation("university", major.id);
                    if (university.prestige === "top") {
                      Game.intel += 10;
                      log(
                        `ğŸ† è€ƒä¸Šé ‚å°–å¤§å­¸ï¼š${university.name} ${major.name}ï¼`,
                      );
                    } else {
                      log(`ğŸ“ å°±è®€ ${university.name} ${major.name}`);
                    }
                    closeModal();
                  },
                });
              }
            });

            showModal(
              "ğŸ“ å¤§å­¸éŒ„å–",
              `æ­å–œè€ƒä¸Š ${university.name}ï¼\nè«‹é¸æ“‡ç§‘ç³»`,
              choices,
            );
          } else {
            if (Game.intel < 55) {
              log("âš ï¸ æ™ºåŠ›ä¸è¶³ï¼Œç„¡æ³•è€ƒä¸Šå¤§å­¸");
            } else {
              log("âš ï¸ å­¸è²»ä¸è¶³ï¼Œç„¡æ³•ä¸Šå¤§å­¸");
            }
          }
        }
        if (Game.age >= 18 && Game.age <= 35 && Math.random() < 0.1) {
          if (
            getNPCsByType("romantic").length + getNPCsByType("lover").length ===
            0
          ) {
            addNPC("romantic");
          }
        }
        // è¨˜éŒ„å¹´åº¦è®ŠåŒ–
        const yearChanges = [];

        // è¨˜éŒ„å¹´æ”¶å…¥
        if (Game.yearlyMoney > 0) {
          yearChanges.push(`ğŸ’° +$${Game.yearlyMoney.toLocaleString()}`);
        }

        // è¨˜éŒ„è‡ªç„¶è¡°é€€
        const oldHealth = Game.health;
        const oldHappy = Game.happy;

        Game.health -= 3 * Game.healthDecay;
        Game.happy -= 2 * Game.happyDecay;

        yearChanges.push(`â¤ï¸ ${(Game.health - oldHealth).toFixed(1)}`);
        yearChanges.push(`ğŸ˜Š ${(Game.happy - oldHappy).toFixed(1)}`);

        if (Game.age > 40) {
          Game.health -= 2;
        }
        if (Game.age > 60) {
          Game.health -= 3;
        }
        if (Game.age > 80) {
          Game.health -= 5;
        }

        // æˆå¹´å¾Œæ²’æœ‰é›¶ç”¨éŒ¢
        if (Game.age >= 18) {
          Game.yearlyMoney = 0;
        }

        // å¹´æ”¶å…¥
        Game.money += Game.yearlyMoney;
        if (Game.yearlyMoney > 0) {
          log(`ğŸ“… é ˜åˆ°é›¶ç”¨éŒ¢ $${Game.yearlyMoney.toLocaleString()}`);
        }

        // å·¥ä½œæ”¶å…¥
        if (Game.jobId !== "none") {
          const job = JOBS.find((j) => j.id === Game.jobId);
          const salary = Math.floor(
            job.salary * Game.incomeBonus * Game.workPenalty * 12,
          );
          Game.money += salary;
          log(`ğŸ’¼ å¹´åº¦å·¥ä½œæ”¶å…¥ $${salary.toLocaleString()}`);
        }

        // æˆ¿ç”¢æ”¶å…¥
        const passiveIncome = Game.inventory.reduce((sum, id) => {
          const house = HOUSES.find((h) => h.id === id);
          return sum + (house ? house.passive * 12 : 0);
        }, 0);

        if (passiveIncome > 0) {
          Game.money += passiveIncome;
          log(`ğŸ  æˆ¿ç”¢å¹´æ”¶å…¥ $${passiveIncome.toLocaleString()}`);
        }

        // è² å‚µè™•ç†
        if (Game.money < 0) {
          Game.debtYears++;
          Game.hasBeenInDebt = true;

          if (Game.debtYears >= 3) {
            Game.inventory = [];
            Game.money = 0;
            Game.happy -= 50;
            log("âš ï¸ å› ç‚ºé•·æœŸè² å‚µï¼Œæ‰€æœ‰è³‡ç”¢è¢«æŸ¥å°ï¼");
            Game.debtYears = 0;
          }
        } else {
          Game.debtYears = 0;
        }

        // é†«ç™‚è²»ç”¨
        if (Game.health < 30) {
          const medicalCost = 100000;
          Game.money -= medicalCost;
          log(`ğŸ¥ å¥åº·ä¸ä½³ï¼Œæ”¯ä»˜é†«ç™‚è²» $${medicalCost.toLocaleString()}`);
        }

        // äººéš›é—œä¿‚è‡ªç„¶è¡°é€€
        Game.relationships.forEach((r) => {
          r.relation = Math.max(0, r.relation - 2);
          if (r.relation < 20 && r.type === "parent") {
            log(`ğŸ˜¢ èˆ‡ ${r.name} çš„é—œä¿‚ç–é äº†`);
          }
        });
        updateNPCRelations();
        // çµ±è¨ˆå¿«æ¨‚å¹´æ•¸
        if (Game.happy > 80) {
          Game.happyYears++;
        }

        // äººç”Ÿéšæ®µæç¤º
        if (Game.age === 6) log("ğŸ’ è©²ä¸Šå°å­¸äº†");
        if (Game.age === 13) log("ğŸ“ å‡ä¸Šåœ‹ä¸­äº†");
        if (Game.age === 18) log("ğŸ‰ æˆå¹´äº†ï¼å¯ä»¥é–‹å§‹å·¥ä½œ");

        checkAchievements();

        // å¹´é½¡é‡Œç¨‹ç¢‘
        if (Game.age === 30) log("ğŸ‚ 30æ­²äº†ï¼Œäººç”Ÿéäº†ä¸‰åˆ†ä¹‹ä¸€");
        if (Game.age === 40) log("ğŸ‚ 40æ­²äº†ï¼Œé‚å…¥ä¸­å¹´");
        if (Game.age === 50) log("ğŸ‚ 50æ­²ï¼ŒåŠç™¾äººç”Ÿ");
        if (Game.age === 60) log("ğŸ‚ 60æ­²ï¼Œé€€ä¼‘å¹´é½¡");
        if (Game.age === 70) log("ğŸ‚ 70æ­²ï¼Œå¤ç¨€ä¹‹å¹´");
        if (Game.age === 80) log("ğŸ‚ 80æ­²ï¼Œé«˜å£½ï¼");
        if (Game.age === 90) log("ğŸ‚ 90æ­²ï¼Œäººç‘ï¼");
        if (Game.age === 100) log("ğŸ‚ 100æ­²ï¼Œç™¾æ­²äººç‘ï¼");

        // è¨˜éŒ„å¹´é½¡è®ŠåŒ–åˆ° logï¼ˆå¸¶æ•¸å€¼è®ŠåŒ–ï¼‰
        log(`ğŸ“… éäº†ä¸€å¹´ï¼Œä½  ${Game.age} æ­²äº†`, yearChanges);

        // éš¨æ©Ÿäº‹ä»¶
        if (Math.random() < 0.15) {
          triggerOriginEvent();
        }

        if (Math.random() < 0.25) {
          triggerRandomEvent();
        }

        // æ­»äº¡åˆ¤å®š
        if (Game.health <= 0) {
          Game.health = 0;
          log("ğŸ’€ ä½ çš„å¥åº·æ­¸é›¶äº†...");
          showEnding();
          return;
        }

        checkAchievements();
        updateUI();
        renderSocial();
        renderStats();
      }

      // æ–°å¢å‡½æ•¸
      function triggerOriginEvent() {
        const originEvents = {
          rich: [
            {
              title: "ğŸ¢ å®¶æ—ä¼æ¥­å±æ©Ÿ",
              desc: "çˆ¶è¦ªå…¬å¸é­æƒ¡æ„æ”¶è³¼",
              choices: [
                {
                  txt: "æŠ•è³‡500è¬æ•‘å…¬å¸",
                  cost: 5000000,
                  effect: (g) => {
                    if (g.money >= 5000000) {
                      g.money -= 5000000;
                      g.money += 10000000;
                      return "æˆåŠŸæ‹¯æ•‘ï¼Œè³ºå›1000è¬";
                    }
                    return "è³‡é‡‘ä¸è¶³";
                  },
                },
                {
                  txt: "è¢–æ‰‹æ—è§€",
                  effect: (g) => {
                    g.yearlyMoney = 0;
                    g.happy -= 20;
                    return "å®¶æ—ä¼æ¥­å€’é–‰";
                  },
                },
              ],
            },
            {
              title: "ğŸ’ ç¹¼æ‰¿éºç”¢",
              desc: "é æˆ¿è¦ªæˆšç•™ä¸‹éºç”¢",
              effect: (g) => {
                g.money += 3000000;
                return "ç²å¾—300è¬éºç”¢";
              },
            },
          ],
          genius: [
            {
              title: "ğŸ“ çå­¸é‡‘æ©Ÿæœƒ",
              desc: "é ‚å°–å¤§å­¸æä¾›å…¨é¡çå­¸é‡‘",
              effect: (g) => {
                g.intel += 20;
                g.money += 500000;
                return "æ™ºåŠ›+20 ä¸¦ç²å¾—50è¬çå­¸é‡‘";
              },
            },
          ],
          mafia: [
            {
              title: "ğŸ—¡ï¸ å¹«æ´¾é¬¥çˆ­",
              desc: "æ•µå°å¹«æ´¾æ‰¾ä¸Šé–€ä¾†",
              choices: [
                {
                  txt: "æ­£é¢å°æ±º",
                  effect: (g) => {
                    if (Math.random() > 0.5) {
                      g.money += 1000000;
                      g.health -= 20;
                      return "æ‰“è´äº†ï¼Œæ¶åˆ°100è¬";
                    } else {
                      g.health -= 40;
                      g.money -= 500000;
                      return "é‡å‚·ä½é™¢";
                    }
                  },
                },
                {
                  txt: "è«‡åˆ¤å’Œè§£",
                  effect: (g) => {
                    g.money -= 300000;
                    g.skills.communication += 10;
                    return "èŠ±30è¬æ“ºå¹³";
                  },
                },
              ],
            },
          ],
          hacker: [
            {
              title: "ğŸ’» æš—ç¶²å§”è¨—",
              desc: "æ”¶åˆ°é«˜é¡é§­å®¢ä»»å‹™å§”è¨—",
              choices: [
                {
                  txt: "æ¥å—ä»»å‹™",
                  effect: (g) => {
                    if (g.skills.programming > 80) {
                      g.money += 2000000;
                      return "ä»»å‹™æˆåŠŸï¼Œè³º200è¬";
                    } else {
                      g.happy -= 15;
                      return "æŠ€è¡“ä¸è¶³ï¼Œå¤±æ•—";
                    }
                  },
                },
                {
                  txt: "æ‹’çµ•",
                  effect: (g) => {
                    g.happy += 5;
                    return "ä¿æŒé“å¾·åº•ç·š";
                  },
                },
              ],
            },
          ],
          royal: [
            {
              title: "ğŸ‘‘ çš‡å®¤å¬è¦‹",
              desc: "é æˆ¿çš‡å®¤è¦ªæˆšé‚€è«‹åƒåŠ å®´æœƒ",
              effect: (g) => {
                g.skills.charm += 15;
                g.money += 500000;
                return "ç¤¾äº¤åœˆå¤§å¢";
              },
            },
          ],
          monk: [
            {
              title: "ğŸ™ é “æ‚Ÿæ™‚åˆ»",
              desc: "ä¿®è¡Œæ™‚çªç„¶é–‹æ‚Ÿ",
              effect: (g) => {
                g.happy += 30;
                g.intel += 10;
                g.health += 15;
                return "èº«å¿ƒéˆæå‡";
              },
            },
          ],
          esports: [
            {
              title: "ğŸ® æˆ°éšŠé‚€è«‹",
              desc: "è·æ¥­æˆ°éšŠæƒ³ç°½ç´„ä½ ",
              choices: [
                {
                  txt: "ç°½ç´„",
                  effect: (g) => {
                    g.jobId = "esports_player";
                    g.money += 800000;
                    return "æˆç‚ºè·æ¥­é¸æ‰‹";
                  },
                },
                {
                  txt: "æ‹’çµ•",
                  effect: (g) => {
                    return "å°ˆæ³¨æœ¬æ¥­";
                  },
                },
              ],
            },
          ],
          spy: [
            {
              title: "ğŸ•µï¸ æ©Ÿå¯†ä»»å‹™",
              desc: "çˆ¶è¦ªå¸Œæœ›ä½ å”åŠ©æƒ…å ±å·¥ä½œ",
              effect: (g) => {
                if (g.intel > 90) {
                  g.money += 1500000;
                  g.health -= 10;
                  return "ä»»å‹™æˆåŠŸä½†æœ‰é¢¨éšª";
                } else {
                  g.happy -= 10;
                  return "èƒ½åŠ›ä¸è¶³";
                }
              },
            },
          ],
        };

        const originId = Game.originId;
        const events = originEvents[originId];

        if (events && events.length > 0) {
          const event = events[Math.floor(Math.random() * events.length)];

          if (event.choices) {
            showOriginEventModal(event);
          } else if (event.effect) {
            const result = event.effect(Game);
            log(`ğŸ­ ã€${Game.origin}å°ˆå±¬ã€‘${event.title}ï¼š${result}`);
            Game.totalEvents++;
          }
        }
      }

      function showOriginEventModal(event) {
        document.getElementById("ev-title").textContent =
          `ã€${Game.origin}ã€‘${event.title}`;
        document.getElementById("ev-desc").textContent = event.desc;

        const btnA = document.getElementById("btn-choice-a");
        const btnB = document.getElementById("btn-choice-b");

        btnA.textContent = event.choices[0].txt;
        btnB.textContent = event.choices[1].txt;

        btnA.onclick = () => {
          const result = event.choices[0].effect(Game);
          log(`   â””â”€ é¸æ“‡ï¼š${event.choices[0].txt} â†’ ${result}`);
          closeModal();
          updateUI();
        };

        btnB.onclick = () => {
          const result = event.choices[1].effect(Game);
          log(`   â””â”€ é¸æ“‡ï¼š${event.choices[1].txt} â†’ ${result}`);
          closeModal();
          updateUI();
        };

        document.getElementById("event-modal").style.display = "flex";
      }

      // ==========================================
      // ğŸ”´ éš¨æ©Ÿäº‹ä»¶ç³»çµ±
      // ==========================================

      function triggerRandomEvent() {
        const RANDOM_EVENTS = [
          // === ğŸ’° é‡‘éŒ¢äº‹ä»¶ ===
          {
            title: "ğŸ’° è·¯ä¸Šæ’¿åˆ°éŒ¢",
            desc: "èµ°è·¯æ™‚åœ¨åœ°ä¸Šç™¼ç¾ä¸€å€‹éŒ¢åŒ…",
            choices: [
              {
                text: "é€äº¤è­¦å¯Ÿå±€",
                effect: (g) => {
                  g.happy += 10;
                  return "åšäº†å¥½äº‹å¿ƒæƒ…å¾ˆå¥½";
                },
              },
              {
                text: "æ‹¿èµ°ç¾é‡‘",
                effect: (g) => {
                  const money = Math.floor(Math.random() * 50000) + 10000;
                  g.money += money;
                  g.happy -= 5;
                  return `æ‹¿åˆ° $${money.toLocaleString()}ï¼Œä½†æœ‰é»å¿ƒè™›`;
                },
              },
            ],
          },
          {
            title: "ğŸ° æœ‹å‹é‚€ä½ æŠ•è³‡",
            desc: "æœ‹å‹èªªæœ‰å€‹ç©©è³ºä¸è³ çš„æŠ•è³‡æ©Ÿæœƒ",
            choices: [
              {
                text: "æŠ•è³‡ $50,000",
                effect: (g) => {
                  if (g.money < 50000) return "éŒ¢ä¸å¤ ";
                  g.money -= 50000;
                  if (Math.random() > 0.5) {
                    g.money += 100000;
                    return "ğŸ‰ è³ºäº† $50,000ï¼";
                  } else {
                    return "ğŸ˜¢ è¡€æœ¬ç„¡æ­¸...";
                  }
                },
              },
              {
                text: "æ‹’çµ•",
                effect: (g) => {
                  return "ä¿ä½äº†éŒ¢åŒ…";
                },
              },
            ],
          },
          {
            title: "ğŸ† ä¸­çäº†",
            desc: "ç™¼ç¥¨å°ä¸­çè™Ÿ",
            effect: (g) => {
              const prizes = [200, 1000, 10000, 200000, 10000000];
              const prize = prizes[Math.floor(Math.random() * prizes.length)];
              g.money += prize;
              g.happy += 20;
              return `ä¸­äº† $${prize.toLocaleString()}ï¼`;
            },
          },

          // === â¤ï¸ å¥åº·äº‹ä»¶ ===
          {
            title: "ğŸ¤’ æ„Ÿå†’äº†",
            desc: "èº«é«”ä¸èˆ’æœ",
            effect: (g) => {
              g.health -= 10;
              g.money -= 1000;
              return "çœ‹é†«ç”ŸèŠ±äº† $1,000";
            },
          },
          {
            title: "ğŸƒ åƒåŠ è·¯è·‘",
            desc: "æœ‹å‹é‚€ä½ åƒåŠ é¦¬æ‹‰æ¾",
            choices: [
              {
                text: "åƒåŠ ",
                effect: (g) => {
                  g.health += 15;
                  g.happy += 10;
                  g.stamina -= 30;
                  return "å®Œæˆæ¯”è³½ï¼èº«é«”æ›´å¥åº·äº†";
                },
              },
              {
                text: "æ‹’çµ•",
                effect: (g) => {
                  return "å¾…åœ¨å®¶è£¡ä¼‘æ¯";
                },
              },
            ],
          },
          {
            title: "ğŸ’Š ç™¼ç¾ä¿å¥é£Ÿå“",
            desc: "è—¥å±€æ¨è–¦ä¿å¥é£Ÿå“",
            choices: [
              {
                text: "è³¼è²· ($5,000)",
                effect: (g) => {
                  g.money -= 5000;
                  g.health += 10;
                  g.healthDecay *= 0.9;
                  return "é•·æœŸæœç”¨æ”¹å–„äº†å¥åº·";
                },
              },
              {
                text: "ä¸è²·",
                effect: (g) => {
                  return "çœä¸‹ä¸€ç­†éŒ¢";
                },
              },
            ],
          },

          // === ğŸ˜Š å¿«æ¨‚äº‹ä»¶ ===
          {
            title: "ğŸ® æ–°éŠæˆ²ç™¼å”®",
            desc: "æœŸå¾…å·²ä¹…çš„éŠæˆ²çµ‚æ–¼ä¸Šå¸‚äº†",
            choices: [
              {
                text: "è³¼è²· ($2,000)",
                effect: (g) => {
                  g.money -= 2000;
                  g.happy += 25;
                  return "ç©å¾—è¶…é–‹å¿ƒï¼";
                },
              },
              {
                text: "å¿ä½ä¸è²·",
                effect: (g) => {
                  g.happy -= 10;
                  return "å¥½æƒ³ç©...";
                },
              },
            ],
          },
          {
            title: "ğŸ¬ æœ‹å‹ç´„çœ‹é›»å½±",
            desc: "æœ‹å‹é‚€ä½ å»çœ‹æœ€æ–°é›»å½±",
            choices: [
              {
                text: "ä¸€èµ·å» ($500)",
                effect: (g) => {
                  g.money -= 500;
                  g.happy += 15;
                  g.skills.communication += 2;
                  return "åº¦éæ„‰å¿«çš„æ™‚å…‰";
                },
              },
              {
                text: "å©‰æ‹’",
                effect: (g) => {
                  return "åœ¨å®¶ä¼‘æ¯";
                },
              },
            ],
          },
          {
            title: "ğŸ‰ ç”Ÿæ—¥æ´¾å°",
            desc: "ä»Šå¤©æ˜¯ä½ çš„ç”Ÿæ—¥",
            effect: (g) => {
              const gifts = Math.floor(Math.random() * 20000) + 5000;
              g.money += gifts;
              g.happy += 30;
              return `æ”¶åˆ° $${gifts.toLocaleString()} çš„ç´…åŒ…ï¼`;
            },
          },

          // === ğŸ§  å­¸ç¿’äº‹ä»¶ ===
          {
            title: "ğŸ“š ç™¼ç¾å¥½æ›¸",
            desc: "åœ¨æ›¸åº—ç™¼ç¾ä¸€æœ¬å¥½æ›¸",
            choices: [
              {
                text: "è³¼è²· ($800)",
                effect: (g) => {
                  g.money -= 800;
                  g.intel += 5;
                  g.happy += 10;
                  return "ç²å¾—äº†æ–°çŸ¥è­˜";
                },
              },
              {
                text: "ä¸è²·",
                effect: (g) => {
                  return "æ”¹å¤©å†èªª";
                },
              },
            ],
          },
          {
            title: "ğŸ’» ç·šä¸Šèª²ç¨‹å„ªæƒ ",
            desc: "çœ‹åˆ°æœ‰èˆˆè¶£çš„ç·šä¸Šèª²ç¨‹æ‰“æŠ˜",
            choices: [
              {
                text: "è³¼è²· ($3,000)",
                effect: (g) => {
                  g.money -= 3000;
                  g.intel += 8;
                  const skills = [
                    "programming",
                    "art",
                    "finance",
                    "communication",
                  ];
                  const skill =
                    skills[Math.floor(Math.random() * skills.length)];
                  g.skills[skill] += 15;
                  return `å­¸åˆ°æ–°æŠ€èƒ½ï¼`;
                },
              },
              {
                text: "æ”¾æ£„",
                effect: (g) => {
                  return "çœä¸‹éŒ¢";
                },
              },
            ],
          },

          // === ğŸ‘¥ ç¤¾äº¤äº‹ä»¶ ===
          {
            title: "ğŸ­ ç¤¾äº¤èšæœƒ",
            desc: "è¢«é‚€è«‹åƒåŠ èšæœƒ",
            choices: [
              {
                text: "åƒåŠ  ($1,500)",
                effect: (g) => {
                  g.money -= 1500;
                  g.happy += 15;
                  g.skills.charm += 5;
                  g.skills.communication += 5;
                  if (Math.random() > 0.6) {
                    addFriend();
                    return "èªè­˜äº†æ–°æœ‹å‹ï¼";
                  }
                  return "åº¦éæ„‰å¿«çš„å¤œæ™š";
                },
              },
              {
                text: "ä¸å»",
                effect: (g) => {
                  return "å®…åœ¨å®¶è£¡";
                },
              },
            ],
          },
          {
            title: "ğŸ’¼ äººè„ˆä»‹ç´¹",
            desc: "æœ‹å‹ä»‹ç´¹é‡è¦äººå£«çµ¦ä½ èªè­˜",
            effect: (g) => {
              g.skills.communication += 10;
              g.skills.charm += 5;
              addFriend();
              return "å»ºç«‹äº†æœ‰ç”¨çš„äººè„ˆ";
            },
          },

          // === âš ï¸ å±æ©Ÿäº‹ä»¶ ===
          {
            title: "ğŸš— è»Šç¦",
            desc: "ä¸å°å¿ƒç™¼ç”Ÿè»Šç¦",
            effect: (g) => {
              g.health -= 20;
              g.money -= 30000;
              g.happy -= 15;
              return "å—å‚·ä½é™¢ï¼ŒèŠ±äº† $30,000";
            },
          },
          {
            title: "ğŸ“± æ‰‹æ©Ÿå£äº†",
            desc: "æ‰‹æ©Ÿæ‘”å£äº†",
            choices: [
              {
                text: "è²·æ–°çš„ ($20,000)",
                effect: (g) => {
                  g.money -= 20000;
                  g.happy += 5;
                  return "æ›äº†æ–°æ‰‹æ©Ÿ";
                },
              },
              {
                text: "ä¿®ç† ($3,000)",
                effect: (g) => {
                  g.money -= 3000;
                  return "ä¿®å¥½äº†";
                },
              },
              {
                text: "æ¹Šåˆè‘—ç”¨",
                effect: (g) => {
                  g.happy -= 10;
                  return "ç”¨å¾—å¾ˆä¸æ–¹ä¾¿...";
                },
              },
            ],
          },
          {
            title: "ğŸ  æˆ¿æ±æ¼²ç§Ÿ",
            desc: "æˆ¿æ±èªªè¦æ¼²æˆ¿ç§Ÿ",
            choices: [
              {
                text: "æ¥å—",
                effect: (g) => {
                  g.yearlyMoney -= 12000;
                  return "æ¯æœˆå¤šä»˜ $1,000";
                },
              },
              {
                text: "æ¬å®¶",
                effect: (g) => {
                  g.money -= 10000;
                  g.stamina -= 20;
                  return "æ¬å®¶èŠ±äº† $10,000";
                },
              },
            ],
          },

          // === ğŸ é©šå–œäº‹ä»¶ ===
          {
            title: "ğŸ° åˆ®åˆ®æ¨‚",
            desc: "è·¯éè²·äº†åˆ®åˆ®æ¨‚",
            effect: (g) => {
              g.money -= 100;
              if (Math.random() > 0.8) {
                const prize = Math.floor(Math.random() * 100000) + 1000;
                g.money += prize;
                g.happy += 30;
                return `ä¸­äº† $${prize.toLocaleString()}ï¼`;
              }
              return "æ²’ä¸­ç";
            },
          },
          {
            title: "ğŸ“¦ ç¶²è³¼é©šå–œ",
            desc: "æ”¶åˆ°æ„å¤–çš„åŒ…è£¹",
            effect: (g) => {
              g.happy += 20;
              return "åŸä¾†æ˜¯ä¹‹å‰è²·çš„æ±è¥¿åˆ°äº†ï¼";
            },
          },
          {
            title: "â˜€ï¸ å¥½å¤©æ°£",
            desc: "ä»Šå¤©å¤©æ°£ç‰¹åˆ¥å¥½",
            effect: (g) => {
              g.happy += 10;
              g.health += 5;
              return "å¿ƒæƒ…æ„‰å¿«ï¼";
            },
          },

          // === ğŸ’¼ å·¥ä½œäº‹ä»¶ ===
          {
            title: "ğŸ’° å¹´çµ‚çé‡‘",
            desc: "å…¬å¸ç™¼å¹´çµ‚çé‡‘",
            effect: (g) => {
              if (g.jobId === "none") return "ä½ æ²’æœ‰å·¥ä½œ";
              const bonus = Math.floor(Math.random() * 100000) + 50000;
              g.money += bonus;
              g.happy += 25;
              return `é ˜åˆ° $${bonus.toLocaleString()} å¹´çµ‚ï¼`;
            },
          },
          {
            title: "ğŸ“ˆ å‡è·æ©Ÿæœƒ",
            desc: "è€é—†æå‡ºå‡è·",
            effect: (g) => {
              if (g.jobId === "none") return "ä½ æ²’æœ‰å·¥ä½œ";
              g.incomeBonus *= 1.2;
              g.happy += 20;
              return "è–ªæ°´å¢åŠ  20%ï¼";
            },
          },
          {
            title: "ğŸ˜° å·¥ä½œå£“åŠ›",
            desc: "æœ€è¿‘å·¥ä½œå£“åŠ›å¾ˆå¤§",
            choices: [
              {
                text: "å’¬ç‰™æ’é",
                effect: (g) => {
                  g.health -= 15;
                  g.happy -= 20;
                  g.money += 30000;
                  return "è³ºäº†åŠ ç­è²»ä½†å¾ˆç´¯";
                },
              },
              {
                text: "è«‹å‡ä¼‘æ¯",
                effect: (g) => {
                  g.money -= 10000;
                  g.health += 10;
                  g.happy += 15;
                  return "èº«å¿ƒç²å¾—ä¼‘æ¯";
                },
              },
            ],
          },
        ];

        // éš¨æ©Ÿé¸æ“‡äº‹ä»¶
        const event =
          RANDOM_EVENTS[Math.floor(Math.random() * RANDOM_EVENTS.length)];

        if (event.choices) {
          showEventModal(event);
        } else if (event.effect) {
          const result = event.effect(Game);
          log(`${event.title}ï¼š${event.desc} - ${result}`);
        }

        Game.totalEvents++;
        updateUI();
      }

      function showEnding() {
        let endingType = "å¹³å‡¡äººç”Ÿ";
        let endingIcon = "ğŸ’€";
        let endingDesc = "ä½ çš„äººç”Ÿæ—…ç¨‹çµæŸäº†ã€‚";

        if (Game.money >= 100000000) {
          endingType = "å„„è¬å¯Œç¿çµå±€";
          endingIcon = "ğŸ‘‘";
          endingDesc = "ä½ æˆç‚ºå„„è¬å¯Œç¿ï¼Œé”åˆ°è²¡å¯Œå·”å³°ï¼äººç”Ÿè´å®¶ï¼";
        } else if (Game.money >= 10000000) {
          endingType = "æˆåŠŸäººå£«çµå±€";
          endingIcon = "ğŸ’¼";
          endingDesc = "ä½ æˆç‚ºåƒè¬å¯Œè±ªï¼Œéä¸Šäº†å¯Œè£•çš„ç”Ÿæ´»ã€‚";
        } else if (Game.age >= 100) {
          endingType = "é•·å£½å‚³å¥‡çµå±€";
          endingIcon = "ğŸŠ";
          endingDesc = "ä½ æ´»åˆ°ç™¾æ­²é«˜é½¡ï¼Œè¦‹è­‰äº†æ™‚ä»£è®Šé·ï¼Œäººç”Ÿåœ“æ»¿ï¼";
        } else if (Game.age >= 80 && Game.happy > 70) {
          endingType = "å¹¸ç¦äººç”Ÿçµå±€";
          endingIcon = "ğŸ˜Š";
          endingDesc = "ä½ åº¦éäº†æ¼«é•·è€Œå¹¸ç¦çš„ä¸€ç”Ÿï¼Œå……æ»¿ç¾å¥½å›æ†¶ã€‚";
        } else if (Game.intel >= 150) {
          endingType = "æ™ºè€…çµå±€";
          endingIcon = "ğŸ§ ";
          endingDesc = "ä½ æ“æœ‰è¶…å‡¡çš„æ™ºæ…§ï¼Œç‚ºä¸–ç•Œå¸¶ä¾†è²¢ç»ã€‚";
        } else if (Game.skills.charm >= 120) {
          endingType = "é­…åŠ›ä¹‹æ˜Ÿçµå±€";
          endingIcon = "âœ¨";
          endingDesc = "ä½ çš„é­…åŠ›ç„¡äººèƒ½åŠï¼Œæˆç‚ºçœ¾äººä»°æ…•çš„å°è±¡ã€‚";
        } else if (Game.money < 0) {
          endingType = "ç ´ç”¢çµå±€";
          endingIcon = "ğŸ’¸";
          endingDesc = "ä½ è² å‚µç´¯ç´¯ï¼Œåœ¨è²§å›°ä¸­åº¦éé¤˜ç”Ÿ...";
        } else if (Game.happy < 30) {
          endingType = "æ†‚é¬±çµå±€";
          endingIcon = "â˜ï¸";
          endingDesc = "ä½ ä¸€ç”Ÿéƒ½æ´»åœ¨é™°éœ¾ä¹‹ä¸‹ï¼Œæœªèƒ½æ‰¾åˆ°çœŸæ­£çš„å¿«æ¨‚...";
        } else if (Game.age < 30) {
          endingType = "æ—©é€çµå±€";
          endingIcon = "ğŸ•Šï¸";
          endingDesc = "ä½ çš„äººç”Ÿéæ–¼çŸ­æš«ï¼Œæœªèƒ½å®Œæˆæ›´å¤šå¤¢æƒ³...";
        } else {
          endingType = "å¹³å‡¡äººç”Ÿçµå±€";
          endingIcon = "ğŸƒ";
          endingDesc = "ä½ éå®Œäº†å¹³å‡¡è€ŒçœŸå¯¦çš„ä¸€ç”Ÿï¼Œé€™å°±æ˜¯äººç”Ÿã€‚";
        }

        document.getElementById("ending-icon").textContent = endingIcon;
        document.getElementById("ending-title").textContent = endingType;
        document.getElementById("ending-desc").textContent = endingDesc;
        document.getElementById("ending-stats").innerHTML = `
                      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; text-align: left;">
                          <div>ğŸ‘¤ å§“å: ${Game.name}</div>
                          <div>ğŸ‚ äº«å¹´: ${Game.age}æ­²</div>
                          <div>ğŸ’° è³‡ç”¢: $${Game.money.toLocaleString()}</div>
                          <div>ğŸ§  æ™ºåŠ›: ${Math.floor(Game.intel)}</div>
                          <div>ğŸ˜Š å¿«æ¨‚: ${Math.floor(Game.happy)}</div>
                          <div>â¤ï¸ å¥åº·: ${Math.floor(Game.health)}</div>
                          <div>ğŸ’¼ è·æ¥­: ${JOBS.find((j) => j.id === Game.jobId).name}</div>
                          <div>ğŸ‘¥ é—œä¿‚: ${Game.relationships.length}äºº</div>
                          <div>ğŸ† æˆå°±: ${Game.unlockedAchievements.length}/${ACHIEVEMENTS.length}</div>
                          <div>ğŸ¯ è¡Œå‹•: ${Game.totalActions}æ¬¡</div>
                          <div>ğŸ“Š äº‹ä»¶: ${Game.totalEvents}æ¬¡</div>
                          <div>ğŸ  å‡ºèº«: ${Game.origin}</div>
                      </div>
                  `;

        document.getElementById("ending-overlay").style.display = "flex";
      }
      function unlockTrait(traitId) {
        if (Game.unlockedTraits.includes(traitId)) {
          return; // å·²ç¶“è§£é–éäº†
        }

        const trait = TRAITS.find((t) => t.id === traitId);
        if (!trait) return;

        Game.unlockedTraits.push(traitId);
        Game.traits.push(trait);
        trait.effect(Game);

        log(`âœ¨ è§£é–æ–°ç‰¹è³ªï¼š${trait.name}`);
        showModal("ğŸ‰ æ–°ç‰¹è³ªè§£é–ï¼", `${trait.name}\n${trait.desc}`, [
          { text: "å¤ªæ£’äº†ï¼", action: () => closeModal() },
        ]);

        updateUI();
      }
      // ===== ğŸ‘¥ NPC ç³»çµ±å‡½æ•¸ =====
      function generateNPC(type) {
        const templates = NPC_TEMPLATES[type];
        if (!templates || templates.length === 0) return null;

        const template =
          templates[Math.floor(Math.random() * templates.length)];
        const npc = {
          id: `npc_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
          name: template.name,
          type: type,
          personality: template.personality,
          relation: template.baseRelation,
          gender: template.gender || (Math.random() > 0.5 ? "male" : "female"),
          age: Game.age + (Math.floor(Math.random() * 6) - 3), // å¹´é½¡å·®è· -3 åˆ° +3
          metAt: Game.age,
          lastInteraction: Game.age,
        };

        return npc;
      }

      function addNPC(type) {
        const npc = generateNPC(type);
        if (!npc) return null;

        Game.npcs.push(npc);
        Game.metNPCs.push(npc.id);

        log(`ğŸ‘¤ èªè­˜äº†æ–°æœ‹å‹ï¼š${npc.name}`);
        return npc;
      }

      function getNPCsByType(type) {
        return Game.npcs.filter((npc) => npc.type === type);
      }

      function interactWithNPC(npcId, interactionType) {
        const npc = Game.npcs.find((n) => n.id === npcId);
        if (!npc) return;

        const interaction = NPC_INTERACTIONS[interactionType];
        if (!interaction) return;

        // æª¢æŸ¥é—œä¿‚éœ€æ±‚
        if (
          interaction.requireRelation &&
          npc.relation < interaction.requireRelation
        ) {
          alert(
            `âŒ é—œä¿‚ä¸å¤ å¥½ï¼Œéœ€è¦å¥½æ„Ÿåº¦ ${interaction.requireRelation} ä»¥ä¸Š`,
          );
          return;
        }

        // æª¢æŸ¥é«”åŠ›
        if (Game.stamina < interaction.cost) {
          alert("âš¡ é«”åŠ›ä¸è¶³ï¼");
          return;
        }

        // æª¢æŸ¥é‡‘éŒ¢
        if (
          interaction.moneyChange < 0 &&
          Game.money < Math.abs(interaction.moneyChange)
        ) {
          alert("ğŸ’¸ é‡‘éŒ¢ä¸è¶³ï¼");
          return;
        }

        // åŸ·è¡Œäº’å‹•
        Game.stamina -= interaction.cost;
        Game.money += interaction.moneyChange;
        npc.relation = Math.max(
          0,
          Math.min(100, npc.relation + interaction.relationChange),
        );
        npc.lastInteraction = Game.age;

        // æ ¹æ“šæ€§æ ¼èª¿æ•´é—œä¿‚è®ŠåŒ–
        let bonus = 0;
        if (npc.personality === "friendly" && interactionType === "chat")
          bonus = 3;
        if (npc.personality === "kind" && interactionType === "help") bonus = 5;
        if (npc.personality === "outgoing" && interactionType === "chat")
          bonus = 2;

        npc.relation += bonus;
        npc.relation = Math.max(0, Math.min(100, npc.relation));

        const changes = [];
        if (interaction.moneyChange !== 0) {
          changes.push(
            `ğŸ’° ${interaction.moneyChange > 0 ? "+" : ""}$${Math.abs(interaction.moneyChange).toLocaleString()}`,
          );
        }
        changes.push(
          `ğŸ’— å¥½æ„Ÿåº¦ ${interaction.relationChange > 0 ? "+" : ""}${interaction.relationChange + bonus}`,
        );

        log(`èˆ‡ ${npc.name} ${interaction.desc}`, changes);

        // æª¢æŸ¥é—œä¿‚é‡Œç¨‹ç¢‘
        if (npc.relation >= 80 && npc.type === "romantic") {
          if (Math.random() > 0.7) {
            showConfessionEvent(npc);
          }
        }

        updateUI();
        renderSocial();
      }

      function showConfessionEvent(npc) {
        showModal(
          "ğŸ’• å¿ƒå‹•æ™‚åˆ»",
          `${npc.name} ä¼¼ä¹å°ä½ æœ‰å¥½æ„Ÿ...\nè¦å‘å°æ–¹å‘Šç™½å—ï¼Ÿ`,
          [
            {
              text: "â¤ï¸ å‘Šç™½",
              action: () => {
                if (npc.relation >= 80) {
                  npc.type = "lover";
                  npc.relation = 85;
                  log(`ğŸ’• ${npc.name} æ¥å—äº†ä½ çš„å‘Šç™½ï¼`);
                  showModal(
                    "ğŸ’• æˆ€æ„›é–‹å§‹",
                    `æ­å–œï¼ä½ å’Œ ${npc.name} é–‹å§‹äº¤å¾€äº†ï¼`,
                    [{ text: "å¤ªå¥½äº†ï¼", action: () => closeModal() }],
                  );
                } else {
                  npc.relation -= 10;
                  log(`ğŸ˜¢ ${npc.name} æ‹’çµ•äº†ä½ ...`);
                  alert("ğŸ˜¢ å°æ–¹æ‹’çµ•äº†...");
                }
                closeModal();
                updateUI();
                renderSocial();
              },
            },
            {
              text: "ä¸è¦",
              action: () => closeModal(),
            },
          ],
        );
      }

      function proposeMarriage(npcId) {
        const npc = Game.npcs.find((n) => n.id === npcId);
        if (!npc || npc.type !== "lover") {
          alert("âŒ åªèƒ½å‘æˆ€äººæ±‚å©šï¼");
          return;
        }

        if (npc.relation < 90) {
          alert("âŒ æ„Ÿæƒ…é‚„ä¸å¤ æ·±åšï¼ˆéœ€è¦å¥½æ„Ÿåº¦ 90+ï¼‰");
          return;
        }

        if (Game.money < 100000) {
          alert("ğŸ’¸ çµå©šéœ€è¦è‡³å°‘ $100,000 æº–å‚™å©šç¦®");
          return;
        }

        showModal("ğŸ’ æ±‚å©š", `å‘ ${npc.name} æ±‚å©šï¼Ÿ\nå©šç¦®è²»ç”¨ï¼š$100,000`, [
          {
            text: "ğŸ’ æ±‚å©š",
            action: () => {
              Game.money -= 100000;
              npc.type = "spouse";
              npc.relation = 95;

              // ç§»é™¤æˆ€äººï¼Œæ”¹æˆé…å¶
              const index = Game.relationships.findIndex((r) => r.id === npcId);
              if (index !== -1) {
                Game.relationships[index].type = "spouse";
              }

              Game.happy += 50;
              log(`ğŸ’’ èˆ‡ ${npc.name} çµå©šäº†ï¼`);

              showModal(
                "ğŸ’’ çµå©šå…¸ç¦®",
                `æ­å–œï¼ä½ å’Œ ${npc.name} çµç‚ºå¤«å¦»ï¼\nç²å¾— +50 å¿«æ¨‚`,
                [{ text: "å¤ªå¹¸ç¦äº†ï¼", action: () => closeModal() }],
              );

              closeModal();
              updateUI();
              renderSocial();
            },
          },
          {
            text: "å†æƒ³æƒ³",
            action: () => closeModal(),
          },
        ]);
      }

      function updateNPCRelations() {
        // æ¯å¹´è‡ªå‹•è¡°æ¸›é•·æ™‚é–“æœªäº’å‹•çš„é—œä¿‚
        Game.npcs.forEach((npc) => {
          const yearsSinceInteraction = Game.age - npc.lastInteraction;
          if (yearsSinceInteraction > 3) {
            npc.relation = Math.max(0, npc.relation - 2);
          }
        });
      }

      function checkAchievements() {
        ACHIEVEMENTS.forEach((ach) => {
          if (Game.unlockedAchievements.includes(ach.id)) return;

          if (ach.check(Game)) {
            Game.unlockedAchievements.push(ach.id);
            showAchievementToast(ach.name);
            log(`ğŸ† è§£é–æˆå°±ï¼š${ach.name}`);
          }
        });

        renderAchievements();
      }
      // ===== ğŸ« æ•™è‚²ç³»çµ±å‡½æ•¸ =====
      function canEnterEducation(eduId) {
        const edu = EDUCATION_LEVELS.find((e) => e.id === eduId);
        if (!edu) return false;

        // æª¢æŸ¥å¹´é½¡
        if (Game.age < edu.minAge) return false;

        // æª¢æŸ¥æ˜¯å¦å·²ç¶“æœ‰æ›´é«˜å­¸æ­·
        const currentEduIndex = EDUCATION_LEVELS.findIndex(
          (e) => e.id === Game.education,
        );
        const targetEduIndex = EDUCATION_LEVELS.findIndex(
          (e) => e.id === eduId,
        );
        if (currentEduIndex >= targetEduIndex) return false;

        // æª¢æŸ¥éœ€æ±‚
        if (edu.requirement) {
          if (edu.requirement.intel && Game.intel < edu.requirement.intel) {
            return false;
          }
        }

        // æª¢æŸ¥é‡‘éŒ¢
        if (edu.cost && Game.money < edu.cost) {
          return false;
        }

        return true;
      }

      function enterEducation(eduId, majorId = null) {
        const edu = EDUCATION_LEVELS.find((e) => e.id === eduId);
        if (!edu) return;

        if (!canEnterEducation(eduId)) {
          alert("âš ï¸ ä¸ç¬¦åˆå…¥å­¸æ¢ä»¶ï¼");
          return;
        }

        // æ‰£é™¤å­¸è²»
        if (edu.cost) {
          Game.money -= edu.cost;
        }

        Game.isStudying = true;
        Game.studyProgress = 0;

        let eduName = edu.name;
        if (majorId) {
          const majors = MAJORS[eduId];
          const major = majors?.find((m) => m.id === majorId);
          if (major) {
            Game.major = majorId;
            eduName += ` - ${major.name}`;
          }
        }

        log(`ğŸ“š é–‹å§‹å°±è®€${eduName}`);
        showModal("ğŸ“ å…¥å­¸é€šçŸ¥", `æ­å–œä½ é€²å…¥${eduName}ï¼\nåŠªåŠ›å­¸ç¿’å§ï¼`, [
          { text: "é–‹å§‹å­¸ç¿’", action: () => closeModal() },
        ]);

        updateUI();
      }

      function studyProgress() {
        if (!Game.isStudying) return;

        Game.studyProgress += 10 + Game.learnBonus * 5;

        if (Game.studyProgress >= 100) {
          graduateEducation();
        }
      }

      function graduateEducation() {
        const currentEdu = Game.education;
        const nextEduIndex =
          EDUCATION_LEVELS.findIndex((e) => e.id === currentEdu) + 1;
        const nextEdu = EDUCATION_LEVELS[nextEduIndex];

        if (nextEdu) {
          Game.education = nextEdu.id;
          Game.isStudying = false;
          Game.studyProgress = 0;

          // æ‡‰ç”¨å­¸æ­·åŠ æˆ
          if (nextEdu.bonus) {
            Object.keys(nextEdu.bonus).forEach((key) => {
              if (key.startsWith("skills.")) {
                const skillName = key.split(".")[1];
                Game.skills[skillName] += nextEdu.bonus[key];
              } else {
                Game[key] += nextEdu.bonus[key];
              }
            });
          }

          // æ‡‰ç”¨ä¸»ä¿®åŠ æˆ
          if (Game.major) {
            const majors = MAJORS[nextEdu.id];
            const major = majors?.find((m) => m.id === Game.major);
            if (major) {
              if (major.intel) Game.intel += major.intel;
              if (major.skills) {
                Object.keys(major.skills).forEach((skill) => {
                  Game.skills[skill] += major.skills[skill];
                });
              }
            }
          }

          log(`ğŸ“ æ­å–œç•¢æ¥­ï¼å–å¾—${nextEdu.name}å­¸æ­·`);
          showModal(
            "ğŸ‰ ç•¢æ¥­å…¸ç¦®",
            `æ­å–œä½ å®Œæˆå­¸æ¥­ï¼\nå–å¾—${nextEdu.name}å­¸æ­·`,
            [{ text: "å¤ªå¥½äº†ï¼", action: () => closeModal() }],
          );

          // è§£é–æˆå°±
          if (nextEdu.id === "phd") {
            Game.unlockedAchievements.push("scholar");
          }
        }

        updateUI();
      }

      function showEducationMenu() {
        let html = '<div style="padding: 20px;">';
        html += `<h2 style="color: var(--gold); margin-bottom: 20px;">ğŸ“ æ•™è‚²ç³»çµ±</h2>`;
        html += `<p style="color: var(--text-dim); margin-bottom: 15px;">ç•¶å‰å­¸æ­·ï¼š${EDUCATION_LEVELS.find((e) => e.id === Game.education)?.name || "ç„¡"}</p>`;

        if (Game.isStudying) {
          html += `<div style="margin-bottom: 20px;">`;
          html += `<p style="color: var(--blue);">ğŸ“š å­¸ç¿’ä¸­... ${Math.floor(Game.studyProgress)}%</p>`;
          html += `<div style="background: #333; height: 20px; border-radius: 10px; overflow: hidden; margin-top: 10px;">`;
          html += `<div style="width: ${Game.studyProgress}%; height: 100%; background: linear-gradient(90deg, var(--blue), var(--green)); transition: width 0.3s;"></div>`;
          html += `</div></div>`;
        }

        html +=
          '<div style="display: flex; flex-direction: column; gap: 10px;">';

        EDUCATION_LEVELS.forEach((edu, index) => {
          if (index === 0) return; // è·³é none

          const canEnter = canEnterEducation(edu.id);
          const currentEduIndex = EDUCATION_LEVELS.findIndex(
            (e) => e.id === Game.education,
          );
          const isCompleted = currentEduIndex >= index;

          let statusColor = isCompleted
            ? "var(--green)"
            : canEnter
              ? "var(--blue)"
              : "var(--red)";
          let statusText = isCompleted
            ? "âœ… å·²å®Œæˆ"
            : canEnter
              ? "å¯å…¥å­¸"
              : "âŒ æœªé”æ¨™";

          html += `<div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; border-left: 3px solid ${statusColor};">`;
          html += `<div style="display: flex; justify-content: space-between; align-items: center;">`;
          html += `<div>`;
          html += `<div style="font-size: 1.1em; font-weight: bold; color: var(--gold);">${edu.name}</div>`;
          html += `<div style="font-size: 0.85em; color: var(--text-dim); margin-top: 5px;">`;
          html += `æœ€ä½å¹´é½¡: ${edu.minAge}æ­²`;
          if (edu.requirement?.intel)
            html += ` | æ™ºåŠ›éœ€æ±‚: ${edu.requirement.intel}`;
          if (edu.cost) html += ` | å­¸è²»: $${edu.cost.toLocaleString()}`;
          html += `</div></div>`;
          html += `<div style="color: ${statusColor}; font-weight: bold;">${statusText}</div>`;
          html += `</div></div>`;
        });

        html += "</div></div>";

        showModal("ğŸ“ æ•™è‚²ç³»çµ±", html, [
          { text: "é—œé–‰", action: () => closeModal() },
        ]);
      }

      function renderAchievements() {
        let html = "";

        ACHIEVEMENTS.forEach((ach) => {
          const unlocked = Game.unlockedAchievements.includes(ach.id);

          html += `
                          <div class="job-card" style="opacity: ${unlocked ? 1 : 0.4}; cursor: default;">
                              <div style="display: flex; align-items: center; gap: 10px;">
                                  <div style="font-size: 2em;">${unlocked ? ach.icon || "ğŸ†" : "ğŸ”’"}</div>
                                  <div>
                                      <div class="job-name">${ach.name}</div>
                                      <div style="font-size: 0.85em; color: var(--text-dim);">${ach.desc}</div>
                                  </div>
                              </div>
                          </div>
                      `;
        });

        document.getElementById("achievement-list").innerHTML = html;
      }

      function showAchievementToast(name) {
        const toast = document.createElement("div");
        toast.className = "achievement-toast";
        toast.innerHTML = `
                      <div class="achievement-icon">ğŸ†</div>
                      <div>
                          <div style="font-size: 0.9em;">è§£é–æˆå°±</div>
                          <div style="font-size: 1.1em;">${name}</div>
                      </div>
                  `;
        toast.style.cssText = `
                      position: fixed;
                      top: 80px;
                      right: 20px;
                      background: linear-gradient(135deg, #ffd700, #ffb300);
                      color: #000;
                      padding: 15px;
                      border-radius: 10px;
                      box-shadow: 0 5px 20px rgba(255, 215, 0, 0.5);
                      z-index: 150;
                      animation: slideIn 0.5s;
                      font-weight: bold;
                      display: flex;
                      gap: 10px;
                      align-items: center;
                  `;

        document.body.appendChild(toast);

        setTimeout(() => {
          toast.style.animation = "slideIn 0.5s reverse";
          setTimeout(() => {
            document.body.removeChild(toast);
          }, 500);
        }, 3000);
      }

      function renderJobs() {
        // éæ¿¾å¯ç”¨è·æ¥­ï¼ˆæ’é™¤ none å’Œå‡ºèº«é™å®šè·æ¥­ï¼‰
        const availableJobs = JOBS.filter((job) => {
          if (job.id === "none") return false;
          if (job.originRequired && job.originRequired !== Game.originId)
            return false;
          return true;
        });

        if (availableJobs.length === 0) {
          document.getElementById("job-list").innerHTML =
            '<div style="text-align: center; color: var(--text-dim); padding: 30px;">æš«ç„¡å¯ç”¨è·æ¥­</div>';
          return;
        }

        // ç¢ºä¿ç´¢å¼•ä¸è¶…å‡ºç¯„åœ
        if (currentJobIndex >= availableJobs.length) currentJobIndex = 0;
        if (currentJobIndex < 0) currentJobIndex = availableJobs.length - 1;

        const job = availableJobs[currentJobIndex];

        // æª¢æŸ¥æ˜¯å¦ç¬¦åˆæ¢ä»¶
        let canApply = true;
        let reqText = "";

        if (job.requirement) {
          Object.keys(job.requirement).forEach((key) => {
            const required = job.requirement[key];
            const current =
              key === "intel"
                ? Game.intel
                : key === "health"
                  ? Game.health
                  : Game.skills[key] || 0;

            if (current < required) canApply = false;

            const emoji =
              key === "intel" ? "ğŸ§ " : key === "health" ? "â¤ï¸" : "ğŸ“Š";
            const status = current >= required ? "âœ…" : "âŒ";
            reqText += `<div style="margin: 3px 0;">${status} ${emoji} ${key}: ${current}/${required}</div>`;
          });
        } else {
          reqText = '<div style="color: var(--green);">âœ… ç„¡ç‰¹æ®Šè¦æ±‚</div>';
        }

        const isCurrentJob = Game.jobId === job.id;

        let html = `
              <div style="position: relative; min-height: 350px;">
                  <!-- å·¦å³åˆ‡æ›æŒ‰éˆ• -->
                  <button onclick="prevJob()"
                          style="position: absolute; left: -10px; top: 50%; transform: translateY(-50%);
                                 width: 50px; height: 50px; border-radius: 50%; font-size: 1.5em;
                                 background: linear-gradient(135deg, #444, #555); z-index: 10;">
                      â—€
                  </button>

                  <button onclick="nextJob()"
                          style="position: absolute; right: -10px; top: 50%; transform: translateY(-50%);
                                 width: 50px; height: 50px; border-radius: 50%; font-size: 1.5em;
                                 background: linear-gradient(135deg, #444, #555); z-index: 10;">
                      â–¶
                  </button>

                  <!-- è·æ¥­å¡ç‰‡ -->
                  <div style="padding: 0 60px;">
                      <div class="job-card" style="background: linear-gradient(135deg, #2a2a3e, #3a3a4e);
                           border: 3px solid ${isCurrentJob ? "var(--gold)" : canApply ? "var(--blue)" : "var(--red)"};
                           padding: 25px; cursor: ${canApply && !isCurrentJob ? "pointer" : "default"};"
                           ${canApply && !isCurrentJob ? `onclick="selectJob('${job.id}')"` : ""}>

                          <div style="text-align: center; margin-bottom: 15px;">
                              <div style="font-size: 2em; margin-bottom: 5px;">ğŸ’¼</div>
                              <div class="job-name" style="font-size: 1.5em; color: var(--gold);">
                                  ${job.name} ${isCurrentJob ? "âœ“ ç•¶å‰è·æ¥­" : ""}
                              </div>
                          </div>

                          <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                              <div style="font-size: 1.2em; color: var(--green); margin-bottom: 10px;">
                                  ğŸ’° æœˆè–ª: $${job.salary.toLocaleString()}
                              </div>
                              <div style="color: var(--text-dim); font-size: 0.95em; line-height: 1.5;">
                                  ${job.desc}
                              </div>
                          </div>

                          <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                              <div style="font-weight: bold; margin-bottom: 8px; color: var(--accent);">
                                  ğŸ“‹ ä»»è·æ¢ä»¶ï¼š
                              </div>
                              ${reqText}
                          </div>

                          ${
                            !canApply && !isCurrentJob
                              ? '<div style="text-align: center; margin-top: 15px; padding: 12px; background: var(--red); border-radius: 8px; font-weight: bold;">âŒ æ¢ä»¶ä¸ç¬¦ï¼Œç„¡æ³•æ‡‰å¾µ</div>'
                              : ""
                          }

                          ${
                            canApply && !isCurrentJob
                              ? '<div style="text-align: center; margin-top: 15px; padding: 12px; background: var(--green); color: black; border-radius: 8px; font-weight: bold; animation: pulse 2s infinite;">ğŸ‘† é»æ“Šå¡ç‰‡æ‡‰å¾µæ­¤è·æ¥­</div>'
                              : ""
                          }

                          ${
                            isCurrentJob
                              ? '<div style="text-align: center; margin-top: 15px; padding: 12px; background: var(--gold); color: black; border-radius: 8px; font-weight: bold;">âœ… é€™æ˜¯ä½ ç›®å‰çš„å·¥ä½œ</div>'
                              : ""
                          }
                      </div>

                      <!-- é ç¢¼æŒ‡ç¤ºå™¨ -->
                      <div style="text-align: center; margin-top: 15px; color: var(--text-dim); font-size: 0.9em;">
                          è·æ¥­ ${currentJobIndex + 1} / ${availableJobs.length}
                          <div style="margin-top: 8px; font-size: 0.85em;">
                              ğŸ’¡ å·¦å³åˆ‡æ›æŸ¥çœ‹æ›´å¤šè·æ¥­
                          </div>
                      </div>
                  </div>
              </div>
          `;

        document.getElementById("job-list").innerHTML = html;
      }

      function selectJob(jobId) {
        if (Game.age < 18) return alert("æœªæ»¿18æ­²ç„¡æ³•å·¥ä½œ");

        Game.jobId = jobId;
        Game.jobYears = 0;

        const job = JOBS.find((j) => j.id === jobId);
        log(`ğŸ’¼ é–‹å§‹å¾äº‹ ${job.name}`);

        checkAchievements();
        updateUI();
        renderJobs();
      }

      function renderSocial() {
        let html = "";

        // === âœ… æ–°å¢ NPC é¡¯ç¤º ===
        if (Game.npcs && Game.npcs.length > 0) {
          html += '<div style="margin-bottom: 20px;">';
          html +=
            '<h3 style="color: var(--gold); margin-bottom: 10px;">ğŸ‘¥ äººéš›é—œä¿‚</h3>';

          Game.npcs.forEach((npc) => {
            const relationColor =
              npc.relation >= 80
                ? "var(--green)"
                : npc.relation >= 50
                  ? "var(--blue)"
                  : npc.relation >= 30
                    ? "var(--orange)"
                    : "var(--red)";

            let typeIcon = "ğŸ‘¤";
            let typeName = "æœ‹å‹";
            if (npc.type === "romantic") {
              typeIcon = "ğŸ’•";
              typeName = "æ›–æ˜§å°è±¡";
            }
            if (npc.type === "lover") {
              typeIcon = "â¤ï¸";
              typeName = "æˆ€äºº";
            }
            if (npc.type === "spouse") {
              typeIcon = "ğŸ’‘";
              typeName = "é…å¶";
            }
            if (npc.type === "colleague") {
              typeIcon = "ğŸ’¼";
              typeName = "åŒäº‹";
            }
            if (npc.type === "classmate") {
              typeIcon = "ğŸ“š";
              typeName = "åŒå­¸";
            }

            html += `
                <div class="job-card" style="cursor: default;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 1.1em; font-weight: bold; color: var(--gold);">
                                ${typeIcon} ${npc.name}
                            </div>
                            <div style="font-size: 0.85em; color: var(--text-dim); margin-top: 3px;">
                                ${typeName} | ${npc.age}æ­² | èªè­˜ ${Game.age - npc.metAt} å¹´
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="color: ${relationColor}; font-weight: bold;">
                                ğŸ’— ${npc.relation}
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 10px; display: flex; gap: 5px; flex-wrap: wrap;">
                        <button class="btn-job" style="flex: 1; min-width: 80px; padding: 8px; font-size: 0.85em;" 
                                onclick="interactWithNPC('${npc.id}', 'chat')">
                            ğŸ’¬ é–’èŠ
                        </button>
                        <button class="btn-job" style="flex: 1; min-width: 80px; padding: 8px; font-size: 0.85em;" 
                                onclick="interactWithNPC('${npc.id}', 'gift')">
                            ğŸ é€ç¦®
                        </button>
                        ${
                          npc.type === "romantic" || npc.type === "lover"
                            ? `
                            <button class="btn-buy" style="flex: 1; min-width: 80px; padding: 8px; font-size: 0.85em;" 
                                    onclick="interactWithNPC('${npc.id}', 'date')">
                                ğŸ’• ç´„æœƒ
                            </button>
                        `
                            : ""
                        }
                        ${
                          npc.type === "lover" && npc.relation >= 90
                            ? `
                            <button class="btn-main" style="flex: 1; min-width: 100px; padding: 8px; font-size: 0.85em;" 
                                    onclick="proposeMarriage('${npc.id}')">
                                ğŸ’ æ±‚å©š
                            </button>
                        `
                            : ""
                        }
                    </div>
                </div>
            `;
          });

          html += "</div>";
        }

        if (Game.relationships.length === 0) {
          html =
            '<div style="color: var(--text-dim); text-align: center; padding: 20px;">é‚„æ²’æœ‰ä»»ä½•äººéš›é—œä¿‚</div>';
        }

        Game.relationships.forEach((npc) => {
          const emoji =
            npc.type === "parent"
              ? npc.id === "dad"
                ? "ğŸ‘¨"
                : "ğŸ‘©"
              : npc.type === "partner"
                ? "ğŸ’•"
                : npc.type === "spouse"
                  ? "ğŸ’"
                  : npc.type === "child"
                    ? "ğŸ‘¶"
                    : "ğŸ‘¥";

          html += `
                          <div class="job-card" style="cursor: default;">
                              <div style="display: flex; align-items: center; gap: 10px;">
                                  <div style="font-size: 2em;">${emoji}</div>
                                  <div style="flex: 1;">
                                      <div class="job-name">${npc.name}</div>
                                      <div style="font-size: 0.85em; color: var(--text-dim);">
                                          ${npc.role} | è¦ªå¯†åº¦: ${Math.floor(npc.relation)}/100
                                      </div>
                                  </div>
                              </div>
                          </div>
                      `;
        });

        document.getElementById("npc-list").innerHTML = html;

        const hasPartner = Game.relationships.some(
          (r) => r.type === "partner" || r.type === "spouse",
        );
        document.getElementById("find-partner-area").style.display =
          Game.age >= 18 && !hasPartner ? "block" : "none";
      }
      function prevJob() {
        currentJobIndex--;
        const availableJobs = JOBS.filter((job) => {
          if (job.id === "none") return false;
          if (job.originRequired && job.originRequired !== Game.originId)
            return false;
          return true;
        });

        if (currentJobIndex < 0) {
          currentJobIndex = availableJobs.length - 1;
        }

        renderJobs();
      }

      function nextJob() {
        currentJobIndex++;
        const availableJobs = JOBS.filter((job) => {
          if (job.id === "none") return false;
          if (job.originRequired && job.originRequired !== Game.originId)
            return false;
          return true;
        });

        if (currentJobIndex >= availableJobs.length) {
          currentJobIndex = 0;
        }

        renderJobs();
      }

      function findPartner() {
        if (Game.money < 500) return alert("æ²’éŒ¢ä½¿ç”¨äº¤å‹è»Ÿé«”");

        Game.money -= 500;
        const chance = (Game.skills.charm / 150) * 0.8 + 0.2;

        if (Math.random() < chance) {
          const names = [
            "å°ç¾",
            "é˜¿è±ª",
            "é›…å©·",
            "å¿—æ˜",
            "Emily",
            "Jack",
            "å°ç³",
            "å¤§è¡›",
            "å‡±è‰",
            "ä¿Šå‚‘",
          ];
          const name = names[Math.floor(Math.random() * names.length)];

          Game.relationships.push({
            id: "partner_" + Date.now(),
            name: name,
            type: "partner",
            relation: 50,
            role: "ä¼´ä¾¶",
          });

          log(`ğŸ’– é…å°æˆåŠŸï¼å’Œ ${name} é–‹å§‹äº¤å¾€`);
        } else {
          Game.happy -= 10;
          log("ğŸ’” æ²’æœ‰é…å°æˆåŠŸ...");
        }

        updateUI();
        renderSocial();
      }

      function addFriend() {
        const names = [
          "å°æ",
          "å°ç‹",
          "å°é™³",
          "å°æ—",
          "Amy",
          "David",
          "å°å¼µ",
          "é˜¿æ˜",
          "å°è¯",
          "é˜¿å¾·",
        ];
        const name = names[Math.floor(Math.random() * names.length)];

        Game.relationships.push({
          id: "friend_" + Date.now(),
          name: name,
          type: "friend",
          relation: 60,
          role: "æœ‹å‹",
        });

        log(`ğŸ‘¥ å’Œ ${name} æˆç‚ºæœ‹å‹`);
        checkAchievements();
      }

      function renderShop() {
        // è»Šåº«
        let carHtml = "";
        CARS.forEach((car) => {
          const owned = Game.inventory.includes(car.id);
          carHtml += `
                          <div class="job-card" style="cursor: default;">
                              <div class="job-name">${car.name} ${owned ? "âœ“ (å·²æ“æœ‰)" : ""}</div>
                              <div class="job-salary">âœ¨ é­…åŠ› +${car.charm}</div>
                              <div style="font-size: 0.85em; color: var(--text-dim); margin: 5px 0;">
                                  ${car.desc}
                              </div>
                              <div style="margin-top: 8px;">
                                  <button class="btn-buy" onclick="buyItem('${car.id}')" ${owned ? "disabled" : ""}>
                                      è³¼è²· $${(car.price / 10000).toFixed(0)}è¬
                                  </button>
                              </div>
                          </div>
                      `;
        });

        // æˆ¿ç”¢
        let houseHtml = "";
        HOUSES.forEach((house) => {
          const owned = Game.inventory.includes(house.id);
          houseHtml += `
                          <div class="job-card" style="cursor: default;">
                              <div class="job-name">${house.name} ${owned ? "âœ“ (å·²æ“æœ‰)" : ""}</div>
                              <div class="job-salary">
                                  ğŸ˜Š å¿«æ¨‚ +${house.happy} | ğŸ’° è¢«å‹•æ”¶å…¥ $${house.passive.toLocaleString()}/æœˆ
                              </div>
                              <div style="font-size: 0.85em; color: var(--text-dim); margin: 5px 0;">
                                  ${house.desc}
                              </div>
                              <div style="margin-top: 8px;">
                                  <button class="btn-buy" onclick="buyItem('${house.id}')" ${owned ? "disabled" : ""}>
                                      è³¼è²· $${(house.price / 10000).toFixed(0)}è¬
                                  </button>
                              </div>
                          </div>
                      `;
        });

        // å¥¢ä¾ˆå“
        let luxHtml = "";
        LUXURIES.forEach((lux) => {
          const owned = Game.inventory.includes(lux.id);
          luxHtml += `
                          <div class="job-card" style="cursor: default;">
                              <div class="job-name">${lux.name} ${owned ? "âœ“ (å·²æ“æœ‰)" : ""}</div>
                              <div class="job-salary">
                                  ${lux.charm ? `âœ¨ é­…åŠ› +${lux.charm}` : ""}
                                  ${lux.happy ? `ğŸ˜Š å¿«æ¨‚ +${lux.happy}` : ""}
                              </div>
                              <div style="font-size: 0.85em; color: var(--text-dim); margin: 5px 0;">
                                  ${lux.desc}
                              </div>
                              <div style="margin-top: 8px;">
                                  <button class="btn-buy" onclick="buyItem('${lux.id}')" ${owned ? "disabled" : ""}>
                                      è³¼è²· $${(lux.price / 10000).toFixed(0)}è¬
                                  </button>
                              </div>
                          </div>
                      `;
        });

        document.getElementById("car-shop").innerHTML = carHtml;
        document.getElementById("house-shop").innerHTML = houseHtml;
        document.getElementById("luxury-shop").innerHTML = luxHtml;
      }

      function buyItem(id) {
        const car = CARS.find((c) => c.id === id);
        const house = HOUSES.find((h) => h.id === id);
        const lux = LUXURIES.find((l) => l.id === id);
        const item = car || house || lux;

        if (!item) return;
        if (Game.inventory.includes(id)) return alert("å·²æ“æœ‰");
        if (Game.money < item.price) return alert("éŒ¢ä¸å¤ ");

        Game.money -= item.price;
        Game.inventory.push(id);

        if (car) {
          Game.skills.charm += car.charm;
          log(`ğŸï¸ è³¼è²·äº† ${car.name}`);
        } else if (house) {
          Game.happy += house.happy;
          log(`ğŸ˜ï¸ è³¼è²·äº† ${house.name}`);
        } else {
          if (lux.charm) Game.skills.charm += lux.charm;
          if (lux.happy) Game.happy += lux.happy;
          log(`ğŸ’ è³¼è²·äº† ${lux.name}`);
        }

        checkAchievements();
        updateUI();
        renderShop();
      }

      function renderStats() {
        const highestSkill = Object.keys(Game.skills).reduce((a, b) =>
          Game.skills[a] > Game.skills[b] ? a : b,
        );

        const totalWealth =
          Game.money +
          Game.inventory.reduce((sum, id) => {
            const item = [...CARS, ...HOUSES, ...LUXURIES].find(
              (i) => i.id === id,
            );
            return sum + (item ? item.price : 0);
          }, 0);

        const html = `
                      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9em;">
                          <div>ğŸ‚ ç•¶å‰å¹´é½¡: ${Game.age}æ­²</div>
                          <div>ğŸ  å‡ºèº«: ${Game.origin}</div>
                          <div>ğŸ’° ç¸½è³‡ç”¢: $${totalWealth.toLocaleString()}</div>
                          <div>ğŸ’¼ å·¥ä½œå¹´è³‡: ${Game.jobYears}å¹´</div>
                          <div>ğŸ‘¥ äººéš›é—œä¿‚: ${Game.relationships.length}äºº</div>
                          <div>ğŸ† æˆå°±æ•¸: ${Game.unlockedAchievements.length}/${ACHIEVEMENTS.length}</div>
                          <div>ğŸ¯ åŸ·è¡Œè¡Œå‹•: ${Game.totalActions}æ¬¡</div>
                          <div>ğŸ“¢ è§¸ç™¼äº‹ä»¶: ${Game.totalEvents}æ¬¡</div>
                          <div>ğŸ˜Š å¿«æ¨‚å¹´æ•¸: ${Game.happyYears}å¹´</div>
                          <div>ğŸŒŸ æœ€å¼·æŠ€èƒ½: ${highestSkill}</div>
                      </div>
                  `;

        document.getElementById("stats-panel").innerHTML = html;
      }

      function nav(page, event) {
        event.preventDefault();
        event.stopPropagation();

        document
          .querySelectorAll(".page")
          .forEach((p) => p.classList.remove("active"));
        document.getElementById("page-" + page).classList.add("active");

        document
          .querySelectorAll(".nav-item")
          .forEach((n) => n.classList.remove("active"));
        event.currentTarget.classList.add("active");

        // æ›´æ–°ç‰¹å®šé é¢çš„è³‡æ–™
        if (page === "profile") {
          renderStats();
        }
      }

      function closeModal() {
        document.getElementById("event-modal").style.display = "none";
      }

      function restartGame() {
        location.reload();
      }
      // ==========================================
      // ğŸ”´ å‡ºèº«å°ˆå±¬äº‹ä»¶ç³»çµ±
      // ==========================================

      function triggerOriginEvent() {
        const originEvents = {
          rich: [
            {
              title: "ğŸ¢ å®¶æ—ä¼æ¥­å±æ©Ÿ",
              desc: "çˆ¶è¦ªå…¬å¸é­æƒ¡æ„æ”¶è³¼ï¼Œéœ€è¦ç·Šæ€¥è³‡é‡‘æ´åŠ©",
              choices: [
                {
                  txt: "æŠ•è³‡500è¬æ•‘å…¬å¸",
                  effect: (g) => {
                    if (g.money >= 5000000) {
                      g.money -= 5000000;
                      g.money += 10000000;
                      return "æˆåŠŸæ‹¯æ•‘ä¼æ¥­ï¼Œå…¬å¸åƒ¹å€¼ç¿»å€ï¼è³ºå›1000è¬";
                    }
                    return "è³‡é‡‘ä¸è¶³ï¼Œç„¡æ³•æŠ•è³‡";
                  },
                },
                {
                  txt: "è¢–æ‰‹æ—è§€",
                  effect: (g) => {
                    g.yearlyMoney = 0;
                    g.happy -= 20;
                    return "å®¶æ—ä¼æ¥­å€’é–‰ï¼Œå¤±å»é›¶ç”¨éŒ¢ä¾†æº";
                  },
                },
              ],
            },
            {
              title: "ğŸ’ ç¹¼æ‰¿éºç”¢",
              desc: "é æˆ¿è¦ªæˆšçªç„¶éä¸–ï¼Œç•™ä¸‹ä¸€ç­†éºç”¢çµ¦ä½ ",
              effect: (g) => {
                g.money += 3000000;
                g.happy += 10;
                return "ç²å¾—300è¬éºç”¢";
              },
            },
          ],
          genius: [
            {
              title: "ğŸ“ çå­¸é‡‘æ©Ÿæœƒ",
              desc: "é ‚å°–å¤§å­¸å› ä½ å„ªç•°æˆç¸¾æä¾›å…¨é¡çå­¸é‡‘",
              effect: (g) => {
                g.intel += 20;
                g.money += 500000;
                return "æ™ºåŠ›+20ï¼Œç²å¾—50è¬çå­¸é‡‘";
              },
            },
            {
              title: "ğŸ”¬ ç ”ç©¶çªç ´",
              desc: "ä½ çš„ç ”ç©¶ç²å¾—é‡å¤§çªç ´",
              effect: (g) => {
                g.intel += 15;
                g.money += 200000;
                g.happy += 15;
                return "å­¸è¡“è²è­½å¤§å¢";
              },
            },
          ],
          mafia: [
            {
              title: "ğŸ—¡ï¸ å¹«æ´¾é¬¥çˆ­",
              desc: "æ•µå°å¹«æ´¾æ‰¾ä¸Šé–€ä¾†å°‹ä»‡",
              choices: [
                {
                  txt: "æ­£é¢å°æ±º",
                  effect: (g) => {
                    if (Math.random() > 0.5) {
                      g.money += 1000000;
                      g.health -= 20;
                      g.skills.charm += 10;
                      return "æ‰“è´äº†ï¼æ¶åˆ°100è¬ï¼Œå¨åé æ’­";
                    } else {
                      g.health -= 40;
                      g.money -= 500000;
                      return "é‡å‚·ä½é™¢ï¼Œæå¤±æ…˜é‡";
                    }
                  },
                },
                {
                  txt: "è«‡åˆ¤å’Œè§£",
                  effect: (g) => {
                    g.money -= 300000;
                    g.skills.communication += 10;
                    return "èŠ±30è¬æ“ºå¹³ï¼Œå­¸æœƒè«‡åˆ¤æŠ€å·§";
                  },
                },
              ],
            },
            {
              title: "ğŸ’° åœ°ç›¤æ“´å¼µ",
              desc: "æœ‰æ©Ÿæœƒæ“´å¼µå®¶æ—å‹¢åŠ›ç¯„åœ",
              effect: (g) => {
                if (g.money >= 500000) {
                  g.money -= 500000;
                  g.yearlyMoney += 10000;
                  return "æŠ•è³‡50è¬æ“´å¼µåœ°ç›¤ï¼Œå¹´æ”¶å…¥+1è¬";
                }
                return "è³‡é‡‘ä¸è¶³";
              },
            },
          ],
          hacker: [
            {
              title: "ğŸ’» æš—ç¶²å§”è¨—",
              desc: "æ”¶åˆ°é«˜é¡é§­å®¢ä»»å‹™å§”è¨—ï¼Œä½†å¯èƒ½é•æ³•",
              choices: [
                {
                  txt: "æ¥å—ä»»å‹™",
                  effect: (g) => {
                    if (g.skills.programming > 80) {
                      g.money += 2000000;
                      g.skills.programming += 10;
                      return "ä»»å‹™æˆåŠŸï¼è³º200è¬ï¼ŒæŠ€è¡“å¤§å¢";
                    } else {
                      g.happy -= 15;
                      g.money -= 100000;
                      return "æŠ€è¡“ä¸è¶³å°è‡´å¤±æ•—ï¼Œæå¤±10è¬";
                    }
                  },
                },
                {
                  txt: "æ‹’çµ•ä»»å‹™",
                  effect: (g) => {
                    g.happy += 5;
                    g.intel += 3;
                    return "ä¿æŒé“å¾·åº•ç·šï¼Œå¿ƒå®‰ç†å¾—";
                  },
                },
              ],
            },
            {
              title: "ğŸ›¡ï¸ è³‡å®‰æ¼æ´ç™¼ç¾",
              desc: "ç™¼ç¾é‡å¤§è³‡å®‰æ¼æ´",
              effect: (g) => {
                g.skills.programming += 15;
                g.money += 500000;
                return "ç²å¾—æ¼æ´çé‡‘50è¬";
              },
            },
          ],
          royal: [
            {
              title: "ğŸ‘‘ çš‡å®¤å¬è¦‹",
              desc: "é æˆ¿çš‡å®¤è¦ªæˆšé‚€è«‹åƒåŠ è²´æ—å®´æœƒ",
              effect: (g) => {
                g.skills.charm += 15;
                g.skills.communication += 10;
                g.money += 500000;
                return "ç¤¾äº¤åœˆå¤§å¹…æå‡ï¼Œé­…åŠ›+15";
              },
            },
            {
              title: "ğŸ’ è¯å§»æè­°",
              desc: "å…¶ä»–è²´æ—å®¶æ—æå‡ºè¯å§»",
              choices: [
                {
                  txt: "æ¥å—è¯å§»",
                  effect: (g) => {
                    g.money += 5000000;
                    g.happy -= 20;
                    return "ç²å¾—500è¬å«å¦ä½†å¤±å»è‡ªç”±";
                  },
                },
                {
                  txt: "æ‹’çµ•è¯å§»",
                  effect: (g) => {
                    g.happy += 15;
                    return "è¿½æ±‚çœŸæ„›ï¼Œå¿ƒéˆè‡ªç”±";
                  },
                },
              ],
            },
          ],
          monk: [
            {
              title: "ğŸ™ é “æ‚Ÿæ™‚åˆ»",
              desc: "ä¿®è¡Œæ™‚çªç„¶é–‹æ‚Ÿï¼Œèº«å¿ƒéˆå¾—åˆ°æ˜‡è¯",
              effect: (g) => {
                g.happy += 30;
                g.intel += 10;
                g.health += 15;
                return "èº«å¿ƒéˆå…¨é¢æå‡";
              },
            },
            {
              title: "ğŸ“¿ é›²éŠå››æ–¹",
              desc: "å¸«çˆ¶å»ºè­°ä½ é›²éŠåƒå­¸",
              effect: (g) => {
                g.intel += 15;
                g.skills.communication += 10;
                g.happy += 20;
                return "è¦‹è­˜å¤§å¢ï¼Œå¿ƒèƒ¸é–‹é—Š";
              },
            },
          ],
          esports: [
            {
              title: "ğŸ® æˆ°éšŠé‚€è«‹",
              desc: "é ‚ç´šè·æ¥­æˆ°éšŠæƒ³é«˜è–ªç°½ç´„ä½ ",
              choices: [
                {
                  txt: "ç°½ç´„ç•¶é¸æ‰‹",
                  effect: (g) => {
                    g.jobId = "esports_player";
                    g.money += 800000;
                    g.happy += 20;
                    return "æˆç‚ºè·æ¥­é¸æ‰‹ï¼Œç°½ç´„é‡‘80è¬";
                  },
                },
                {
                  txt: "æ‹’çµ•ç°½ç´„",
                  effect: (g) => {
                    g.intel += 5;
                    return "å°ˆæ³¨æœ¬æ¥­ç™¼å±•";
                  },
                },
              ],
            },
            {
              title: "ğŸ† æ¯”è³½é‚€è«‹",
              desc: "å—é‚€åƒåŠ é›»ç«¶æ¯”è³½",
              effect: (g) => {
                if (Math.random() > 0.6) {
                  g.money += 500000;
                  g.happy += 20;
                  return "å¥ªå† ï¼ç²å¾—çé‡‘50è¬";
                } else {
                  g.happy += 5;
                  return "é›–æ•—çŒ¶æ¦®ï¼Œç²å¾—ç¶“é©—";
                }
              },
            },
          ],
          spy: [
            {
              title: "ğŸ•µï¸ æ©Ÿå¯†ä»»å‹™",
              desc: "çˆ¶è¦ªå¸Œæœ›ä½ å”åŠ©åŸ·è¡Œæƒ…å ±å·¥ä½œ",
              choices: [
                {
                  txt: "æ¥å—ä»»å‹™",
                  effect: (g) => {
                    if (g.intel > 90) {
                      g.money += 1500000;
                      g.health -= 10;
                      g.intel += 10;
                      return "ä»»å‹™æˆåŠŸï¼è³º150è¬ä½†æœ‰ä¸€å®šé¢¨éšª";
                    } else {
                      g.happy -= 10;
                      g.health -= 15;
                      return "èƒ½åŠ›ä¸è¶³ï¼Œä»»å‹™å¤±æ•—";
                    }
                  },
                },
                {
                  txt: "æ‹’çµ•ä»»å‹™",
                  effect: (g) => {
                    g.happy += 5;
                    return "é¸æ“‡å¹³å‡¡ç”Ÿæ´»";
                  },
                },
              ],
            },
            {
              title: "ğŸ” ç ´è­¯å¯†ç¢¼",
              desc: "ç™¼ç¾ç¥ç§˜åŠ å¯†è¨Šæ¯",
              effect: (g) => {
                if (g.intel > 100) {
                  g.money += 800000;
                  g.intel += 15;
                  return "æˆåŠŸç ´è­¯ï¼Œç²å¾—80è¬çå‹µ";
                }
                return "é›£åº¦å¤ªé«˜ï¼Œç„¡æ³•ç ´è­¯";
              },
            },
          ],
          chef_family: [
            {
              title: "ğŸ³ ç¾é£Ÿå¤§è³½",
              desc: "å—é‚€åƒåŠ åœ‹éš›çƒ¹é£ªå¤§è³½",
              effect: (g) => {
                if (g.skills.cooking > 80) {
                  g.money += 1000000;
                  g.skills.cooking += 20;
                  g.happy += 25;
                  return "å¥ªå† ï¼ç²å¾—100è¬çé‡‘";
                } else {
                  g.skills.cooking += 10;
                  g.happy += 10;
                  return "é›–æœªå¾—çä½†æŠ€è¡“ç²¾é€²";
                }
              },
            },
            {
              title: "â­ ç±³å…¶æ—è©•é‘‘",
              desc: "ç±³å…¶æ—è©•å¯©ä¾†è¨ªé¤å»³",
              effect: (g) => {
                g.skills.cooking += 15;
                g.money += 500000;
                g.happy += 20;
                return "ç²å¾—æ˜Ÿç´šèªè­‰ï¼Œåè²å¤§å™ª";
              },
            },
          ],
          fashion: [
            {
              title: "ğŸ‘— æ™‚è£é€±é‚€è«‹",
              desc: "å·´é»æ™‚è£é€±é‚€è«‹ä½ èµ°ç§€",
              effect: (g) => {
                g.skills.charm += 20;
                g.money += 800000;
                g.happy += 15;
                return "å¤§æ”¾ç•°å½©ï¼Œé­…åŠ›+20";
              },
            },
            {
              title: "ğŸ“¸ æ™‚å°šé›œèªŒå°é¢",
              desc: "åœ‹éš›æ™‚å°šé›œèªŒæƒ³é‚€ä½ ç•¶å°é¢",
              effect: (g) => {
                g.skills.charm += 15;
                g.money += 500000;
                return "ç™»ä¸Šå°é¢ï¼ŒçŸ¥ååº¦å¤§å¢";
              },
            },
          ],
          scientist_family: [
            {
              title: "ğŸ”¬ è«–æ–‡ç™¼è¡¨",
              desc: "ä½ çš„ç ”ç©¶è«–æ–‡å—åˆ°å­¸ç•Œé—œæ³¨",
              effect: (g) => {
                g.intel += 20;
                g.money += 1000000;
                g.happy += 15;
                return "å­¸è¡“åœ°ä½æå‡ï¼Œç²å¾—ç ”ç©¶ç¶“è²»";
              },
            },
            {
              title: "ğŸ… ç§‘å­¸çé …",
              desc: "ç²å¾—é‡è¦ç§‘å­¸çé …æå",
              effect: (g) => {
                if (g.intel > 120) {
                  g.money += 5000000;
                  g.intel += 25;
                  g.happy += 30;
                  return "ç²çï¼å¾—åˆ°500è¬çé‡‘";
                } else {
                  g.intel += 10;
                  return "é›–æœªç²çä½†å‚™å—è‚¯å®š";
                }
              },
            },
          ],
        };

        const originId = Game.originId;
        const events = originEvents[originId];

        if (events && events.length > 0) {
          const event = events[Math.floor(Math.random() * events.length)];

          if (event.choices) {
            showOriginEventModal(event);
          } else if (event.effect) {
            const result = event.effect(Game);
            log(`ğŸ­ ã€${Game.origin}å°ˆå±¬ã€‘${event.title}ï¼š${result}`);
            Game.totalEvents++;
          }
        }
      }

      function showOriginEventModal(event) {
        document.getElementById("ev-title").textContent =
          `ã€${Game.origin}å°ˆå±¬ã€‘${event.title}`;
        document.getElementById("ev-desc").textContent = event.desc;

        const btnA = document.getElementById("btn-choice-a");
        const btnB = document.getElementById("btn-choice-b");

        btnA.textContent = event.choices[0].txt;
        btnB.textContent = event.choices[1].txt;

        btnA.onclick = () => {
          const result = event.choices[0].effect(Game);
          log(`ğŸ­ ã€${Game.origin}å°ˆå±¬ã€‘${event.title}`);
          log(`   â””â”€ é¸æ“‡ï¼š${event.choices[0].txt} â†’ ${result}`);
          closeModal();
          updateUI();
          checkAchievements();
        };

        btnB.onclick = () => {
          const result = event.choices[1].effect(Game);
          log(`ğŸ­ ã€${Game.origin}å°ˆå±¬ã€‘${event.title}`);
          log(`   â””â”€ é¸æ“‡ï¼š${event.choices[1].txt} â†’ ${result}`);
          closeModal();
          updateUI();
          checkAchievements();
        };

        document.getElementById("event-modal").style.display = "flex";
      }

      // åˆå§‹åŒ–
      initCreation();
    </script>
  </body>
</html>
