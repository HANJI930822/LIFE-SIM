<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™‚äº‹äººç”Ÿ V11.0ï¼šå¤©è³¦èˆ‡å±æ©Ÿ</title>
    <style>
        :root { --bg: #121212; --card: #1e1e1e; --accent: #bb86fc; --text: #e0e0e0; --green: #03dac6; --red: #cf6679; --gold: #ffd700; --blue: #2196f3; }
        body { font-family: 'å¾®è»Ÿæ­£é»‘é«”', sans-serif; background: var(--bg); color: var(--text); max-width: 600px; margin: 0 auto; padding-bottom: 80px; user-select: none; overflow-x: hidden; }
        
        /* ä»‹é¢æ¨£å¼ */
        .header { background: #2c2c2c; padding: 10px 15px; position: sticky; top: 0; z-index: 50; box-shadow: 0 2px 8px rgba(0,0,0,0.6); }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; font-size: 0.9em; text-align: center; }
        .big-stat { font-size: 1.2em; font-weight: bold; color: var(--gold); grid-column: span 3; margin-bottom: 5px; transition: color 0.3s; }
        .big-stat.debt { color: var(--red); animation: shake 0.5s; }
        
        /* ğŸ”¥ ç‹€æ…‹è­¦å‘Šæ¢ ğŸ”¥ */
        .status-alert { grid-column: span 3; color: white; font-weight: bold; font-size: 0.8em; padding: 5px; border-radius: 4px; display: none; margin-bottom:5px; text-align:center;}
        .alert-red { background: #b00020; animation: pulseRed 1s infinite; }
        .alert-orange { background: #ff9800; }

        .stamina-container { grid-column: span 3; margin-top: 5px; text-align: left; }
        .stamina-label { font-size: 0.8em; color: var(--blue); margin-bottom: 2px; display: flex; justify-content: space-between; }
        .progress-bg { background: #444; height: 8px; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--blue); transition: width 0.3s ease; }
        .progress-fill.low { background: var(--red); }

        .card { background: var(--card); border-radius: 10px; margin: 15px 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); overflow: hidden; }
        .card-body { padding: 15px; }
        .card h3 { margin-top: 0; color: var(--accent); border-bottom: 1px solid #333; padding-bottom: 10px; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        /* æŒ‰éˆ•æ¨£å¼ */
        button { background: #333; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; transition: 0.2s; font-size: 1em; position: relative; overflow: hidden; }
        button:hover { background: #444; filter: brightness(1.2); }
        button:disabled { opacity: 0.3; cursor: not-allowed; filter: grayscale(1); }
        
        /* ğŸ”¥ ç‰¹æ®Šè·æ¥­æŒ‰éˆ• ğŸ”¥ */
        .btn-special { background: linear-gradient(45deg, #6200ea, #b388ff); border: 1px solid var(--accent); display:none; }
        .btn-special:hover { filter: brightness(1.3); transform: scale(1.02); }

        .btn-main { background: var(--accent); color: black; font-weight: bold; width: 100%; margin-top: 10px; font-size: 1.1em; }
        .btn-buy { background: var(--green); color: black; font-weight: bold; }
        .btn-risk { background: var(--red); color: white; }
        .cost-tag { font-size: 0.7em; color: #aaa; display: block; margin-top: 2px; }

        /* å‰µè§’èˆ‡å…¶ä»–ä»‹é¢ */
        #scene-creation { padding: 20px; text-align: center; }
        .input-group { margin-bottom: 15px; text-align: left; }
        .input-group input, .input-group select { width: 95%; padding: 10px; background: #222; border: 1px solid #444; color: white; border-radius: 5px; }
        .origin-card { background: #222; border: 2px solid #333; border-radius: 8px; padding: 15px; margin-bottom: 10px; cursor: pointer; text-align: left; }
        .origin-card.selected { border-color: var(--accent); background: #2a2a2a; }
        .origin-name { font-weight: bold; color: var(--gold); }
        
        #scene-game { display: none; }
        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: #000; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #333; z-index: 50; }
        .nav-item { color: #888; cursor: pointer; text-align: center; font-size: 0.8em; }
        .nav-item.active { color: var(--accent); font-weight: bold; }
        .nav-icon { display: block; font-size: 1.5em; margin-bottom: 2px; }
        .page { display: none; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        
        .log-box { height: 120px; overflow-y: auto; background: #111; padding: 10px; border-radius: 5px; font-size: 0.9em; color: #ccc; border: 1px solid #333; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 100; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-box { background: var(--card); width: 85%; max-width: 400px; padding: 20px; border-radius: 12px; border: 1px solid var(--accent); text-align: center; }
        .modal-btn { width: 100%; margin-bottom: 10px; padding: 15px; border: 1px solid #444; }

        @keyframes pulseRed { 0% { opacity: 0.8; } 50% { opacity: 1; } 100% { opacity: 0.8; } }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 100% { transform: translateX(0); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="scene-creation">
        <h1 style="color:var(--accent)">ğŸ§¬ è§’è‰²å‰µé€ </h1>
        <div class="card"><div class="card-body">
            <div class="input-group"><label>å§“å</label><input type="text" id="inp-name" placeholder="è¼¸å…¥å§“å" maxlength="6"></div>
            <div class="input-group"><label>æ€§åˆ¥</label><select id="inp-gender"><option value="ç”·">ğŸ‘¨ ç”·ç”Ÿ</option><option value="å¥³">ğŸ‘© å¥³ç”Ÿ</option><option value="å…¶ä»–">ğŸŒˆ å…¶ä»–</option></select></div>
        </div></div>
        <h3 style="text-align:left;margin-left:10px;color:var(--gold)">å‡ºèº«èƒŒæ™¯</h3>
        <div id="origin-list"></div>
        <button class="btn-main" onclick="startGame()">ğŸš€ é–‹å§‹äººç”Ÿ</button>
    </div>

    <div id="scene-game">
        <div class="header">
            <div class="stat-grid">
                <div class="big-stat" id="money-display">$0</div>
                
                <div id="alert-debt" class="status-alert alert-red">âš ï¸ è² å‚µè­¦å‘Šï¼</div>
                <div id="alert-depression" class="status-alert alert-orange">â˜ï¸ æ†‚é¬±ç‹€æ…‹ï¼šä¸æƒ³å·¥ä½œ...</div>
                <div id="alert-sick" class="status-alert alert-red">ğŸ¥ é‡ç—…è­¦å‘Šï¼šè«‹æ³¨æ„å¥åº·ï¼</div>

                <div style="grid-column: span 3; font-size:0.8em; color:#aaa; margin-bottom:5px;">
                    <span id="player-name"></span> | <span id="player-origin" style="color:var(--gold)"></span>
                </div>
                <div>ğŸ“… <span id="year">0</span> (<span id="age">0</span>æ­²)</div>
                <div>â¤ï¸ <span id="health">100</span></div>
                <div>ğŸ˜Š <span id="happy">80</span></div>
                <div class="stamina-container">
                    <div class="stamina-label"><span>âš¡ é«”åŠ›</span><span id="stamina-text">100/100</span></div>
                    <div class="progress-bg"><div id="stamina-bar" class="progress-fill" style="width: 100%;"></div></div>
                </div>
            </div>
        </div>

        <div id="page-home" class="page active">
            <div class="card">
                <img src="images/banner-home.jpg" class="img-banner" onerror="this.src='https://images.unsplash.com/photo-1519689680058-324335c77eba?w=600'">
                <div class="card-body">
                    <h3>ğŸ“ å¹´åº¦è¡Œå‹•</h3>
                    <div class="btn-grid">
                        <button onclick="action('work')" id="btn-work">ğŸ’¼ å·¥ä½œ <span class="cost-tag">âš¡ -30</span></button>
                        <button onclick="action('study')" id="btn-study">ğŸ“š é€²ä¿® <span class="cost-tag">âš¡ -20</span></button>
                        <button onclick="action('play')" id="btn-play">ğŸ® ç©æ¨‚ <span class="cost-tag">âš¡ -10</span></button>
                        <button onclick="action('gym')" id="btn-gym">ğŸ‹ï¸ å¥èº« <span class="cost-tag">âš¡ -25</span></button>
                        
                        <button onclick="action('dev_app')" id="btn-dev" class="btn-special">ğŸ’» é–‹ç™¼AI <span class="cost-tag">éœ€æ™ºåŠ›80 / âš¡-50</span></button>
                        <button onclick="action('stream')" id="btn-stream" class="btn-special">ğŸ¤³ ç›´æ’­å¸¶è²¨ <span class="cost-tag">éœ€é­…åŠ›80 / âš¡-40</span></button>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-body">
                    <h3>ğŸ“œ äººç”Ÿå‹•æ…‹</h3>
                    <div id="game-log" class="log-box"></div>
                    <button class="btn-main" id="btn-nextyear" onclick="nextYear()">ğŸ‚ ä¸‹ä¸€æ­²</button>
                </div>
            </div>
        </div>

        <div id="page-assets" class="page"><div class="card"><div class="card-body"><h3>ğŸï¸ è»Šåº«</h3><div id="car-shop"></div></div></div><div class="card"><div class="card-body"><h3>ğŸ˜ï¸ æˆ¿ç”¢</h3><div id="house-shop"></div></div></div></div>
        <div id="page-casino" class="page"><div class="card"><div class="card-body"><h3>ğŸ° è³­å ´</h3><div id="casino-area"><input type="number" id="bet-amount" placeholder="é‡‘é¡" style="width:90%;padding:10px;margin-bottom:10px"><div class="btn-grid"><button class="btn-risk" onclick="gamble('big')">å¤§</button><button class="btn-risk" onclick="gamble('small')">å°</button></div><p id="casino-msg"></p></div></div></div></div>
        <div id="page-profile" class="page"><div class="card"><div class="card-body"><h3>ğŸ† æˆå°±</h3><div id="achievement-list"></div><button onclick="restartGame()" style="width:100%;margin-top:20px">é‡ä¾†</button></div></div></div>

        <div class="nav-bar">
            <div class="nav-item active" onclick="nav('home')"><span class="nav-icon">ğŸ </span>ç”Ÿæ´»</div>
            <div class="nav-item" onclick="nav('assets')"><span class="nav-icon">ğŸï¸</span>è³‡ç”¢</div>
            <div class="nav-item" onclick="nav('casino')"><span class="nav-icon">ğŸ°</span>è³­å ´</div>
            <div class="nav-item" onclick="nav('profile')"><span class="nav-icon">ğŸ†</span>æˆå°±</div>
        </div>
    </div>

    <div id="event-modal" class="modal-overlay"><div class="modal-box"><div class="modal-title" id="ev-title"></div><div id="ev-desc" style="margin-bottom:20px;"></div><button class="modal-btn" id="btn-choice-a">A</button><button class="modal-btn" id="btn-choice-b">B</button></div></div>

    <script src="data.js"></script>
    <script>
        let Game = { name: "", origin: "", age: 0, money: 0, health: 100, happy: 80, intel: 0, charm: 0, stamina: 100, debtYears: 0, inventory: [], achievements: [] };
        const COSTS = { work: 30, study: 20, play: 10, gym: 25, dev_app: 50, stream: 40 };
        let activeEvent = null, selectedOriginId = null;

        function initCreation() {
            if(typeof ORIGIN_DATA === 'undefined') return document.getElementById('origin-list').innerHTML="<p style='color:red'>Data.js è¼‰å…¥å¤±æ•—</p>";
            let html = ""; ORIGIN_DATA.forEach(o => html += `<div class="origin-card" onclick="selectOrigin('${o.id}', this)"><div class="origin-name">${o.name}</div><div style="font-size:0.9em;color:#aaa">${o.desc}</div><div style="font-size:0.8em;color:var(--green)">âœ¨ ${o.buff}</div></div>`);
            document.getElementById('origin-list').innerHTML = html;
            selectOrigin(ORIGIN_DATA[0].id, document.querySelector('.origin-card'));
        }
        function selectOrigin(id, el) { selectedOriginId = id; document.querySelectorAll('.origin-card').forEach(c => c.classList.remove('selected')); if(el) el.classList.add('selected'); }

        function startGame() {
            let name = document.getElementById('inp-name').value;
            if(!name) return alert("è«‹è¼¸å…¥åå­—");
            let o = ORIGIN_DATA.find(x => x.id === selectedOriginId);
            Game = { ...Game, name: name, origin: o.name, money: o.money, intel: o.intel, charm: o.charm, happy: o.happy };
            document.getElementById('scene-creation').style.display='none'; document.getElementById('scene-game').style.display='block';
            document.getElementById('player-name').innerText = Game.name; document.getElementById('player-origin').innerText = Game.origin;
            renderShop(); updateUI(); log(`ğŸ‘¶ ${Game.name} å‡ºç”Ÿäº†ï¼èƒŒæ™¯ï¼š${Game.origin}`);
        }

        function updateUI() {
            ['age', 'health', 'happy', 'intel', 'charm'].forEach(k => { document.getElementById(k).innerText = Game[k]; });
            document.getElementById('year').innerText = new Date().getFullYear() + Game.age;
            let mEl = document.getElementById('money-display'); mEl.innerText = "$"+Game.money.toLocaleString();
            
            // è­¦å‘Šèˆ‡ç‹€æ…‹é¡¯ç¤º
            document.getElementById('alert-debt').style.display = (Game.money < 0) ? 'block' : 'none';
            if(Game.money < 0) { mEl.classList.add('debt'); document.getElementById('alert-debt').innerText = `âš ï¸ è² å‚µè­¦å‘Šï¼é‚„æ¬¾å‰© ${3-Game.debtYears} å¹´`; } else mEl.classList.remove('debt');
            
            // æ†‚é¬±ç‹€æ…‹
            let isDepressed = Game.happy < 20;
            document.getElementById('alert-depression').style.display = isDepressed ? 'block' : 'none';

            // é‡ç—…ç‹€æ…‹
            document.getElementById('alert-sick').style.display = (Game.health < 30) ? 'block' : 'none';

            // é«”åŠ›æ¢
            let bar = document.getElementById('stamina-bar');
            if(Game.stamina < 0) Game.stamina = 0;
            bar.style.width = Game.stamina + "%"; document.getElementById('stamina-text').innerText = Game.stamina+"/100";
            if(Game.stamina < 20) bar.classList.add('low'); else bar.classList.remove('low');

            updateActionButtons(isDepressed);
            
            // ç‰¹æ®ŠæŒ‰éˆ•è§£é–é‚è¼¯
            document.getElementById('btn-dev').style.display = (Game.age >= 18 && Game.intel >= 80) ? 'block' : 'none';
            document.getElementById('btn-stream').style.display = (Game.age >= 18 && Game.charm >= 80) ? 'block' : 'none';

            let nextBtn = document.getElementById('btn-nextyear');
            if(Game.stamina < 10) nextBtn.classList.add('pulse'); else nextBtn.classList.remove('pulse');
            document.getElementById('casino-area').style.display = (Game.age < 18) ? 'none' : 'block';
        }

        function updateActionButtons(isDepressed) {
            let btns = ['work', 'study', 'play', 'gym', 'dev', 'stream'];
            btns.forEach(id => {
                let btn = document.getElementById('btn-'+id);
                if(!btn) return;
                
                // 1. æª¢æŸ¥é«”åŠ›
                let cost = COSTS[id] || 0;
                let enoughStamina = Game.stamina >= cost;
                
                // 2. æª¢æŸ¥æ†‚é¬±ç‹€æ…‹ (æ†‚é¬±æ™‚ä¸èƒ½å·¥ä½œã€ä¸èƒ½é–‹ç™¼)
                let blockedByDepression = isDepressed && (id === 'work' || id === 'dev' || id === 'study');
                
                if(blockedByDepression) {
                    btn.disabled = true;
                    if(id === 'work') btn.innerHTML = `â˜ï¸ å¿ƒæƒ…å¤ªå·®...`;
                } else if(!enoughStamina) {
                    btn.disabled = true;
                } else {
                    btn.disabled = false;
                    // æ¢å¾©æŒ‰éˆ•æ–‡å­— (å¦‚æœæ˜¯å·¥ä½œ)
                    if(id === 'work' && Game.age >= 18) btn.innerHTML = `ğŸ’¼ å·¥ä½œ <span class="cost-tag">âš¡ -30</span>`;
                }
            });
            
            // å¬°å…’æœŸç‰¹æ®Šæ–‡å­— (ç°¡åŒ–è™•ç†)
            if(Game.age <= 3) document.getElementById('btn-work').innerHTML = `ğŸ¼ å–å¥¶ <span class="cost-tag">âš¡ -30</span>`;
        }

        function action(type) {
            if(Game.health <= 0) return alert("å·²æ­»äº¡");
            if(Game.stamina < COSTS[type]) return alert("é«”åŠ›ä¸è¶³");
            
            // ğŸ”¥ ç‰¹æ®Šè·æ¥­é‚è¼¯ ğŸ”¥
            if(type === 'dev_app') {
                Game.stamina -= COSTS.dev_app;
                let success = Math.random() < (Game.intel / 150); // æ™ºåŠ›è¶Šé«˜æˆåŠŸç‡è¶Šé«˜
                if(success) {
                    let profit = 100000 + (Game.intel * 2000);
                    Game.money += profit; Game.happy += 10;
                    log(`ğŸš€ APP é–‹ç™¼å¤§ç²æˆåŠŸï¼è³ºäº† $${profit.toLocaleString()}`);
                } else {
                    Game.happy -= 10;
                    log(`ğŸ› ç¨‹å¼ä¸€å † Bugï¼Œé–‹ç™¼å¤±æ•—...`);
                }
            } 
            else if(type === 'stream') {
                Game.stamina -= COSTS.stream;
                let income = Game.charm * 1000 + (Math.random() * 50000);
                Game.money += Math.floor(income); Game.charm += 1;
                log(`ğŸ¤³ ç›´æ’­å¥½å¤šäººæ–—å…§ï¼è³ºäº† $${Math.floor(income).toLocaleString()}`);
            }
            else {
                // æ™®é€šè¡Œå‹•
                Game.stamina -= COSTS[type];
                if(type === 'work') {
                    if(Game.age <= 3) { log("å–å¥¶ç¡è¦º"); }
                    else if(Game.age < 18) { Game.money+=500; Game.health-=2; log("æ‰“å·¥è³ºäº† $500"); }
                    else { let v=25000+(Game.intel*800); Game.money+=v; Game.health-=3; Game.happy-=5; log(`å·¥ä½œè³ºäº† $${v}`); }
                }
                if(type === 'study') { Game.intel+=4; if(Game.age>=18)Game.money-=2000; log("æ™ºåŠ›+4"); }
                if(type === 'play') { Game.happy+=12; if(Game.age>=18)Game.money-=4000; log("å¿«æ¨‚+12"); }
                if(type === 'gym') { Game.health+=5; Game.charm+=2; if(Game.age>=18)Game.money-=800; log("å¥åº·+5 é­…åŠ›+2"); }
            }
            updateUI();
        }

        function nextYear() {
            if(Game.health <= 0) return;
            Game.age++; Game.health -= 3; Game.stamina = 100; log(`ğŸ‚ ${Game.age} æ­²äº†`);
            
            // å‚µå‹™æª¢æŸ¥
            if(Game.money < 0) { Game.debtYears++; if(Game.debtYears > 3) triggerDebtPunishment(); } else Game.debtYears=0;
            
            // ğŸ”¥ é‡ç—…æ‰£éŒ¢ ğŸ”¥
            if(Game.health < 30) {
                let bill = 50000;
                Game.money -= bill;
                log(`ğŸ¥ èº«é«”å¤ªå·®ä½é™¢äº†ï¼Œæ”¯ä»˜é†«è—¥è²» $${bill}`);
            }

            // è³‡ç”¢è¢«å‹•
            Game.inventory.forEach(id => {
                let c = CAR_DATA.find(x=>x.id==id); if(c) Game.charm+=1;
                let h = HOUSE_DATA.find(x=>x.id==id); if(h) Game.happy+=2;
            });
            
            // éš¨æ©Ÿäº‹ä»¶
            if(Math.random()<0.3 && typeof EVENT_DATA !== 'undefined') {
                let r = Math.floor(Math.random()*EVENT_DATA.length);
                activeEvent = EVENT_DATA[r];
                showModal(activeEvent.title, activeEvent.desc, activeEvent.choices[0].txt, activeEvent.choices[1].txt, 0, 1);
            }
            if(Game.health <= 0) { Game.health = 0; log("ğŸ’€ æ­»äº¡"); }
            updateUI();
        }

        // å…±ç”¨å‡½æ•¸
        function showModal(t, d, b1, b2, i1, i2) { document.getElementById('ev-title').innerText=t; document.getElementById('ev-desc').innerText=d; let ba=document.getElementById('btn-choice-a'), bb=document.getElementById('btn-choice-b'); ba.onclick=()=>resolveEvent(i1); bb.onclick=()=>resolveEvent(i2); ba.innerText=b1; bb.innerText=b2; document.getElementById('event-modal').style.display='flex'; }
        function resolveEvent(i) { let r=activeEvent.choices[i].effect(Game); log(`âš¡ ${r}`); document.getElementById('event-modal').style.display='none'; updateUI(); }
        function triggerDebtPunishment() { Game.inventory=[]; Game.money=0; Game.happy-=50; activeEvent={choices:[{effect:()=>"è³‡ç”¢å……å…¬"}]}; showModal("ç ´ç”¢", "æœŸé™å·²åˆ°ï¼Œå¼·åˆ¶é‚„æ¬¾", "èªå‘½", "èªå‘½", 0, 0); }
        function renderShop() { if(typeof CAR_DATA==='undefined')return; let ch="", hh=""; CAR_DATA.forEach(c=>ch+=renderItem(c,'car')); HOUSE_DATA.forEach(h=>hh+=renderItem(h,'house')); document.getElementById('car-shop').innerHTML=ch; document.getElementById('house-shop').innerHTML=hh; }
        function renderItem(i,t) { return `<div style="display:flex;justify-content:space-between;margin-bottom:10px;border-bottom:1px solid #333;"><div style="display:flex;"><img src="${i.img}" class="item-img" onerror="this.style.display='none'"><div><b>${i.name}</b><br><span style="color:#888;font-size:0.8em">${t=='car'?'é­…åŠ›+'+i.charm:'å¿«æ¨‚+'+i.happy}</span></div></div><button class="btn-buy" onclick="buy('${t}','${i.id}')">$${i.price/10000}è¬</button></div>`; }
        function buy(t,id) { let i = t=='car'?CAR_DATA.find(x=>x.id==id):HOUSE_DATA.find(x=>x.id==id); if(Game.inventory.includes(id))return alert("å·²æ“æœ‰"); if(Game.money>=i.price){Game.money-=i.price;Game.inventory.push(id);log(`è³¼è²· ${i.name}`);updateUI();}else alert("éŒ¢ä¸å¤ "); }
        function gamble(c) { let v=parseInt(document.getElementById('bet-amount').value); if(!v)return; if(Game.stamina<5)return alert("é«”åŠ›ä¸è¶³"); Game.stamina-=5; let d=Math.floor(Math.random()*10), r=d>=5?'big':'small'; if(c==r){Game.money+=v;log(`è´ $${v}`);}else{Game.money-=v;log(`è¼¸ $${v}`);} updateUI(); }
        function nav(p){ document.querySelectorAll('.page').forEach(e=>e.classList.remove('active')); document.getElementById('page-'+p).classList.add('active'); }
        function restartGame(){ location.reload(); }

        initCreation();
    </script>
</body>
</html>
