<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™‚äº‹äººç”Ÿ V9.0ï¼šå‚µå‹™å±æ©Ÿ</title>
    <style>
        :root { --bg: #121212; --card: #1e1e1e; --accent: #bb86fc; --text: #e0e0e0; --green: #03dac6; --red: #cf6679; --gold: #ffd700; --blue: #2196f3; }
        body { font-family: 'å¾®è»Ÿæ­£é»‘é«”', sans-serif; background: var(--bg); color: var(--text); max-width: 600px; margin: 0 auto; padding-bottom: 80px; user-select: none; overflow-x: hidden; }
        
        .header { background: #2c2c2c; padding: 10px 15px; position: sticky; top: 0; z-index: 50; box-shadow: 0 2px 8px rgba(0,0,0,0.6); }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; font-size: 0.9em; text-align: center; }
        
        /* ğŸ”¥ é‡‘éŒ¢é¡¯ç¤ºå„ªåŒ–ï¼šè² å‚µæ™‚è®Šç´… ğŸ”¥ */
        .big-stat { font-size: 1.2em; font-weight: bold; color: var(--gold); grid-column: span 3; margin-bottom: 5px; transition: color 0.3s; }
        .big-stat.debt { color: var(--red); animation: shake 0.5s; }
        
        /* ğŸ”¥ å‚µå‹™è­¦å‘Šæ¢ ğŸ”¥ */
        .debt-warning { grid-column: span 3; background: #b00020; color: white; font-weight: bold; font-size: 0.8em; padding: 5px; border-radius: 4px; display: none; animation: pulseRed 1s infinite; }

        .stamina-container { grid-column: span 3; margin-top: 5px; text-align: left; }
        .stamina-label { font-size: 0.8em; color: var(--blue); margin-bottom: 2px; display: flex; justify-content: space-between; }
        .progress-bg { background: #444; height: 8px; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--blue); transition: width 0.3s ease; }
        .progress-fill.low { background: var(--red); }

        /* é€šç”¨ UI */
        .img-banner { width: 100%; height: 150px; object-fit: cover; border-radius: 8px 8px 0 0; display: block; background: #333; }
        .item-img { width: 60px; height: 60px; object-fit: cover; border-radius: 8px; margin-right: 10px; background: #333; }
        .card { background: var(--card); border-radius: 10px; margin: 15px 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); overflow: hidden; }
        .card-body { padding: 15px; }
        .card h3 { margin-top: 0; color: var(--accent); border-bottom: 1px solid #333; padding-bottom: 10px; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button { background: #333; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; transition: 0.2s; font-size: 1em; position: relative; overflow: hidden; }
        button:hover { background: #444; filter: brightness(1.2); }
        button:disabled { opacity: 0.4; cursor: not-allowed; filter: grayscale(1); }
        .cost-tag { font-size: 0.7em; color: #aaa; display: block; margin-top: 2px; }
        .btn-buy { background: var(--green); color: black; font-weight: bold; }
        .btn-risk { background: var(--red); color: white; }
        .btn-main { background: var(--accent); color: black; font-weight: bold; width: 100%; margin-top: 10px; font-size: 1.1em; }
        .btn-main.pulse { animation: pulse 1.5s infinite; }

        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: #000; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #333; z-index: 50; }
        .nav-item { color: #888; cursor: pointer; text-align: center; font-size: 0.8em; }
        .nav-item.active { color: var(--accent); font-weight: bold; }
        .nav-icon { display: block; font-size: 1.5em; margin-bottom: 2px; }

        .page { display: none; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        .log-box { height: 120px; overflow-y: auto; background: #111; padding: 10px; border-radius: 5px; font-size: 0.9em; color: #ccc; border: 1px solid #333; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 100; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-box { background: var(--card); width: 85%; max-width: 400px; padding: 20px; border-radius: 12px; border: 1px solid var(--accent); text-align: center; box-shadow: 0 0 20px rgba(187, 134, 252, 0.2); animation: popIn 0.3s; }
        .modal-title { font-size: 1.4em; color: var(--gold); margin-bottom: 10px; font-weight: bold; }
        .modal-desc { margin-bottom: 20px; font-size: 1.1em; line-height: 1.5; }
        .modal-btn { width: 100%; margin-bottom: 10px; padding: 15px; border: 1px solid #444; }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(187, 134, 252, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(187, 134, 252, 0); } 100% { box-shadow: 0 0 0 0 rgba(187, 134, 252, 0); } }
        @keyframes pulseRed { 0% { opacity: 0.8; } 50% { opacity: 1; } 100% { opacity: 0.8; } }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 100% { transform: translateX(0); } }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="header">
        <div class="stat-grid">
            <div class="big-stat" id="money-display">$0</div>
            
            <div id="debt-alert" class="debt-warning">âš ï¸ éŠ€è¡Œè­¦å‘Šï¼šè«‹åœ¨ 3 å¹´å…§é‚„æ¸…å‚µå‹™ï¼</div>
            
            <div>ğŸ“… <span id="year">2025</span> (<span id="age">0</span>æ­²)</div>
            <div>â¤ï¸ <span id="health">100</span></div>
            <div>ğŸ˜Š <span id="happy">80</span></div>
            
            <div class="stamina-container">
                <div class="stamina-label"><span>âš¡ é«”åŠ›</span><span id="stamina-text">100/100</span></div>
                <div class="progress-bg"><div id="stamina-bar" class="progress-fill" style="width: 100%;"></div></div>
            </div>
        </div>
    </div>

    <div id="event-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-title" id="ev-title"></div>
            <div class="modal-desc" id="ev-desc"></div>
            <button class="modal-btn" id="btn-choice-a">é¸é … A</button>
            <button class="modal-btn" id="btn-choice-b">é¸é … B</button>
        </div>
    </div>

    <div id="page-home" class="page active">
        <div class="card">
            <img src="images/banner-home.jpg" class="img-banner" onerror="this.src='https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=600'">
            <div class="card-body">
                <h3>ğŸ“ å¹´åº¦è¡Œå‹•</h3>
                <div class="btn-grid">
                    <button onclick="action('work')" id="btn-work">ğŸ’¼ å·¥ä½œè³ºéŒ¢<span class="cost-tag">âš¡ -30</span></button>
                    <button onclick="action('study')" id="btn-study">ğŸ“š é€²ä¿®æ™ºåŠ›<span class="cost-tag">âš¡ -20</span></button>
                    <button onclick="action('play')" id="btn-play">ğŸ® ç©æ¨‚æ”¾é¬†<span class="cost-tag">âš¡ -10</span></button>
                    <button onclick="action('gym')" id="btn-gym">ğŸ‹ï¸ å¥èº«é‹å‹•<span class="cost-tag">âš¡ -25</span></button>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <h3>ğŸ“œ äººç”Ÿå‹•æ…‹</h3>
                <div id="game-log" class="log-box"></div>
                <button class="btn-main" id="btn-nextyear" onclick="nextYear()">ğŸ‚ ä¸‹ä¸€æ­² (é«”åŠ›å›æ»¿)</button>
            </div>
        </div>
    </div>

    <div id="page-assets" class="page">
        <div class="card"><div class="card-body"><h3>ğŸï¸ è±ªè»Šè»Šåº«</h3><div id="car-shop"></div></div></div>
        <div class="card"><div class="card-body"><h3>ğŸ˜ï¸ æˆ¿ç”¢åœ°å¥‘</h3><div id="house-shop"></div></div></div>
    </div>
    <div id="page-casino" class="page"><div class="card"><div class="card-body"><h3>ğŸ° çš‡å®¶è³­å ´</h3><input type="number" id="bet-amount" placeholder="é‡‘é¡" style="width:90%;padding:10px;margin-bottom:10px"><div class="btn-grid"><button class="btn-risk" onclick="gamble('big')">å¤§</button><button class="btn-risk" onclick="gamble('small')">å°</button></div><p id="casino-msg"></p></div></div></div>
    <div id="page-profile" class="page"><div class="card"><div class="card-body"><h3>ğŸ† æˆå°±</h3><div id="achievement-list"></div><button onclick="restartGame()" style="width:100%;margin-top:100px">é‡ä¾†</button></div></div></div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="nav('home')"><span class="nav-icon">ğŸ </span>ç”Ÿæ´»</div>
        <div class="nav-item" onclick="nav('assets')"><span class="nav-icon">ğŸï¸</span>è³‡ç”¢</div>
        <div class="nav-item" onclick="nav('casino')"><span class="nav-icon">ğŸ°</span>è³­å ´</div>
        <div class="nav-item" onclick="nav('profile')"><span class="nav-icon">ğŸ†</span>æˆå°±</div>
    </div>

    <script src="data.js"></script>
    <script>
        // --- éŠæˆ²å¼•æ“ ---
        let Game = { 
            age: 18, money: 5000, health: 100, happy: 80, intel: 40, charm: 30, 
            stamina: 100, 
            debtYears: 0, // ğŸ”¥ æ–°å¢ï¼šå‚µå‹™è¨ˆæ™‚å™¨
            inventory: [], achievements: [] 
        };
        const COSTS = { work: 30, study: 20, play: 10, gym: 25 };
        let activeEvent = null;

        function init() { renderShop(); updateUI(); log("V9.0 å‚µå‹™ç³»çµ±ä¸Šç·šï¼è«‹å°å¿ƒç†è²¡ã€‚"); }

        function updateUI() {
            ['age', 'health', 'happy', 'intel', 'charm'].forEach(k => { let el=document.getElementById(k); if(el) el.innerText = Game[k]; });
            
            let moneyEl = document.getElementById('money-display');
            moneyEl.innerText = "$" + Game.money.toLocaleString();

            // ğŸ”¥ å‚µå‹™è¦–è¦ºæ•ˆæœ
            let alertBox = document.getElementById('debt-alert');
            if (Game.money < 0) {
                moneyEl.classList.add('debt'); // è®Šç´…
                alertBox.style.display = 'block';
                let timeLeft = 3 - Game.debtYears;
                alertBox.innerText = `âš ï¸ åš´é‡è­¦å‘Šï¼šè² å‚µï¼è«‹åœ¨ ${timeLeft} å¹´å…§é‚„æ¸…ï¼Œå¦å‰‡å°‡è¢«å‘Šä¸Šæ³•é™¢ï¼`;
            } else {
                moneyEl.classList.remove('debt');
                alertBox.style.display = 'none';
            }

            // é«”åŠ›æ¢
            let bar = document.getElementById('stamina-bar');
            let text = document.getElementById('stamina-text');
            if(Game.stamina < 0) Game.stamina = 0;
            bar.style.width = Game.stamina + "%";
            text.innerText = Game.stamina + "/100";
            if(Game.stamina < 20) bar.classList.add('low'); else bar.classList.remove('low');

            checkButtonState('btn-work', COSTS.work);
            checkButtonState('btn-study', COSTS.study);
            checkButtonState('btn-play', COSTS.play);
            checkButtonState('btn-gym', COSTS.gym);

            let nextBtn = document.getElementById('btn-nextyear');
            if(Game.stamina < 10) nextBtn.classList.add('pulse'); else nextBtn.classList.remove('pulse');
        }

        function checkButtonState(btnId, cost) {
            document.getElementById(btnId).disabled = (Game.stamina < cost);
        }

        function log(msg) { 
            let box = document.getElementById('game-log'); 
            box.innerHTML = `<div style="margin-bottom:6px;border-bottom:1px solid #333;">[${Game.age}æ­²] ${msg}</div>` + box.innerHTML; 
        }

        function action(type) {
            if(Game.health <= 0) return alert("å·²æ­»äº¡");
            if(Game.stamina < COSTS[type]) return alert("é«”åŠ›ä¸è¶³ï¼è«‹æŒ‰ã€Œä¸‹ä¸€æ­²ã€ä¼‘æ¯ã€‚");
            
            Game.stamina -= COSTS[type];

            if(type === 'work') { let v = 25000+(Game.intel*800); Game.money+=v; Game.health-=3; Game.happy-=5; log(`å·¥ä½œè³ºäº† $${v}`); }
            if(type === 'study') { Game.intel+=4; Game.money-=2000; log("é€²ä¿®æ™ºåŠ›+4"); }
            if(type === 'play') { Game.happy+=12; Game.money-=4000; log("ç©æ¨‚å¿«æ¨‚+12"); }
            if(type === 'gym') { Game.health+=5; Game.charm+=2; Game.money-=800; log("å¥èº«å¥åº·+5"); }

            updateUI();
        }

        function nextYear() {
            if(Game.health <= 0) return;

            Game.age++;
            Game.health -= 3;
            Game.stamina = 100;
            log("ğŸ’¤ ä¼‘æ¯äº†ä¸€å¹´ï¼Œé«”åŠ›å…¨æ»¿ï¼");

            // ğŸ”¥ å‚µå‹™æª¢æŸ¥é‚è¼¯ (æ ¸å¿ƒæ›´æ–°) ğŸ”¥
            if (Game.money < 0) {
                Game.debtYears++;
                log(`âš ï¸ ä½ æ­£è™•æ–¼è² å‚µç‹€æ…‹ï¼(ç¬¬ ${Game.debtYears} å¹´)`);
                
                if (Game.debtYears > 3) {
                    // è§¸ç™¼å¼·åˆ¶é‚„æ¬¾äº‹ä»¶
                    triggerDebtPunishment();
                    // æ‡²ç½°å®Œç•¢ï¼Œé‡ç½®è¨ˆæ™‚å™¨
                    Game.debtYears = 0;
                }
            } else {
                // å¦‚æœéŒ¢æ˜¯æ­£çš„ï¼Œå‚µå‹™è¨ˆæ™‚å™¨æ­¸é›¶
                Game.debtYears = 0;
            }

            // è³‡ç”¢åŠ æˆ
            Game.inventory.forEach(id => {
                let car = CAR_DATA.find(c => c.id === id); if(car) Game.charm += 1;
                let house = HOUSE_DATA.find(h => h.id === id); if(house) Game.happy += 2;
            });

            // éš¨æ©Ÿäº‹ä»¶
            if(Math.random() < 0.3 && typeof EVENT_DATA !== 'undefined') {
                let randIndex = Math.floor(Math.random() * EVENT_DATA.length);
                activeEvent = EVENT_DATA[randIndex];
                showModal(activeEvent.title, activeEvent.desc, activeEvent.choices[0].txt, activeEvent.choices[1].txt, 0, 1);
            }
            
            if(Game.health <= 0) Game.health = 0;
            updateUI();
        }

        // ğŸ”¥ å¼·åˆ¶é‚„æ¬¾æ‡²ç½°äº‹ä»¶ ğŸ”¥
        function triggerDebtPunishment() {
            let punishMsg = "ğŸ‘® æ³•é™¢å¼·åˆ¶åŸ·è¡Œï¼š";
            let lostAssets = false;
            
            // 1. å¼·åˆ¶è®Šè³£è³‡ç”¢ (å¦‚æœæœ‰çš„è©±)
            if (Game.inventory.length > 0) {
                Game.inventory = []; // æ¸…ç©ºæ‰€æœ‰è³‡ç”¢
                punishMsg += "ä½ çš„è»Šå­å’Œæˆ¿å­å…¨éƒ¨è¢«éŠ€è¡ŒæŸ¥å°æ‹è³£æŠµå‚µï¼";
                lostAssets = true;
                // å‡è¨­æ‹è³£å¾ŒéŒ¢å›åˆ° 0 (ç¨å¾®ä»æ…ˆä¸€é»)
                Game.money = 0;
            } else {
                punishMsg += "ä½ åä¸‹ç„¡è²¡ç”¢å¯æ‰£æŠ¼ã€‚";
            }

            // 2. é¡å¤–æ‡²ç½°
            Game.happy -= 50;
            Game.health -= 20;
            punishMsg += " ä½ å› æ¬ å‚µè¢«å‘Šä¸Šæ³•é™¢ï¼Œèº«å¿ƒä¿±ç–² (å¿«æ¨‚-50, å¥åº·-20)ã€‚";

            // 3. é¡¯ç¤ºå½ˆçª—å‘ŠçŸ¥ç©å®¶
            // é€™è£¡æˆ‘å€‘æ‰‹å‹•é€ ä¸€å€‹äº‹ä»¶å½ˆçª—
            activeEvent = {
                choices: [
                    { effect: (p) => { return "å¸Œæœ›èƒ½è¨˜å–æ•™è¨“..."; } },
                    { effect: (p) => { return "å¸Œæœ›èƒ½è¨˜å–æ•™è¨“..."; } } // å…©å€‹é¸é …ä¸€æ¨£
                ]
            };
            
            showModal("âš–ï¸ å‚µå‹™åˆ°æœŸ", punishMsg, "æˆ‘ç ´ç”¢äº†...", "äººç”Ÿå¥½é›£...", 0, 0);
        }

        function showModal(title, desc, btnAtxt, btnBtxt, idxA, idxB) {
            document.getElementById('ev-title').innerText = title;
            document.getElementById('ev-desc').innerText = desc;
            let btnA = document.getElementById('btn-choice-a');
            let btnB = document.getElementById('btn-choice-b');
            btnA.onclick = function() { resolveEvent(idxA); };
            btnB.onclick = function() { resolveEvent(idxB); };
            btnA.innerText = btnAtxt;
            btnB.innerText = btnBtxt;
            document.getElementById('event-modal').style.display = 'flex';
        }

        function resolveEvent(idx) {
            let resultText = activeEvent.choices[idx].effect(Game);
            log(`âš¡ [çµæœ] ${resultText}`);
            document.getElementById('event-modal').style.display = 'none';
            updateUI();
        }

        // å•†åº—èˆ‡å…¶ä»–åŠŸèƒ½
        function renderShop() {
            if(typeof CAR_DATA === 'undefined') return;
            let carHtml = ""; CAR_DATA.forEach(c => { carHtml += `<div style="display:flex;justify-content:space-between;margin-bottom:10px;border-bottom:1px solid #333;"><div style="display:flex;"><img src="${c.img}" class="item-img" onerror="this.style.display='none'"><div><b>${c.name}</b><br><span style="color:#888;font-size:0.8em">é­…åŠ›+${c.charm}</span></div></div><button class="btn-buy" onclick="buy('car', '${c.id}')">$${c.price/10000}è¬</button></div>`; }); document.getElementById('car-shop').innerHTML = carHtml;
            let houseHtml = ""; HOUSE_DATA.forEach(h => { houseHtml += `<div style="display:flex;justify-content:space-between;margin-bottom:10px;border-bottom:1px solid #333;"><div style="display:flex;"><img src="${h.img}" class="item-img" onerror="this.style.display='none'"><div><b>${h.name}</b><br><span style="color:#888;font-size:0.8em">å¿«æ¨‚+${h.happy}</span></div></div><button class="btn-buy" onclick="buy('house', '${h.id}')">$${h.price/10000}è¬</button></div>`; }); document.getElementById('house-shop').innerHTML = houseHtml;
        }
        function buy(type, id) {
            let item = type === 'car' ? CAR_DATA.find(c => c.id === id) : HOUSE_DATA.find(h => h.id === id);
            if(Game.inventory.includes(id)) return alert("å·²æ“æœ‰ï¼");
            if(Game.money >= item.price) { Game.money -= item.price; Game.inventory.push(id); log(`ğŸ‰ è³¼è²·æˆåŠŸï¼š${item.name}`); updateUI(); } else alert("éŒ¢ä¸å¤ ï¼");
        }
        function gamble(c){ 
            let v=parseInt(document.getElementById('bet-amount').value);
            if(!v)return alert("é‡‘é¡éŒ¯èª¤"); // å…è¨±è² å‚µè³­åšç¿»èº«ï¼
            if(Game.stamina < 5) return alert("é«”åŠ›ä¸è¶³");
            Game.stamina -= 5;
            let d=Math.floor(Math.random()*10);
            let r=d>=5?'big':'small';
            if(c===r){Game.money+=v;log(`è³­åšè´äº† $${v}`);}else{Game.money-=v;log(`è³­åšè¼¸äº† $${v}`);}
            updateUI();
        }
        function nav(p){ document.querySelectorAll('.page').forEach(e=>e.classList.remove('active')); document.getElementById('page-'+p).classList.add('active'); }
        function restartGame(){ location.reload(); }

        init();
    </script>
</body>
</html>
